/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[g]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var g=0;return $jscomp.iteratorPrototype(function(){return g<a.length?{done:!1,value:a[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var g=a[Symbol.iterator];return g?g.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var g,f=[];!(g=a.next()).done;)f.push(g.value);return f};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.checkStringArgs=function(a,g,f){if(null==a)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return a+""};
$jscomp.polyfill=function(a,g,f,c){if(g){f=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var d=a[c];d in f||(f[d]={});f=f[d]}a=a[a.length-1];c=f[a];g=g(c);g!=c&&null!=g&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,f){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var d=c.length,b=a.length,e=Math.max(0,Math.min(f|0,c.length)),g=0;g<b&&e<d;)if(c[e++]!=a[g++])return!1;return g>=b}},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,f){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,f||0)}},"es6-impl","es3");
$jscomp.owns=function(a,g){return Object.prototype.hasOwnProperty.call(a,g)};
$jscomp.polyfill("WeakMap",function(a){function g(b){$jscomp.owns(b,c)||$jscomp.defineProperty(b,c,{value:{}})}function f(b){var a=Object[b];a&&(Object[b]=function(b){g(b);return a(b)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d["delete"](b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(m){return!1}}())return a;var c="$jscomp_hidden_"+Math.random().toString().substring(2);f("freeze");f("preventExtensions");
f("seal");var d=0,b=function(b){this.id_=(d+=Math.random()+1).toString();if(b){$jscomp.initSymbol();$jscomp.initSymbolIterator();b=$jscomp.makeIterator(b);for(var a;!(a=b.next()).done;)a=a.value,this.set(a[0],a[1])}};b.prototype.set=function(b,a){g(b);if(!$jscomp.owns(b,c))throw Error("WeakMap key fail: "+b);b[c][this.id_]=a;return this};b.prototype.get=function(b){return $jscomp.owns(b,c)?b[c][this.id_]:void 0};b.prototype.has=function(b){return $jscomp.owns(b,c)&&$jscomp.owns(b[c],this.id_)};b.prototype["delete"]=
function(b){return $jscomp.owns(b,c)&&$jscomp.owns(b[c],this.id_)?delete b[c][this.id_]:!1};return b},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),e=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=e.get(b)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var c=e.entries(),d=c.next();if(d.done||d.value[0]!=b||"s"!=d.value[1])return!1;d=c.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!c.next().done?!1:!0}catch(p){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var g=new WeakMap,f=function(a){this.data_={};this.head_=b();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var e;!(e=a.next()).done;)e=e.value,this.set(e[0],e[1])}};f.prototype.set=function(b,a){var e=c(this,b);e.list||(e.list=this.data_[e.id]=[]);e.entry?e.entry.value=a:(e.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,value:a},e.list.push(e.entry),this.head_.previous.next=e.entry,this.head_.previous=e.entry,this.size++);return this};f.prototype["delete"]=
function(b){b=c(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};f.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=b();this.size=0};f.prototype.has=function(b){return!!c(this,b).entry};f.prototype.get=function(b){return(b=c(this,b).entry)&&b.value};f.prototype.entries=function(){return d(this,function(b){return[b.key,
b.value]})};f.prototype.keys=function(){return d(this,function(b){return b.key})};f.prototype.values=function(){return d(this,function(b){return b.value})};f.prototype.forEach=function(b,a){for(var e=this.entries(),c;!(c=e.next()).done;)c=c.value,b.call(a,c[1],c[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var c=function(b,a){var c;c=a&&typeof a;"object"==c||"function"==c?g.has(a)?c=g.get(a):(c=""+ ++e,g.set(a,c)):c="p_"+a;var d=b.data_[c];if(d&&$jscomp.owns(b.data_,c))for(var f=0;f<
d.length;f++){var h=d[f];if(a!==a&&h.key!==h.key||a===h.key)return{id:c,list:d,index:f,entry:h}}return{id:c,list:d,index:-1,entry:void 0}},d=function(b,a){var e=b.head_;return $jscomp.iteratorPrototype(function(){if(e){for(;e.head!=b.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:a(e)};e=null}return{done:!0,value:void 0}})},b=function(){var b={};return b.previous=b.next=b.head=b},e=0;return f},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),c=new a($jscomp.makeIterator([f]));if(!c.has(f)||1!=c.size||c.add(f)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var d=c.entries(),b=d.next();if(b.done||b.value[0]!=f||b.value[1]!=f)return!1;b=d.next();return b.done||b.value[0]==f||4!=b.value[0].x||b.value[1]!=b.value[0]?!1:d.next().done}catch(e){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var g=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)this.add(c.value)}this.size=this.map_.size};g.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};g.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};g.prototype.clear=function(){this.map_.clear();this.size=0};g.prototype.has=function(a){return this.map_.has(a)};g.prototype.entries=
function(){return this.map_.entries()};g.prototype.values=function(){return this.map_.values()};g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(a,c){var d=this;this.map_.forEach(function(b){return a.call(c,b,b,d)})};return g},"es6-impl","es3");$jscomp.findInternal=function(a,g,f){a instanceof String&&(a=String(a));for(var c=a.length,d=0;d<c;d++){var b=a[d];if(g.call(f,b,d,a))return{i:d,v:b}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,f){return $jscomp.findInternal(this,a,f).v}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,g){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,c={next:function(){if(f<a.length){var d=f++;return{value:g(d,a[d]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");$jscomp.polyfill("Array.from",function(a){return a?a:function(a,f,c){$jscomp.initSymbolIterator();f=null!=f?f:function(b){return b};var d=[],b=a[Symbol.iterator];if("function"==typeof b)for(a=b.call(a);!(b=a.next()).done;)d.push(f.call(c,b.value));else for(var b=a.length,e=0;e<b;e++)d.push(f.call(c,a[e]));return d}},"es6-impl","es3");
$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6-impl","es3");$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,f){var c=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===f&&(f=c.length);for(var d=Math.max(0,Math.min(f|0,c.length)),b=a.length;0<b&&0<d;)if(c[--d]!=a[--b])return!1;return 0>=b}},"es6-impl","es3");$jscomp.polyfill("Number.isNaN",function(a){return a?a:function(a){return"number"===typeof a&&isNaN(a)}},"es6-impl","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,f){return $jscomp.findInternal(this,a,f).i}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,f){return[a,f]})}},"es6-impl","es3");
$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,f){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var b in d)$jscomp.owns(d,b)&&(a[b]=d[b])}return a}},"es6-impl","es3");$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var f=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=f),a>>>=1)f+=f;return c}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,f){return f})}},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6-impl","es3");$jscomp.polyfill("Number.isSafeInteger",function(a){return a?a:function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER}},"es6-impl","es3");
var jstz=function(){var a={"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],
"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk",
"Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]},g=function(b){b=-b.getTimezoneOffset();return null!==b?b:0},f=function(){var b=g(new Date(2014,0,2)),a=g(new Date(2014,5,2)),e=b-a;return 0>e?b+",1":0<e?a+",1,s":b+",0"},c=function(){var b;if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat&&(b=Intl.DateTimeFormat(),"undefined"!==typeof b&&"undefined"!==typeof b.resolvedOptions&&(b=b.resolvedOptions().timeZone)&&(-1<b.indexOf("/")||
"UTC"===b)))return b},d=function m(b,a,e){"undefined"===typeof a&&(a=864E5,e=36E5);var c=(new Date(b.getTime()-a)).getTime();b=b.getTime()+a;for(var d=(new Date(c)).getTimezoneOffset(),f=null;c<b-e;){var g=new Date(c);if(g.getTimezoneOffset()!==d){f=g;break}c+=e}return 864E5===a?m(f,36E5,6E4):36E5===a?m(f,6E4,1E3):f},b=function(b,a,e,c){if("N/A"!==e)return e;if("Asia/Beirut"===a){if("Africa/Cairo"===c.name&&13983768E5===b[6].s&&14116788E5===b[6].e||"Asia/Jerusalem"===c.name&&13959648E5===b[6].s&&
14118588E5===b[6].e)return 0}else if("America/Santiago"===a){if("America/Asuncion"===c.name&&14124816E5===b[6].s&&1397358E6===b[6].e||"America/Campo_Grande"===c.name&&14136912E5===b[6].s&&13925196E5===b[6].e)return 0}else if("America/Montevideo"===a){if("America/Sao_Paulo"===c.name&&14136876E5===b[6].s&&1392516E6===b[6].e)return 0}else if("Pacific/Auckland"===a&&"Pacific/Fiji"===c.name&&14142456E5===b[6].s&&13961016E5===b[6].e)return 0;return e},e=function(e,c){for(var d={},f=jstz.olson.dst_rules.zones,
g=f.length,h=a[c],m=0;m<g;m++){var n=f[m],y;y=f[m];for(var z=0,q=0;q<e.length;q++)if(y.rules[q]&&e[q]){if(e[q].s>=y.rules[q].s&&e[q].e<=y.rules[q].e)z=0,z+=Math.abs(e[q].s-y.rules[q].s),z+=Math.abs(y.rules[q].e-e[q].e);else{z="N/A";break}if(864E6<z){z="N/A";break}}y=z=b(e,c,z,y);"N/A"!==y&&(d[n.name]=y)}for(var F in d)if(d.hasOwnProperty(F))for(f=0;f<h.length;f++)if(h[f]===F)return F;return c},h=function(b){var a=function(){for(var b=[],a=0;a<jstz.olson.dst_rules.years.length;a++){var e;e=jstz.olson.dst_rules.years[a];
var c=(new Date(e,0,1,0,0,1,0)).getTime();e=(new Date(e,12,31,23,59,59)).getTime();for(var f=(new Date(c)).getTimezoneOffset(),g=null,h=null;c<e-864E5;){var m=new Date(c),n=m.getTimezoneOffset();n!==f&&(n<f&&(g=m),n>f&&(h=m),f=n);c+=864E5}e=g&&h?{s:d(g).getTime(),e:d(h).getTime()}:!1;b.push(e)}return b}();return function(b){for(var a=0;a<b.length;a++)if(!1!==b[a])return!0;return!1}(a)?e(a,b):b};return{determine:function(){var b=c();b||(b=jstz.olson.timezones[f()],"undefined"!==typeof a[b]&&(b=h(b)));
return{name:function(){return b}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"Africa/Casablanca",rules:[{e:12202236E5,s:12122784E5},{e:12508092E5,s:12438144E5},{e:1281222E6,s:12727584E5},{e:13120668E5,s:13017888E5},{e:13489704E5,s:1345428E6},{e:13828392E5,s:13761E8},{e:14142888E5,s:14069448E5}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},
{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,
s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,
s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,
s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},{e:1414314E6,s:13967784E5}]},{name:"America/Santiago",rules:[{e:1206846E6,s:1223784E6},{e:1237086E6,s:12552336E5},{e:127035E7,s:12866832E5},{e:13048236E5,s:13138992E5},{e:13356684E5,s:13465584E5},{e:1367118E6,s:13786128E5},{e:13985676E5,s:14100624E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,
s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,
s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:1414098E6,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,
s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,
s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},
{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,
s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},
{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]},{name:"Europe/London",rules:[{e:12249828E5,s:12068388E5},{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]}]};(function(a,g){"object"==typeof module&&module.exports?module.exports=g():"function"==typeof define&&define.amd?define(g):a.Spinner=g()})(this,function(){function a(b,a){var e=document.createElement(b||"div"),c;for(c in a)e[c]=a[c];return e}function g(b){for(var a=1,e=arguments.length;a<e;a++)b.appendChild(arguments[a]);return b}function f(b,a,e,c){var d=["opacity",a,~~(100*b),e,c].join("-");e=.01+e/c*100;c=Math.max(1-(1-b)/a*(100-e),b);var f=p.substring(0,p.indexOf("Animation")).toLowerCase();n[d]||
(v.insertRule("@"+(f&&"-"+f+"-"||"")+"keyframes "+d+"{0%{opacity:"+c+"}"+e+"%{opacity:"+b+"}"+(e+.01)+"%{opacity:1}"+(e+a)%100+"%{opacity:"+b+"}100%{opacity:"+c+"}}",v.cssRules.length),n[d]=1);return d}function c(b,a){var e=b.style,c,d;a=a.charAt(0).toUpperCase()+a.slice(1);if(void 0!==e[a])return a;for(d=0;d<m.length;d++)if(c=m[d]+a,void 0!==e[c])return c}function d(b,a){for(var e in a)b.style[c(b,e)||e]=a[e];return b}function b(b){for(var a=1;a<arguments.length;a++){var e=arguments[a],c;for(c in e)void 0===
b[c]&&(b[c]=e[c])}return b}function e(b,a){return"string"==typeof b?b:b[a%b.length]}function h(a){this.opts=b(a||{},h.defaults,r)}function l(){function b(b,e){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',e)}v.addRule(".spin-vml","behavior:url(#default#VML)");h.prototype.lines=function(a,c){function f(){return d(b("group",{coordsize:l+" "+l,coordorigin:-m+" "+-m}),{width:l,height:l})}function h(a,h,l){g(n,g(d(f(),{rotation:360/c.lines*a+"deg",left:~~h}),g(d(b("roundrect",
{arcsize:c.corners}),{width:m,height:c.scale*c.width,left:c.scale*c.radius,top:-c.scale*c.width>>1,filter:l}),b("fill",{color:e(c.color,a),opacity:c.opacity}),b("stroke",{opacity:0}))))}var m=c.scale*(c.length+c.width),l=2*c.scale*m,w=-(c.width+c.length)*c.scale*2+"px",n=d(f(),{position:"absolute",top:w,left:w});if(c.shadow)for(w=1;w<=c.lines;w++)h(w,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(w=1;w<=c.lines;w++)h(w);return g(a,n)};h.prototype.opacity=
function(b,a,e,c){b=b.firstChild;c=c.shadow&&c.lines||0;b&&a+c<b.childNodes.length&&(b=(b=(b=b.childNodes[a+c])&&b.firstChild)&&b.firstChild)&&(b.opacity=e)}}var m=["webkit","Moz","ms","O"],n={},p,v,r={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};h.defaults={};b(h.prototype,{spin:function(b){this.stop();var e=this,c=e.opts,f=
e.el=a(null,{className:c.className});d(f,{position:c.position,width:0,zIndex:c.zIndex,left:c.left,top:c.top});b&&b.insertBefore(f,b.firstChild||null);f.setAttribute("role","progressbar");e.lines(f,e.opts);if(!p){var g=0,h=(c.lines-1)*(1-c.direction)/2,m,l=c.fps,w=l/c.speed,n=(1-c.opacity)/(w*c.trail/100),u=w/c.lines;(function H(){g++;for(var b=0;b<c.lines;b++)m=Math.max(1-(g+(c.lines-b)*u)%w*n,c.opacity),e.opacity(f,b*c.direction+h,m,c);e.timeout=e.el&&setTimeout(H,~~(1E3/l))})()}return e},stop:function(){var b=
this.el;b&&(clearTimeout(this.timeout),b.parentNode&&b.parentNode.removeChild(b),this.el=void 0);return this},lines:function(b,c){function h(b,e){return d(a(),{position:"absolute",width:c.scale*(c.length+c.width)+"px",height:c.scale*c.width+"px",background:b,boxShadow:e,transformOrigin:"left",transform:"rotate("+~~(360/c.lines*m+c.rotate)+"deg) translate("+c.scale*c.radius+"px,0)",borderRadius:(c.corners*c.scale*c.width>>1)+"px"})}for(var m=0,l=(c.lines-1)*(1-c.direction)/2,w;m<c.lines;m++)w=d(a(),
{position:"absolute",top:1+~(c.scale*c.width/2)+"px",transform:c.hwaccel?"translate3d(0,0,0)":"",opacity:c.opacity,animation:p&&f(c.opacity,c.trail,l+m*c.direction,c.lines)+" "+1/c.speed+"s linear infinite"}),c.shadow&&g(w,d(h("#000","0 0 4px #000"),{top:"2px"})),g(b,g(w,h(e(c.color,m),"0 0 1px rgba(0,0,0,.1)")));return b},opacity:function(b,a,e){a<b.childNodes.length&&(b.childNodes[a].style.opacity=e)}});if("undefined"!==typeof document){v=function(){var b=a("style",{type:"text/css"});g(document.getElementsByTagName("head")[0],
b);return b.sheet||b.styleSheet}();var u=d(a("group"),{behavior:"url(#default#VML)"});!c(u,"transform")&&u.adj?l():p=c(u,"animation")}return h});var CTATConfig={Options:{},addProperty:function(a,g,f,c){f=f||g[0];Object.defineProperty(CTATConfig,a,{enumerable:!0,configurable:!1,writable:!c,value:f.toLowerCase()});var d={};g.forEach(function(b){d[b]=b.toLowerCase();Object.defineProperty(CTATConfig,a+"_is_"+b,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:a,val:d[b]})})});CTATConfig.Options[a]=d}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","None"],"None");CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file",skills:"skills"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;
void 0===useDebugging&&(useDebugging=!1);var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.4.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,nameTranslator=null,hints=[],hintIndex=0,caseInsensitive=!0,unordered=!0,lockWidget=!0,highlightRightSelection=!0;
CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(a){return document.getElementById(a)};var CTATGlobalFunctions={};function unhighlightall(a){if(CTATShellTools.component_descriptions){a=CTATShellTools.getAllComponents();for(var g=0;g<a.length;g++){var f=a[g];f.setHintHighlight&&f.setHintHighlight(!1,null)}}}CTATGlobalFunctions.stringToBoolean=function(a){switch(String(a).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!a}};
CTATGlobalFunctions.isInstructorMode=function(){var a=flashVars?flashVars.getRawFlashVars():null;return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(a){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(a,g){CTATGlobalFunctions.isCTATObject(a)?a.setPreviewMode(g):a.previewMode=g};
CTATGlobalFunctions.setCenterTutor=function(a,g){CTATGlobalFunctions.isCTATObject(a)?a.setCenterTutor(g):a.centerTutor=g};CTATGlobalFunctions.setTutorWidth=function(a,g){CTATGlobalFunctions.isCTATObject(a)?a.setTutorWidth(g):a.width=g};CTATGlobalFunctions.setTutorHeight=function(a,g){CTATGlobalFunctions.isCTATObject(a)?a.setTutorHeight(g):a.height=g};CTATGlobalFunctions.setTutorDimensions=function(a,g,f){CTATGlobalFunctions.isCTATObject(a)?a.setTutorDimensions(g,f):(a.width=g,a.height=f)};
CTATGlobalFunctions.setTutorValue=function(a,g,f){CTATGlobalFunctions.isCTATObject(a)?a.setTutorValue(g,f):a[g]=f};CTATGlobalFunctions.setCommunicationMode=function(a,g){CTATGlobalFunctions.isCTATObject(a)?a.setCommunicationMode(g):a.tutoring_service_communication=g};CTATGlobalFunctions.setRemoteSocketURL=function(a,g){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketURL(g):a.remoteSocketURL=g};
CTATGlobalFunctions.setRemoteSocketPort=function(a,g){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketPort(g):a.remoteSocketPort=g};CTATGlobalFunctions.setProblemSummary=function(a){};CTATGlobalFunctions.isCTATObject=function(a){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(a){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(a){return"boolean"===typeof a?a:"string"===typeof a?CTATGlobalFunctions.stringToBoolean(a):"number"===typeof a?0<a:a?!0:!1};function noenter(a){if(CTATConfig.platform_is_Google())return 0;a=a||window.event;return 13!==(a.keyCode||a.charCode)}CTATGlobalFunctions.isBlank=function(a){return!a||/^\s*$/.test(a)};function componentToHex(a){a=a.toString(16);return 1==a.length?"0"+a:a}
function rgbToHex(a,g,f){return"#"+componentToHex(a)+componentToHex(g)+componentToHex(f)}function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}
function parseQueryStringArgs(a){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+a);var g="?"==a.charAt(0)?a.substring(1):a;a={};if(g)for(var g=g.split("&"),f=0;f<g.length;f++){var c=g[f].split("=");a[decodeURIComponent(c[0])]=decodeURIComponent(c[1].replace(/\+/g," "))}return a}
function setOrientation(a){ctatdebug("setOrientation ("+a+")");switch(a){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function a(){}return function(g){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=g;return new a}}());
function thisMovie(a){return-1!=navigator.appName.indexOf("Microsoft")?window[a]:document[a]}function introspect(a,g,f,c){f=f||"";"number"!==this.typeOf(c)&&(c=1);var d=this.typeOf(g);a=[f,a," ",d," :"].join("");if("object"===d){if(0<c){f=[f,"  "].join("");for(var b in g)d=this.introspect(b,g[b],f,c-1),a=[a,"\n",d].join("");return a}return[a," ..."].join("")}return"null"===d?[a," null"].join(""):[a," ",g].join("")}
function findPointOfAttachment(a){ctatdebug("findPointOfAttachment ("+a+")");for(var g=0;g<movieclips.length;g++){var f=movieclips[g];ctatdebug("Examining: "+f.getName()+"...");if(!0===f.isRegistered(a))return f}return null}function findMovieClip(a){a=a.trim();ctatdebug("findMovieClip ("+a.trim()+")");for(var g=0;g<movieclips.length;g++){var f=movieclips[g];ctatdebug("Examining: "+f.getName()+"...");if(f.getName()==a)return f}return null}
function colName(a,g){ctatdebug("colName ("+a+")");for(var f="";0<=a;)f=String.fromCharCode(a%26+97)+f,a=Math.floor(a/26)-1;!0===g&&f.toUpperCase();return f}function selectText(a){}function urldecode(a){return decodeURIComponent((""+a).replace(/\+/g,"%20"))}function detectIE(){var a=window.navigator.userAgent,g=a.indexOf("MSIE "),f=a.indexOf("Trident/");return 0<g?parseInt(a.substring(g+5,a.indexOf(".",g)),10):0<f?(g=a.indexOf("rv:"),parseInt(a.substring(g+3,a.indexOf(".",g)),10)):!1}
function listProperties(a){ctatdebug("listProperties (l: "+a.length+")");for(var g in a)ctatdebug("["+g+"]")}function listPropertiesKV(a,g){ctatdebug("listPropertiesKV (size: "+a.length+")");if(1==g)for(var f=0;f<a.length;f++)ctatdebug("["+f+"]: "+a[f]);else for(f in a)ctatdebug("["+f+"]: "+a[f])}function listAllDivAttributes(a){ctatdebug("listAllDivAttributes ()");var g=0;a=a.attributes;for(var f=a.length;g<f;g++)pointer.ctatdebug("Attribute: "+a[g].nodeName+", with value: "+a[g].nodeValue)}
var getBackgroundDimensions=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var g=new Image;g.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return g.width+" "+g.height},getBackgroundWidth=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var g=new Image;g.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return g.width},getBackgroundHeight=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var g=new Image;g.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,
"");return g.height};function getIndicesOf(a,g,f){var c=0,d=a.length,b=[];f||(g=g.toLowerCase(),a=a.toLowerCase());for(;-1<(f=g.indexOf(a,c));)b.push(f),c=f+d;return b}CTATGlobalFunctions.formatColor=function(a){if(/^#[0-9a-f]{6}$/i.test(a))return a;var g=a.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==g)return rgbToHex(Number(g[1]),Number(g[2]),Number(g[3]));g=a.match(/^#?([0-9a-f]{0,6})$/i);if(null!==g){for(a=g[1];6>a.length;)a="0"+a;return"#"+a}return a};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var a="",c=0;return{set_prefix:function(c){a=String(c)},set_index:function(a){c=a},gensym:function(){var d=a+c;c+=1;return d}}};var a=this.make_gensym();a.set_index(2);var g=this.make_gensym();g.set_index(1);g.set_prefix("ctatdiv");return{z_index:a.gensym,div_id:g.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(a,g){function f(b,a,e){null===b&&(b="unknownclass");null===a&&(a="nullinstance");return"["+b+":"+a+"] "+e}var c=a,d=g,b=this,e=!0;"undefined"!=CTATBase.DebuggingFilter[c]&&CTATBase.DebuggingFilter[c]&&(e=!1);this.getClassName=function(){return c};this.getClassname=function(){return c};this.setClassName=function(b){c=b};this.setName=function(b){d=b};this.getName=function(){return d};this.getUseDebugging=function(){return useDebugging};this.setUseDebugging=function(b){useDebugging=
b};this.toHHMMSS=function(b){var a=parseInt(b,10);b=Math.floor(a/3600);var e=Math.floor((a-3600*b)/60),a=a-3600*b-60*e;10>b&&(b="0"+b);10>e&&(e="0"+e);10>a&&(a="0"+a);return b+":"+e+":"+a};this.ctatdebug=function(a){if(e){var c=a;useDebuggingBasic?b.ctatdebugInternal(c,"UnknownClass"):(null===a&&(c="No message provided"),useDebugging&&b.ctatdebugInternal(c,b.getClassName()))}};this.ctatdebugObject=function(b){var a=0,e;for(e in b)this.ctatdebug("("+a+")"+e+": "+b[e]),a++};this.ctatdebugInternal=function(a,
e){var c=a;if(null===c||void 0===c)c="No message!";""===c&&(c="Empty message!");if(useDebuggingBasic)c=f("Unknown","undefined",c),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole?(CTATBase.customconsole.innerHTML+=c+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight):console.log(c);else{null===e&&(e="UndefinedClass");null===c&&(c="No message");c=f(e,b.getName(),c);try{console.trace(c)}catch(n){}"google"==CTATConfig.platform?
Logger.log(c):(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=c+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(a){var e="",c;for(c in a)e+=c+", ";b.ctatdebugInternal("Object: "+e,"Global")};this.urldecode=function(b){return decodeURIComponent((b+"").replace(/\+/g,"%20"))};this.entitiesConvert=function(b){this.ctatdebug("entitiesConvert ()");
return this.urldecode(unescape(b))};this.entitiesGenerate=function(b){return b}};function formatLogMessageGoogle(a,g,f){f=(new CTATBase(a,g)).htmlEncode(f);return"["+a+":"+g+"] "+f}function ctatdebug(a){(useDebugging||useDebuggingBasic)&&null!==a&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",a)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(a,"CTATTutor")))}
Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var a="",g="",f="tutor",c="",d="",b="",e="notstarted";this.setState=function(b){e=b};this.getState=function(){return e};this.setLabel=function(b){a=b};this.getLabel=function(){return a};this.setDescription=function(b){g=b};this.getDescription=function(){return g};this.setURLPrefix=function(a){b=a};this.getURLPrefix=function(){return b};this.setTutorFlag=function(b){f=b};this.getTutorFlag=function(){return f};this.setProblemFile=
function(b){c=b};this.getProblemFile=function(){return b+c};this.setStudentInterface=function(b){d=b};this.getStudentInterface=function(){return b+d}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;CTATProblem.prototype.toString=function(){return this.getProblemFile()+" on "+this.getStudentInterface()};var CTATProblemSet=function(){CTATBase.call(this,"CTATProblemSet","problemset");var a=this,g=[];this.addProblem=function(a){g.push(a)};this.getProblems=function(){return g};this.getProblemSize=function(){return g.length};this.getFirstProblem=function(){a.ctatdebug("getFirstProblem () problems.length "+g.length);return 0==g.length?null:g[0]}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(a){return this.parseXML(a)};this.parseXML=function(a){this.ctatdebug("parseXML ()");var g=null;try{"undefined"!==typeof $?g=$.parseXML(a):"undefined"!==typeof XMLParser?g=(new XMLParser).parseFromString(a):this.ctatdebug("Bottoming out, no parser configured!")}catch(f){return null!=g?this.ctatdebug("JQuery could not process the provided XML: "+f.message+" ("+g.parseError.errorCode+") ("+g.parseError.reason+") ("+
g.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+f.message),null}return null==g?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):g.documentElement};this.getElementName=function(a){return a.nodeName};this.getElementValue=function(a){return a.nodeValue};this.getElementChildren=function(a){for(var g=[],f=0;f<a.childNodes.length;f++)1==a.childNodes[f].nodeType&&g.push(a.childNodes[f]);return g};this.getNodeTextValue=function(a){if(null==
a)return"";if(null==a.childNodes)return a.nodeValue;if(0==a.childNodes.length)return"";for(var g=a.childNodes,f=0;f<g.length;f++){var c=g[f];if("value"==c.nodeName||"Value"==c.nodeName){if(1==c.childNodes.length)return c.childNodes[0].nodeValue;if(0==c.childNodes.length)break;else return c.childNodes[1].nodeValue}}return a.childNodes[0].nodeValue};this.getElementAttr=function(a,g){if(!a.attributes)return this.ctatdebug("Warning: Element "+a.nodeName+" does not have any attributes"),"";for(var f=0;f<
a.attributes.length;f++)if(a.attributes[f].nodeName==g)return a.attributes[f].nodeValue;return""};this.listElementAttr=function(a){this.ctatdebug("Listing "+a.attributes.length+" attributes for element "+a.nodeName+" ...");for(var g=0;g<a.attributes.length;g++)this.ctatdebug(g+" name: "+a.attributes[g].nodeName+", value: "+a.attributes[g].nodeValue)};this.stringify=function(a){return this.xmlToString(a)};this.xmlToString=function(a){this.ctatdebug("xmlToString ()");return null==a?(this.ctatdebug("Error: xml data is null"),
null):(new XMLSerializer).serializeToString(a)}};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var a=this,g=new CTATXML,f="",c=new CTATProblemSet,d=[c];this.init=function(b){a.ctatdebug("init ()");if(null==b)a.ctatdebug("Error: document root to be parsed is null.");else{a.ctatdebug("Root name: "+g.getElementName(b));b=g.getElementChildren(b);for(var e=0;e<b.length;e++){var c=b[e],d=g.getElementName(c);a.ctatdebug("Examining element: "+g.getElementName(c));if("Problems"==d){a.ctatdebug("Processing Problems ...");for(var c=
g.getElementChildren(c),f=0;f<c.length;f++){var n=c[f];a.ctatdebug("Problem ["+f+"] desc: "+g.getElementAttr(n,"description")+", interface: "+g.getElementAttr(n,"student_interface")+", brd: "+g.getElementAttr(n,"problem_file"));a.addProblem(g.getElementAttr(n,"problem_file"),g.getElementAttr(n,"student_interface"),g.getElementAttr(n,"name"),g.getElementAttr(n,"label"),g.getElementAttr(n,"description")).setTutorFlag(g.getElementAttr(n,"tutor_flag"))}}"ProblemSets"==d&&a.ctatdebug("Processing ProblemSets ...");
"Assets"==d&&a.ctatdebug("Processing Assets ...")}}};this.addProblem=function(b,e,c,d,g){var h=new CTATProblem;h.setProblemFile(b);h.setStudentInterface(e);h.setName(c?c:b);h.setLabel(d?d:b);h.setDescription(g?g:b);h.setURLPrefix(f);a.ctatdebug("Adding problem ...");a.getProblemSets()[0].addProblem(h);return h};this.setURLPrefix=function(b){f=b};this.getURLPrefix=function(){return f};this.getProblems=function(){return c};this.getProblemSets=function(){return d}};CTATPackage.prototype=Object.create(CTATBase.prototype);
CTATPackage.prototype.constructor=CTATPackage;var CTATConnectionBase=function(a,g){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var f=-1,c="",d="http";this.setURL=function(b){c=b};this.getURL=function(){return c};this.setID=function(b){f=b};this.getID=function(){return f};this.setSocketType=function(b){d=b};this.getSocketType=function(){return d}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(a){function g(){e.ctatdebug("init ()");var b=flashVars?flashVars.getRawFlashVars():f?f:{},b=b.session_id?b.session_id:"dummySession";if(null!==c){"dummySession"==b&&e.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{c.setRequestHeader("Content-type",d.contentType),c.setRequestHeader("ctatsession",b)}catch(m){alert("HTTP object creation error: "+m.message)}}else"undefined"==typeof $?alert("Internal error: http object is null right after creation"):
d.headers.ctatsession=b;e.ctatdebug("init () done")}CTATConnectionBase.call(this,"CTATConnection");var f=a,c=null,d={contentType:"text/plain",data:null,processData:!1,method:"POST",mimeType:"text/html",headers:{}},b=!1,e=this,h=null;e.setSocketType("http");this.setContentType=function(b){d.contentType=b};this.getContentType=function(){return d.contentType};this.setConsumed=function(a){b=a;e.ctatdebug("consumed: "+b)};this.getConsumed=function(){e.ctatdebug("consumed: "+b);return b};this.assignReceiveFunction=
function(b){h=b;c&&"undefined"!=typeof c.onreadystatechange&&(c.onreadystatechange=b)};this.assignFailFunction=function(b){d.error=b;c&&"function"==typeof c.error&&c.error(b)};this.setData=function(b){d.data=b};this.getData=function(){return d.data};this.getHTTPObject=function(){return c};this.getMethod=function(){return d.method};this.setMethod=function(b){d.method=b};this.send=function(){e.ctatdebug("send ()");var b=e.getHTTPObject(),a=function(){e.ctatdebug("Networking error!")};b&&(b.onerror=
a);try{b&&b.open(e.getMethod(),e.getURL(),!0)}catch(n){e.ctatdebug("Error in newConnection.httpObject.open: "+n.message);return}g();try{"undefined"!=typeof $?c=b=$.ajax(e.getURL(),d).done(h).fail(a):d.data?b.send(d.data):b.send()}catch(n){this.ctatdebug("Error in newConnection.httpObject.send: "+n.message)}};this.then=function(b,a){var d=c&&"function"==typeof c.then;e.ctatdebug("CTATConnection.then() supported "+d+", done & fail:\n  "+b+",\n  "+a);return d?c.then(b,a):{then:function(){console.log("CTATConnection.then() not supported")}}};
e.ctatdebug("createHTTPObject ()");c=new XMLHttpRequest;if("undefined"!=typeof $)c=null;else if(window.XMLHttpRequest)e.ctatdebug("Creating regular XMLHttpRequest ..."),c=new XMLHttpRequest,c.overrideMimeType&&c.overrideMimeType("text/html");else if(e.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){e.ctatdebug("Detected window.ActiveXObject ...");try{e.ctatdebug("Creating Msxml2.XMLHTTP ..."),c=new ActiveXObject("Msxml2.XMLHTTP")}catch(l){try{e.ctatdebug("Creating Microsoft.XMLHTTP ..."),
c=new ActiveXObject("Microsoft.XMLHTTP")}catch(m){alert("Error: Unable to create HTTP Request Object: "+m.message)}}}else alert("Internal error: an HTTP connection object could not be created")};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATWSConnection=function(a){CTATConnectionBase.call(this,"CTATWSConnection");var g="",f=!1,c=this,d=null,b=[],e=!1,h=0,l=0,m=null,n=null;c.setSocketType("ws");this.setConsumed=function(b){f=b;c.ctatdebug("consumed: "+f)};this.getConsumed=function(){c.ctatdebug("consumed: "+f);return f};this.assignReceiveFunction=function(b){m=b};this.assignCloseFunction=function(b){n=b};this.setData=function(b){g=b};this.getData=function(){return g};this.init=function(){ctatdebug("init ("+c.getURL()+"); websocket "+
d);null==d&&(d=new WebSocket(c.getURL()),d.addEventListener("open",function(a){ctatdebug("STATUS: open");e=!0;ctatdebug("Connection open, flushing outgoing queue ...");h=(new Date).getTime();if(0<b.length){for(a=0;a<b.length;a++)d.send(b[a]);b=[]}}),d.addEventListener("message",function(b){l=(new Date).getTime();ctatdebug("STATUS: message after "+(l-h)+" ms");ctatdebug("Received: "+b.data);m?m(b.data):ctatdebug("Error: no processing function provided")}),d.addEventListener("close",function(b){ctatdebug("STATUS: close; "+
(b?"code "+b.code+", reason "+b.reason:"no event"));e=!1;d.close(1E3,b?b.reason?b.reason:"received close code "+b.code:"no close event received");n&&n(b)}),d.addEventListener("error",function(b){ctatdebug("STATUS: error; "+(b?b.type:"no event"));e=!1;d.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");c.init();!1===e?(ctatdebug("Connection not ready yet, storing ..."),b.push(g)):(ctatdebug("Connection ready, sending data ..."),
h=(new Date).getTime(),d.send(g))};this.getWebSocket=function(){return d};this.close=function(b,a){e=!1;n=a||n;d.close(1E3,b||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(a){var g=this,f=[];this.addShape=function(a){f.push(a)};this.hideShape=function(a){for(var c=0;c<f.length;c++)if(f[c].getName()==a){f[c].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(a){for(var c=0;c<f.length;c++)if(f[c].getName()==a){f[c].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var a=0;a<f.length;a++)f[a].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var a=0;a<f.length;a++)f[a].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(a,d,b){for(var e=0;e<f.length;e++)if(f[e].getName()==a){f[e].modifyCanvasCSS("left",d+"px");f[e].modifyCanvasCSS("top",b+"px");break}};this.moveComponent=function(a,d){for(var b=0;b<f.length;b++)f[b].modifyCanvasCSS("left",a+"px"),f[b].modifyCanvasCSS("top",d+"px")};this.removeShape=function(a){for(var c=0,b=0;b<f.length;b++)if(f[b].getName()==a){c=b;break}f[c].detatchCanvas();f.splice(c,1)};this.removeComponent=function(){for(;0<f.length;)g.removeShape(f[0].getName())}};var CTATDefaultLanguagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",CONGRATULATIONS_YOU_ARE_DONE:"Congratulations, you are done with this problem.",SURE_YOU_ARE_DONE:"Are you sure you are done?",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",DONE:"Done",HINT:"Hint",
NEXT:"Next",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",NO_HINT_AVAILABLE:"No hint is available at this step.",NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",
ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator.",AWAITING_OTHER_COLLABORATORS:"Waiting for other team members..."},CTATLanguageManager=function(){CTATBase.call(this,"CTATLanguageManager","theLanguagePack");var a=this;this.getString=function(g){a.ctatdebug("getString ("+g+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[g])return CTATLanguagePack[g]}else a.ctatdebug("No custom language pack defined, using default...");
return CTATDefaultLanguagePack[g]};this.filterString=function(g){a.ctatdebug("filterString ("+g+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[g])return a.ctatdebug("Found tag in provided language pack, returning: "+CTATLanguagePack[g]),CTATLanguagePack[g]}else a.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLanguagePack&&CTATDefaultLanguagePack[g]?(a.ctatdebug("Found tag in default language pack, returning: "+
CTATDefaultLanguagePack[g]),CTATDefaultLanguagePack[g]):g}};CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function a(){warnScrim=!1;w.scrimDown()}function g(b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("errScrimUp ("+b+")"),!0===errorScrim?!0===e&&(e=!1,getSafeElementById(ctatcontainer).removeChild(r)):!0===warnScrim&&(e=!0),w.scrimUp(b))}function f(b,a){w.ctatdebug("makeHTMLButton ()");var e=document.createElement("input");e.type="button";
e.value=a;b?(w.ctatdebug("clickHandle!=null"),e.onclick=b):(w.ctatdebug("clickHandle==null"),e.onclick=w.defaultClickHandler);e.id=a;e.setAttribute("class","scrimButton");return e}CTATBase.call(this,"CTATScrim","__undefined__");var c="",d=!1,b=!1,e=!1,h=null,l=null,m=new CTATCanvasComponent("CTAT Scrim"),n=[],p=null,v=null,r=null,u=null,w=this;this.scrimUp=function(g){if("google"!=CTATConfig.platform)if(w.ctatdebug("scrimUp ()"),g=CTATGlobals.languageManager.filterString(g),w.ctatdebug("Message: "+
g),!0===scrimIsUp?(c=!0===waitScrim?g:c+(" \n "+g),m.removeComponent(),w.removeHTMLElements()):(c=g,scrimIsUp=!0),w.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp),w.ctatdebug("drawScrim ()"),"google"==CTATConfig.platform)w.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel">CTAT Info Panel</h4><div id="scrimpanel" class="inhalt"><br>'+
c+"<br><br></div></div></div>"),!0===e&&(waitScrim=!1,r=f(a,"close"),$(r).appendTo("#scrimpanel")),!0===d&&(waitScrim=!1,p=f(h,"yes"),$(p).appendTo("#scrimpanel"),d=!1),!0===b&&(waitScrim=!1,v=f(l,"no"),$(v).appendTo("#scrimpanel"),b=!1),!0===waitScrim)){w.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");g=$('<div id="scrim_spin">');g.css("width","100%");g.css("position","relative");$("#scrimpanel").append(g);try{var n=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(n.el)}catch(z){(z instanceof
ReferenceError||z instanceof TypeError)&&w.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',z,typeof z)}}};this.waitScrimUp=function(){w.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),waitScrim=!0,w.scrimUp(CTATGlobals.languageManager.getString("LOADING")),w.ctatdebug("return from waitScrimUp(): scrimIsUp "+
scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("nextProblemScrimUp ()"),w.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(a,c){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("OKScrimUp ("+a+","+c+")"),waitScrim=b=d=e=warnScrim=errorScrim=!1,w.scrimUp(a),u=f(c,"OK"),$(u).appendTo("#scrimpanel"))};this.confirmScrimUp=function(a,e,c){"google"!=CTATConfig.platform&&
(!0===scrimIsUp&&w.scrimDownForced(),w.ctatdebug("confirmScrimUp ("+a+","+e+","+c+")"),b=d=!0,l=c,h=e,w.scrimUp(a))};this.errorScrimUp=function(b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),!1===authorTimeSet?(w.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),n.push("ERROR: "+b),errorScrim=!0):!1===inAuthorTime?w.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,g("ERROR: "+
b)))};this.warningScrimUp=function(b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&w.scrimDownForced(),!1===authorTimeSet?(w.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),n.push("WARNING: "+b),warnScrim=!0):!1===inAuthorTime?w.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(warnScrim=!0,g("WARNING: "+b)))};this.handleTSDisconnect=function(){connectionScrim=!0;w.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};
this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?w.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?w.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?w.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===connectionScrim?w.ctatdebug("The scrim is up for a connection issue leave it up!"):w.scrimDownForced())};this.scrimDownForced=function(){w.ctatdebug("enter scrimDownForced() scrimIsUp "+
scrimIsUp);$("#scrim").remove();m.removeComponent();w.removeHTMLElements();waitScrim=scrimIsUp=!1;c="";w.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){w.ctatdebug("defaultClickHandler ()");w.scrimDown()};this.setInAuthorTime=function(b){w.ctatdebug("setting inAuthorTime = "+b);authorTimeSet=!0;inAuthorTime=b;if(!b)warnScrim=errorScrim=!1,e&&null.removeChild(r);else if(errorScrim||warnScrim)for(var a in n)g(a)};this.getInAuthorTime=function(){return inAuthorTime}};
CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var CTAT={ToolTutor:{interfaceMessages:[],tutorMessages:[]}};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(a){window.hasOwnProperty("interfaceObject")?window.interfaceObject=a:this._interface=a;return a}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(a){window.hasOwnProperty("tutorObject")?window.tutorObject=a:this._tutor=a;return a}});
CTAT.ToolTutor.registerTutor=function(a){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(a);if(this.tutor=a)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(a){ctatdebug("CTAT.ToolTutor.sendToInterface()\n  "+a);return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(a):commMessageHandler?commMessageHandler.processMessage(a):this.interfaceMessages.push(a)};
CTAT.ToolTutor.registerInterfaceMessageHandler=function(a){ctatdebug("CTAT.ToolTutor.registerInterfaceMessageHandler("+a+")");"string"===typeof a&&(a=document.getElementById(a));if(this.message_handler=a)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};CTAT.ToolTutor.registerInterface=function(a){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(a);this.registerInterfaceMessageHandler(a)};
CTAT.ToolTutor.sendToTutor=function(a){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(a):this.tutor?this.tutor.receiveFromInterface(a):this.tutorMessages.push(a)};
CTAT.ToolTutor.reboot=function(a){(a="undefined"!=typeof location&&location&&location.href?location.href:null)&&console.log("ToolTutor.reboot(), setting location to "+a);return a&&!CTATConfiguration.get("editorMode")?("function"==typeof setTimeout?setTimeout(location.replace.bind(location),600,a):location.replace(a),!0):!1};var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var a=this,g={},f=null,c=null,d=null,b=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",
log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"none",problem_state_status:"empty",question_file:"none",refresh_session_url:"none",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"none",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",student_interface:"none",student_problem_id:"none",
study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(b){a.ctatdebug("assignRawFlashVars() raw['session_id'] "+a.raw.session_id+", aData['session_id'] "+b.session_id);a.raw=b;a.preParse()};this.getRawFlashVars=
function(){return a.raw};this.getSingleParameterValues=function(b){var e=[];if(!b)return e;var c=a.getRawFlashVars(),d;for(d in b){var f=b[d];c[f]&&"none"!=c[f]&&e.push(c[f])}return e};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(b){return 0<=b.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(b,c){var e={},d=0,f=0;if(b)for(var g in b)e[g]=b[g],d++;a.ctatdebug("generateDefaultConfiguration() nDefaults "+d+", result['session_id'] "+
e.session_id);if("undefined"!=typeof c&&null!=c)for(g in c)e[g]=c[g],f++;a.ctatdebug("generateDefaultConfiguration() nLocalVars "+f);f=d=null;if(window&&window.frameElement&&(f=window.frameElement.getAttribute("data-params"))){d=jQuery.parseJSON(f);console.log("setting data params from iframe attr");for(var h in d)e[h]=CTATGlobals.EncodedParams[h]?decodeURIComponent(d[h].replace(/\+/g,"%20")):d[h],console.log("set "+h+" to "+e[h])}if(null===d)for(h=$('object param[name="flashvars"]'),a.ctatdebug("generateDefaultConfiguration() objs "+
h),d=0;d<h.length;++d)if(f=$(h[d]).attr("value"),a.ctatdebug("generateDefaultConfiguration() fVarsAsString "+f),f&&(f=parseQueryStringArgs(f))&&f.question_file)for(var r in f)e[r]=f[r];ctatdebug("tutorPrep ("+e+")");r={};if(null===e||void 0===e)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");h=location.search;ctatdebug("Query String: "+h);d="?"==h.charAt(0)?h.substring(1):h;h={};if(d)for(d=d.split("&"),f=0;f<d.length;f++){g=d[f].split("=");ctatdebug("Setting flashvar "+
g[0]+", to: "+decodeURIComponent(g[1].replace(/\+/g," ")));h[decodeURIComponent(g[0])]="";for(var u=1;u<g.length;u++)h[decodeURIComponent(g[0])]+=(1<u?"=":"")+decodeURIComponent(g[u].replace(/\+/g," "));ctatdebug("Decoded args: "+h[decodeURIComponent(g[0])])}null!==h&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),r=h);h=!1;for(var w in r)if(r.hasOwnProperty(w))switch(ctatdebug("Processing external FlashVar "+w+"("+r[w]+")"),w){case "GENERATED":"on"==r[w]&&(e.session_id=CTATGuid.guid(),
h=!0);break;case "BRD":e.question_file=r[w];break;case "BRMODE":e.BehaviorRecorderMode=r[w];break;case "PROBLEM":e.problem_name=r[w];break;case "DATASET":e.dataset_name=r[w];break;case "LEVEL1":e.dataset_level_name1=r[w];break;case "TYPE1":e.dataset_level_type1=r[w];break;case "LEVEL2":e.dataset_level_name2=r[w];break;case "TYPE2":e.dataset_level_type2=r[w];break;case "LEVEL3":e.dataset_level_name3=r[w];break;case "TYPE3":e.dataset_level_type3=r[w];break;case "LEVEL4":e.dataset_level_name4=r[w];break;
case "TYPE4":e.dataset_level_type4=r[w];break;case "USER":e.user_guid=r[w];break;case "SESSION":!1===h&&(e.session_id=r[w]);break;case "SOURCE":e.source_id=r[w];break;case "LOGTYPE":e.Logging=r[w];break;case "PORT":e.remoteSocketPort=r[w];break;case "REMOTEURL":e.remoteSocketURL=r[w];break;case "DISKDIR":e.log_to_disk_directory=r[w];break;case "log_service_url":e.log_service_url=r[w];break;case "URL":e.log_service_url=r[w];break;case "LOGURL":e.log_service_url=r[w];break;case "CONNECTION":e.tutoring_service_communication=
r[w];break;case "SUI":e.sui=r[w];break;case "VAR1":e.var1=r[w];break;case "VAL1":e.val1=r[w];break;case "VAR2":e.var2=r[w];break;case "VAL2":e.val2=r[w];break;case "VAR3":e.var3=r[w];break;case "VAL3":e.val3=r[w];break;case "VAR4":e.var4=r[w];break;case "VAL4":e.val4=r[w];break;case "SLOG":case "SessionLog":e.SessionLog=r[w];break;case "KEYBOARDGROUP":"Disabled"==r[w]&&(e.keyboard="disabled");"Auto"==r[w]&&(e.keyboard="auto");"On"==r[w]&&(e.keyboard="on");break;default:e[w]=r[w]}}return e};this.getCustomFields=
function(){return g};this.setTimeZone=function(b){a.ctatdebug("setTimeZone ("+b+")");null==b||""==b||void 0==b?(b=jstz.determine(),a.ctatdebug("Assigning detected timezone: "+b.name()),b=b.name()):(50<b.length&&(b=b.substr(0,50)),3!=b.length&&4!=b.length||a.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=a.raw&&(a.raw.timezone=b)};this.getTimeZone=function(){return null!=a.raw&&a.raw.timezone?a.raw.timezone:"UTC"};this.listWithAmpersands=
function(){var b="",c;for(c in a.raw)var d=c+"="+encodeURIComponent(a.raw[c]),b=""!=b?b+"&"+d:d;a.ctatdebug("CTATConfiguration.listWithAmpersands() result "+b.substring(0,25)+"...");return b};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var b in a.raw)ctatdebug("["+b+"]: "+a.raw[b])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==a.raw.dataset_name||void 0==a.raw.dataset_name)a.raw.dataset_name="DefaultDataset";var b=0,c;for(c in a.raw){if("VAR"==c||"var"==c)g[c]=
a.raw[c];b++}a.ctatdebug("preParse() nRaw "+b);b=0;for(c=!0;1==c;){c=!1;var d="custom_field_name"+(b+1),f="custom_field_value"+(b+1);a.ctatdebug("Trying : "+a.raw[d]+","+a.raw[f]);null!=a.raw[d]&&(a.ctatdebug("Adding: "+d+","+a.raw[f]),g[a.raw[d]]=a.raw[f],c=!0,b++)}};this.getDatasetNames=function(){a.ctatdebug("getDatasetNames ()");if(null!=f)return f;f={};f=[];for(var b=0,c=!0;1==c;){var c=!1,d="dataset_level_name"+(b+1);null!=a.raw[d]&&(a.ctatdebug("Adding: "+d+","+a.raw[d]),f[b]=a.raw[d],c=!0,
b++)}return f};this.getDatasetTypes=function(){a.ctatdebug("getDatasetTypes ()");if(null!=c)return c;c=[];for(var b=0,d=!0;1==d;){var d=!1,f="dataset_level_type"+(b+1);null!=a.raw[f]&&(a.ctatdebug("Adding: "+f+","+a.raw[f]),c[b]=a.raw[f],d=!0,b++)}return c};this.getConditionNames=function(){var b=[],c=0;void 0!=a.raw.study_condition_name&&""!=a.raw.study_condition_name&&(b.push(a.raw.study_condition_name),c++);for(var d=0,f=!0;1==f;){var f=!1,g="study_condition_name"+(d+1);null!=a.raw[g]&&(a.ctatdebug("Adding: "+
g+","+a.raw[g]),b[d+c]=a.raw[g],f=!0,d++)}return b};this.getConditionTypes=function(){d=[];var b=0;void 0!=a.raw.study_condition_type&&""!=a.raw.study_condition_type&&(d.push(a.raw.study_condition_type),b++);for(var c=0,f=!0;1==f;){var f=!1,g="study_condition_type"+(c+1);null!=a.raw[g]&&(a.ctatdebug("Adding: "+g+","+a.raw[g]),d[c+b]=a.raw[g],f=!0,c++)}return d};this.getConditionDescriptions=function(){a.ctatdebug("getConditionDescriptions ()");b=[];var c=0;a.raw.study_condition_description&&""!==
a.raw.study_condition_description&&(a.ctatdebug("Adding study_condition_description: "+a.raw.study_condition_description),b.push(a.raw.study_condition_description),c++);for(var d=0,f=!0;!0===f;){var f=!1,g="study_condition_description"+(d+1);null!=a.raw[g]&&(a.ctatdebug("Adding: "+g+","+a.raw[g]),b[d+c]=a.raw[g],f=!0,d++)}return b};this.get=function(b){return a.raw[b]};this.set=function(b,c){b&&(a.raw[b]=c)};this.setParams=function(b){if(b)for(var c in b)a.set(c,b[c])};this.isInstructorMode=function(){var b=
this.getRawFlashVars();return b&&b.deliverymode?"delivery"==b.deliverymode?!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=function(b,c){a.raw.previewMode=c};this.setCenterTutor=function(b,c){a.raw.centerTutor=c};this.setTutorWidth=function(b,c){a.raw.width=c};this.setTutorHeight=function(b,c){a.raw.height=c};this.setTutorDimensions=function(b,c,d){a.raw.width=c;a.raw.height=d};this.setTutorValue=
function(b,c,d){a.raw[c]=d};this.setCommunicationMode=function(b,c){a.raw.tutoring_service_communication=c};this.setRemoteSocketURL=function(b,c){a.raw.remoteSocketURL=c};this.setRemoteSocketPort=function(b,c){a.raw.remoteSocketPort=c}};CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(a,g){if(!CTATConfiguration.theConfObject){this.theConfObject=new CTATConfiguration;var f=this.theConfObject.generateDefaultConfiguration(this.theConfObject.raw,a);this.theConfObject.assignRawFlashVars(f);"none"==this.theConfObject.get("session_id")&&this.theConfObject.set("session_id",CTATGuid.guid());flashVars=this.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}"Default"!=g&&"OLI"!=g||this.theConfObject.setParams(a);return this.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};CTATConfiguration.get=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(a)};
CTATConfiguration.set=function(a,g){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(a,g)};CTATConfiguration.getCustomFields=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getCustomFields()};CTATConfiguration.setParams=function(a){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(a)};
CTATConfiguration.getSingleParameterValues=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(a)};CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(a){return null===a||"undefined"===typeof a?!1:0===a.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(a){if(null===a||"undefined"===typeof a)return!1;a=a.toString().toLowerCase();return 0===a.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===a.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(a,g){this.ctatdebug("createInCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+g);f+=g.toXMLString(!1);return f+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(a,g){this.ctatdebug("createCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+g.toXMLString(!1);return f+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(a,g,f,c,d,b,e,h,l){e=void 0==e?a.length:e;h=void 0==h?1:h;g="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+(g?g:new CTATSAI("","","")).toXMLString();g+="<TutorAdvice>";for(var m=0;m<a.length;m++)g+="<value><![CDATA["+a[m]+"]]\x3e</value>";g=g+("</TutorAdvice><TotalHintsAvailable>"+e+"</TotalHintsAvailable><CurrentHintNumber>"+h+"</CurrentHintNumber>")+
("<Actor>"+f+"</Actor>")+this.fmtSkillBarVector(c);g+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";if(d||0===d)g+="<StepID>"+d+"</StepID>";g+="<transaction_id>"+b+"</transaction_id>";g+="<LogAsResult>true</LogAsResult>";g+=this.formatCustomFields(l);return g+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(a,g,f,c,d,b,e,h,l,m,n){this.ctatdebug("TMB.createAssociatedRulesMessageForAction(indicator "+a+", sai "+g+", actor "+f+", studentSAI "+c+",\n  skillBarVector "+d+", stepID "+b+", transactionID "+e+",\n  tutorAdvice "+h+", outOfOrder "+l+", traceOutcome "+n);a="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>"+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(a)?"Correct":"InCorrect")+
"</Indicator>");a+=(g?g:new CTATSAI("","","")).toXMLString();g=c.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");g=g.replace("</Selection>","</StudentSelection>").replace("</Action>","</StudentAction>").replace("</Input>","</StudentInput>");a=a+g+("<Actor>"+f+"</Actor>")+this.fmtSkillBarVector(d);a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";a+="<StepID>"+b+"</StepID>";a+="<transaction_id>"+e+"</transaction_id>";
h&&(a+="<TutorAdvice><![CDATA["+h+"]]\x3e</TutorAdvice>");a+="<LogAsResult>true</LogAsResult>";a+="<end_of_transaction>"+(h?!1:!0)+"</end_of_transaction>";a+="undefined"!=typeof l&&l?"<OutOfOrder>true</OutOfOrder>":"";a+=n?"<"+CTATMsgType.TRACE_OUTCOME+">"+n+"</"+CTATMsgType.TRACE_OUTCOME+">":"";a+=this.formatCustomFields(m);return a+="</properties></message>"};
CTATTutorMessageBuilder.prototype.formatCustomFields=function(a){var g="";if(a)for(var f in a)a.hasOwnProperty(f)&&(g+="<custom_field><name>"+f+"</name><value>"+(null==a[f]?"":a[f].toString())+"</value></custom_field>");return g?"<custom_fields>"+g+"</custom_fields>":""};
CTATTutorMessageBuilder.prototype.isDoneStep=function(a,g){g[0]=!1;var f=a.getIndicator();if(!f)return!1;var c=a.getStudentSelection();c||(c=a.getProperty("tool_selection"));g[0]=CTATTutorMessageBuilder.isCorrect(indicator);var d="done"==c;this.ctatdebug("isDoneStep() indicatorObj "+f+", selectionObj "+c+", correct[0] "+g[0]+", result "+d);return d};
CTATTutorMessageBuilder.prototype.createHintMessage=function(a,g,f,c){f="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var d=0;d<a.length;d++)f+="<value><![CDATA["+a[d]+"]]\x3e</value>";f+="</HintsMessage>";g&&g.toXMLString&&(f+=g.toXMLString());return f+("<transaction_id>"+c+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(a,g){var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+a+"</ErrorType><Details>"+(g?g:"");return f+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(a,g){var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>"+("<SuccessMsg><![CDATA["+g+"]]\x3e</SuccessMsg>")+("<transaction_id>"+a+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(a,g){var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>"+("<BuggyMsg><![CDATA["+g+"]]\x3e</BuggyMsg>")+("<transaction_id>"+a+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return f+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(a){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+a+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(a,g){var f="<message><verb>SendNoteProperty</verb><properties><MessageType>"+a+"</MessageType>";if(g)for(var c in g)f+="<"+c+">"+g[c]+"</"+c+">";f+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+a+", "+g+") returns "+f);return f};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(a,g,f,c,d,b,e){a="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+a+"</caseInsensitive>")+("<unordered>"+g+"</unordered>")+("<lockWidget>"+f+"</lockWidget>");a+="<suppressStudentFeedback>"+c+"</suppressStudentFeedback>";a+="<highlightRightSelection>"+d+"</highlightRightSelection>";a+="<confirmDone>"+b+"</confirmDone>";a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
a+=this.fmtSkillBarVector(e);return a+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(a){var g="";if(void 0!==a&&null!==a&&0<a.length){for(var g=g+"<Skills>",f=0;f<a.length;f++)g+="<value><![CDATA["+a[f]+"]]\x3e</value>";g+="</Skills>"}return g};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(a,g,f,c){a="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+f+"</HighlightMsgText>")+("<Selection><value>"+a+"</value></Selection>")+("<Action><value>"+g+"</value></Action>");a+="<transaction_id>"+c+"</transaction_id>";a+="<end_of_transaction>true</end_of_transaction>";return a+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTATLMS={identifier:null,initLMSConnection:function(){},closeLMSConnection:function(){},setValue:function(a,g){},getValue:function(a){return null},saveProblemState:function(a){},getProblemState:function(a){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(g){a(g)}).fail(function(g,f,c){a(null);g=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",f+" "+c);CTAT.ToolTutor.sendToInterface(g,!0)}):a(null)},
gradeStudent:function(a,g){},logEvent:function(a){},processProblemSummary:function(a){},is:{},init:{}};
CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(a){return a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){}};CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var a=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==a){window.parent.doLMSInitialize();var g=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",g);"not attempted"==g&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==g&&CTATConfiguration.set("problem_state_status","completed");"failed"==g&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==g&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");a=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){return CTATLMS.setValue("cmi.suspend_data",a.problem_state)};CTATLMS.getProblemState=function(a){var f=CTATLMS.getValue("cmi.suspend_data");if(!f&&window.parent&&"function"==
typeof window.parent.doLMSGetLastError){var c=window.parent.doLMSGetLastError();if(0!=c)return console.log("Empty result with error "+c+" from LMS.getValue('cmi.suspend_data'):",window.parent.doLMSGetErrorString?window.parent.doLMSGetErrorString(c):""),a(null)}return a(f)};CTATLMS.gradeStudent=function(a,f){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((a/f).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=
function(a){["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(a){var c=this.getElementsByTagName(a);CTATLMS.setValue(a,$("<div>").html(c[0].innerHTML).text())},a);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var a=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,f){};CTATLMS.getValue=function(a){return null};CTATLMS.saveProblemState=function(g){parent.postMessage({action:"save_problem_state",input:window.btoa(g.problem_state)},a)};CTATLMS.getProblemState=function(a){return a(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(g,f){parent.postMessage({action:"grade",input:{value:g,max:f}},a)};CTATLMS.logEvent=function(g){parent.postMessage({action:"log",input:g},a)};CTATLMS.processProblemSummary=function(a){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.ToolsListener=function(){return window.location.search&&/[?&;]mode=ctatAsListener/i.test(window.location.search)};CTATLMS.is.OLI=function(){return"OLI"==CTATConfiguration.get("CTATTarget")};
CTATLMS.is.TutorShop=function(){return"TutorShop"==CTATConfiguration.get("LMS")};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,g){};CTATLMS.getValue=function(a){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){a.session_id=a.session_id?a.session_id:"dummySession";var g=[],f;for(f in a)g.push(f+"="+encodeURIComponent(a[f]));
$.post(CTATConfiguration.get("curriculum_service_url"),g.join("&"),null,"application/x-www-form-urlencoded")}};CTATLMS.getProblemState=function(a){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(g){a(g)}).fail(function(g,f,c){a(null);g=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",f+" "+c);CTAT.ToolTutor.sendToInterface(g,!0)}):a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=
function(){}};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(a,g){CTATBase.call(this,"CTATCommLibrary",a);var f=authenticityToken="",c=0,d=[],b=null,e=a?a:null,h=null==g?!0:g,l=!0,m=null,n=this,p="http",v="ERROR_CONN_TS",r="";this.setUseCommSettings=function(b){l=b};this.getUseCommSettings=function(){return l};this.setConnectionRefusedMessage=function(b){v=b};this.setSocketType=function(b){p=b};this.hasSecureSocket=function(){return/https/i.test(p)||/wss/i.test(p)};
this.hasJavaScriptConnection=function(){return/javascript/i.test(p)};this.hasWebSocket=function(){return/websocket/i.test(p)};this.assignHandler=function(b){e=b};this.assignMessageListener=function(b){m=b};this.encodeVariables=function(b){n.ctatdebug("encodeVariables ()");for(var a="",c=0;c<b.length;c++){var e=b[c];0<c&&(a+="&");a+=e.name;a+="=";a+=encodeURIComponent(e.value)}return a};this.encodeVariablesOLI=function(b){n.ctatdebug("encodeVariablesOLI ()");for(var a="",c=0;c<b.length;c++){var e=
b[c];0<c&&(a+="&");a+=e.name;a+="=";a+=encodeURIComponent(e.value)}return a};this.createConnection=function(a,e,f){n.ctatdebug("createConnection () canBeWebSocket "+f);f="undefined"==typeof f?!0:!1!==f;if(!e)return new CTATConnection(a);if(f&&n.hasWebSocket())return f=this.findWSConnection(e),f||(f=new CTATWSConnection(a),f.setID(c),f.setURL(e),f.assignReceiveFunction(this.processWSReply),f.assignCloseFunction(this.processWSClose),d.push(f),c++),f;f=new CTATConnection(a);f.setID(c);f.setURL(e);f.assignReceiveFunction(n.processReply);
d.push(f);c++;return b=f};this.findWSConnection=function(b){ctatdebug("findWSConnection( "+b+" )");b=n.editSocketURLForHTTPS(b);for(var a=0;a<d.length;a++){var c=d[a];ctatdebug("checking: socketType = "+c.getSocketType()+" URL = "+c.getURL());if("ws"==c.getSocketType()&&c.getURL()==b)return c}return null};this.startBundle=function(){n.ctatdebug("startBundle ()");!1===useBundling?this.ctatdebug("Not using bundling, bump"):(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',
inBundle=!0)};this.endBundle=function(){n.ctatdebug("endBundle ()");!1===useBundling?n.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+="</messages></properties></message>",n.sendXML(bundleFormatter))};this.setFixedURL=function(b){f=b};this.getURL=function(){n.ctatdebug("getURL ()");if(""!==f)return n.ctatdebug("Returning fixedURL: "+f),f;var b=flashVars.getRawFlashVars(),a="http://";n.hasSecureSocket()&&(a="https://");a=a+b.remoteSocketURL+":"+b.remoteSocketPort;-1!=b.remoteSocketURL.indexOf("http")&&
(a=b.remoteSocketURL+":"+b.remoteSocketPort);return a};this.sendXML=function(b,a){n.ctatdebug("Sending: "+b);n.ctatdebug("sendXML ("+b+")");e.updateLastActionTimestamp&&e.updateLastActionTimestamp();if(!0===useBundling&&!0===inBundle)n.ctatdebug("Bundling ..."),bundleFormatter+=b;else{bundleFormatter=b;flashVars.getRawFlashVars();var c=this.getURL(),d=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(d='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);n.getUseCommSettings()&&n.hasJavaScriptConnection()?
(n.sendToToolsOrCollaborators(c,d,a),CTAT.ToolTutor.sendToTutor(d)):n.send_post(c,d)}};this.sendToToolsOrCollaborators=function(b,a,c){return!n.hasWebSocket()||"ctatAsListener"!=CTATConfiguration.get("mode")&&"undefined"!=typeof c&&!1===c?!1:(this.send_post(b,a),!0)};this.sendXMLNoBundle=function(b){n.ctatdebug("sendXMLNoBundle ("+b+")");bundleFormatter=b;e.updateLastActionTimestamp&&e.updateLastActionTimestamp();var a=this.getURL(),c=b;-1==b.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+
b);flashVars.getRawFlashVars();n.getUseCommSettings()&&n.hasJavaScriptConnection()?(n.sendToToolsOrCollaborators(a,c),CTAT.ToolTutor.sendToTutor(c)):this.send_post(a,c)};this.sendXMLURL=function(b,a,c){ctatdebug("sendXMLURL ("+a+", "+c+")");var d=b;-1==b.indexOf("<?xml")&&(d='<?xml version="1.0" encoding="UTF-8"?>'+b);flashVars.getRawFlashVars();n.ctatdebug("Sending: "+d);e.updateLastActionTimestamp&&e.updateLastActionTimestamp();this.getUseCommSettings()&&n.hasJavaScriptConnection()?(n.sendToToolsOrCollaborators(a,
d),c||CTAT.ToolTutor.sendToTutor(d)):this.send_post(a,d)};this.send_post_variables=function(b,a){n.ctatdebug("send_post_variables ("+b+")");flashVars.getRawFlashVars();var c;c=!1===useOLIEncoding?this.encodeVariables(a):this.encodeVariablesOLI(a);this.ctatdebug("Sending: "+c);e.updateLastActionTimestamp&&e.updateLastActionTimestamp();if(!0===CTATGlobals.CommDisabled)n.ctatdebug("Communications globally disabled, please check your settings");else{var d=n.createConnection(CTATConfiguration.getRawFlashVars(),
b,!1);d.setContentType("application/x-www-form-urlencoded");n.ctatdebug("CTATCommLibrary.send_post_variables() data to send:\n  "+c);null!==m&&m.processOutgoing(c);d.setURL(b);d.setData(c);d.assignReceiveFunction(n.processReply);d.send()}};this.send_post=function(b,a){var c;ctatdebug("send_post ("+b+")");if(!0===CTATGlobals.CommDisabled)n.ctatdebug("Communications globally disabled, please check your settings");else{ctatdebug("Outoing on wire: "+a);c=flashVars.getRawFlashVars();var e=b;n.hasWebSocket()?
(ctatdebug("opening websocket connection: url "+b),e=b.replace(/https?:/,"ws:"),e=n.editSocketURLForHTTPS(e),ctatdebug("opening websocket connection to "+e),c=n.createConnection(c,e),c.setData(a),n.ctatdebug(a)):(c=n.createConnection(c,e),c.setData(a));null!==m&&m.processOutgoing(a);c.send()}};this.processReply=function(b,a,c){n.ctatdebug("processReply ("+d.length+","+b+", ...)");"undefined"==typeof c&&"function"==typeof this.getHTTPObject&&this.getHTTPObject();a=0;b=[];var f;for(f=0;f<d.length;f++){var g=
d[f];if(g&&"function"==typeof g.getHTTPObject){var l=g.getHTTPObject();n.ctatdebug("Testing connection entry["+f+"]: readyState & status: "+(l?l.readyState+" & "+l.status:"null")+", consumed: "+g.getConsumed());l&&(4==l.readyState&&!1===g.getConsumed()?(n.ctatdebug("Investigating request response: "+a+" -> "+l.status+", for: "+g.getURL()),c=!1,0===l.status&&(c=!0,n.ctatdebug("Received message (status 0): ("+l.responseText+"), status: "+l.status),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(v))),
408==l.status&&(c=!0,n.ctatdebug("Received message (status 408): "+l.responseText),h&&CTATScrim.scrim.scrimDown()),502==l.status&&(c=!0,n.ctatdebug("Received message (status 502): "+l.responseText),h&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),200==l.status?(c=!0,n.ctatdebug("Processing 200 response ..."),null!==e?(b.push(l.responseText),null!==m&&m.processIncoming(l.responseText)):n.ctatdebug("Error: httphandler is null, can't process response!")):e&&e.processError&&
(c=!0,n.ctatdebug("Processing non-200 response, status "+l.status),e.processError(l.status,l.responseText)),!1===c&&n.ctatdebug("Error: status not handled for: "+l.status),n.ctatdebug("Marking connection as consumed ..."),g.setConsumed(!0)):(0===l.readyState&&n.ctatdebug("Received message (status 0, request not initialized)"),1===l.readyState&&n.ctatdebug("Received message (status 1, server connection established)"),2===l.readyState&&n.ctatdebug("Received message (status 2, request received)"),3===
l.readyState&&n.ctatdebug("Received message (status 3, processing request)")),a++)}}n.cleanup();for(a=0;a<b.length;a++)n.ctatdebug("Processing incoming message: "+a),c=b[a],-1!=c.indexOf("status=success")?n.ctatdebug("Info: logging success message received, not propagating to message handler"):(n.ctatdebug("Processing incoming message: "+c),e.processMessage(c))};this.processWSReply=function(b){n.ctatdebug("processWSReply() length "+(null===b?null:b.toString().length));"string"==typeof b&&(null!==
m&&m.processIncoming(b),-1!=b.indexOf("status=success")?n.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+b):(n.ctatdebug("Processing incoming message: "+b),e.processMessage(b)))};this.processWSClose=function(b){n.ctatdebug("processWSClose("+b+")");b instanceof CloseEvent&&n.ctatdebug("CloseEvent: code "+b.code+", reason "+b.reason+", wasClean "+b.wasClean);CTATLMS.is.Authoring()||CTATLMS.is.ToolsListener()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):
CTATScrim.scrim.handleTSDisconnect()};this.cleanup=function(){n.ctatdebug("cleanup ()");n.ctatdebug("checkEntries() httprequests.length "+d.length);for(var b=0,a=d.length-1;0<=a;a--){var c=d[a];if(c)if(!0===c.getConsumed())n.ctatdebug("checkEntries() removing["+a+"] ID: "+c.getID()),d.splice(a,1),b++;else if("function"==typeof c.getHTTPObject){var e=c.getHTTPObject();n.ctatdebug("checkEntries() checking["+a+"], readyState: "+(e?e.readyState:"null")+", consumed: "+c.getConsumed())}}n.ctatdebug("Removed "+
b+" entries")};this.retrieveProblemFile=function(b,a,c){var e=/\.([A-z]*)$/.exec(b);e&&e[1]&&"nools"===e[1].toLowerCase()?(console.log("got a nools file:",b),c.processNools(b)):(console.log("got an xml file, maybe:",b),this.retrieveXMLFile(b,a,c))};this.getFileRequest=function(b,a,c){var e=-1!=(location.href?location.href:b).indexOf("file://")?!0:!1;location.href||n.ctatdebug("We can't check location.href in the current configuration");if(e)c=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+
b+" - You are trying to use the file:// protocol, which is not allowed in this browser."),n.ctatdebug("onerror GET for fileName "+c),CTAT.ToolTutor.sendToInterface(c,!0);else return r=b,b=new CTATConnection,b.assignReceiveFunction(function(b,c,e){"undefined"==typeof e&&(e="function"==typeof this.getHTTPObject&&this.getHTTPObject());n.ctatdebug("onready... GET for xmlFile xmlhttp "+e+", .readyState & .status "+(e?e.readyState+" & "+e.status:""));e&&4!=e.readyState||(e&&200==e.status&&a(e),e&&404==
e.status&&(b=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file","("+r+") not found"),n.ctatdebug("Error loading xmlFile "+r+": "+b),CTAT.ToolTutor.sendToInterface(b,!0)))}),b.assignFailFunction(c),b};this.retrieveXMLFile=function(b,a,c){n.ctatdebug("retrieveXMLFile ("+b+")");a=this.getFileRequest(b,function(b){b.responseXML?(n.ctatdebug("parsing brd xml using something else"),b=b.responseXML.documentElement):(n.ctatdebug("parsing brd xml using node"),b=(new CTATXML).parseXML(b.responseText));
null===b?(b=(new CTATTutorMessageBuilder).createErrorMessage("Error parsing xmlFile "+r),n.ctatdebug("Error parsing xmlFile "+r+": "+b),CTAT.ToolTutor.sendToInterface(b,!0)):c.processXML(b)},function(){var b=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+r+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");n.ctatdebug("onerror GET for xmlFile "+
b);CTAT.ToolTutor.sendToInterface(b,!0);c.processXML(null)});a.setMethod("GET");a.setURL(b);a.setContentType("text/plain");a.send()};this.retrieveJSONFile=function(b,a){n.ctatdebug("retrieveJSONFile ("+b+")");var c=this.getFileRequest(b,function(){4==c.readyState&&200==c.status&&(n.ctatdebug("Successfully retrieved file: "+b),a(JSON.parse(c.responseText)))},function(){var b=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+r+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
n.ctatdebug("onerror GET for xmlFile "+b);CTAT.ToolTutor.sendToInterface(b,!0)});c.open("GET",b,!0);c.setRequestHeader("Content-type","text/plain");c.send()};this.retrieveFile=function(b,a){n.ctatdebug("retrieveFile ("+b+")");var c=this.getFileRequest(b,function(){4==c.readyState&&200==c.status&&(n.ctatdebug("Successfully retrieved file: "+b),a(c.responseText))},function(){var b=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+r+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");
n.ctatdebug("onerror GET for xmlFile "+b);CTAT.ToolTutor.sendToInterface(b,!0)});c.open("GET",b,!0);c.setRequestHeader("Content-type","text/plain");c.send()};this.then=function(a,c){return b&&"function"==typeof b.then?b.then(a,c):{then:function(){console.log("CTATCommLibrary.then() not supported")}}}};CTATCommLibrary.setAuthenticityToken=function(a){Array.isArray(a)&&(a=0<a.length?a[0]:"");a&&(CTATCommLibrary.authenticityToken=decodeURIComponent(a))};CTATCommLibrary.getAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken&&(""===a||0>a.search(/authenticity_token=/)&&0<=a.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+a+(a?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):a};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(a){if(a&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");a=a.replace("ws:","wss:");var g=CTATConfiguration.get("remoteSocketSecurePort");g&&(a=a.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+g));ctatdebug("url after replace: "+a)}return a};var CTATSequencer=function(){CTATBase.call(this,"CTATSequencer","sequencer");var a=this,g=new CTATPackage,f=new CTATXML,c=null,d="sequential",b=null;this.setAlgorithm=function(b){d=b};this.getAlgorithm=function(){return d};this.handlePackageRetrieval=function(c){a.ctatdebug("handlePackageRetrieval ()");g.init(c);null!=b&&b(g)};this.processXML=function(c){a.ctatdebug("parseXML ()");g.init(c);null!=b&&b(g)};this.init=function(e,d,l){useDebuggingBasic=!0;a.ctatdebug("init ("+e+", "+d+", "+l+")");g.setURLPrefix(l);
b=d;c=new CTATCommLibrary(null,!1);c.retrieveXMLFile(e,f,this)};this.getSequenceType=function(){return"fixed"};this.getProblemSetSize=function(){a.ctatdebug("getProblemSetSize ()");var b=g.getProblemSets();return 0==b.length?(a.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),g.getProblems().getProblemSize()):b[0].getProblemSize()};this.getFirstProblem=function(){a.ctatdebug("getFirstProblem ()");var b=g.getProblemSets();return 0==b.length?(a.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),
g.getProblems()[0]):b[0].getFirstProblem()};this.getProblemList=function(){a.ctatdebug("getProblemList ()");var b=g.getProblemSets();return 0==b.length?(a.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),g.getProblems()):b[0].getProblems()};this.getNextProblem=function(b){a.ctatdebug("getNextProblem ()");var c=g.getProblemSets();return 0==c.length?(a.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),g.getProblems()[b]):c[0].getProblems()[b]};
this.addProblem=function(b,a,c,d,f){g.addProblem(b,a,c,d,f)}};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;Object.defineProperty(CTATSequencer,"PackageListURI",{enumerable:!1,configurable:!1,writable:!1,value:/^([^?]*\/)?package[.]xml$/i});var CTATActionEvaluationData=function(a){CTATBase.call(this,"CTATActionEvaluationData","actionevaluation");var g=0,f=0,c="",d=a;this.setClassification=function(b){this.classification=b};this.isHint=function(){return"HINT"==d};this.hasClassification=function(){return!0};this.setCurrentHintNumber=function(b){g=b};this.setTotalHintsAvailable=function(b){f=b};this.setHintID=function(b){c=b};this.getClassification=function(){return""};this.setEvaluation=function(b){d=b};this.getEvaluation=function(){return d};
this.getAttributeString=function(){var b="";if(!this.isHint())return b;b+='current_hint_number="'+g+'" ';b+='total_hints_available="'+f+'" ';""!==c&&(b+='hint_id="'+c+'" ');return b}};CTATActionEvaluationData.prototype=Object.create(CTATBase.prototype);CTATActionEvaluationData.prototype.constructor=CTATActionEvaluationData;var CTATVariable=function(){this.value=this.name=""};var CTATCurriculumService=function(a){CTATBase.call(this,"CTATCurriculumService","curriculum_service");var g=[],f=this;this.reset=function(){g=[]};this.addVariable=function(a,d){var b=new CTATVariable;b.name=a;b.value=d;g.push(b)};this.sendSummary=function(c){f.ctatdebug("sendSummary ()");var d=new CTATXML,b=c.getXMLObject();c=b.getElementsByTagName("ProblemSummary");c=$("<div>").html(c[0].innerHTML).text();d.xmlToString(b);var b=flashVars.getRawFlashVars(),d=b.curriculum_service_url,e=new CTATXML,
h=e.parse(c),e=e.getElementAttr(h,"CompletionStatus");d?(e&&e.toLowerCase().startsWith("complete")&&(CTATScrim.scrim.nextProblemScrimUp(),a.assignMessageListener(f),a.assignHandler(f)),g=[],this.addVariable("user_guid",b.user_guid),this.addVariable("session_id",b.session_id),this.addVariable("authenticity_token",b.authenticity_token),this.addVariable("school_name",b.school_name),this.addVariable("summary",c),c=b.target_frame,e=b.reuse_swf,b=b.run_problem_url,this.addVariable("targetFrame",c),this.addVariable("reuseSWF",
e),f.ctatdebug("CTATCurriculumService.sendSummary about to send targetFrame = "+c+", reuseSwf "+e+", runProblemUrl "+b),a.send_post_variables(d,g)):"complete"==e&&CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("CONGRATULATIONS_YOU_ARE_DONE"))};this.processOutgoing=function(a){f.ctatdebug('CTATCurriculumService.processOutgoing("'+a+'")')};this.processIncoming=function(a){var c=flashVars.getRawFlashVars().run_problem_url;f.ctatdebug("CTATCurriculumService.processIncoming("+(a?a.substring(0,
12)+"...":"")+") parent.location.replace "+parent.location.replace+', runProblemUrl "'+c+'"');if(c&&parent&&parent.location){var b=CTATCommShell.commShell.getLoggingLibrary();b&&b.then(function(){parent.location.replace(c)},function(){console.log("CTATCurriculumService: cannot chain to logging lib "+b)})}};this.processMessage=function(a){this.ctatdebug("CTATCurriculumService.processMessage("+(a?a.substring(0,30)+"...":"")+")")};this.updateFlashVars=function(a){f.ctatdebug("UpdateFlashVars ()")};this.checkProtocol=
function(a){return"localhost"==a||"127.0.0.1"==a?!0:null===/^http[s]?:\/\/([^\/]+)\//.exec(a)||4096<=a.length?!1:!0}};CTATCurriculumService.prototype=Object.create(CTATBase.prototype);CTATCurriculumService.prototype.constructor=CTATCurriculumService;var CTATHTMLManager=function(){var a=null,g="";this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var f,c=0;c<a.length;c++)f=a[c],ctatdebug(f)};this.initEntities=function(){null==a&&(a=[],a["&amp;"]="*!*",a["&nbsp;"]="\u00a0",a["&iexcl;"]="\u00a1",a["&cent;"]="\u00a2",a["&pound;"]="\u00a3",a["&curren;"]="\u00a4",a["&yen;"]="\u00a5",a["&brvbar;"]="\u00a6",a["&sect;"]="\u00a7",a["&uml;"]="\u00a8",a["&copy;"]=
"\u00a9",a["&reg;"]="\u00ae",a["&deg;"]="\u00b0",a["&plusmn;"]="\u00b1",a["&sup1;"]="\u00b9",a["&sup2;"]="\u00b2",a["&sup3;"]="\u00b3",a["&acute;"]="\u00b4",a["&micro;"]="\u00b5",a["&frac14;"]="\u00bc",a["&frac12;"]="\u00bd",a["&frac34;"]="\u00be",a["&iquest;"]="\u00bf",a["&Agrave;"]="\u00c0",a["&Aacute;"]="\u00c1",a["&Acirc;"]="\u00c2",a["&Atilde;"]="\u00c3",a["&Auml;"]="\u00c4",a["&Aring;"]="\u00c5",a["&AElig;"]="\u00c6",a["&Ccedil;"]="\u00c7",a["&Egrave;"]="\u00c8",a["&Eacute;"]="\u00c9",a["&Ecirc;"]=
"\u00ca",a["&Euml;"]="\u00cb",a["&Igrave;"]="\u00cc",a["&Iacute;"]="\u00cd",a["&Icirc;"]="\u00ce",a["&Iuml;"]="\u00cf",a["&ETH;"]="\u00d0",a["&Ntilde;"]="\u00d1",a["&Ograve;"]="\u00d2",a["&Oacute;"]="\u00d3",a["&Ocirc;"]="\u00d4",a["&Otilde;"]="\u00d5",a["&Ouml;"]="\u00d6",a["&Oslash;"]="\u00d8",a["&Ugrave;"]="\u00d9",a["&Uacute;"]="\u00da",a["&Ucirc;"]="\u00db",a["&Uuml;"]="\u00dc",a["&Yacute;"]="\u00dd",a["&THORN;"]="\u00de",a["&szlig;"]="\u00df",a["&agrave;"]="\u00e0",a["&aacute;"]="\u00e1",a["&acirc;"]=
"\u00e2",a["&atilde;"]="\u00e3",a["&auml;"]="\u00e4",a["&aring;"]="\u00e5",a["&aelig;"]="\u00e6",a["&ccedil;"]="\u00e7",a["&egrave;"]="\u00e8",a["&eacute;"]="\u00e9",a["&ecirc;"]="\u00ea",a["&euml;"]="\u00eb",a["&igrave;"]="\u00ec",a["&iacute;"]="\u00ed",a["&icirc;"]="\u00ee",a["&iuml;"]="\u00ef",a["&eth;"]="\u00f0",a["&ntilde;"]="\u00f1",a["&ograve;"]="\u00f2",a["&oacute;"]="\u00f3",a["&ocirc;"]="\u00f4",a["&otilde;"]="\u00f5",a["&ouml;"]="\u00f6",a["&oslash;"]="\u00f8",a["&ugrave;"]="\u00f9",a["&uacute;"]=
"\u00fa",a["&ucirc;"]="\u00fb",a["&uuml;"]="\u00fc",a["&yacute;"]="\u00fd",a["&thorn;"]="\u00fe",a["&yuml;"]="\u00ff",a["&gt;"]=">",a["&lt;"]="<",a["&#61;"]="=",a["&361;"]="=",a["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");a["&apos;"]="\\'"};this.entitiesConvert=function(a){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return g=a};this.htmlEncode=function(a){return a};this.htmlDecode=function(a){return"undefined"!==
typeof $?$("<div/>").html(a).text():"undefined"!==typeof Entities?(new Entities).decode(a):a}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATLogMessageBuilder=function(){CTATBase.call(this,"CTATLogMessageBuilder","logmessagebuilder");var a=this,g=[],f=[];this.setContextName=function(a){CTATLogMessageBuilder.contextGUID=a};this.getContextName=function(){return CTATLogMessageBuilder.contextGUID};this.makeSessionElement=function(){var a=flashVars.getRawFlashVars();return void 0!=a.log_session_id&&null!=a.log_session_id?"<session_id>"+a.log_session_id+"</session_id>":"<session_id>"+a.session_id+"</session_id>"};this.createContextMessage=
function(c){a.ctatdebug("createContextMessage()");var d=new Date,b=flashVars.getRawFlashVars(),e='<context_message context_message_id="'+this.getContextName()+'" name="START_PROBLEM">';c||(e+=this.makeMetaElement(d));void 0!=b.class_name?""!=b.class_name?(c="<class>"+("<name>"+b.class_name+"</name>"),void 0!=b.school_name&&(c+="<school>"+b.school_name+"</school>"),void 0!=b.period_name&&(c+="<period>"+b.period_name+"</period>"),void 0!=b.class_description&&(c+="<description>"+b.class_description+
"</description>"),void 0!=b.instructor_name&&(c+="<instructor>"+b.instructor_name+"</instructor>"),c+="</class>"):c="<class />":c="<class />";e+=c;c=flashVars.getDatasetTypes();var f=flashVars.getDatasetNames();a.ctatdebug("Check: "+c.length+", "+f.length);if(null!=c&&null!=f){a.ctatdebug("We have valid data set names and types, adding to message ...");for(var d="<dataset>"+("<name>"+b.dataset_name+"</name>"),g=0;g<c.length;g++)a.ctatdebug("Adding ..."),d+='<level type="'+c[g]+'">',d+="<name>"+f[g]+
"</name>";d+="<problem ";a.ctatdebug('Checking vars ["problem_tutorflag"]: '+b.problem_tutorflag);a.ctatdebug('Checking vars ["problem_otherproblemflag"]: '+b.problem_otherproblemflag);if(void 0!=b.problem_tutorflag||void 0!=b.problem_otherproblemflag)void 0!=b.problem_tutorflag?d+=' tutorFlag="'+b.problem_tutorflag+'"':void 0!=b.problem_otherproblemflag&&(d+='tutorFlag="'+b.problem_otherproblemflag+'"');d=d+">"+("<name>"+b.problem_name+"</name>");d=void 0!=b.problem_context?d+("<context>"+b.problem_context+
"</context>"):d+"<context />";d+="</problem>";for(b=0;b<c.length;b++)d+="</level>";e+=d+"</dataset>"}b="";c=flashVars.getConditionNames();d=flashVars.getConditionTypes();f=flashVars.getConditionDescriptions();if(0<c.length)for(g=0;g<c.length;g++)b+="<condition><name>"+c[g]+"</name>",b+=""==d[g]?"":"<type>"+d[g]+"</type>",b+=""==f[g]?"":"<desc>"+f[g]+"</desc>",b+="</condition>";var e=e+b,b=flashVars.getCustomFields(),m;for(m in b)b.hasOwnProperty(m)&&(e+="<custom_field>",e+="<name>"+m+"</name>",e+=
"<value>"+b[m]+"</value>",e+="</custom_field>");e+="</context_message>";a.ctatdebug("messageString = "+e);return e};this.createSemanticEventToolMessage=function(c,d,b,e,h,l){a.ctatdebug("createSemanticEventToolMessage("+l+")");var m=new Date;flashVars.getRawFlashVars();var n='<tool_message context_message_id="'+this.getContextName()+'">';h||(n+=this.makeMetaElement(m));d='<semantic_event transaction_id="'+d+'" name="'+b+'"';""!=e&&(d+=' subtype="'+e+'"');void 0!=l&&""!=l&&(d+=' trigger="'+l+'"');
n+=d+"/>";e="<event_descriptor>";c=c.toXMLString(!0);n+=e+c+"</event_descriptor>";n+=this.createCustomFields(g,f);n+="</tool_message>";a.ctatdebug("messageString = "+n);return n};this.createUIEventToolMessage=function(c,d,b,e){a.ctatdebug("createUIEventToolMessage()");var h=new Date;flashVars.getRawFlashVars();var l='<tool_message context_message_id="'+this.getContextName()+'">';e||(l+=this.makeMetaElement(h));l+='<ui_event name="'+d+'">'+b+"</ui_event>";c="<event_descriptor>"+c.toSerializedString();
l=l+(c+"</event_descriptor>")+this.createCustomFields(g,f);l+="</tool_message>";a.ctatdebug("messageString = "+l);return l};this.createTutorMessage=function(c,d,b,e,h,l,m,n){a.ctatdebug("createTutorMessage()");var p=new Date;flashVars.getRawFlashVars();var v='<tutor_message context_message_id="'+this.getContextName()+'">';n||(v+=this.makeMetaElement(p));d='<semantic_event transaction_id="'+d+'" name="'+b+'"';""!==l&&(d+=' subtype="'+l+'"');v+=d+"/>";c="<event_descriptor>"+c.toXMLString(!0);v+=c+"</event_descriptor>";
c="<action_evaluation ";e.hasClassification()&&null!=e.getAttributeString()&&(c+=e.getAttributeString());c+=">"+e.getEvaluation()+"</action_evaluation>";v+=c;""!=h&&(v+="<tutor_advice>"+h+"</tutor_advice>");null!=m&&(a.ctatdebug("Adding skills to log message ..."),v+=m.toLogString());v+=this.createCustomFields(g,f);v+="</tutor_message>";a.ctatdebug("messageString = "+v);return v};this.createGenericMessage=function(c,d){a.ctatdebug("createGenericMessage()");flashVars.getRawFlashVars();var b='<message context_message_id="'+
this.getContextName()+'">',b=b+c+"</message>";a.ctatdebug("messageString = "+b);return b};this.makeMetaElement=function(c){a.ctatdebug("makeMetaElement ()");var d=flashVars.getRawFlashVars(),b;b="<meta>"+("<user_id>"+d.user_guid+"</user_id>");b+="<session_id>"+d.session_id+"</session_id>";b+="<time>"+this.formatTimeStamp(c)+"</time>";return b+="<time_zone>"+flashVars.getTimeZone()+"</time_zone></meta>"};this.wrapForOLI=function(c){a.ctatdebug("wrapForOLI ()");var d=new Date,b=flashVars.getRawFlashVars();
c=encodeURIComponent(c);var e;e='<?xml version="1.0" encoding="UTF-8"?><log_action '+('auth_token="'+encodeURIComponent(b.auth_token)+'" ');e=void 0!=b.log_session_id&&null!=b.session_id?e+('session_id="'+b.log_session_id+'" '):e+('session_id="'+b.session_id+'" ');e=e+'action_id="EVALUATE_QUESTION" '+('user_guid="'+b.user_guid+'" ');e+='date_time="'+this.formatTimeStampOLI(d)+'" ';e+='timezone="'+flashVars.getTimeZone()+'" ';e+='source_id="'+b.source_id+'" ';e=b.activity_context_guid?e+('external_object_id="'+
b.activity_context_guid+'" info_type="tutor_message.dtd">'):e+'external_object_id="" info_type="tutor_message.dtd">';return e+c+"</log_action>"};this.createLogSessionStart=function(){a.ctatdebug("createLogSessionStart ()");var c=new Date;a.ctatdebug("Date: "+c);var d='<log_session_start timezone="'+flashVars.getTimeZone()+'" ',b=flashVars.getRawFlashVars(),d=d+('date_time="'+this.formatTimeStampOLI(c)+'" '),d=d+('auth_token="'+b.auth_token+'" '),d=d+('session_id="'+b.session_id+'" '),d=d+('user_guid="'+
b.user_guid+'" ');return d+'class_id="" treatment_id="" assignment_id="" info_type="tutor_message.dtd"/>'};this.formatTimeStamp=function(c){a.ctatdebug("formatTimeStamp ("+c+")");var d="",b=c.getUTCFullYear(),d=d+(b+"-"),b=c.getUTCMonth();b++;d+=(10>b?"0"+b:b)+"-";b=c.getUTCDate();d+=(10>b?"0"+b:b)+" ";b=c.getUTCHours();d+=(10>b?"0"+b:b)+":";b=c.getUTCMinutes();d+=(10>b?"0"+b:b)+":";b=c.getUTCSeconds();d+=10>b?"0"+b:b;c=c.getUTCMilliseconds();return d+"."+c};this.formatTimeStampOLI=function(c){a.ctatdebug("formatTimeStampOLI ("+
c+")");var d="",b=c.getUTCFullYear(),d=d+(b+"/"),b=c.getUTCMonth();b++;d+=(10>b?"0"+b:b)+"/";b=c.getUTCDate();d+=(10>b?"0"+b:b)+" ";b=c.getUTCHours();d+=(10>b?"0"+b:b)+":";b=c.getUTCMinutes();d+=(10>b?"0"+b:b)+":";b=c.getUTCSeconds();d+=10>b?"0"+b:b;c=c.getUTCMilliseconds();return d+"."+c};this.resetCustomFields=function(){a.ctatdebug("resetCustomFields ()");g=[];f=[]};this.createCustomFields=function(c,d){a.ctatdebug("createCustomFields ()");if(null==c||null==d)return a.ctatdebug("No custom fields provided"),
"";a.ctatdebug("Processing "+c.length+" custom fields ...");for(var b="",e=0;e<c.length;e++)a.ctatdebug("Adding custom field: ["+c[e]+"],["+d[e]+"]"),b+="<custom_field>",b+="<name>"+c[e]+"</name>",b+="<value>"+d[e]+"</value>",b+="</custom_field>";return b};this.addCustomFields=function(c,d){a.ctatdebug("addCustomFields () "+(c?c.length:"null"));if(void 0!=c)for(var b=0;b<c.length;b++)g.push(c[b]),f.push(d[b])};this.addCustomField=function(c,d){a.ctatdebug("addCustomfield ("+c+","+d+")");g.push(c);
f.push(d)};this.getCustomFieldNames=function(){return g};this.getCustomFieldValues=function(){return f}};CTATLogMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATLogMessageBuilder.prototype.constructor=CTATLogMessageBuilder;CTATLogMessageBuilder.contextGUID="";CTATLogMessageBuilder.commLogMessageBuilder=null;var CTATCustomLogElementObject=function(){this.reset=function(){};this.addCustomLogElement=function(a,g){customElementsNames.push(a);customElementsTypes.push(a)};this.getCustomElementNames=function(){return customElementsNames};this.getCustomElementTypes=function(){return customElementsTypes}};var loggingDisabled=!1,CTATLoggingLibrary=function(a){CTATBase.call(this,"CTATLoggingLibrary","logginglibrary");var g=this,f=!0,c=!1,d=!1,b=[],e="undefined",h="undefined",l="undefined",m="undefined",n="undefined",p="undefined",v="undefined",r="undefined",u="UnassignedDataset",w="UnassignedLevelName",B="UnassignedLevelType",y=null,z=null,r=CTATGuid.guid();void 0!=a&&null!=a?(c=a,0==c&&(CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder)):CTATLogMessageBuilder.commLogMessageBuilder=
new CTATLogMessageBuilder;var q=new CTATCommLibrary;q.setName("commLoggingLibrary");q.setUseCommSettings(!1);q.setConnectionRefusedMessage("ERROR_CONN_LS");q.assignHandler(this);q.setFixedURL(CTATConfiguration.get("log_service_url"));this.getLastSAI=function(){return z};this.assignLogListener=function(b){y=b};this.generateSession=function(){b.session_id="ctat_session_"+CTATGuid.guid();return b.session_id};this.setLogClassName=function(b){e=b};this.setDatasetName=function(b){u=b};this.setDatasetLevelName=
function(b){w=b};this.setDatasetLevelType=function(b){B=b};this.setSchool=function(b){h=b};this.setPeriod=function(b){l=b};this.setDescription=function(b){m=b};this.setInstructor=function(b){n=b};this.setProblemName=function(b){p=b};this.setProblemContext=function(b){v=b};this.setUserID=function(b){r=b};this.getLoggingCommLibrary=function(){return q};this.setUseSessionLog=function(b){f=b};this.setLoggingURL=function(b){g.getLoggingCommLibrary().setFixedURL(b)};this.getSessionIdentifierBundle=function(){var a=
[];a.class_name=e;a.school_name=h;a.period_name=l;a.class_description=m;a.instructor_name=n;a.dataset_name=u;a.problem_name=p;a.problem_context=v;a.auth_token="";a.user_guid=r;a.session_id=b.session_id;a.source_id="tutor";a.dataset_level_name1=w;a.dataset_level_type1=B;return a};this.setupExternalLibraryUsage=function(){g.ctatdebug("setupExternalLibraryUsage ()");b.class_name=e;b.school_name=h;b.period_name=l;b.class_description=m;b.instructor_name=n;b.dataset_name=u;b.problem_name=p;b.problem_context=
v;b.auth_token="";b.user_guid=r;b.session_id="ctat_session_"+CTATGuid.guid();b.source_id="tutor";b.dataset_level_name1=w;b.dataset_level_type1=B;flashVars=CTATConfiguration.generateDefaultConfigurationObject();flashVars.assignRawFlashVars(b)};this.initCheck=function(){g.ctatdebug("initCheck ()");0==c&&0==d&&(g.setupExternalLibraryUsage(),d=!0)};this.sendMessage=function(b){g.ctatdebug("sendMessage ()");g.ctatdebug("Raw log message to send: "+b);this.sendMessageInternal(b);null!=y&&y(b)};this.sendMessageInternal=
function(b){g.ctatdebug("sendMessageInternal ()");if(!0===loggingDisabled)g.ctatdebug("Warning: loggingDisabled==true");else if(1==c){var a=CTATConfiguration.get("Logging");if("ClientToService"!=a&&"ClientToLogServer"!=a)g.ctatdebug("Logging is turned off, as per: "+a);else{var e=CTATConfiguration.get("tutoring_service_communication");"ClientToService"!=a||"http"!=e&&"https"!=e||(a=CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),g.setLoggingURL(a),g.ctatdebug("Reconfigured the logging url to be: "+
a));g.ctatdebug("Pre encoded log message: "+b);0>b.indexOf("<log_session_start")&&(b=CTATLogMessageBuilder.commLogMessageBuilder.wrapForOLI('<?xml version="1.0" encoding="UTF-8"?><tutor_related_message_sequence version_number="4">'+b+"</tutor_related_message_sequence>"));g.ctatdebug("Encoded log message: "+b);CTATLMS.logEvent(b);CTATConfiguration.get("log_service_url")&&q.sendXMLNoBundle(b)}}else g.ctatdebug("Use internal: "+c)};this.startProblem=function(){g.ctatdebug("startProblem ()");g.initCheck();
g.logSessionStart();CTATLogMessageBuilder.commLogMessageBuilder||(CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder);g.sendMessage(CTATLogMessageBuilder.commLogMessageBuilder.createContextMessage(!0))};this.logSessionStart=function(){g.ctatdebug("logSessionStart ()");g.initCheck();var b=CTATConfiguration.getRawFlashVars();void 0!=b.SessionLog&&("false"==b.SessionLog||"boolean"==typeof b.SessionLog&&!1===b.SessionLog?(g.ctatdebug("Turning SessionLog off ..."),f=!1):(g.ctatdebug("Turning SessionLog on ..."),
f=!0));!0===f&&(CTATLogMessageBuilder.commLogMessageBuilder||(CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder),this.sendMessage(CTATLogMessageBuilder.commLogMessageBuilder.createLogSessionStart()))};this.logSemanticEvent=function(b,a,c,e,d,f,h){g.ctatdebug("logSemanticEvent ("+h+")");g.initCheck();z=a;var m=new Date;CTATLogMessageBuilder.commLogMessageBuilder.resetCustomFields();CTATLogMessageBuilder.commLogMessageBuilder.addCustomFields(d,f);CTATLogMessageBuilder.commLogMessageBuilder.addCustomField("tool_event_time",
CTATLogMessageBuilder.commLogMessageBuilder.formatTimeStamp(m)+" UTC");b=CTATLogMessageBuilder.commLogMessageBuilder.createSemanticEventToolMessage(a,b,c,e,!0,h);this.sendMessage(b)};this.logTutorResponse=function(b,a,c,e,d,f,h,m,l){g.ctatdebug("logTutorResponse ()");g.initCheck();z=a;var w=new Date;CTATLogMessageBuilder.commLogMessageBuilder.resetCustomFields();CTATLogMessageBuilder.commLogMessageBuilder.addCustomFields(m,l);CTATLogMessageBuilder.commLogMessageBuilder.addCustomField("tutor_event_time",
CTATLogMessageBuilder.commLogMessageBuilder.formatTimeStamp(w)+" UTC");g.ctatdebug("Formatting feedback ...");void 0!=f&&null!=f?f="<![CDATA["+CTATGlobals.languageManager.filterString(f)+"]]\x3e":(g.ctatdebug("No feedback provided, using empty string"),f="");g.ctatdebug("Creating tutor message ...");b=CTATLogMessageBuilder.commLogMessageBuilder.createTutorMessage(a,b,c,d,f,e,h,!0);this.sendMessage(b);return b};this.processMessage=function(b){g.ctatdebug("processMessage ()");g.ctatdebug("Response from log server: "+
b)};this.start=function(){g.ctatdebug("start ()");var b=g.generateSession();g.startProblem();return b};this.logInterfaceAttempt=function(b,a,c,e){g.ctatdebug("logInterfaceAttempt ()");e=CTATGuid.guid();b=new CTATSAI(b,a,c);b.setInput(c);z=b;this.logSemanticEvent(e,b,"ATTEMPT","");return e};this.logInterfaceAttemptSAI=function(b,a){g.ctatdebug("logInterfaceAttemptSAI ()");z=b;var c=CTATGuid.guid();this.logSemanticEvent(c,b,"ATTEMPT","");return c};this.logResponse=function(b,a,c,e,d,f,h,m){g.ctatdebug("logResponse ()");
a=new CTATSAI(a,c,e);a.setInput(e);e=new CTATActionEvaluationData("");e.setEvaluation(f);void 0==m?this.logTutorResponse(b,a,d,"",e,h):this.logTutorResponse(b,a,d,"",e,h,null,m.getCustomElementNames(),m.getCustomElementTypes())};this.logResponseSAI=function(b,a,c,e,d,f){g.ctatdebug("logResponse ()");var h=new CTATActionEvaluationData("");h.setEvaluation(e);void 0==f?this.logTutorResponse(b,a,c,"",h,d):this.logTutorResponse(b,a,c,"",h,d,null,f.getCustomElementNames(),f.getCustomElementTypes())};this.endSession=
function(){this.generateSession()};this.then=function(b,a){return q&&"function"==typeof q.then?q.then(b,a):{then:function(){console.log("CTATLoggingLibrary.then() not supported")}}}};CTATLoggingLibrary.prototype=Object.create(CTATBase.prototype);CTATLoggingLibrary.prototype.constructor=CTATLoggingLibrary;var CTATArgument=function(){var a="",g="Undefined",f="String",c="text";this.setValue=function(a){g=a};this.getValue=function(){return g};this.setName=function(c){a=c};this.getName=function(){return a};this.setType=function(a){f=a};this.getType=function(){return f};this.setFormat=function(a){c=a};this.getFormat=function(){return c}};CTATArgument.prototype.clone=function(){var a=new CTATArgument;a.setValue(this.getValue());a.setType(this.getType());a.setFormat(this.getFormat());return a};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATStringUtil=function(){this.String2Boolean=function(a){switch(a){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(a,g,f){return a.replace(g,f)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(a,g,f,c){CTATBase.call(this,"CTATSAI","sai");var d=new CTATStringUtil,b="undefined",e=[],h=[],l=[],m=[],n=null,p=this,n="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return l};this.getArgument=function(b){if(0==l.length){var a=new CTATArgument;l.push(a)}return l[b]};this.getArgumentsTyped=function(){p.ctatdebug("getArgumentsTyped");var b,a=[];for(b=0;b<l.length;b++){var c=l[b];"Boolean"===c.getType()?(p.ctatdebug("Adding Boolean argument ("+
c.getValue()+") ..."),a.push(d.String2Boolean(c.getValue()))):"Number"===c.getType()?(p.ctatdebug("Adding Number argument ("+c.getValue()+") ..."),a.push(Number(c.getValue()))):"String"===c.getType()?"No_Value"===c.getValue()?(p.ctatdebug("Detected default argument ("+c.getValue()+"), setting contents to null instead"),a.push(null)):a.push(String(c.getValue())):p.ctatdebug("Unrecognized argument type: "+c.getType()+" in "+p.toSerializedString()+" IGNORING IT!!!")}p.ctatdebug("Resulting arguments: "+
a);return a};this.addSelection=function(b,a){var c=new CTATArgument;c.setValue(b);void 0!=a&&null!=a&&c.setType(a);e.push(c)};this.addAction=function(b){h.push(b)};this.checkDefaultArgument=function(){p.ctatdebug("checkDefaultArgument ()");if(0===l.length){p.ctatdebug("Adding default argument ...");var b=new CTATArgument;l.push(b)}};this.setArgument=function(b,a){p.checkDefaultArgument();for(var c=l.length;c<=b;++c)l.push(new CTATArgument);c=l[b];c.setValue(a);return c};this.addArgument=function(b,
a,c){this.ctatdebug("addArgument ("+b+","+a+","+c+")");var e=new CTATArgument;e.setValue(b);e.setType(a);e.setFormat(c);l.push(e);return e};this.addExistingArgument=function(b){l.push(b);return b};this.setSAI=function(a,c,e,d,f){p.setSelection(Array.isArray(a)?0<a.length?a[0]:"":a);p.setAction(Array.isArray(c)?0<c.length?c[0]:"":c);p.setInput(Array.isArray(e)?0<e.length?e[0]:"":e);p.setType(d);b=f};this.setInput=function(b){p.ctatdebug("setInput("+b+")");p.checkDefaultArgument();p.getArgument(0).setValue(b)};
this.getInputObject=function(){return 0===l.length?null:l[0]};this.getInput=function(){return 0===l.length?"":p.getArgument(0).getValue()};this.setType=function(b){p.checkDefaultArgument();p.getArgument(0).type=b};this.getType=function(){return 0===l.length?"":p.getArgument(0).type};this.setFormat=function(b){p.checkDefaultArgument();p.getArgument(0).setFormat(b)};this.getFormat=function(){return 0===l.length?"":p.getArgument(0).getFormat()};this.toString=function(){return"["+String(p.getSelection())+
","+String(p.getAction())+","+String(p.getInput())+"]"};this.setSelection=function(b,a){var c=p.getSelectionObject();null==c?(c=new CTATArgument,c.setValue(b),void 0!=a&&null!=a&&c.setType(a),e.push(c)):c.setValue(b)};this.getSelectionObject=function(){return 0==e.length?null:e[0]};this.getSelection=function(){if(0==e.length)return null;var b=e[0];return"object"===typeof b?b.getValue():b};this.setAction=function(b){0<h.length?h[0]=b:h.push(b)};this.getAction=function(){return 0==h.length?null:h[0]};
this.appendToSelectionArray=function(b,a){var c=new CTATArgument;c.setValue(String(b));void 0!=a&&null!=a&&c.setType(a);e.push(c)};this.setSelectionArray=function(b){e=[];for(var a=0;a<b.length;a++)p.appendToSelectionArray(b[a],"String")};this.getSelectionArray=function(){for(var b=[],a=0;a<e.length;a++){var c=e[a];"object"===typeof c?b.push(e[a].getValue()):b.push(c)}return b};this.appendToActionArray=function(b){null==b?h.push(""):h.push(String(b))};this.setActionArray=function(b){h=null==b?[]:
Array.isArray(b)?b.slice():[String(b)]};this.getActionArray=function(){return h};this.appendToInputArray=function(b){p.ctatdebug("appendToInputArray ("+b+")");null==b?p.addArgument("","String","text"):p.addArgument(b,"String","text")};this.setInputArray=function(b){l=[];if(null!=b)for(var a=0;a<b.length;a++)p.appendToInputArray(b[a])};this.getInputArray=function(){p.ctatdebug("getInputArray ("+l.length+")");m=[];for(var b=0;b<l.length;b++){var a=l[b];"object"===typeof a?(p.ctatdebug("Adding object value ("+
a.getValue()+") to temp input array"),m.push(a.getValue())):(p.ctatdebug("Adding string value ("+a+") to temp input array"),m.push(a))}return m};this.setPrompt=function(a){b=a};this.getPrompt=function(){return b};this.propagate=function(b){p.ctatdebug("propagate ()");b=b.getArguments();for(var a=0;a<b.length;a++){var c=b[a],e=l[a];if(null===c||null===e){p.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}e.setValue(c.getValue())}};this.fromString=function(b){b=
n.parse(b);p.fromXML(b)};this.fromXML=function(b){p.ctatdebug("fromXML ()");l=[];b=n.getElementChildren(b);for(var a,c=0;c<b.length;c++){var e=b[c];if("selection"==n.getElementName(e)||"Selection"==n.getElementName(e)){for(var d=n.getElementChildren(e),f=!1,g=0;g<d.length;g++)a=d[g],"value"==n.getElementName(a)&&(a=n.getNodeTextValue(a),1>g?p.setSelectionArray(a):p.appendToSelectionArray(a),f=!0,p.setSelection(a));!1===f&&(a=n.getNodeTextValue(e),p.setSelectionArray(a),p.setSelection(a))}if("action"==
n.getElementName(e)||"Action"==n.getElementName(e)){d=n.getElementChildren(e);f=!1;for(g=0;g<d.length;g++)a=d[g],"value"==n.getElementName(a)&&(a=n.getNodeTextValue(a),1>g?p.setActionArray(a):p.appendToActionArray(a),f=!0,p.setAction(a));!1===f&&(a=n.getNodeTextValue(e),p.setActionArray(a),p.setAction(a))}if("inputArray"==n.getElementName(e)||"value"==n.getElementName(e)||"Input"==n.getElementName(e)){a=n.getElementChildren(e);var h;l=[];d=new CTATHTMLManager;f=new CTATArgument;g=0;l.push(f);for(var m=
0;m<a.length;m++){var v=a[m];"value"==n.getElementName(v)&&(h=n.getElementChildren(v),null!==h?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+h.length),1===h.length?(h=d.htmlDecode(n.getNodeTextValue(v)),p.ctatdebug("Setting new value to: "+h),f.setValue(h)):(h=d.htmlDecode(n.getNodeTextValue(v)),p.ctatdebug("Setting new value to: "+h),f.setValue(h),f.setName(v.attributes.getNamedItem("name").value),f.setType(v.attributes.getNamedItem("type").value),f.setFormat(v.attributes.getNamedItem("format").value),
g++),1>m?p.setInputArray(h):p.appendToInputArray(h)):(v=d.htmlDecode(n.getNodeTextValue(v)),p.ctatdebug("Setting new value to: "+v),f.setValue(v),1>m?p.setInputArray(v):p.appendToInputArray(v)))}}if("prompt"==n.getElementName(e)||"Prompt"==n.getElementName(e))p.ctatdebug("Parsing prompt ..."),p.setPrompt(n.getNodeTextValue(e))}p.checkDefaultArgument()};this.appendFromElement=function u(b,a,c,e,d){p.ctatdebug("appendFromElement ()");e=String(n.getElementName(a)).toLowerCase();if(e==b||"value"==e)if(e=
n.getElementChildren(a),!Array.isArray(e)||1>e.length)0==d?c.push(n.getNodeTextValue(a)):p.appendToInputArray(n.getNodeTextValue(a));else for(a=0;a<e.length;++a)u(b,e[a],c,a,d)};this.setArrayFromElements=function(b){p.ctatdebug("setArrayFromElements ()");if(!b||!Array.isArray(b)||1>b.length)p.ctatdebug("can't get name: don't know whether selection, action or input");else{var a,c=String(n.getElementName(b[0])).toLowerCase();switch(c){case "selection":p.ctatdebug("Processing selection field ...");e=
[];for(a=0;a<b.length;++a)p.appendFromElement(c,b[a],e,a,!1);break;case "action":p.ctatdebug("Processing action field ...");h=[];for(a=0;a<b.length;++a)p.appendFromElement(c,b[a],h,a,!1);break;case "input":p.ctatdebug("Processing input field ...");l=[];for(a=0;a<b.length;++a)p.appendFromElement(c,b[a],l,a,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+c+'"');return}p.ctatdebug("CTATSAI.setArrayFromElements() eltName "+c+", length "+a+", selectionArray "+
p.getSelectionArray()+", actionArray "+p.getActionArray()+", inputArray "+p.getInputArray())}};this.fromXMLInternal=function(b){p.ctatdebug("fromXMLInternal ()");new CTATXML;l=[];b=n.getElementChildren(b);for(var a,c=0;c<b.length;c++){var e=b[c];if("selection"==n.getElementName(e)||"Selection"==n.getElementName(e)){for(var d=n.getElementChildren(e),f=!1,g=0;g<d.length;g++)a=d[g],"value"==n.getElementName(a)&&(a=n.getNodeTextValue(a),1>g?p.setSelectionArray(a):p.appendToSelectionArray(a),f=!0,p.setSelection(a));
!1===f&&(a=n.getNodeTextValue(e),p.setSelectionArray(a),p.setSelection(a))}if("action"==n.getElementName(e)||"Action"==n.getElementName(e)){d=e.childNodes;f=!1;for(g=0;g<d.length;g++)a=d[g],"value"==n.getElementName(a)&&(a=n.getNodeTextValue(a),1>g?p.setActionArray(a):p.appendToActionArray(a),f=!0,p.setAction(a));!1===f&&(a=n.getNodeTextValue(e),p.setActionArray(a),p.setAction(a))}if("inputArray"==n.getElementName(e)||"Input"==n.getElementName(e)){a=e.childNodes;l=[];var d=new CTATHTMLManager,f=new CTATArgument,
g=0,h;l.push(f);for(var m=0;m<a.length;m++)if(h=a[m],"value"==n.getElementName(h)){var u=n.getElementChildren(h);null!==u?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+u.length),1===u.length?(h=d.htmlDecode(n.getNodeTextValue(h)),p.ctatdebug("Setting new value to: "+h),f.setValue(h)):(h=d.htmlDecode(n.getNodeTextValue(h)),p.ctatdebug("Setting new value to: "+h),f.setValue(h),f.setName(n.getElementAttr("name")),f.setType(n.getElementAttr("type")),f.setFormat(n.getElementAttr("format")),
g++)):(h=d.htmlDecode(n.getNodeTextValue(h)),p.ctatdebug("Setting new value to: "+h),f.setValue(h));1>m?p.setInputArray(h):p.appendToInputArray(h)}}if("prompt"==n.getElementName(e)||"Prompt"==n.getElementName(e))p.ctatdebug("Parsing prompt ..."),p.setPrompt(n.getNodeTextValue(e))}p.checkDefaultArgument()};this.toXMLString=function(b){p.ctatdebug("toXMLString ()");return b?p.toLSxmlString():p.toTSxmlString()};this.toLSxmlString=function(){p.ctatdebug("toLSxmlString ()");for(var b="",a=0;a<e.length;a++){var c=
e[a];"object"===typeof c?(b="String"!=c.getType()?b+('<selection type="'+c.getType()+'">'):b+"<selection>",b+=c.getValue()+"</selection>"):b+="<selection>"+c+"</selection>"}b+="<action>"+p.getAction();for(a=1;a<h.length;a++)b+="</action><action>"+h[a];b+="</action>";for(a=0;a<l.length;a++)c=l[a],b="object"===typeof c?"String"!=c.getType()?b+('<input type="'+c.getType()+'"><![CDATA['+c.getValue()+"]]\x3e</input>"):b+("<input><![CDATA["+c.getValue()+"]]\x3e</input>"):b+("<input><![CDATA["+c+"]]\x3e</input>");
return b};this.toTSxmlString=function(){p.ctatdebug("toTSxmlString ()");var b;b="<Selection><value>"+p.getSelection();for(var a=1;a<e.length;a++){var c=e[a];b="object"===typeof c?b+("</value><value>"+c.getValue()):b+("</value><value>"+c)}b+="</value></Selection><Action><value>"+p.getAction();for(a=1;a<h.length;a++)b+="</value><value>"+h[a];b+="</value></Action><Input>";if(1<l.length)for(a=0;a<l.length;a++)c=l[a],b+='<value fmt="text" name="'+c.getName()+'" type="'+c.getType()+'"><![CDATA['+c.getValue()+
"]]\x3e</value>";else b+="<value><![CDATA["+p.getInput()+"]]\x3e</value>";return b+"</Input>"};this.toSerializedString=function(){var b;b=""+("<selection>"+p.getSelection()+"</selection><action>"+p.getAction()+"</action><inputArray>");for(var a=0;a<l.length;a++){var c=l[a];b+='<value fmt="text" name="'+c.getName()+'" type="'+c.getType()+'">'+c.getValue()+"</value>"}return b+"</inputArray>"};this.clone=function(){p.ctatdebug("clone ()");for(var b=new CTATSAI(p.getSelection(),p.getAction(),p.getInput(),
p.getPrompt()),a=0;a<p.getArguments().length;++a)b.setArgument(a,p.getArgument(a).clone());b.setSelectionArray(p.getSelectionArray().slice());b.setActionArray(p.getActionArray().slice());b.setInputArray(p.getInputArray().slice());p.ctatdebug("CTATSAI.clone() this "+p+", clone "+b+", clone inputArray "+b.getInputArray());return b};this.isDone=function(){var b=p.getSelection(),a=p.getAction();return null==b||null==a?!1:"done"==b.toString().toLowerCase()&&"buttonpressed"==a.toString().toLowerCase()};
var v=!1;if(Array.isArray(a)&&Array.isArray(g)&&(Array.isArray(f)||null==f)&&(p.setSelectionArray(a),p.setActionArray(g),p.setInputArray(f),v=!0,0<a.length&&0<g.length)){p.setSAI(a[0],g[0],null==f?null:f[0],"String",c);return}null!==a&&""!==a&&p.setSelection(a);null!==a&&(p.setSAI(a,g,f,"String",c),v||(p.setSelectionArray(Array.isArray(a)?a:[a]),p.setActionArray(Array.isArray(g)?g:[g]),p.setInputArray(Array.isArray(f)?f:[f]),v=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);
CTATSAI.prototype.constructor=CTATSAI;CTATSAI.delayedActionRegExp=/^([^:]+):([0-9]+)$/;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var a="",g="",f="",c="",d=0,b="",e=!1,h="",l="",m="",n="",p="";this.setSkillName=function(b){a=b};this.setDisplayName=function(b){g=b};this.setModelName=function(b){c=b};this.setCategory=function(b){f=b};this.setLevel=function(b){!0===isNaN(b)?ctatdebug("Error: attempting to set a level to NaN"):(d=b,this.setPKnown(String(d)))};this.setDescription=function(a){b=a};this.getSkillName=function(){return a};this.getDisplayName=function(){return g};
this.hasDisplayName=function(){return""!==g&&null!==g};this.getModelName=function(){return c};this.hasCategory=function(){return""!==f};this.hasModelName=function(){return""!==c};this.getCategory=function(){return f};this.getLevel=function(){return d};this.getDescription=function(){return b};this.setTouched=function(b){e=b};this.getTouched=function(){return e};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){var c='<skill label="'+g+'" pSlip="'+l+'" description="'+b;
return c+='" pKnown="'+m+'" category="'+f+'" pLearn="'+n+'" name="'+a+'" pGuess="'+h+'" history="'+p+'" />'};this.setPGuess=function(b){h=b};this.getPGuess=function(){return h};this.setPSlip=function(b){l=b};this.getPSlip=function(){return l};this.setPLearn=function(b){n=b};this.getPLearn=function(){return n};this.setPKnown=function(b){m=b};this.getPKnown=function(){return m};this.setSkillHistory=function(b){p=b};this.getSkillHistory=function(){return p}};CTATSkill.prototype=Object.create(CTATBase.prototype);
CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var a=this;this.fromXMLString=function(a,f){this.ctatdebug("fromXMLString ()");this.ctatdebug("Skills string: "+a);if(null===a)this.ctatdebug("Warning: skill object is null");else if(""===a)this.ctatdebug("Info: empty skill string provided, bump");else if(a){this.ctatdebug("CTATSkillSet.fromXMLString() Raw:     "+a);var c=f?a:decodeURIComponent(a.replace(/\+/g," "));this.ctatdebug("CTATSkillSet.fromXMLString() Decoded: "+
c);if(null!==/\/<value>.+<\/value>/.exec(c))this.parseByValue(c);else{var d=(new CTATXML).parseXML(c);this.parseByAttributes(d,c)}this.ctatdebug("fromXMLString () done")}else this.ctatdebug("Warning: skill object is undefined or otherwise empty.")};this.fromXMLData=function(a,f){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(f)?this.parseByValue(f):this.parseByAttributes(a);this.ctatdebug("fromXMLData () done")};this.parseByValue=function(g){this.ctatdebug("parseByValue()");if(g){g=
g.childNodes;for(var f=new CTATXML,c=0;c<g.length;c++){var d=f.getNodeTextValue(g[c]).split("`"),b=d[0].split(" ");4==d.length?this.addSkill(b[0],d[1],d[2],d[3],d[3],b[1]):this.addSkill(b[0],d[1],d[2],d[3],d[4],b[1])}}else a.ctatdebug("Error: aSkills is null")};this.parseDOM=function(a){this.ctatdebug("parseDOM()");var f=new CTATXML;a=f.getElementChildren(a);for(var c=0;c<a.length;c++){var d=f.getNodeTextValue(a[c]).split("`"),b=d[0].split(" ");4==d.length?this.addSkill(b[0],d[1],d[2],d[3],d[3],b[1]):
this.addSkill(b[0],d[1],d[2],d[3],d[4],b[1])}};this.parseByAttributes=function(g){this.ctatdebug("parseByAttributes()");if(g)if(g=g.childNodes)for(var f=0;f<g.length;f++){var c=g[f];if("Skill"==c.nodeName||"skill"==c.nodeName){this.ctatdebug("Parsing node ("+f+"): "+c.nodeName+" -> "+c.nodeValue);var d=c.attributes.getNamedItem("name");if(d=d?d.value:""){var b=c.attributes.getNamedItem("pKnown"),b=b?b.value:"",e=c.attributes.getNamedItem("description"),e=e?e.value:"",h=c.attributes.getNamedItem("label"),
h=h?h.value:"",l=c.attributes.getNamedItem("category"),l=l?l.value:"",m=c.attributes.getNamedItem("pGuess"),m=m?m.value:"",n=c.attributes.getNamedItem("pLearn"),n=n?n.value:"",p=c.attributes.getNamedItem("pSlip"),p=p?p.value:"",c=(c=c.attributes.getNamedItem("history"))?c.value:"";this.addSkill(d,b,.95,e,h,l,m,n,p,c)}}}else this.ctatdebug("Error: list of skill xml elements is null");else a.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};this.getSize=
function(){return this.internalSkillSet.length};this.addSkill=function(a,f,c,d,b,e,h,l,m,n){this.ctatdebug("addSkill() name = "+a+" level = "+f+" mastery = "+c+" aDescription = "+d+" adisplayName = "+b+" aCategory = "+e+" pguess= "+h+" plearn = "+l+" pslip = "+m+" history = "+n);a=this.setSkillLevel(a,f,c);this.ctatdebug("Configuring "+a.getDisplayName());d&&a.setDescription(d);b&&a.setDisplayName(b);e&&a.setCategory(e);(h||0===h)&&a.setPGuess(h);(l||0===l)&&a.setPLearn(l);(m||0===m)&&a.setPSlip(m);
""!==n&&a.setSkillHistory(n);return a};this.addSkillAsObject=function(a){this.addSkill(a.name,a.level,a.mastery,a.description,a.label,a.category,a.pGuess,a.pLearn,a.pSlip,"")};this.setSkillLevel=function(a,f,c){this.ctatdebug("setSkillLevel ("+a+","+f+","+c+")");c=this.getSkill(a);null===c?(this.ctatdebug("Skill not found, creating new one ..."),c=new CTATSkill,c.setSkillName(a),c.setLevel(f),this.internalSkillSet.push(c)):(this.ctatdebug("Skill found, adjusting ..."),c.setLevel(1),c.setLevel(f));
c.setTouched(!0);return c};this.getSkill=function(a){this.ctatdebug("getSkill ("+a+") -> "+this.internalSkillSet.length);if(!a)return null;for(var f=0;f<this.internalSkillSet.length;f++){var c=this.internalSkillSet[f];if(c.getSkillName()==a)return this.ctatdebug("Returning: "+f),c}return null};this.getSkillLevel=function(a){if(!a)return-1;for(var f in this.internalSkillSet)if(f.getSkillName()==a)return f.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");for(var a=[],
f=0;f<this.internalSkillSet.length;f++){var c=this.internalSkillSet[f];!0===c.getTouched()&&(this.ctatdebug("Adding touched skill: "+c.getSkillName()),a.push(c))}return a};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");for(var a=0;a<this.internalSkillSet.length;a++)this.internalSkillSet[a].setTouched(!1)};this.toSetPreferencesXMLString=function(){this.ctatdebug("toSetPreferencesXMLString ()");for(var a="<skills>",f=0;f<this.internalSkillSet.length;f++)a+=this.internalSkillSet[f].toSetPreferencesXMLString();
return a+"</skills>"};this.toLogString=function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var a="",f=0;f<this.internalSkillSet.length;f++){var c=this.internalSkillSet[f],a=a+('<skill probability="'+c.getLevel()+'"><name>'+c.getSkillName()+"</name>");c.hasCategory()&&(a+="<category>"+c.getCategory()+"</category>");c.hasModelName()&&(a+="<model_name>"+c.getModelName()+"</model_name>");a+="</skill>"}return a}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);
CTATSkillSet.prototype.constructor=CTATSkillSet;CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(a,g){this.name=a||"";this.value=g||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var a=null,g=0;this.isJSONObject=function(a){return a.ctat?!0:!1};this.parse=function(a){return this.parseJSON(a)};this.parseJSON=function(f){this.ctatdebug("parseJSON ()");a=null;if("string"==typeof f){this.ctatdebug("Parsing JSON as a string ... ");try{a=JSON.parse(f)}catch(d){return this.ctatdebug("Error parsing JSON message: "+d.message),a=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var c in a)return this.ctatdebug("Creating internal JSON object with name: "+
c),f=new CTATJSONObject,f.name=c,f.value=a[c],f;return null};this.getElementName=function(a){return"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.name};this.getElementValue=function(a){return null==a?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.value};this.getElementChildren=
function(a){if(null==a)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof a)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null;var c=a.value,d=[],b;for(b in c){var e=c[b];if("string"==typeof e)a=new CTATJSONObject,a.name=b,a.value=e,d.push(a);else if(null==e[0]||void 0==e[0])a=new CTATJSONObject,a.name=b,a.value=e,d.push(a);else for(var f in e)a=new CTATJSONObject,a.name=b,a.value=e[f],d.push(a)}return d};
this.getNodeTextValue=function(a){if("string"!=typeof a.value){var c=null;for(c in a.value)if("content"==c)return a.value[c].toString();for(c in a.value)if("value"==c)return a.value[c].toString()}return a.value};this.getElementAttr=function(a,c){var d=a.value,b;for(b in d)if(b==c)return d[b];return null};this.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};this.walkDOM=function(a){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");g=0;this.walk(a);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(a){g++;if(!(5<g)){var c=0,d;for(d in a){var b=a[d];this.ctatdebug("("+c+") typeof (key): "+typeof d+" -> typeof(value): "+typeof b+"("+b.length+")");"string"!=typeof b?(this.ctatdebug("walk ("+d+")"),this.walk(b)):this.ctatdebug("walk ("+d+") : "+b);c++}}};this.stringify=function(a){return this.toJSONString(a)};this.toJSONString=function(a){return JSON.stringify(a,null,2)};this.syntaxHighlight=function(a){"string"!=typeof a&&(a=JSON.stringify(a,void 0,2));a=a.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var c="number";/^"/.test(a)?c=/:$/.test(a)?"key":"string":/true|false/.test(a)?c="boolean":/null/.test(a)&&(c="null");return'<span class="'+c+'">'+a+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(a){function g(a){var c=[],e=b.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+b.stringify(a)+"): valueElts.length "+e.length);for(a=0;a<e.length;++a){var d=e[a];"value"!=b.getElementName(d)?console.log("CTATMessage.parseRules(): unexpected element name "+b.getElementName(d)+" at custom_fields["+a+"]"):(d=b.getNodeTextValue(d))&&c.push(d)}return c}function f(a){var c={},e=b.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+b.stringify(a)+
"): cfElts.length "+e.length);for(a=0;a<e.length;++a){var d=e[a];if("custom_field"==b.getElementName(d)){for(var f=null,g=null,d=b.getElementChildren(d),h=0,m=0;h<d.length&&2>m;++h){var l=d[h];switch(b.getElementName(l)){case "name":f=b.getNodeTextValue(l);m++;break;case "value":g=b.getNodeTextValue(l),m++}}f&&(c[f]=g?g:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+f+"]="+c[f]+";"))}}return c}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};
var c=a,d=null,b=null;void 0==a&&(c=null);b="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;c&&(this.ctatdebug("messageParser "+b+", messageObj "+c),c.children&&this.ctatdebug(c.children));var e="ungraded",h=!1,l=!1,m=new CTATSkillSet,n="",p="",v="",r="",u="",w=!0,B,y=null,z=null,q=null,F=!1;this.setURL=function(b){B=b};this.getURL=function(){return B};this.assignSAI=function(b){l=!0;y=b};this.setTransactionID=function(b){p=b};this.getTransactionID=function(){return p};this.setGradeResult=function(b){e=
b};this.getGradeResult=function(){return e};this.getXMLObject=function(){return c};this.getSkillsObject=function(){return m};this.getCustomFields=function(){return z};this.getRules=function(){return q};this.getSuccessMessage=function(){return v};this.getBuggyMsg=function(){return r};this.getHighlightMsg=function(){return u};this.parse=function(){this.ctatdebug("parse ()");if(null!==c){this.ctatdebug("messageParser: "+b);this.ctatdebug("Root name: "+b.getElementName(c));"tool_message"==b.getElementName(c)?
(this.ctatdebug("Detected tool message"),n="tool_message"):"message"!=b.getElementName(c)?(this.ctatdebug("Detected log message"),h=!0,n=b.getElementName(c)):(this.ctatdebug("Detected regular message"),h=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var a=b.getElementChildren(c),e=0;e<a.length;e++){var f=a[e];"properties"==b.getElementName(f)&&(ctatdebug("Found a 'properties' element ... "),d=b.getElementChildren(f))}this.ctatdebug("Message "+n+", with transaction id: "+
p)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var a="",e="",d="",w="",p=[],x=[],H=[];if("tool_message"==n){this.ctatdebug("Parsing s, a and i");a=b.getElementChildren(c);for(e=0;e<a.length;e++)if(d=a[e],"tool_message"==b.getElementName(d))for(d=b.getElementChildren(d),w=0;w<d.length;w++)p=d[w],"event_descriptor"==b.getElementName(p)&&(y=new CTATSAI,y.fromXMLInternal(p));l=!0}else{if(h){this.ctatdebug("isLogMessage ...");for(var F=b.getElementChildren(c),S=0;S<F.length;S++){var O=F[S];
if("event_descriptor"==b.getElementName(O))for(var O=b.getElementChildren(O),L=0;L<O.length;L++){var D=O[L];"selection"==b.getElementName(D)&&(a=b.getNodeTextValue(D),p.push(D));"action"==b.getElementName(D)&&(e=b.getNodeTextValue(D),x.push(D));"input"==b.getElementName(D)&&(d=b.getNodeTextValue(D),H.push(D));"prompt"==b.getElementName(D)&&(w=b.getNodeTextValue(D))}}}else for(this.ctatdebug("!isLogMessage ..."),F=b.getElementChildren(c),S=0;S<F.length;S++)if(O=F[S],"properties"==b.getElementName(O))for(O=
b.getElementChildren(O),L=0;L<O.length;L++){var D=O[L],P=b.getElementName(D);this.ctatdebug("Nodename: "+P);switch(P){case "URL":B=b.getNodeTextValue(D);break;case "Skills":m.parseByValue(D);break;case "SuccessMsg":v=a=b.getNodeTextValue(D);break;case "BuggyMsg":r=b.getNodeTextValue(D);break;case "Selection":a=b.getNodeTextValue(D);p.push(D);break;case "Action":e=b.getNodeTextValue(D);x.push(D);break;case "Input":d=b.getNodeTextValue(D);H.push(D);break;case "prompt":w=b.getNodeTextValue(D);break;
case "HighlightMsgText":u=b.getNodeTextValue(D);break;case "custom_fields":z=f(D);break;case "Rules":q=g(D)}}this.ctatdebug("SAI: "+a+","+e+","+d);""!==a&&null!==a?(y=new CTATSAI(a,e,d,w),y.setArrayFromElements(p),y.setArrayFromElements(x),y.setArrayFromElements(H),l=!0):(this.ctatdebug("No SAI found"),l=!1);this.ctatdebug("parseSAI () done, hassai: "+l+", ("+a+","+e+","+d+","+w+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=n){if(!h)for(var a=
b.getElementChildren(c),e=0;e<a.length;e++){var d=a[e];if("properties"==b.getElementName(d))for(var d=b.getElementChildren(d),f=0;f<d.length;f++){var g=d[f];"transaction_id"==b.getElementName(g)&&(p=b.getNodeTextValue(g))}}this.ctatdebug("parseTransactionID() done, id: "+p)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var a=b.getElementChildren(c),e=0;e<a.length;e++){var d=a[e];if("properties"==b.getElementName(d))for(var d=b.getElementChildren(d),f=0;f<d.length;f++){var g=
d[f];"MessageType"==b.getElementName(g)&&(n=b.getNodeTextValue(g))}}this.ctatdebug("parseMessageType() -> "+n)};this.getMessageType=function(){return n};this.getTransactionID=function(){return p};this.getSAI=function(){return l?y:new CTATSAI};this.getSelection=function(){return l?y.getSelection():""};this.getAction=function(){return l?y.getAction():""};this.getInput=function(){return l?y.getInput():""};this.getSelectionArray=function(){return l?y.getSelectionArray():[]};this.getActionArray=function(){return l?
y.getActionArray():[]};this.getInputArray=function(){return l?y.getInputArray():[]};this.getXML=function(){return c};this.getXMLString=function(b){if(c.xml)return c.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(c);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=n?"":this.getProperty("Indicator")};this.getIndicatorSub=function(){return"AssociatedRules"!=n?"":this.getProperty("IndicatorSub")};this.setProperty=function(a,c){this.ctatdebug("setProperty ("+
a+","+c+")");if(null!==d)for(var e=0;e<d.length;e++)b.getElementName(d[e]);else this.ctatdebug("Internal error: no messageProperties object available")};this.getProperty=function(a){if(!h)if(null!==d)for(var c=0;c<d.length;c++){var e=d[c];if(b.getElementName(e)==a)return b.getNodeTextValue(e)}else this.ctatdebug("Internal error: no messageProperties object available");return""};this.hasProperty=function(b){b=this.getProperty(b);return!h&&""!==b};this.hasSAI=function(){return l};this.isEndOfTransaction=
function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return h};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};this.getToolSelection=function(){return""};p=CTATMessage.makeTransactionId();this.parse();this.init=function(b){this.setMessageType(b)};
this.setSelection=function(b){y&&y.setSelection(b);this.setProperty("SELECTION",b)};this.setAction=function(b){y&&y.setAction(b);this.setProperty("ACTION",b)};this.setInput=function(b){y&&y.setInput(b);this.setProperty("INPUT",b)};this.lockTransactionId=function(b){if(null===b||"undefined"===typeof b||1>b.length)throw new CTATExampleTracerException("lockTranactionId() argument "+b+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,b);F=!0};this.setMessageType=function(b){this.setProperty(CTATMessage.MESSAGE_TYPE,
b);n=b};this.setTransactionId=function(b){if(!F){if(null===b||"undefined"===typeof b||1>b.length)b=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,b)}};this.suppressLogging=function(){w=!1};this.isLoggingSuppressed=function(){return!w};CTATMessage.create=function(b,a){var c=new CTATMessage;c.init(b);return c}};Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});
Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});CTATMessage.prototype=Object.create(CTATBase.prototype);CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATComponentDescription=function(){CTATBase.call(this,"CTATComponentDescription","");this.groupName=this.name=this.type="Unknown";this.height=this.width=this.y=this.x=0;this.tabIndex=this.zIndex=-1;this.styles={};this.params={};this.componentPointer=null;this.setComponentPointer=function(a){this.componentPointer=a};this.getComponentPointer=function(){return this.componentPointer};this.setGenericDefaults=function(){this.name="Generic name";this.styles={BackgroundColor:null,BorderColor:null,FontName:null,
FontSize:null,FontColor:null,FontBold:null,FontItalic:!1,FontUnderlined:!1,TextAlign:null,ShowHintHighlight:!1,blockOnCorrect:!1,disabledBackgroundColor:"#999999",disabledTextColor:"#999999",tutorComponent:null};return this}};CTATComponentDescription.prototype=Object.create(CTATBase.prototype);CTATComponentDescription.prototype.constructor=CTATComponentDescription;var CTATShellTools={ctat_base:new CTATBase("CTATShellTools","shelltools"),component_descriptions:{},registerComponentDescription:function(a){CTATShellTools.ctat_base.ctatdebug("registerComponentDescription ("+a.name+","+a.type+")");CTATShellTools.component_descriptions[a.name]=a},listComponents:function(){CTATShellTools.ctat_base.ctatdebug("listComponents ()");var a=CTATShellTools.component_descriptions,g;for(g in a){var f=a[g];CTATShellTools.ctat_base.ctatdebug("Obtaining component for "+f.name+
" with type: "+f.type);f=f.getComponentPointer();null!==f?CTATShellTools.ctat_base.ctatdebug("Component: "+f.getName()+" of instance: "+f.getClassName()):CTATShellTools.ctat_base.ctatdebug("Error: component pointer is null")}},feedback_components:[],registerFeedbackComponent:function(a,g,f,c,d){CTATShellTools.feedback_components.push({component:a,next:g,prev:f,showHints:c,showFeedback:d})},showNextHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.next&&a.next.bind(a.component)()})},
showPrevHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.prev&&a.prev.bind(a.component)()})},showFeedback:function(a){0==CTATShellTools.feedback_components.length?CTATScrim.scrim.OKScrimUp(a,null):CTATShellTools.feedback_components.forEach(function(g){g.showFeedback&&g.showFeedback.bind(g.component)(a)})},showHints:function(a){CTATShellTools.feedback_components.forEach(function(g){g.showHints&&g.showHints.bind(g.component)(a)})},getCurrentMs:function(){return(new Date).valueOf()},
getAllComponents:function(){var a=[];$(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return a},getNameFromGroup:function(a){CTATShellTools.ctat_base.ctatdebug("getNameFromGroup ("+a+")");var g=a.split(" ");return 1==g.length?a:g[0].substring(0,g[0].length-1)},findComponent:function(a){var g=CTATShellTools.component_descriptions,f=[],c=null;CTATShellTools.ctat_base.ctatdebug("findComponent("+a+")");if(!a)return[];for(var d=['div[data-ctat-component]:has(input[name="'+a+
'"])',"done"==a.toLowerCase()?".CTATDoneButton":"","hint"==a.toLowerCase()||"help"==a.toLowerCase()?".CTATHintButton":""],c=-1<a.indexOf(".")?$('[id="'+a+'"]'):$("#"+a),b=0;0===c.length&&b<d.length;b++)c=$(d[b]);if(0<c.length&&(c.each(function(){$(this).data("CTATComponent")&&f.push($(this).data("CTATComponent"))}),0<f.length))return f;CTATShellTools.ctat_base.ctatdebug("JQuery couldn't find the component, let's try our internal list ...");for(var e in g){c=g[e];if(!c||!c.name||!c.getComponentPointer())return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+
e+(c?c.name?"(no component pointer)":"(no name attribute)":"")),null;CTATShellTools.ctat_base.ctatdebug("Comparing "+c.name+" to: "+a);if(c.name==a)return CTATShellTools.ctat_base.ctatdebug("Found a component description for ["+c.name+"], returning pointer ("+c.getComponentPointer()+") ..."),f.push(c.getComponentPointer()),f;c.groupName==a&&(CTATShellTools.ctat_base.ctatdebug("Found the component group ("+c.groupName+"), adding component instance for "+c.name+" ..."),f.push(c.getComponentPointer()))}return 0===
f.length&&(CTATShellTools.ctat_base.ctatdebug("Info (groupArray.length==0), no appropriate component found, perhaps this is a group component"),-1!=a.indexOf("."))?(a=a.split("."),this.findComponent(a[0])):f},findComponentInstance:function(a,g){var f=CTATShellTools.findComponent(a,g);return 1==f.length?f[0]:f},findComponentByClass:function(a){var g=CTATShellTools.component_descriptions,f;for(f in g){var c=g[f];if(null===c)return null;if(null!==c.getComponentPointer()&&c.getComponentPointer().getClassName()==
a)return c.getComponentPointer()}a=$("."+a);return 0<a.length?a.first().data("CTATComponent"):null}};var CTATTutoringServiceMessageBuilder=function(){CTATBase.call(this,"CTATTutoringServiceMessageBuilder","__undefined__");this.createStartProblemMessage=function(a){this.ctatdebug("createStartProblemMessage ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>StartProblem</MessageType><ProblemName>"+a+"</ProblemName></properties></message>"};this.createInterfaceIdentificationMessage=function(a){this.ctatdebug("createInterfaceIdentificationMessage ("+a+")");return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceIdentification</MessageType><Guid>"+
a+"</Guid></properties></message>"};this.createInterfaceDescriptionMessage=function(a){this.ctatdebug("createInterfaceDescriptionMessage ()");message="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceDescription</MessageType>";message+="<WidgetType>"+a.getClassName()+"</WidgetType>";message+="<CommName>"+a.getName()+"</CommName>";message+="<UpdateEachCycle>false</UpdateEachCycle>";message+="<serialized>";message+="<"+a.getClassName()+' name="'+a.getName()+'" x="0" y="0" width="50" height="30" scaleX="1" scaleY="1" originalWidth="50" originalHeight="30" zIndex="-1" tabIndex="-1">';
message+="<Parameters><selection>";if("CTATRadioButton"==a.getClassName()||"CTATCheckBox"==a.getClassName())message+="<CTATComponentParameter>",message+="<name>group</name>",message+='<value fmt="text" name="Group Name" type="String" includein="sparse">'+a.getComponentGroup()+"</value>",message+="</CTATComponentParameter>";message+="</selection></Parameters>";message+="</"+a.getClassName()+">";message+="</serialized>";return message+="</properties></message>"};this.createSetPreferencesMessage=function(a,
g){this.ctatdebug("createSetPreferencesMessage ()");var f=CTATConfiguration.getRawFlashVars(),c;c="<message><verb>NotePropertySet</verb><properties><MessageType>SetPreferences</MessageType>"+("<log_service_url>"+f.log_service_url+"</log_service_url>");var d=!1,b=!1,e=f.Logging;this.ctatdebug("Parsing and processing logMethod: "+e);switch(e){case "ServiceToLogServer":d=!0;break;case "ServiceToDisk":b=!0;break;case "ServiceToDiskAndLogServer":b=d=!0;break;case "ClientToLogServer":b=d=!1;break;case "ClientToService":b=
d=!0}c=c+("<log_to_remote_server>"+d+"</log_to_remote_server><log_to_disk>"+b+"</log_to_disk>")+("<log_to_disk_directory>"+f.log_to_disk_directory+"</log_to_disk_directory>");c+="<logging>"+f.Logging+"</logging>";c+="<user_guid>"+f.user_guid+"</user_guid>";c+="<problem_name>"+f.problem_name+"</problem_name>";c+="<question_file><![CDATA["+f.question_file+"]]\x3e</question_file>";c+="<class_name>"+f.class_name+"</class_name>";c+="<school_name>"+f.school_name+"</school_name>";c+="<instructor_name>"+
f.instructor_name+"</instructor_name>";c+="<session_id>"+f.session_id+"</session_id>";c+="<source_id>"+f.source_id+"</source_id>";c+="<sui><![CDATA["+f.sui+"]]\x3e</sui>";c+="<problem_state_status>"+f.problem_state_status+"</problem_state_status>";c+="<curriculum_service_url>"+f.curriculum_service_url+"</curriculum_service_url>";c+="<restore_problem_url>"+f.restore_problem_url+"</restore_problem_url>";c+="<tutoring_service_communication>"+f.tutoring_service_communication+"</tutoring_service_communication>";
c+="<mode>"+f.mode+"</mode>";c+="<collaborators>"+f.collaborators+"</collaborators>";null!==CTATSkillSet.skills&&(c+=CTATSkillSet.skills.toSetPreferencesXMLString());c+="<CommShellVersion>"+a+"</CommShellVersion>";g&&(c+=g);return""+(c+"</properties></message>")};this.createTracerActionMessage=function(a,g){this.ctatdebug("createTracerActionMessage ()");var f;f="<message><verb>NotePropertySet</verb><properties><MessageType>TracerAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+g.toXMLString(!1);
return""+(f+"</properties></message>")};this.createInterfaceActionMessage=function(a,g){this.ctatdebug("createInterfaceActionMessage ()");var f;f="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")};this.createUntutoredActionMessage=function(a,g){this.ctatdebug("createUntutoredActionMessage ("+a+")");var f;f="<message><verb>NotePropertySet</verb><properties><MessageType>UntutoredAction</MessageType>"+
("<transaction_id>"+a+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")};this.createProblemSummaryRequestMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemSummaryRequest</MessageType></properties></message>"};this.createProblemRestoreEndMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemRestoreEnd</MessageType></properties></message>"};this.createInterfaceConfigurationEnd=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceConfigurationEnd</MessageType></properties></message>"};
this.createInCorrectActionMessage=function(a,g){this.ctatdebug("createInCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")};this.createURLResponse=function(a,g){CTATGlobal.debug(classType,"createURLResponse ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+
a+" ]]\x3e</URL><content><![CDATA[ "+btoa(g)+" ]]\x3e</content></properties></message>"};this.createCorrectActionMessage=function(a,g){this.ctatdebug("createCorrectActionMessage ()");var f;f="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+g.toXMLString(!1);return""+(f+"</properties></message>")}};CTATTutoringServiceMessageBuilder.prototype=Object.create(CTATBase.prototype);
CTATTutoringServiceMessageBuilder.prototype.constructor=CTATTutoringServiceMessageBuilder;var CTATMessageHandler=function(a){function g(){var b=!1,a,e=[],f="";for(a=d.length-1;0<=a;--a)if("SendWidgetLock"==d[a].getMessageType())switch(e=d.splice(a,1),f=e[0].getProperty("WidgetLockFlag"),String(f).toLowerCase()){case "no":case "off":case "false":b=!1;break;default:b=!0}c.ctatdebug("checkForSendWidgetLock() found "+e.length+" msg, wlFlag "+f+", result"+b);return b}CTATBase.call(this,"CTATMessageHandler","messagehandler");var f=null,c=this,d=[],b=null,e=0,b=CTATConfig.parserType_is_XML()?
new CTATXML:new CTATJSON;this.assignHandler=function(b){c.ctatdebug("assignHandler ()");f=b};this.reset=function(){c.ctatdebug("reset ()");d=[]};this.getInStartState=function(){return CTATMessageHandler.inStartState};var h=!1;this.receiveFromTutor=function(b){this.processMessage(b)};this.processMessage=function(a){c.ctatdebug("Incoming message: "+a);if(!0!==h)if(CTATConfig.parserType_is_JSON()&&-1!=a.indexOf("<?xml"))alert("Error: CTAT is configured to parse JSON but it received an XML message, disabling comm capabilities ..."),
h=!0;else if(CTATConfig.parserType_is_XML()&&0===a.indexOf("{"))alert("Error: CTAT is configured to parse XML but it received a JSON message, disabling comm capabilities ..."),h=!0;else{var e;c.ctatdebug("Attempting parse ...");e=b.parse(a);null===e?c.ctatdebug("Error parsing message: "+a):this.parseElement(e,a)}};this.parseElement=function(a,e){var d=b.getElementName(a);c.ctatdebug("parseElement ("+d+")");"CTATResponseMessages"!=d&&"StartStateMessages"!=d&&"MessageBundle"!=d||this.processMessageBundle(a);
"message"==d&&this.processSingleMessage(a,e)};this.processMessageBundle=function(a,e){var d=b.getElementName(a);c.ctatdebug("processMessageBundle ("+d+")");d=b.getElementChildren(a);if(null===d)c.ctatdebug("Error parsing bundle");else{ctatdebug("Processing "+d.length+" objects in bundle");for(var f=0;f<d.length;f++)this.parseElement(d[f])}};this.processSingleMessage=function(g,h){c.ctatdebug("processSingleMessage ("+b.getElementName(g)+")");a.sendToTools(h);h=new CTATMessage(g);var m=h.getProperty("subtype"),
m=!m||/tutor/i.test(m)?"tutor":m;f.updateLastActionTimestamp&&f.updateLastActionTimestamp();var l=b.getElementChildren(g);c.ctatdebug("Generated CTATMessage, now doing regular processing ...");for(var v=0;v<l.length;v++){var r=l[v];if("properties"==b.getElementName(r)){c.ctatdebug("Parsing properties ...");for(var u=b.getElementChildren(r),w=0;w<u.length;w++){var B=u[w];if("MessageType"==b.getElementName(B)){B=b.getNodeTextValue(B);c.ctatdebug("MessageType: "+B);switch(B){case "StateGraph":ctatdebug("Setting inStartState to true");
CTATMessageHandler.inStartState=!0;a.setGotProblemRestoreEnd(!1);this.processStateGraph(r);a.propagateShellEvent("StateGraph",h);break;case "StartProblem":c.ctatdebug("Setting inStartState to true");CTATMessageHandler.inStartState=!0;a.setGotProblemRestoreEnd(!1);this.processStartProblem(u);a.propagateShellEvent("StartProblem",h);break;case "InterfaceIdentification":this.processInterfaceIdentification(u);a.propagateShellEvent("InterfaceIdentification",h);break;case "InterfaceDescription":this.processInterfaceDescription(u);
a.propagateShellEvent("InterfaceDescription",h);break;case "GetAllInterfaceDescriptions":a.sendInterfaceDescriptionMessages();a.propagateShellEvent("GetAllInterfaceDescriptions",h);break;case "SendWidgetLock":c.ctatdebug("Found: SendWidgetLock");!0===this.getInStartState()&&d.push(h);a.propagateShellEvent("SendWidgetLock",h);break;case "CorrectAction":c.ctatdebug("Found: CorrectAction");!0===this.getInStartState()?d.push(h):f.processCorrectAction(h);a.propagateShellEvent("CorrectAction",h);break;
case "InCorrectAction":c.ctatdebug("Found: InCorrectAction");!0===CTATMessageHandler.inStartState?d.push(h):(c.ctatdebug("Handing incorrect message to messagehandler ..."),f.processInCorrectAction(h));a.propagateShellEvent("InCorrectAction",h);break;case "HighlightMsg":c.ctatdebug("Found: HighlightMsg");f.processHighlightMsg(h);a.propagateShellEvent("HighlightMsg",h);break;case "UnHighlightMsg":c.ctatdebug("Found: UnHighlightMsg");f.processUnHighlightMsg(h);a.propagateShellEvent("UnHighlightMsg",
h);break;case "AssociatedRules":c.ctatdebug("Found: AssociatedRules ("+u.length+")");for(var y=B="",z="",q=0;q<u.length;q++){var F=u[q];switch(b.getElementName(F)){case "TutorAdvice":B=b.getNodeTextValue(F);break;case "Actor":m=b.getNodeTextValue(F);break;case "Indicator":y=b.getNodeTextValue(F);break;case "StepID":b.getNodeTextValue(F);break;case "LogAsResult":b.getNodeTextValue(F);break;case "tool_selection":case "StudentSelection":z=b.getNodeTextValue(F);break;case "Skills":c.ctatdebug("Processing skills ..."),
null===CTATSkillSet.skills&&(c.ctatdebug("Interesting, there isn't a skillSet object yet. Creating ..."),CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(F)}}f.processAssociatedRules(h,y,B,z);break;case "BuggyMessage":c.ctatdebug("Found: BuggyMessage");f.processBuggyMessage(h);a.propagateShellEvent("BuggyMessage",h);break;case "SuccessMessage":c.ctatdebug("Found: SuccessMessage");f.processSuccessMessage(h);a.propagateShellEvent("SuccessMessage",h);break;case "InterfaceAction":c.ctatdebug("Found: InterfaceAction");
B=h.getSAI();-1!=B.getAction().indexOf(":")?(c.ctatdebug("Processing and storing timed interface action : "+B.getAction()),y=parseInt(B.getAction().substring(B.getAction().indexOf(":")+1)),c.ctatdebug("Target time: "+y),B.setAction(B.getAction().substring(0,B.getAction().indexOf(":"))),c.ctatdebug("Timing ..."),setTimeout(f.processInterfaceAction,y,h),setTimeout(a.propagateShellEvent,y,"InterfaceAction",h,m)):(c.ctatdebug("Processing regular (non-timed) interface action"),!0===CTATMessageHandler.inStartState?
(c.ctatdebug("inStartState==true => storing for later playback ..."),d.push(h)):(f.processInterfaceAction(h),a.propagateShellEvent("InterfaceAction",h,m)));break;case "UntutoredAction":c.ctatdebug("Found: UntutoredAction");B=h.getSAI();-1!=B.getAction().indexOf(":")?(c.ctatdebug("Processing and storing timed interface action : "+B.getAction()),y=parseInt(B.getAction().substring(B.getAction().indexOf(":")+1)),c.ctatdebug("Target time: "+y),B.setAction(B.getAction().substring(0,B.getAction().indexOf(":"))),
c.ctatdebug("Timing ..."),setTimeout(f.processUntutoredAction,y,h),setTimeout(a.propagateShellEvent,y,"UntutoredAction",h,m)):(c.ctatdebug("Processing regular (non-timed) interface action"),!0===CTATMessageHandler.inStartState?(c.ctatdebug("inStartState==true => storing for later playback ..."),d.push(h)):(f.processUntutoredAction(h),a.propagateShellEvent("UntutoredAction",h,m)));break;case "InterfaceIdentification":c.ctatdebug("Found: InterfaceIdentification");a.propagateShellEvent("InterfaceIdentification",
h);break;case "AuthorModeChange":c.ctatdebug("Found: AuthorModeChange");f.globalReset();a.propagateShellEvent("AuthorModeChange",h);break;case "ResetAction":c.ctatdebug("Found: ResetAction");f.globalReset();a.propagateShellEvent("ResetAction",h);break;case "ShowHintsMessage":c.ctatdebug("Found: ShowHintsMessage");B=!1;y=[];for(z=0;z<u.length;z++)if(q=u[z],"HintsMessage"==b.getElementName(q))for(q=b.getElementChildren(q),F=0;F<q.length;F++){var C=q[F];"value"==b.getElementName(C)&&(y.push(b.getNodeTextValue(C)),
B=!0)}!0===B?f.processHintResponse(h,y):c.ctatdebug("Error: incomplete hint message received");a.propagateShellEvent("ShowHintsMessage",h);break;case "ConfirmDone":c.ctatdebug("Found: ConfirmDone");f.processConfirmDone(h);a.propagateShellEvent("ConfirmDone",h);break;case "VersionInfo":c.ctatdebug("Found: VersionInfo");f.processVersionInfo(u);a.propagateShellEvent("VersionInfo",h);break;case "TutoringServiceAlert":c.ctatdebug("Found: TutoringServiceAlert");f.processTutoringServiceAlert(u);a.propagateShellEvent("TutoringServiceAlert",
h);break;case "TutoringServiceError":B=h.getProperty("Action");c.ctatdebug("Found: TutoringServiceError - actor "+m+", action "+B);var A;B&&(A=CTATSAI.delayedActionRegExp.exec(B))&&2<A.length&&1<A[2]?(y=parseInt(A[2]),h.setProperty("Action",A[1]),c.ctatdebug("Delaying TutoringServiceError by "+y+" ..."),setTimeout(f.processTutoringServiceError,y,h),setTimeout(a.propagateShellEvent,y,"TutoringServiceError",h,m)):(f.processTutoringServiceError(h),a.propagateShellEvent("TutoringServiceError",h,m));break;
case "ProblemSummaryResponse":c.ctatdebug("Found: ProblemSummaryResponse");f.processProblemSummaryResponse(h);a.propagateShellEvent("ProblemSummaryResponse",h);break;case "StartStateEnd":c.ctatdebug("Found: StartStateEnd");CTATShellTools.listComponents();null!==f?f.processStartState():this.ctatdebug("Error: no message handler object available to process start state");try{c.processStartStateActions()}catch(E){c.ctatdebug("Caught in the act: "+E.message)}CTATMessageHandler.inStartState=!1;a.propagateShellEvent("StartStateEnd",
h);break;case "ProblemRestoreEnd":c.ctatdebug("Found: ProblemRestoreEnd");f.processProblemRestoreEnd(h);a.propagateShellEvent("ProblemRestoreEnd",h);break;case "GetURL":c.ctatdebug("Found: GetURL");f.processGetURL(h);a.propagateShellEvent("GetURL",h);break;case "SetPreferences":f.forwardToTutor(h);return;case "InterfaceReboot":e++;ctatdebug("Found: InterfaceReboot #"+e+" -- href "+(location?location.href:"(no location)"));1<e&&!CTAT.ToolTutor.reboot("InterfaceReboot from CTATMessageHandler")&&(B=
"ws://"+CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),ctatdebug("closing connection w/ url: "+B),a.closeWSConnection(B,function(){var b=window.frameElement.getAttribute("id");"function"==typeof CustomEvent&&(b=new CustomEvent("refreshIframe",{detail:b}),window.parent.document.dispatchEvent(b))},"interfaceReboot"));break;case "NoOp":m=h&&h.getTransactionID();l=h&&h.getSAI();ctatdebug("NoOp transactionID "+m+", SAI "+l);return}(B=/student[0-9]+/i.exec(m))&&B[0]==
m&&f.forwardToTutor(h)}}}}};this.processStateGraph=function(a){c.ctatdebug("processStateGraph ()");if(void 0===a||null===a)c.ctatdebug("Error: state graph property list is undefined");else if(c.ctatdebug("Processing node: "+a.nodeName),null===b.getElementChildren(a))c.ctatdebug("Error: state graph property list is undefined");else{a=b.getElementChildren(a);for(var e=0;e<a.length;e++){var d=a[e];c.ctatdebug("State graph attribute: "+b.getElementName(d));"caseInsensitive"==b.getElementName(d)&&(caseInsensitive=
"false"==b.getNodeTextValue(d)?!1:!0);"unordered"==b.getElementName(d)&&(unordered="false"==b.getNodeTextValue(d)?!1:!0);"lockWidget"==b.getElementName(d)&&(lockWidget="false"==b.getNodeTextValue(d)?!1:!0);"suppressStudentFeedback"==b.getElementName(d)&&("false"==b.getNodeTextValue(d)?CTATGlobals.suppressStudentFeedback=!1:CTATGlobals.suppressStudentFeedback=!0);"highlightRightSelection"==b.getElementName(d)&&(highlightRightSelection="false"==b.getNodeTextValue(d)?!1:!0);"confirmDone"==b.getElementName(d)&&
(c.ctatdebug("Confirm done: "+b.getNodeTextValue(d)),"true"==b.getNodeTextValue(d)?CTATGlobals.confirmDone=!0:CTATGlobals.confirmDone=!1);"Skills"==b.getElementName(d)&&(null===CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(d),f.updateSkillWindow())}}};this.processStartProblem=function(b){c.ctatdebug("processStartProblem ()");f.processStartProblem()};this.processInterfaceIdentification=function(b){};this.processInterfaceDescription=function(a){c.ctatdebug("processInterfaceDescription ("+
a.length+")");for(var e="Unknown",d="Unknown",f=null,g=0;g<a.length;g++){var h=a[g];c.ctatdebug("Inspecting element: "+b.getElementName(h));"WidgetType"==b.getElementName(h)&&(c.ctatdebug("Widget type: "+b.getNodeTextValue(h)),e=b.getNodeTextValue(h));"CommName"==b.getElementName(h)&&(c.ctatdebug("Instance name: "+b.getNodeTextValue(h)),d=b.getNodeTextValue(h));if("serialized"==b.getElementName(h)){c.ctatdebug("Prepareing to de-serialize component ...");for(var l=b.getElementChildren(h),w=0;w<l.length;w++){var B=
l[w];-1!=b.getElementName(B).indexOf("CTAT")&&(f=B)}}"interface"==b.getElementName(h)&&(c.ctatdebug("Storing interface for post start-state reconstruction ..."),CTATGlobals.interfaceElement=h);"script"==b.getElementName(h)&&(c.ctatdebug("Storing and loading main javascript code as defined by the BRD ..."),scriptElement=b.getNodeTextValue(h))}null!==f?this.deserializeComponent(e,d,f):c.ctatdebug("Error: unable to find CTAT serialization point of attachement");c.ctatdebug("processInterfaceDescription () done")};
this.deserializeComponent=function(a,e,d){c.ctatdebug("deserializeComponent ("+a+","+e+")");if(!0===CTATGlobals.ignoreInterfaceDescriptions)c.ctatdebug("ignoreInterfaceDescriptions==true");else if(null===b.getElementAttr(d,"x"))c.ctatdebug("Warning: this component does not have x,y information. Probably an older component");else{var f=b.getElementAttr(d,"x"),g=b.getElementAttr(d,"y"),h=b.getElementAttr(d,"width"),m=b.getElementAttr(d,"height"),l=b.getElementAttr(d,"tabIndex"),n=b.getElementAttr(d,
"zIndex");null===l&&(l=-1);null===n&&(n=0);var y=new CTATComponentDescription;y.type=a;y.name=e;y.x=Math.floor(f);y.y=Math.floor(g);y.tabIndex=l;y.zIndex=n;y.width=Math.floor(h);y.height=Math.floor(m);CTATShellTools.registerComponentDescription(y);d=b.getElementChildren(d);for(f=0;f<d.length;f++){g=d[f];b.getElementName(g);if("Parameters"==b.getElementName(g))for(this.ctatdebug("Processing component parameters ..."),h=b.getElementChildren(g)[0],h=b.getElementChildren(h),m=0;m<h.length;m++){var z=
h[m];if("CTATComponentParameter"==b.getElementName(z)){this.ctatdebug("Processing parameter property (CTATComponentParameter) ...");for(var n=l=void 0,z=b.getElementChildren(z),q=0;q<z.length;q++){var F=z[q];"name"==b.getElementName(F)&&(this.ctatdebug("Found parameter name: "+b.getNodeTextValue(F)),l=b.getNodeTextValue(F));"value"==b.getElementName(F)&&(this.ctatdebug("Found parameter value: "+b.getNodeTextValue(F)),n=b.getNodeTextValue(F).trim())}this.ctatdebug("Parameter name: "+l+", value: "+
n);void 0!==l&&(y.params[l]=n,"group"==l&&(y.groupName=n))}}if("Styles"==b.getElementName(g))for(this.ctatdebug("Processing component styles ..."),g=b.getElementChildren(g)[0],g=b.getElementChildren(g),h=0;h<g.length;h++)if(n=g[h],"CTATStyleProperty"==b.getElementName(n)){this.ctatdebug("Processing style property (CTATStyleProperty) ...");l=m="";n=b.getElementChildren(n);for(z=0;z<n.length;z++)q=n[z],"name"==b.getElementName(q)&&(m=b.getNodeTextValue(q)),"value"==b.getElementName(q)&&(l=b.getNodeTextValue(q).trim());
this.ctatdebug("Style (name: "+m+", value: "+l+")");""!==m&&(y.styles[m]=l)}}c.ctatdebug("deserializeComponent ("+a+","+e+") done")}};this.processStartStateActions=function(){c.ctatdebug("processStartStateActions ("+d.length+")");if(0===d.length)c.ctatdebug("No start state messages, bump");else if(0<CTATMessageHandler.startStateHandlers.length)for(var b=0;b<CTATMessageHandler.startStateHandlers.length;b++)CTATMessageHandler.startStateHandlers[b].processStartStateActions(d);else{for(var b=g(),a=0;a<
d.length;a++){var e=d[a];c.ctatdebug("Processing startstate message["+a+"] type: "+e.getMessageType());switch(e.getMessageType()){case "InterfaceAction":f.processInterfaceAction(e,b);break;case "UntutoredAction":f.processUntutoredAction(e,b);break;case "CorrectAction":f.processCorrectAction(e);break;case "InCorrectAction":f.processInCorrectAction(e)}}if(""!==CTATMessageHandler.scriptElement)try{eval(CTATMessageHandler.scriptElement)}catch(p){alert("Error executing script from BRD: "+p.message)}}};
this.sleep=function(b){c.ctatdebug("sleep ("+b+")")}};CTATMessageHandler.prototype=Object.create(CTATBase.prototype);CTATMessageHandler.prototype.constructor=CTATMessageHandler;CTATMessageHandler.startStateHandlers=[];CTATMessageHandler.inStartState=!1;CTATMessageHandler.scriptElement="";var CTATSessionExpiry=function(a,g,f,c){function d(){var b=v&&v.getHTTPObject?v.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processInactivityReply() refreshConnection "+v+", getHTTPObject "+b);v&&b&&h.ctatdebug("CTATSessionExpiry.processInactivityReply() readyState "+b.readyState+", status "+b.status+", responseText "+(4==b.readyState?b.responseText:null))}function b(){try{if(50>m)throw"No-op: time interval "+m+" too short: less than 50 ms";r=setInterval(function(){v.send.apply(v,[])},m);
return"ok"}catch(w){return w.toString()}}function e(){try{if(50>n)throw"No-op: time interval "+n+" too short: less than 50 ms";u=setInterval(function(){h.checkInactivity.apply(h,[])},n);return"ok"}catch(w){return w.toString()}}CTATBase.call(this,"CTATSessionExpiry",g);var h=this,l=1E3*g,m=1E3*(g-60),n=6E4,p=Date.now(),v=null,r=0,u=0;this.checkInactivity=function(){var b=Date.now(),a=p;h.ctatdebug("CTATSessionExpiry.checkInactivity() elapsed "+(b-a)+", limit "+l+",\n                 now "+Date(b)+
",\n lastActionTimestamp "+h.getLastActionTimestamp());if(!(b<a+l))try{h.cancelTimers();var c=new CTATConnection(CTATConfiguration.getRawFlashVars());c.setMethod("GET");c.setURL(f);c.assignReceiveFunction(d);c.send();return"ok"}catch(z){return z.toString()}};this.updateLastActionTimestamp=function(){p=Date.now()};this.getLastActionTimestamp=function(){return new Date(p)};this.toString=function(){return"CTATSessionExpiry sessionTimeoutMS "+l+", refreshIntervalMS "+m+", refreshTimer "+r+", inactivityTimer "+
u+",\n  expireLogoutURL "+f+",\n  refreshSessionURL "+c};this.getRefreshConnection=function(){return v};this.getSessionTimeoutMS=function(){return l};this.getRefreshIntervalMS=function(){return m};this.getInactivityIntervalMS=function(){return n};this.setSessionTimeoutMS=function(b){l=b};this.setRefreshIntervalMS=function(a){m=a;h.cancelRefreshTimer();b()};this.setInactivityIntervalMS=function(b){n=b;h.cancelInactivityTimer();e()};this.cancelRefreshTimer=function(){0!==r&&clearInterval(r);r=0};this.cancelInactivityTimer=
function(){0!==u&&clearInterval(u);u=0};this.cancelTimers=function(){h.cancelRefreshTimer();h.cancelInactivityTimer()};this.getRefreshTimer=function(){return r};this.getInactivityTimer=function(){return u};v=new CTATConnection(a);v.setMethod("GET");v.setURL(c);v.assignReceiveFunction(function(){var b=v&&v.getHTTPObject?v.getHTTPObject():null;h.ctatdebug("CTATSessionExpiry.processRefreshReply() refreshConnection "+v+", getHTTPObject "+b);v&&b&&h.ctatdebug("CTATSessionExpiry.processRefreshReply() readyState "+
b.readyState+", status "+b.status+", responseText "+(4==b.readyState?b.responseText:null))});b();e()};CTATSessionExpiry.prototype=Object.create(CTATBase.prototype);CTATSessionExpiry.prototype.constructor=CTATSessionExpiry;
CTATSessionExpiry.factory=function(a){var g=Number(a.session_timeout)||0,f=a.expire_logout_url,c=a.refresh_session_url;ctatdebug("CTATSessionExpiry.init() session_timeout "+g+", expire_logout_url "+f+", refresh_session_url "+c);return 60>=g||!f||!c?null:new CTATSessionExpiry(a,g,f,c)};"undefined"!==typeof module&&(module.exports=CTATSessionExpiry);var CTATTransactionListener=function(a){function g(b){return b&&"function"==typeof b.getTransactionID?b.getTransactionID():null}function f(b){h.ctatdebug("formatTimeStamp ("+b+")");return sprintf("%04d-%02d-%02d %02d:%02d:%02d.%03d UTC",b.getUTCFullYear(),b.getUTCMonth()+1,b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),b.getUTCMilliseconds())}function c(b,a){for(var c,e,d=1;;++d){var f=a+"_type"+d,g=a+"_name"+d;c=CTATConfiguration.get(f);e=CTATConfiguration.get(g);if(!c||!e)break;
b[f]=c;b[g]=e}1==d&&(c=CTATConfiguration.get(a+"_type"),e=CTATConfiguration.get(a+"_name"),b[f]=c?c:"",b[g]=e?e:"");return b}function d(b,a){if(b&&"function"==typeof b.toLowerCase&&0<=b.toLowerCase().indexOf("hint"))return!0;if(!a)return!1;if(0<=a.getMessageType().toLowerCase().indexOf("hint"))return!0;var c=a.getSelection().toLowerCase();return 0<=a.getAction().toLowerCase().indexOf("buttonpress")&&(0<=c.indexOf("hint")||0<=c.indexOf("help"))}function b(b,a){var c=b.getProperty(a),e=c?c.split(CTATTransactionListener.valueDelimiter):
[];h.ctatdebug("CTATTransactionListener.getPropertyAsArray("+a+") withValues "+c+", result "+e);return e}function e(a,c){for(var e=b(a,c),d="",f=0;f<e.length;++f)d+=e[f];h.ctatdebug("CTATTransactionListener.getProperty("+c+") valueElts "+e+", result "+d);return d}CTATBase.call(this,"CTATTransactionListener","");var h=this,l=null,m={},n=0,p=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.getMailer=function(){return l};this.onmessage=function(b){h.ctatdebug("CTATTransactionListener.onmessage("+
b.toString()+")");(b=b.data&&3<=b.data.length?new CTATSAI(b.data[0],b.data[1],b.data[2]):null)&&CTATCommShell.shell.processComponentAction(b,!1,!0,null,"ATTEMPT","Detector")};if(!l)a:{if("undefined"!=typeof TransactionMailerUsers&&"function"==typeof TransactionMailerUsers.create)try{l=l=TransactionMailerUsers.create("Assets",a,CTATConfiguration.get("process_detectors_url"),CTATConfiguration.get("authenticity_token"),CTATConfiguration.get("detectors"),CTATConfiguration.get("provider_key"));break a}catch(v){console.trace("Error creating transaction mailer: "+
v);l=l=null;break a}l=void 0}this.isReady=function(){return null!=h.mailerProxy};this.toString=function(){return"transactions sent to ["+h.process_transactions_url+":]"};this.processCommShellEvent=function(a,r,u){console.trace("CTATTransactionListener.processCommShellEvent("+a+", "+r+", "+u+")");try{var w=null;switch(a){case "InterfaceAction":case "AssociatedRules":case "UntutoredAction":case "NextPressed":case "PreviousPressed":var v=r;r&&r.constructor!=CTATMessage&&(v=r.constructor!=Element?p.parse(v):
v,v=new CTATMessage(v));var y=v;h.ctatdebug("CTATTransactionListener.makeOrCompleteTransaction("+a+") pointer "+h+", problemInfo null, pointer.problemInfo "+(h?h.problemInfo:null));var z=v=null,q=!1;if(z=g(y)){var F,C;b:switch(a){case "UntutoredAction":C=!1;break b;case "InterfaceAction":C="tutor-performed"!=e(y,"subtype").toLowerCase();break b;default:C=!0}if(F=!(q=!C)){var A;C=z;var E=m[C];E?(delete m[C],--n,h.ctatdebug("CTATTransactionListener.removeIncompleteTransaction("+C+") count now "+n),
A=E):A=null;F=(v=A)&&(q=!0)}F||(v={meta:h.problemInfo.meta,context:h.problemInfo.context});switch(a){case "AssociatedRules":case "NextPressed":case "PreviousPressed":u=v;u.tutor_data&&console.log("Warning: CTATTransactionListener.addTutorInfo("+a+") tx has tutor_data with time "+u.tutor_data.tutor_event_time);u.tutor_data={};u.tutor_data.tutor_event_time=f(new Date);u.tutor_data.selection=e(y,"Selection");u.tutor_data.action=e(y,"Action");u.tutor_data.input=e(y,"Input");u.tutor_data.action_evaluation=
y.getIndicator();0<=u.tutor_data.action_evaluation.toLowerCase().indexOf("hint")&&(u.tutor_data.current_hint_number=e(y,"CurrentHintNumber"),u.tutor_data.total_hints_available=e(y,"TotalHintsAvailable"));u.tutor_data.tutor_advice=e(y,"TutorAdvice");var I=u.tutor_data;F=[];var G=CTAT.ToolTutor.tutor&&CTAT.ToolTutor.tutor.getProblemSummary()?CTAT.ToolTutor.tutor.getProblemSummary().getSkills():null,x=y.getSkillsObject().getSkillSet();for(A=0;A<x.length;++A){var H=x[A],J=CTATSkillSet.skills?CTATSkillSet.skills.getSkill(H.getSkillName()):
null;if(J){E={};E.name=J.getSkillName();E.category=J.getCategory();var S=null==E.category||""==E.category.trim()?E.name:E.name+" "+E.category,O=G?G.getSkill(S):null,L;O?(E.pKnown=isNaN(L=O.getPKnown())?"":L,E.pGuess=isNaN(L=O.getPGuess())?"":L,E.pSlip=isNaN(L=O.getPSlip())?"":L,E.pLearn=isNaN(L=O.getPLearn())?"":L,E.history=isNaN(L=O.getHistory())?"":L,E.opportunityCount=isNaN(L=O.getOpportunityCount())?"":L):(E.pKnown=isNaN(L=J.getPKnown())?"":L,E.pGuess=isNaN(L=J.getPGuess())?"":L,E.pSlip=isNaN(L=
J.getPSlip())?"":L,E.pLearn=isNaN(L=J.getPLearn())?"":L);h.ctatdebug("CTATTransactionListener.createSkills() ssSk "+J+", tracerSk "+O+", skElt "+E);F.push(E)}}I.skills=F;u.tutor_data.step_id=e(y,"StepID");u.tutor_data.rule_names=b(y,"Rules");var D=u.tutor_data,P=y.getCustomFields();h.ctatdebug("CTATTransactionListener.createCustomFields() result "+P);D.custom_fields=P;break;default:v.meta.date_time=f(new Date);I=v;if(!(I.transaction_id=g(y)))throw Error("Message has no transaction_id: eventType "+
a+", msg\n  "+y);I.semantic_event="UntutoredAction"==a?"UNTUTORED-ACTION":d(a,y)?"HINT-REQUEST-HINTS":"ATTEMPT-RESULT";I.actor=u?u:"student";I.tool_data&&console.log("Warning: CTATTransactionListener.addToolInfo("+a+") tx has tool_data with time "+I.tool_data.tool_event_time);I.tool_data={};I.tool_data.tool_event_time=f(new Date);I.tool_data.selection=e(y,"Selection");I.tool_data.action=e(y,"Action");I.tool_data.input=e(y,"Input")}var T;if(q)T=v;else{var I=z,G=v,Q=m[I];Q&&(console.log("Warning: CTATTransactionListener.storeIncompleteTransaction() found tx with ID "+
I,Q),--n);m[I]=G;++n;h.ctatdebug("CTATTransactionListener.storeIncompleteTransaction("+I+") count now "+n);T=null}w=T}else w=null;break;case "StartProblem":h.ctatdebug("CTATTransactionListener.createContextMessage()");T={};var R=new Date;h.ctatdebug("TX.makeMetaElement ()");Q={};Q.date_time=f(R);Q.session_id=CTATConfiguration.get("session_id");Q.user_guid=CTATConfiguration.get("user_guid");T.meta=Q;T.context={};q=T.context;Q=null;CTATLogMessageBuilder&&CTATLogMessageBuilder.commLogMessageBuilder&&
(Q=CTATLogMessageBuilder.commLogMessageBuilder.getContextName());Q||(Q=CTATLogMessageBuilder.contextGUID);if(!Q)throw Error("Context message ID not yet defined");q.context_message_id=Q;var U=T.context,M;M=CTATConfiguration.get("class_name");U.class_name=M?M:"";M=CTATConfiguration.get("school_name");U.class_school=M?M:"";M=CTATConfiguration.get("period_name");U.class_period_name=M?M:"";M=CTATConfiguration.get("class_description");U.class_description=M?M:"";M=CTATConfiguration.get("instructor_name");
U.class_instructor_name=M?M:"";var V=T.context,W=CTATConfiguration.get("dataset_name");V.dataset_name=W?W:"";c(V,"dataset_level");prop=CTATConfiguration.get("problem_name");V.problem_name=prop?prop:"";prop=CTATConfiguration.get("problem_context");V.problem_context=prop?prop:"";prop=CTATConfiguration.get("problem_tutorflag");V.problem_tutorFlag=prop?prop:"";c(V,"study_condition");v=T.context;Q=0;if(y=CTATConfiguration.getCustomFields())for(z in v.custom_fields={},y)y.hasOwnProperty(z)&&(v.custom_fields[z]=
y[z],++Q);h.ctatdebug("CTATTransactionListener.createCustomFields() nAdded "+Q+", cfs "+y);h.problemInfo=T;break;case "ProblemRestoreEnd":h.initializing=!1}w&&!h.initializing&&l.sendTransaction(w)}catch(aa){console.log("Error in CTATTransactionListener.processCommShellEvent("+a+"): "+aa,aa.stack)}};ctatdebug("**<end of CTATTransactionListener constructor, process_transactions_url "+a+", mailerProxy "+l)};
Object.defineProperty(CTATTransactionListener,"scriptParam",{enumerable:!1,configurable:!1,writable:!1,value:"process_transactions_url"});Object.defineProperty(CTATTransactionListener,"valueDelimiter",{enumerable:!1,configurable:!1,writable:!1,value:/<\/?value>/});CTATTransactionListener.prototype=Object.create(CTATBase.prototype);CTATTransactionListener.prototype.constructor=CTATTransactionListener;"undefined"!==typeof module&&(module.exports=CTATTransactionListener);
CTATTransactionListener.create=function(a){var g=null;if(!a&&("undefined"==typeof TransactionMailerUsers||"function"!=typeof TransactionMailerUsers.create))return null;try{if(g=new CTATTransactionListener(a),!g.getMailer())throw Error("Transaction listener postMessage() not defined.");}catch(f){console.trace("Error creating or connecting to transaction listener",f),g=null}return g};var CTATNameTranslator=function(){CTATBase.call(this,"CTATNameTranslator","translator");var a=!1,g=this;this.setPassthrough=function(f){a=CTATGlobalFunctions.toBoolean(f)};this.getPassthrough=function(){return a};this.manufactorJSON=function(a,c){g.ctatdebug("manufactorJSON ("+a+","+c+")");var d=a.split(":");if(1==d.length)return g.ctatdebug("No range in aRange, returning basic JSON ..."),"";var b=this.getA1Row(d[0]),e=this.getA1Col(d[0]),f=this.getA1Row(d[1]),l=this.getA1Col(d[1]);g.ctatdebug("Manufacturing json from: ["+
b+","+e+"] to: ["+f+","+l+"]");d="[";b=parseInt(f)-parseInt(b);e=parseInt(l)-parseInt(e);b++;e++;g.ctatdebug("X range: "+b+", Y range: "+e);for(f=0;f<b;f++){0<f&&(d+=",");d+="[";for(l=0;l<e;l++)0<l&&(d+=","),d+='"',d+=c,d+='"';d+="]"}return d+"]"};this.translateFromCTAT=function(f,c){if(!0===a)return f;var d=f.toLowerCase();g.ctatdebug("translateFromCTAT ("+d+")");var b;if(-1!=d.indexOf(".r")){var e=d.split(".");b=e[1].split("r");0>=b.length&&(b=e[1].split("c"));0>=b.length?g.ctatdebug("Info: incoming name does not need translation"):
(d=b[1],b=b[0].substr(1),g.ctatdebug("Original row (1st format): "+b+" original col: "+d),d=!0===c?colName(d,!1)+b:e[0]+"."+colName(d,!1)+b,g.ctatdebug("Translated: "+d))}else{if(0===d.indexOf("r")){var e=d.indexOf("c"),h=parseInt(d.substr(1,e-1)),l=parseInt(d.substr(e+1));b=h+1;d=l;g.ctatdebug("Original row (2nd format) (columnindex: "+e+"): "+h+" -> "+b+", original col: "+l+" -> "+d);d=colName(d,!1)+b;g.ctatdebug("Translated: "+d);return d}g.ctatdebug("Info: incoming name does not need translation")}return d};
this.translateToCTAT=function(f){if(!0===a)return f;var c=this.letterToColumn(f.substr(0,1))-1;return"R"+(parseInt(f.substr(1))-1)+"C"+c};this.columnToLetter=function(a){for(var c,d="";0<a;)c=(a-1)%26,d=String.fromCharCode(c+65)+d,a=(a-c-1)/26;return d};this.letterToColumn=function(a){for(var c=0,d=a.length,b=0;b<d;b++)c+=(a.charCodeAt(b)-64)*Math.pow(26,d-b-1);return c};this.getA1Row=function(a){return parseInt(a.substr(1))-1};this.getA1Col=function(a){return this.letterToColumn(a.substr(0,1))-1}};
CTATNameTranslator.prototype=Object.create(CTATBase.prototype);CTATNameTranslator.prototype.constructor=CTATNameTranslator;var CTATCommShell=function(){CTATBase.call(this,"CTATCommShell","theShell");var a=null,g=null,f=null,c=null,d=null,b=this,e=null,h=null,l={},m=null,n=null,p=null,v=null,r=[],u=!1,h="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.init=function(e){this.ctatdebug("init ()");var h=CTATConfiguration.getRawFlashVars(),m="http://";"https"==h.tutoring_service_communication&&(m="https://");var l=h.remoteSocketURL;l&&(l=String(l).toLowerCase(),0==l.indexOf("http")||0==l.indexOf("ws"))&&(m="");d=
e;CTATLogMessageBuilder.contextGUID=CTATGuid.guid();b.ctatdebug("processSkills ()");CTATSkillSet.skills=new CTATSkillSet;e=flashVars.getRawFlashVars();null!=e.skills&&CTATSkillSet.skills.fromXMLString(e.skills,!0);b.updateSkillWindow(null);null==commMessageHandler&&(commMessageHandler=new CTATMessageHandler(this),CTAT.ToolTutor.registerInterface(commMessageHandler));commMessageHandler.assignHandler(this);c=new CTATTutoringServiceMessageBuilder;h.deliverymode&&"review"==h.deliverymode&&(h.Logging=
"None");g=CTATSessionExpiry.factory(h);CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder;a=new CTATCommLibrary;a.setConnectionRefusedMessage("ERROR_CONN_TS");a.setSocketType(h.tutoring_service_communication+(h.collaborators||CTATLMS.is.ToolsListener()?" websocket":""));a.assignHandler(this);f=new CTATCurriculumService(a);null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));commLoggingLibrary.getLoggingCommLibrary().setFixedURL(flashVars.getRawFlashVars().log_service_url);
flashVars.setTimeZone(null);new CTATHTMLManager;this.ctatdebug("CTATCommShell.init() FlashVar info: "+h.info);if(null!=h.info)try{parent.javaScriptInfo&&parent.javaScriptInfo(decodeURIComponent(h.info))}catch(q){}else this.ctatdebug("There is no info flash var");console.log("Connecting to: "+m+h.remoteSocketURL+":"+h.remoteSocketPort);e=c.createSetPreferencesMessage(version,this.getAllInterfaceDescriptions());a.sendXMLURL(e,m+h.remoteSocketURL+":"+h.remoteSocketPort,CTATConfiguration.get("collaborators"));
(m=CTATConfiguration.get("collaborators"))&&1<m.length&&(CTATScrim.scrim.scrimDown(),CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.getString("AWAITING_OTHER_COLLABORATORS")));b.addGlobalEventListener(CTATTransactionListener.create(h[CTATTransactionListener.scriptParam]))};this.getCommLibrary=function(){return a};this.forwardToTutor=function(b){a&&a.hasJavaScriptConnection()&&CTAT.ToolTutor.sendToTutor(b.getXMLString())};this.getLoggingLibrary=function(){return commLoggingLibrary};this.propagateShellEvent=
function(b,a,c,e){ctatdebug("propagateShellEvent ("+b+", "+typeof a+")");for(var d=0;d<r.length;d++)r[d].processCommShellEvent(b,a,c,e)};this.reset=function(){b.ctatdebug("reset ()");CTATGlobals.interfaceElement=null;commMessageHandler.reset()};this.getSessionExpiry=function(){return g};this.getMessageHandler=function(){return this.commMessageHandler};this.addStartStateHandler=function(a){b.ctatdebug("addStartStateHandler ()");null==CTATMessageHandler.startStateHandlers&&(CTATMessageHandler.startStateHandlers=
[]);CTATMessageHandler.startStateHandlers.push(a)};this.gradeComponent=function(a){this.ctatdebug("gradeComponent ("+a.getName()+","+a.getClassName()+")");var c=CTATShellTools.findComponentByClass("CTATDoneButton");null!=c&&c!=a?c.moveHintHighlight(!1,null):b.ctatdebug("Info: no done button available to reset");b.clearFeedbackComponents();null!=nameTranslator?nameTranslator.translateFromCTAT(a.getName()):this.ctatdebug("Info: no name translator provided, using as-is");null==a?this.ctatdebug("Internal error, provided component is null"):
(this.ctatdebug("Info: we have a valid component, grading ..."),"Do not tutor"==a.getTutorComponent()?b.processComponentAction(a.getSAI(),!1):(this.ctatdebug("Checking for back grading: "+a.getName()),"CTATTextArea"==a.getClassName()||"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()?(this.ctatdebug("Backgrading ..."),this.ctatdebug("Grading "+a.getClassName()+" with value: "+a.getValue()),!0===CTATGlobalFunctions.isBlank(a.getValue())?this.ctatdebug("Empty component, nothing to grade"):
(a.updateSAI(),a=a.getSAI(),b.processComponentAction(a))):(a="CTATTableGoogle"==a.getClassName()?new CTATSAI(a.getCurrentSelection(),"UpdateTextArea",a.getCurrentValue()):a.getSAI(),b.processComponentAction(a))))};this.processMessage=function(b){this.ctatdebug("processMessage ()");commMessageHandler.processMessage(b);this.ctatdebug("processMessage () done")};this.processStartProblem=function(){this.ctatdebug("processStartProblem ()");"google"==CTATConfig.external&&this.showFeedback("The tutor is starting, please wait ...");
CTATLMS.initLMSConnection&&CTATLMS.initLMSConnection()};this.processStartState=function(){this.ctatdebug("processStartState ()");CTATMessageHandler.inStartState=!0;null!=d?(this.ctatdebug("Calling tutor.createInterface () ..."),d.createInterface()):(this.ctatdebug("Error: no tutor object available, calling createInterface globally ..."),window.hasOwnProperty("createInterface")&&window.createInterface());this.ctatdebug("Logging start of problem ...");null!=commLoggingLibrary?commLoggingLibrary.startProblem():
this.ctatdebug("Info: no logging library available!");b.propagateShellEvent("StartProblem",null);this.ctatdebug("End of start state, inspecting suppressStudentFeedback ...");if(!0===CTATGlobals.suppressStudentFeedback){this.ctatdebug("Hiding hint button ...");var a=CTATShellTools.findComponentByClass("CTATHintButton");null!=a&&a.SetVisible(!1)}"google"==CTATConfig.external?(b.ctatdebug("Calling google app script hint request driver ..."),addCall(new RPCObject("resetOnEditQueue","dummy","dummy"))):
this.ctatdebug("processStartState () done")};this.sendStartProblemMessage=function(){b.ctatdebug("sendStartProblemMessage()")};this.sendProblemSummaryRequest=function(c){b.ctatdebug("sendProblemSummaryRequest()");p=c;c=(new CTATTutoringServiceMessageBuilder).createProblemSummaryRequestMessage();a.sendXML(c,!1)};this.getAllInterfaceDescriptions=function(){b.ctatdebug("getAllInterfaceDescriptions ()");for(var a="<messages>",c=new CTATTutoringServiceMessageBuilder,e=CTATShellTools.getAllComponents(),
d=0;d<e.length;d++){var f=e[d];b.ctatdebug("Getting component interface description message for: "+f.getName());a+=c.createInterfaceDescriptionMessage(f);f.getConfigurationActions&&f.getConfigurationActions().forEach(function(b){a+=c.createInterfaceActionMessage(CTATGuid.guid(),b)})}return a+="</messages>"};this.sendInterfaceDescriptionMessages=function(){b.ctatdebug("sendInterfaceDescriptionMessages ()");var c;c='<?xml version="1.0" encoding="UTF-8"?><message><verb>NotePropertySet</verb><properties><MessageType>MessageBundle</MessageType>'+
b.getAllInterfaceDescriptions();c+="</properties></message>";b.ctatdebug("Final bundle: "+c);a.sendXMLNoBundle(c)};this.processSerialization=function(){b.ctatdebug("processSerialization()");b.setText(this.label)};this.processComponentAction=function(c,e,d,f,g,h){b.ctatdebug("processComponentAction("+c.getName()+" -> "+c.getSelection()+","+c.getAction()+","+c.getInput()+")");this.showFeedback("");d=CTATGuid.guid();null!=commLoggingLibrary?u&&(b.ctatdebug("We're not in the start state, logging the action ..."),
"scrim"==c.getSelection()?ctatdebug("Not logging any scrim actions (for now)"):void 0!=g?commLoggingLibrary.logSemanticEvent(d,c,g,"","","",h):"hint"==c.getSelection()||"null.nextButton"==c.getSelection()||"null.previousButton"==c.getSelection()?commLoggingLibrary.logSemanticEvent(d,c,"HINT_REQUEST","","","",h):commLoggingLibrary.logSemanticEvent(d,c,"ATTEMPT","","","",h)):this.ctatdebug("Info: no logging library available!");g=new CTATTutoringServiceMessageBuilder;!1!==e&&e!==CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR?
(c=g.createInterfaceActionMessage(d,c),b.propagateShellEvent("InterfaceAction",c)):(c=g.createUntutoredActionMessage(d,c),b.propagateShellEvent("UntutoredAction",c));a.sendXML(c);CTAT.SAI&&"function"==typeof CTAT.SAI.storeForReplay&&CTAT.SAI.storeForReplay(c)};this.onEditSuccess=function(a){b.ctatdebug("onEditSuccess ("+a+")");null==nameTranslator?b.ctatdebug("Error: CTAT name translator not available"):-1!=a.indexOf(":")?(b.ctatdebug("Bump"),b.showFeedback("You're asking for a hint for multiple cells, please select only a single cell.")):
(a=nameTranslator.translateToCTAT(a),b.ctatdebug("Info A1 notiation mapped to (if needed): "+a),a=new CTATSAI("hint","ButtonPressed",a),b.processComponentAction(a),b.propagateShellEvent("REQUESTHINT",null),b.ctatdebug("onEditSuccess () done"))};this.onFailure=function(a){b.ctatdebug("onFailure ("+a.message+")")};this.onNOPEditSuccess=function(a){b.ctatdebug("onNOPEditSuccess ("+a+")")};this.onNOPFailure=function(a){b.ctatdebug("onNOPFailure ("+a.message+")")};this.requestHint=function(){b.ctatdebug("requestHint(external -> "+
CTATConfig.external+")");var a;if("none"==CTATConfig.external)b.ctatdebug("Calling built-in hint request driver ..."),CTATGlobals.Tab.previousFocus?(a=new CTATSAI("hint","ButtonPressed","hint request"),CTATGlobals.Tab.previousFocus.getSAI?(a.addSelection(CTATGlobals.Tab.previousFocus.getSAI().getSelection()),a.addAction("PreviousFocus")):b.ctatdebug("Current focus is not a CTAT component, can't ask for a hint yet")):(b.ctatdebug("CTATGlobals.Tab.previousFocus===null"),a=new CTATSAI("hint","ButtonPressed",
"hint request")),this.processComponentAction(a),this.propagateShellEvent("RequestHint",null);else if(b.clearFeedbackComponents(),"google"==CTATConfig.external){b.ctatdebug("Calling google app script hint request driver ...");try{google.script.run.withSuccessHandler(b.onEditSuccess).withFailureHandler(b.onFailure).getSheetSelectedRange()}catch(B){b.ctatdebug("google.script.run: "+B.message)}}else b.ctatdebug("'external' has configuration that doesn't match anything: "+CTATConfig.external)};this.processDone=
function(a){b.ctatdebug("processDone()");!0===CTATGlobals.confirmDone?CTATScrim.scrim.confirmScrimUp(CTATGlobals.languageManager.getString("SURE_YOU_ARE_DONE"),this.processDoneContinue,this.processDoneCancel):(a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1"),b.processComponentAction(a))};this.processDoneContinue=function(a){b.ctatdebug("processDoneContinue()");CTATScrim.scrim.scrimDown();a=new CTATSAI("done","ButtonPressed",a&&"string"==typeof a?a:"-1");b.processComponentAction(a);
b.propagateShellEvent("DonePressed",null)};this.processDoneCancel=function(a){b.ctatdebug("processDoneCancel()");CTATScrim.scrim.scrimDown();a=CTATGuid.guid();var c=new CTATSAI("ConfirmDone","ButtonPressed","no");commLoggingLibrary.logSemanticEvent(a,c,"ATTEMPT","")};this.processGetURL=function(c){b.ctatdebug("processGetURL()");-1!=c.getURL().indexOf("http://")?a.retrieveFile(c.getURL().substring(7),b.processClientBRDLoad):a.retrieveFile(c.getURL(),b.processClientBRDLoad)};this.processClientBRDLoad=
function(c){b.ctatdebug("processClientBRDLoad()");var e=a.getURL();a.sendXML("<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+e+" ]]\x3e</URL><content><![CDATA[ "+window.btoa(c)+" ]]\x3e</content></properties></message>")};this.processCorrectAction=function(a){b.ctatdebug("processCorrectAction()");a.setGradeResult("correct");b.clearFeedbackComponents();null!=v&&(ctatdebug("Calling custom grading processor ..."),v("CORRECT",a));var c=a.getSelection();
if(l[c]&&null!=m)m("CORRECT",a),this.propagateShellEvent("CORRECT",a);else{var e=CTATShellTools.findComponent(c);if(null!=e)for(ctatdebug("Processing "+e.length+" components ..."),c=0;c<e.length;c++)ctatdebug("Check "+e[c].getName()),e[c]?e[c].setCorrect&&e[c].setCorrect(a):b.ctatdebug("Internal error, component pointer is null");else b.ctatdebug("Error: component is null for selection "+c)}};this.processInCorrectAction=function(a){b.ctatdebug("processInCorrectAction()");a.setGradeResult("incorrect");
null!=v&&(ctatdebug("Calling custom grading processor ..."),v("INCORRECT",a));var c=a.getSelection();if(l[c]&&null!=m)m("INCORRECT",a);else{var e=CTATShellTools.findComponent(c);if(null!==e)for(c=0;c<e.length;c++)ctatdebug("Calling setIncorrect on component ("+e[c].getClassName()+")..."),e[c].setIncorrect&&e[c].setIncorrect(a);else b.ctatdebug("Error: component is null for selection "+c)}};this.processHighlightMsg=function(a){b.ctatdebug("processHighlightMsg()");var c=a.getSelection(),e=CTATShellTools.findComponent(c);
if(null!=e)for(c=0;c<e.length;c++)"function"==typeof e[c].setHintHighlight&&e[c].setHintHighlight(!0,a);else b.ctatdebug("Error: component is null for selection "+c);this.showFeedback(a.getHighlightMsg())};this.processUnHighlightMsg=function(a){b.ctatdebug("processUnHighlightMsg()");var c=a.getSelection(),e=CTATShellTools.findComponent(c);if(null!=e)for(c=0;c<e.length;c++)"function"==typeof e[c].setHintHighlight&&e[c].setHintHighlight(!1,null,a);else b.ctatdebug("Error: component is null for selection "+
c)};this.processAssociatedRules=function(e,d,f,g){b.ctatdebug("processAssociatedRules()");if(0==commMessageHandler.getInStartState()){logHintSAI=e.getSAI();var h,m=new CTATActionEvaluationData("");b.ctatdebug("Found tutor advice: "+f);"Hint"==d||"HintWindow"==d?(ctatdebug("Preparing log message to indicate a hint response","commShell"),m.setCurrentHintNumber(hintIndex+1),m.setTotalHintsAvailable(hints.length),m.setEvaluation("HINT"),h="HINT_MSG",hints[hintIndex]&&(f=hints[hintIndex])):("Correct"==
e.getIndicator()?m.setEvaluation("CORRECT"):m.setEvaluation("INCORRECT"),h="RESULT");ctatdebug("Adding custom field names ...");var l=[],n=[];l.push("step_id");n.push(e.getProperty("StepID"));var p=e.getInput();ctatdebug("CTATCommShell.processAssociatedRules() tutorInput: "+p);p&&(l.push("tutor_input"),n.push(p.toString()));if(p=e.getRules())l.push("rule_names"),n.push(p.toString());var p=e.getCustomFields(),w;for(w in p)l.push(w),n.push(p[w]);w=e.getSkillsObject();b.updateSkillWindow(w);ctatdebug("Sending log message ...");
p="";null!=commLoggingLibrary?u?p=commLoggingLibrary.logTutorResponse(e.getTransactionID(),logHintSAI,h,"",m,f,w,l,n):e.suppressLogging():this.ctatdebug("Info: no logging library available!");this.ctatdebug("Calling propagateShellEvent with logging payload: "+p);this.propagateShellEvent("AssociatedRules",e,null,p);"done"==logHintSAI.getSelection()&&"ButtonPressed"==logHintSAI.getAction()&&"Correct"==e.getIndicator()&&(h=c.createProblemSummaryRequestMessage(),a.sendXML(h,!1))}else b.updateSkillWindow(null);
if((g=g&&CTATShellTools.findComponent(g))&&g.length)for(h=0;h<g.length;h++)ctatdebug("Calling processAssociatedRules on component ("+g[h].getClassName()+")..."),g[h].processAssociatedRules&&g[h].processAssociatedRules(e,d,f);b.ctatdebug("processAssociatedRules() done")};this.processBuggyMessage=function(a){b.ctatdebug("processBuggyMessage()");this.showFeedback(a.getBuggyMsg())};this.processSuccessMessage=function(a){b.ctatdebug("processSuccessMessage()");this.showFeedback(a.getSuccessMessage())};
this.processUntutoredAction=function(a,c){b.processInterfaceAction(a,c)};this.processInterfaceAction=function(a,c){b.ctatdebug('CTATCommShell.processInterfaceAction ("'+a.getMessageType()+'")');var e=a.getProperty("trigger"),e=a.getProperty("subtype")||(e&&"data"==e.toLowerCase()?"tutor-performed":"");null!=commLoggingLibrary?u&&commLoggingLibrary.logSemanticEvent(a.getTransactionID(),a.getSAI(),"ATTEMPT",e):this.ctatdebug("Info: no logging library available!");if("root"==a.getSelection()||"_root"==
a.getSelection()){b.ctatdebug("Info: selection is 'root', we'll call the function straight up ...");for(var e=[window,CTATCommShell.commShell],d=a.getAction(),f=a.getInput(),g=0;g<e.length&&"function"!=typeof e[g][d];++g);if(g>=e.length)b.ctatdebug("Internal error: unable to find function: "+d);else{b.ctatdebug("Calling as: "+d+"("+f+")");try{e[g][d](f)}catch(A){b.ctatdebug("Internal error: unable to execute function: "+A.message)}}}else if(e=CTATShellTools.findComponent(a.getSelection()),null===
e)b.ctatdebug("Internal error: unable to find pointer to component object");else if(0==e.length)b.ctatdebug("Error: no component found to call interface action on");else{d=e.length;b.ctatdebug("Call the action on the component(s) -> ("+d+")...");for(f=0;f<d;f++)if(b.ctatdebug("About to call "+a.getAction()+" ("+a.getInput()+") on: "+a.getSelection()),g=e[f],"function"==typeof g.executeSAI&&g.executeSAI(a),b.ctatdebug("Method executed, continuing with post-processing ..."),1==commMessageHandler.getInStartState()){var h=
a.getAction();h&&h.toLowerCase().startsWith("updatetext")&&!g.getDivWrap().className.includes("CTATTextField")&&g.setEnabled(!c)}b.ctatdebug("processInterfaceAction() Done")}};this.removeComponent=function(b){CTATTutor.removeComponent(b)};this.processInterfaceIdentification=function(a){b.ctatdebug("processInterfaceIdentification()")};this.processAuthorModeChange=function(a){b.ctatdebug("processAuthorModeChange()")};this.processShowHintsMessage=function(a){b.ctatdebug("processShowHintsMessage()")};
this.processConfirmDone=function(a){b.ctatdebug("processConfirmDone()")};this.processVersionInfo=function(a){b.ctatdebug("processVersionInfo()")};this.updateLastActionTimestamp=function(){g&&g.updateLastActionTimestamp()};this.processTutoringServiceAlert=function(a){b.ctatdebug("processTutoringServiceAlert()");for(var c="",e=0;e<a.length;e++){var d=a[e];"ErrorType"==h.getElementName(d)&&h.getNodeTextValue(d);"Details"==h.getElementName(d)&&(c=h.getNodeTextValue(d))}CTATScrim.scrim.scrimUp(c)};this.processTutoringServiceError=
function(a){b.ctatdebug("processTutoringServiceError()");var c=a.getProperty("ErrorType");a=a.getProperty("Details");CTATScrim.scrim.scrimDown();CTATScrim.scrim.errorScrimUp(c+" - "+a)};this.processProblemSummaryResponse=function(a,c){b.ctatdebug("processProblemSummaryResponse() iscb "+c);if(commLoggingLibrary&&!c)commLoggingLibrary.then(b.processProblemSummaryResponse(a,!0));else if(CTATLMS.processProblemSummary&&CTATLMS.processProblemSummary(a.getXMLObject()),CTATLMS.closeLMSConnection&&CTATLMS.closeLMSConnection(),
null!=p){var d=a.getXMLObject(),g=d.getElementsByTagName("ProblemSummary"),h=d.getElementsByTagName("cmi.core.lesson_status"),m=d.getElementsByTagName("cmi.core.score.raw"),l=d.getElementsByTagName("cmi.core.exit"),d=d.getElementsByTagName("cmi.core.session_time"),g=$("<div>").html(g[0].innerHTML).text(),h="<cmi.core.lesson_status>"+$("<div>").html(h[0].innerHTML).text()+"</cmi.core.lesson_status>",m="<cmi.core.score.raw>"+$("<div>").html(m[0].innerHTML).text()+"</cmi.core.score.raw>",l="<cmi.core.exit>"+
$("<div>").html(l[0].innerHTML).text()+"</cmi.core.exit>",d="<cmi.core.session_time>"+$("<div>").html(d[0].innerHTML).text()+"</cmi.core.session_time>";p(g,"<scorm>"+h+m+l+d+"</scorm>");p=null}else l=new CTATXML,null!=e?e(l.xmlToString(a.getXMLObject())):f.sendSummary(a)};this.setGotProblemRestoreEnd=function(b){u=b};this.processProblemRestoreEnd=function(a){b.ctatdebug("processProblemRestoreEnd() scrimIsUp "+scrimIsUp);u=!0;CTATScrim.scrim.scrimDown()};this.clearFeedbackComponents=function(){b.ctatdebug("clearFeedbackComponents ()");
CTATShellTools.showHints(null)};this.processHintResponse=function(a,c){b.ctatdebug("processHintResponse()");unhighlightall();CTATShellTools.showHints(c);var e=a.getSAI();if(null!=e)if(e=e.getSelection(),null!=e)if(b.ctatdebug("Highlighting selection for hint: "+e),e=CTATShellTools.findComponent(e),null!=e)for(var d=0;d<e.length;d++)1==CTATCommShell.detailedFeedback&&"function"==typeof e[d].setHintHighlight&&e[d].setHintHighlight(!0,a);else b.ctatdebug("Unable to find component name in list: "+e);
else b.ctatdebug("Error: no highlight selection present in SAI");else b.ctatdebug("Warning: no SAI found in highlight message");CTATCommShell.detailedFeedback=!0;b.ctatdebug("processHintResponse() done")};this.showHighlightSelection=function(a,c){b.ctatdebug("showHighlightSelection ("+a+")");var e=CTATShellTools.findComponent(a);if(null!=e)for(var d=0;d<e.length;d++)1==CTATCommShell.detailedFeedback&&(0===d?e[d].moveHintHightlight&&e[d].moveHintHighlight(!0,c):e[d].setHintHighlight&&e[d].setHintHighlight(!0,
c));else b.ctatdebug("Unable to find component name in list: "+e)};this.globalReset=function(){b.ctatdebug("globalReset ()");CTATMessageHandler.scriptElement=""};this.nextProblem=function(c){b.ctatdebug("nextProblem ()");if(CTATGlobalFunctions.isBlank(c))b.ctatdebug("Message is blank, requesting next problem ..."),c=flashVars.getRawFlashVars().run_problem_url,a.send(c);else{b.ctatdebug("Message contains html data, writing ...");try{document.close()}catch(B){alert("Error closing document: "+B.message)}try{document.write(c)}catch(B){alert("Error writing document: "+
B.message)}}};this.updateSkillWindow=function(a){b.ctatdebug("updateSkillWindow()");CTATSkillSet.skills.untouchSkills();var c=CTATShellTools.findComponentByClass("CTATSkillWindow");null!==c?null!=a?c.updateSkillSet(a):c.drawComponent():b.ctatdebug("Info: no skill window available")};this.processComponentFocus=function(a){b.ctatdebug("processComponentFocus("+a.getName()+","+a.getClassName()+")");"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()||"CTATTextArea"==a.getClassName()?
(CTATGlobals.selectedTextInput=a,null!==mobileAPI&&!0===mobileAPI.getEnabled()&&mobileAPI.processTextFocus(a.getX(),a.getY(),a.getWidth(),a.getHeight())):CTATGlobals.selectedTextInput=null;b.ctatdebug("processComponentFocus() done")};this.showFeedback=function(a){null!=a&&void 0!=a&&/\S/.test(a)&&" "!=a?(b.ctatdebug("showFeedback("+a+") -> l: "+a.length),CTATShellTools.showFeedback(a),null!=n&&n(a)):b.ctatdebug("showFeedback(): False alarm: empty message. This can happen when the commshell is trying to clear the hint window and there is no hint window.")};
this.assignFeedbackHandler=function(a){b.ctatdebug("assignFeedbackHandler()");n=a};this.gradeSAI=function(a,c,e){b.ctatdebug("gradeSAI()");l[a]=e;a=new CTATSAI(a,c,e);b.processComponentAction(a,!0,!0)};this.assignGradingHandler=function(a){b.ctatdebug("assignGradingHandler()");m=a};this.assignAnonymousGradingProcessor=function(b){v=b};this.assignDoneProcessor=function(b){e=b};this.addEventListener=function(b,a){};this.addGlobalEventListener=function(a){b.ctatdebug("addGlobalEventListener( "+a+")");
a&&r.push(a)};this.sendToTools=function(b){a&&a.sendToToolsOrCollaborators(a.getURL(),b,!1)};this.closeWSConnection=function(b,c,e){(b=a.findWSConnection(b))?b.close(e,c):console.warn("connection not found")}};CTATCommShell.prototype=Object.create(CTATBase.prototype);CTATCommShell.prototype.constructor=CTATCommShell;CTATCommShell.commShell=null;CTATCommShell.detailedFeedback=!0;function enableDetailedFeedback(a){CTATCommShell.detailedFeedback=a};var CTATComponentReference=function(a,g){var f=a,c=g;this.setElement=function(a){f=a};this.getElement=function(){return f};this.setDiv=function(a){c=a};this.getDiv=function(){return c}};CTATComponentReference.components={};CTATComponentReference.list=function(){for(var a in CTATComponentReference.components){var g=CTATComponentReference.components[a];ctatdebug("Component: "+g.getElement().getName()+", with div: "+g.getDiv().id)}};
CTATComponentReference.getComponentFromID=function(a){var g=CTATComponentReference.components;return g.hasOwnProperty(a)?(a=g[a],a.getElement()?a.getElement():null):null};CTATComponentReference.add=function(a,g){var f=new CTATComponentReference(a,g);return CTATComponentReference.components[f.getDiv().getAttribute("id")]=f};var CTATCompBase=function(a,g,f,c,d,b){CTATBase.call(this,a,g);var e=f||0,h=c||0,l=d||-2,m=b||-2,n=50,p=25,v=!1,r=!1,u="",w=!1,B=!0,y=null,z="",q=null;this.isTabIndexable=!0;var F=0,C=null,A=this,E=null,I="hidden",G=CTATGlobalFunctions.gensym.z_index(),x=CTATGlobalFunctions.gensym.div_id(),H=CTATGlobalFunctions.gensym.z_index(),J=CTATGlobalFunctions.gensym.div_id();this.setIsAbstractComponent=function(b){v=b};this.isAbstractComponent=function(){return v};this.setIsFeedbackComponent=function(b){r=
b};this.isFeedbackComponent=function(){return r};this.setTabIndex=function(b){!0===this.isTabIndexable?(q=b,0>q?(q=CTATGlobals.Tab.Tracker,CTATGlobals.Tab.Tracker++):CTATGlobals.Tab.Tracker=q):q=-1};this.getTabIndex=function(){return q||this.getComponent().getAttribute("tabindex")};this.setZIndex=function(b){A.ctatdebug("Setting z index to: "+b);F=b;null!==y&&(y.style.zIndex=b)};this.getZIndex=function(){return F};this.setDefaultWidth=function(b){n=b};this.getDefaultWidth=function(){return n};this.setDefaultHeight=
function(b){p=b};this.getDefaultHeight=function(){return p};this.processCommShellEvent=function(b,a){A.ctatdebug("processCommShellEvent ("+b+")")};this.makeDivWrapper=function(b){y=document.createElement("div");y.id=this.getName();y.setAttribute("onkeypress","return noenter(event)");y.setAttribute("data-ctat-component",this.getClassName());y.style.position="absolute";y.style.left=e+"px";y.style.top=h+"px";y.style.zIndex=G;y.style.width=A.getWidth()+"px";y.style.height=A.getHeight()+"px";$(y).data("CTATComponent",
this);b.appendChild(y)};this.setDivWrapper=function(b){(y=b)&&y.setAttribute("data-ctat-component",this.getClassName())};var S=this.setClassName;this.setClassName=function(b){S(b);y&&y.setAttribute("data-ctat-component",this.getClassName())};this.wrapComponent=function(b){A.ctatdebug("wrapComponent ()");A.makeDivWrapper(b);A.ctatdebug("wrapComponent () done")};this.createCanvas=function(){A.ctatdebug("createCanvas ()");E=document.createElement("canvas");E.setAttribute("id",J);E.setAttribute("onkeypress",
"return noenter(event)");E.setAttribute("width",l+canvasCalibrate+"px");E.setAttribute("height",m+canvasCalibrate+"px");E.setAttribute("style","border: 1px "+this.borderColor+" solid; "+("hidden"==I?"visibility: hidden; ":"")+"z-index:"+H+";");y.firstChild?y.insertBefore(E,y.firstChild):y.appendChild(E);return E};this.redraw=function(){var b=y.style.display;y.style.display="none";y.style.display=b};this.setCanvasVisibility=function(b){I=b};this.getSubCanvasCtx=function(){if(E)return E.getContext("2d")};
this.getSubCanvas=function(){return E};this.getX=function(){return e};this.getY=function(){return h};this.getWidth=function(){if(0>=l){var b;C?b=window.getComputedStyle(C):y&&(b=window.getComputedStyle(y));if(b)return parseFloat(b.width)}return l};this.getHeight=function(){if(0>=m&&y){var b=window.getComputedStyle(y);return parseFloat(b.getPropertyValue("height"))}return m};this.getText=function(){return u};this.getEnabled=function(){return B};this.assignEnabled=function(b){B=b;y.setAttribute("data-ctat-enabled",
B)};this.setEnabled=function(b){A.ctatdebug("setEnabled ("+b+")");A.assignEnabled(b);C?C.disabled=!B:A.ctatdebug("Error: component pointer is null")};this.lock=this.setEnabled.bind(A,!1);this.unlock=this.setEnabled.bind(A,!0);this.getDivWrap=function(){return y};this.getComponent=function(){return C};this.component=null;Object.defineProperty(this,"component",{get:function(){return C}});this.getCanvasZIndex=function(){return H};this.getComponentGroup=function(){return z};this.setComponent=function(b){C=
b;this.setEnabled(this.getEnabled())};this.getTopDivZIndex=function(){return G};this.getTopDivID=function(){return x};this.setComponentGroup=function(b){z=b;C&&(C.name=b)};this.assignText=function(b){u=b};this.init=function(){A.ctatdebug("THIS IS THE BASE INIT METHOD")};this.initialize=function(){A.ctatdebug("initialize ()");A.configFromDescription();A.init();A.processSerialization();A.render();A.processTabOrder();A.ctatdebug("initialize () done")};this.getInitialized=function(){return w};this.setInitialized=
function(b){A.ctatdebug("setInitialized ("+b+")");w=b;!0!==w||y?A.ctatdebug("Not wrapping, initialized="+w+", divWrapper = "+y):(A.ctatdebug("Wrapping a component and appending it to the top container div if one was never set ..."),(b=findPointOfAttachment(this.getName()))?(A.ctatdebug("Attaching component to existing MovieClip ..."),A.wrapComponent(b.getDivWrapper())):(A.ctatdebug("Attaching component to main div ..."),0<$("#"+ctatcontainer).length&&A.wrapComponent(getSafeElementById(ctatcontainer))));
A.getDivWrap().classList.add("CTATComponent");A.ctatdebug("setInitialized () done")};this.addSafeEventListener=function(b,a,c){A.ctatdebug("addSafeEventListener ("+b+")");A.ctatdebug("Adding event listener to: "+c);c?c.addEventListener(b,a):(C?(A.ctatdebug("Adding eventlistener to component instead of target"),C.addEventListener(b,a)):A.ctatdebug("Error: pointer to component is null, can't add event listener"),A.ctatdebug("addSafeEventListener () done"))};this.drawComponent=function(){};this.addComponentReference=
function(b,a){A.ctatdebug("addComponentReference ("+b.getName()+" -> "+a.getAttribute("id")+")");CTATComponentReference.add(b,a);A.ctatdebug("addComponentReference ()")};this.getComponentFromID=function(b){return CTATComponentReference.getComponentFromID(b)};this.processSerialization=function(){A.ctatdebug("processSerialization()");A.ctatdebug("implement in child class")};this.move=function(b,a){e=Number(b);h=Number(a);if(void 0===a||null===a||isNaN(h))if(0<=b.indexOf(",")){var c=b.split(",");e=Number(c[0]);
h=Number(c[1])}else h=0;e=isNaN(e)?0:e;h=isNaN(h)?0:h;y&&(y.style.left=e+"px",y.style.top=h+"px")};this.setSize=function(b,a){var c=Number(b),e=Number(a);(void 0===a||null===a||isNaN(e))&&0<=b.indexOf(",")&&(e=b.split(","),c=Number(e[0]),e=Number(e[1]));A.ctatdebug("setSize ("+c+","+e+")");isNaN(c)||A.setWidth(c);isNaN(e)||A.setHeight(e)};this.SetVisible=this.setVisible=function(b){b=CTATGlobalFunctions.toBoolean(b);I=!0===b?"block":"hidden";E&&E.setAttribute("style","border: 0px; position: absolute; "+
(b?"":"visibility:hidden; ")+"; left:"+e+"px; top:"+h+"px; z-index:"+H+";");y.style.visibility=!0===b?"unset":"hidden"};this.FadeIn=function(b){A.SetVisible(!0)};this.FadeOut=function(b){A.SetVisible(!1)};this.reset=function(){};this.setX=function(b){this.x=b;y.style.left=this.x+"px";!0===w&&this.render()};this.setY=function(b){this.y=b;y.style.top=this.y+"px";!0===w&&this.render()};this.setWidth=function(b){A.ctatdebug("setWidth ("+b+")");l=b;y?y.style.width=l+"px":A.ctatdebug("Internal error: no div wrapper available to set width")};
this.setHeight=function(b){A.ctatdebug("setHeight ("+b+")");m=b;y?y.style.height=m+"px":A.ctatdebug("Internal error: no div wrapper available to set height")};this.setText=function(b){u=b;return this};this.getValue=function(){return C?C.value:""};this.backgrade=!1;this.unHighlightAll=function(){$(".CTAT--hint").each(function(){for(var b=$(this),a=null;0<b.length&&null===a;)b.data("CTATComponent")?a=b.data("CTATComponent"):b=b.parent();a&&a.setHintHighlight&&a.setHintHighlight(!1,null)})};this.processOnFocus=
function(){A.ctatdebug("processOnFocus ("+A.getName()+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus!=A?(A.ctatdebug("CTATGlobals.Tab.Focus!=pointer, updating CTATGlobals.Tab.Focus ..."),CTATGlobals.Tab.Focus=A):A.ctatdebug("CTATGlobals.Tab.Focus==pointer");A.ctatdebug("processOnFocus () done")};this.processFocus=function(b){A.ctatdebug("processFocus ()");b.currentTarget.getAttribute("id");if(A){mobileAPI&&!0===mobileAPI.getEnabled()&&A.hideKeyboard();CTATCommShell.commShell&&
CTATCommShell.commShell.processComponentFocus(A);if(CTATGlobals.Tab.Focus){A.ctatdebug("old focus: "+CTATGlobals.Tab.Focus.getName()+", new focus:"+A.getName()+", correct: "+CTATGlobals.Tab.Focus.isCorrect());if(1==CTATGlobals.Tab.Focus.isCorrect()){A.ctatdebug("Previous focus is a correct component, don't backgrade!");return}if(CTATGlobals.Tab.Focus==A){A.ctatdebug("We're already there!");return}CTATGlobals.Tab.Focus.backgrade&&CTATGlobals.Tab.Focus.processAction()}else A.ctatdebug("No previously focused component yet, can't grade");
"hint"==A.getClassName()||"CTATHintButton"==A.getClassName()?A.ctatdebug("Info: focus moved to hint, bump"):(CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus,CTATGlobals.Tab.Focus=A,A.ctatdebug("processFocus () done"))}else A.ctatdebug("Error: component reference is null")};this.processTabOrder=function(){A.ctatdebug("processTabOrder ("+q+")");!0===v?A.ctatdebug("Component is an abstract component, bump"):C?(A.ctatdebug("We have a component, actually assigning to html component ..."),null!==q&&
(C.tabIndex=q),C.onfocus=A.processOnFocus):A.ctatdebug("Error: we don't have an html component yet, can't assign tab index")};this.hideKeyboard=function(){document.activeElement.blur();$("input").blur()}};CTATCompBase.prototype=Object.create(CTATBase.prototype);CTATCompBase.prototype.constructor=CTATCompBase;var CTATCSS=function(){var a=0,g=[],f=0,c=[],d=0,b=[];this.resetSelectors=function(){f=0;c=[];c[f]=[]};this.resetCSSStringArray=function(){b=[];d=0};this.clearCSS=function(){this.resetSelectors();this.resetCSSStringArray();g=[];a=0};this.addStringCSS=function(a){b[d]=a;d++};this.addCSSAttribute=function(b,c){g[a]=b;g[a+1]=c;a+=2};this.removeStringCSS=function(a){a=b.indexOf(a);0<=a&&b.splice(a,1)};this.removeCSSAttribute=function(b){b=g.indexOf(b);0<=b&&g.splice(b,2)};this.modifyCSSAttribute=function(b,
a){var c=g.indexOf(b);-1==c?this.addCSSAttribute(b,a):g[c+1]=a};this.addSelector=function(b){c[f]=[];c[f][0]=b;f++};this.addSelectorAttribute=function(b,a,d){var e=1;a:if(0===f)b=0;else{for(var g=0;g<c.length&&null!==c[g][0];g++)if(c[g][0]==b){b=g;break a}b=-1}for(;void 0!==c[b][e];)e++;c[b][e]=a;c[b][e+1]=d};this.toCSSString=function(){for(var a="",d=0;d<c.length;d++){for(var a=a+(c[d][0]+" { "),f=1;f<c[d].length;f++)a+=c[d][f],a=0===f%2?a+"; ":a+": ";a+=" }; "}for(d=0;d<g.length;d++)a+=g[d],a=0===
d%2?a+": ":a+"; ";for(d=0;d<b.length;d++)a+=b[d]+" ";return a}};CTAT.Component={};CTAT.Component.Base={};
CTAT.Component.Base.Style=function(a,g,f,c,d,b){CTATCompBase.call(this,a,g,f,c,d,b);var e=new CTATCSS;this.addCSSAttribute=function(b,a){e.addCSSAttribute(b,a);this.render()};this.removeCSSAttribute=function(b){e.removeCSSAttribute(b);this.render()};this.addStringCSS=function(b){e.addStringCSS(b);this.render()};this.removeStringCSS=function(b){e.removeStringCSS(b);this.render()};this.modifyCSSAttribute=function(b,a){e.modifyCSSAttribute(b,a);this.render()};this.getCSS=function(){return e.toCSSString()};
this.render=function(){!0===this.isAbstractComponent()?this.ctatdebug("Component is an abstract component, bump"):this.getInitialized()&&(this.getComponent()?this.ctatdebug(e.toCSSString()):this.ctatdebug("Internal error, html component not available for rendering"))};this.setStyleAll=function(b,a){this.getSubCanvas()&&this.getSubCanvas().setAttribute(b,a);this.modifyCSSAttribute(b,a)}};CTAT.Component.Base.Style.prototype=Object.create(CTATCompBase.prototype);
CTAT.Component.Base.Style.prototype.constructor=CTAT.Component.Base.Style;CTAT.Component.Base.Graphical=function(a,g,f,c,d,b,e){CTAT.Component.Base.Style.call(this,a,g,c,d,b,e);var h=f||(new CTATComponentDescription).setGenericDefaults();this.getGrDescription=function(){return h};this.setGrDescription=function(b){h=b;this.processDescription(h)};var l={},m={};this.getAlign=function(){return this.component?$(this.component).css("text-align"):$(this.getDivWrap()).css("text-align")};this.setAlign=function(b){this.component&&(this.component.style.textAlign=b);return this};this.getBackgroundColor=
function(){return $(this.getComponent()).css("background-color")};this.setBackgroundColor=function(b){b=b?CTATGlobalFunctions.formatColor(b):null;this.component&&(this.component.style.backgroundColor=b);return this};this.setDisabledBGColor=function(b){return this};this.setDisabledTextColor=function(b){return this};this.getBorderColor=function(){return $(this.getComponent()).css("border-color")};this.setBorderColor=function(b){b&&(b=CTATGlobalFunctions.formatColor(b),this.getComponent()?$(this.getComponent()).css("border-color",
b):this.getDivWrap().style.borderColor=b);return this};this.getBorderRoundness=function(){return $(this.getComponent()).css("border-radius")};this.setBorderRoundness=function(b){b=parseInt(b,10);isNaN(b)?b=l.roundness=0:l.roundness=b;b+="px";this.component&&this.getBorderRoundness()!==b&&($(this.component).css("border-radius",b),this.component.style.borderRadius=l.roundness);return this};this.getBorderStyle=function(){return $(this.getComponent()).css("borderStyle")};this.setBorderStyle=function(b){this.component&&
(this.component.style.borderStyle=b);return this};this.getBorderWidth=function(){return this.getComponent()?$(this.getComponent()).css("borderWidth"):l.width};this.setBorderWidth=function(b){l.width=b;/(\d*(px)? ?){1,3}(\d*(px)? ?)?/.test(b)||(b="0px",console.log("invalid width string"));this.component&&this.getBorderWidth()!==b&&$(this.component).css("borderWidth",b);return this};this.setPadding=function(b){b=parseInt(b);isNaN(b)&&(b=0);this.component&&(this.component.style.padding=b+"px");return this};
this.getFontColor=function(){if(this.component)return $(this.component).css("color")};this.setFontColor=function(b){console.log("setFontColor( )");m.color=CTATGlobalFunctions.formatColor(b);this.component&&(console.log("got comp"),this.getFontColor()!==m.color&&$(this.component).css("color",m.color));return m.color};this.setFontFamily=function(b){this.component&&(this.component.style.fontFamily=b);return this};this.getFontFamily=function(){if(this.component)return this.component.style.fontFamily;
console.warn("component not found");return null};this.setFontSize=function(b){b=parseInt(b);isNaN(b)?this.component.style.fontSize=null:(m.size=b,this.component&&(this.component.style.fontSize=b+"pt"));return this};this.setShowBorder=function(b){b=CTATGlobalFunctions.toBoolean(b);this.component&&(b?this.setBorderStyle("solid"):this.setBorderStyle("none"));return this};this.setUnderlined=function(b){p_underlined=CTATGlobalFunctions.toBoolean(b);this.component&&(this.component.style.textDecoration=
p_underlined?"underline":null);return this};this.setBolded=function(b){b=CTATGlobalFunctions.stringToBoolean(b);this.component&&(this.component.style.fontWeight=b?"bold":null);return this};this.setItalicized=function(b){CTATGlobalFunctions.toBoolean(b);this.component&&(this.component.style.fontStyle=m.italicized?"italic":null);return this};var n=this;a=function(b){var a=b||{};return{setHandler:function(b,c){a[b]=c},set:function(b){if(a.hasOwnProperty(b)){if(a[b]){var c=Array.prototype.slice.call(arguments,
1);return a[b].apply(n,c)}n.ctatdebug("Error: NULL handler for "+b)}else n.ctatdebug("Error: No handler set for "+b)}}};this.style_handlers=a({BackgroundColor:this.setBackgroundColor,BorderColor:this.setBorderColor,borderRoundness:this.setBorderRoundness,DrawBorder:this.setShowBorder,FontFace:this.setFontFamily,FontSize:this.setFontSize,FontBold:this.setBolded,FontItalic:this.setItalicized,FontUnderlined:this.setUnderlined,labelText:this.setText,padding:this.setPadding,showBorder:this.setShowBorder,
TextAlign:this.setAlign,TextColor:this.setFontColor});this.setStyle=function(b,a){this.style_handlers.set(b,a)};this.setStyleHandler=function(b,a){this.style_handlers.setHandler(b,a)};this.parameter_handlers=a({group:this.setComponentGroup});this.setParameter=function(b,a){this.parameter_handlers.set(b,a)};this.setParameterHandler=function(b,a){this.parameter_handlers.setHandler(b,a)};this.data_ctat_handlers={};this.processAttributes=function(){if(this.getDivWrap()){var b=$(this.getDivWrap()),a=parseInt(b.attr("tabindex"),
10)||parseInt(b.attr("data-ctat-tabindex"),10);isNaN(a)||(this.setTabIndex(a),b.attr("tabindex",null));a=b.attr("name");void 0!==a&&this.setComponentGroup(a);for(var c in this.data_ctat_handlers)a=b.data("ctat-"+c),void 0!==a&&this.data_ctat_handlers[c].apply(this,[a])}};this.data_ctat_handlers.enabled=function(b){this.setEnabled(CTATGlobalFunctions.toBoolean(b))};this.processParameters=function(b){if(b)if(b instanceof CTATComponentDescription){n.setName(b.name);b=b.params;for(var a in b)this.setParameter(a,
b[a])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+b)};this.processStyles=function(b){if(b)if(b instanceof CTATComponentDescription){b=b.styles;for(var a in b)this.setStyle(a,b[a])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+b)};this.processDescription=function(b){this.processParameters(b);this.processStyles(b)};this.configFromDescription=function(){this.processParameters(h)};
this.processSerialization=function(){this.processStyles(h)};this.addClass=function(b){this.getDivWrap()&&null!=this.getDivWrap()&&this.getDivWrap().classList.add(b)};this.removeClass=function(b){this.getDivWrap()&&null!=this.getDivWrap().classList&&this.getDivWrap().classList.remove(b)}};CTAT.Component.Base.Graphical.prototype=Object.create(CTAT.Component.Base.Style.prototype);CTAT.Component.Base.Graphical.prototype.constructor=CTAT.Component.Base.Graphical;CTAT.Component.Base.SAIHandler=function(a,g,f,c,d,b,e){CTAT.Component.Base.Graphical.call(this,a,g,f,c,d,b,e);var h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt),l=this.setName;this.setName=function(b){l(b);h.setSelection(this.getName())};this.getSAI=function(){return h};this.setSAI=function(b,a,c){b instanceof CTATSAI?h=b:(b=null===b||void 0===b?this.getName():b,h=new CTATSAI(b,a,c,
CTAT.Component.Base.SAIHandler.DefaultPrompt));return this};this.setInput=function(b){h instanceof CTATSAI?h.setInput(b):h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,b,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setAction=function(b){h instanceof CTATSAI?h.setAction(b):h=new CTATSAI(this.getName(),b,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setActionInput=function(b,a){this.setAction(b);
this.setInput(a);return this};this.setSelection=function(b){h instanceof CTATSAI?h.setSelection(b):h=new CTATSAI(b,CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt)};this.updateSAI=function(){};this.executeSAI=function(b){this.ctatdebug("executeSAI ()");var a;a=b instanceof CTATMessage?b.getSAI():b;if(a instanceof CTATSAI){var c=a.getAction();this.ctatdebug("Processing "+c+"("+a.getInput()+") on: "+a.getSelection());
if("function"==typeof this[c]){a=a.getArgumentsTyped();this.ctatdebug("JSON args: "+JSON.stringify(a));try{this.ctatdebug("Executing "+c+"("+a+","+typeof b+")..."),a.push(b),this[c].apply(this,a)}catch(v){return this.ctatdebug("ERROR: failed to execute action: "+v.message),!1}this.component&&(b=new CustomEvent("CTAT_EXECUTE_SAI",{detail:{sai:b,component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(b));return!0}this.ctatdebug("ERROR: Unsupported action: "+c+" from "+a.toLSxmlString());
return!1}this.ctatdebug("ERROR: Non-SAI sent to executeSAI("+typeof b+")");return!1}};CTAT.Component.Base.SAIHandler.DefaultAction="ButtonPressed";CTAT.Component.Base.SAIHandler.DefaultInput="-1";CTAT.Component.Base.SAIHandler.DefaultPrompt="";CTAT.Component.Base.SAIHandler.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTAT.Component.Base.SAIHandler.prototype.constructor=CTAT.Component.Base.SAIHandler;CTAT.Component.Base.Tutorable=function(a,g,f,c,d,b,e){CTAT.Component.Base.SAIHandler.call(this,a,g,f,c,d,b,e);var h=!0,l=!0,m=!0,n=CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR,p=this,v=!1;this.setTutorComponent=function(b){n=b;b=CTAT.Component.Base.Tutorable.Options.TutorComponent;switch(n){case b.TUTOR:m=h=l=!0;break;case b.TUTOR_NO_FEEDBACK:h=l=!0;m=!1;break;case b.DO_NOT_TUTOR:h=!1,l=!0}};this.setParameterHandler("tutorComponent",this.setTutorComponent);this.data_ctat_handlers.tutor=
function(b){h=CTATGlobalFunctions.toBoolean(b)};this.data_ctat_handlers["show-feedback"]=function(b){m=CTATGlobalFunctions.toBoolean(b)};this.getTutorComponent=function(){var b=CTAT.Component.Base.Tutorable.Options.TutorComponent;return h&&l&&m?b.TUTOR:h&&l&&!m?b.TUTOR_NO_FEEDBACK:!h&&l?b.DO_NOT_TUTOR:n};this.getDisableOnCorrect=function(){var b=$(this.getDivWrap()).attr("data-ctat-disable-on-correct");return b?CTATGlobalFunctions.toBoolean(b):!0};this.setDisableOnCorrect=function(b){$(this.getDivWrap()).attr("data-ctat-disable-on-correct",
b)};this.setParameterHandler("DisableOnCorrect",this.setDisableOnCorrect);var r=!0;this.getShowHintHighlight=function(){return r};this.setShowHintHighlight=function(b){r=CTATGlobalFunctions.toBoolean(b)};this.setParameterHandler("ShowHintHighlight",this.setShowHintHighlight);this.data_ctat_handlers["show-hint-highlight"]=function(b){r=CTATGlobalFunctions.toBoolean(b)};var u=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED;this.getComponentStatus=function(){return u};this.setComponentStatus=
function(b){u=b};this.isCorrect=function(){return u===CTAT.Component.Base.Tutorable.Options.Status.CORRECT};this.isIncorrect=function(){return u===CTAT.Component.Base.Tutorable.Options.Status.INCORRECT};this.isNotGraded=function(){return u===CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.setCorrect=function(b){this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(b);u=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;!0===this.getDisableOnCorrect()&&this.setEnabled(!1);
!1===CTATGlobals.suppressStudentFeedback&&m&&this.showCorrect(b);this.ctatdebug("setCorrect() post showCorrect");this.component&&(b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:b,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(b))};this.setIncorrect=function(b){this.ctatdebug("setIncorrect()");this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(b);u=CTAT.Component.Base.Tutorable.Options.Status.INCORRECT;!1===CTATGlobals.suppressStudentFeedback&&
m&&this.showInCorrect(b);this.component&&(b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.incorrect,{detail:{sai:b,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(b))};this.setNotGraded=function(){this.ctatdebug("setNotGraded ()");this.setHintHighlight(!1);if(!this.isNotGraded()&&(u=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED,this.removeCorrect(),this.removeInCorrect(),this.component)){var b=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.ungrade,
{detail:{component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(b)}};this.showHintHighlight=function(b,a){this.component.classList.remove("CTAT--correct");this.component.classList.remove("CTAT--incorrect");b?this.component.classList.add("CTAT--hint"):this.component.classList.remove("CTAT--hint")};this.setHintHighlight=function(b,a){this.ctatdebug("setHintHighlight ("+b+")");if(r){var c=CTATGlobalFunctions.toBoolean(b);if(this.component){var e=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:c,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(e)}c!==v&&(v=c,this.showHintHighlight(c,a))}};this.moveHintHighlight=function(b,a){this.ctatdebug("moveHintHighlight ("+b+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus=p;p.component.focus?CTATGlobals.Tab.Focus.getComponent().focus():CTATGlobals.Tab.Focus.getDivWrap().focus();if(r){var c=CTATGlobalFunctions.toBoolean(b);if(this.component){var e=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:c,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(e)}c!==v&&(v=c,this.showHintHighlight(c,a))}};this.highlight=function(b){ctatdebug("highlight ()");this.component.classList.add("CTAT--highlight")};this.unhighlight=function(b){ctatdebug("unhighlight ()");this.component.classList.remove("CTAT--highlight")};this.showCorrect=function(b){this.ctatdebug("showCorrect("+b+")");this.getComponent().classList.remove("CTAT--incorrect");this.getComponent().classList.remove("CTAT--hint");
this.getComponent().classList.add("CTAT--correct")};this.removeCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--correct")};this.showInCorrect=function(b){this.ctatdebug("showInCorrect("+b+")");this.getComponent().classList.remove("CTAT--correct");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--incorrect")};this.removeInCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--incorrect")};this.resetTutoring=
function(){this.showHintHighlight(!1);this.removeCorrect();this.removeInCorrect();u=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.grade=function(){this.updateSAI();this.processAction(!0)};this.processAction=function(b,a){this.ctatdebug("processAction("+b+","+a+")");p.unHighlightAll();var c=CTATShellTools.findComponentByClass("CTATDoneButton");c&&c instanceof CTAT.Component.Base.Tutorable&&c!=this&&c.setNotGraded();this.ctatdebug("processAction() finished checking doneButton");ctatdebug("Clearing hint window ...");
CTATCommShell.commShell&&CTATCommShell.commShell.clearFeedbackComponents();b=void 0===b||null===b?!1:b;a=void 0===a||null===a?!1:a;""!==this.getComponentGroup()?CTATShellTools.findComponent(this.getComponentGroup()).forEach(function(b){b.setNotGraded&&b.setNotGraded()}):this.setNotGraded();this.ctatdebug("processAction() finished setNotGraded");CTATCommShell.commShell&&(b?CTATCommShell.commShell.processComponentAction(this.getSAI(),!0,!0):a?CTATCommShell.commShell.processComponentAction(this.getSAI(),
!1,!0):CTATCommShell.commShell.processComponentAction(this.getSAI(),h,l));this.ctatdebug("processAction() finished call to commShell.processComponentAction");this.component&&(c=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.action,{detail:{sai:this.getSAI(),component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(c))};this.addEventScreen=function(b){var a=document.createElement("div");a.style.position="absolute";a.style.top="0";a.style.left="0";a.style.bottom="0";a.style.right=
"0";b&&a.addEventListener("dblclick",function(){setTimeout(function(){var b=p.getDivWrap().getAttribute("data-ctat-enabled");p.setEnabled(!0);var a=p.getComponent();a.hasEditListeners||(a.addEventListener("blur",function(){p.setEnabled(!1);p.getDivWrap().setAttribute("data-ctat-enabled",b);p.getDivWrap().setAttribute("value",a.value)}),"CTATTextArea"===p.getClassName()&&a.addEventListener("keydown",function(b){13==(b.keyCode||b.charCode)&&(b.preventDefault(),this.value+="\n")}),a.hasEditListeners=
!0);a.focus()},410)});this.getDivWrap().appendChild(a)}};CTAT.Component.Base.Tutorable.Options={TutorComponent:{TUTOR:"Tutor",TUTOR_NO_FEEDBACK:"Tutor but no visual feedback",DO_NOT_TUTOR:"Do not tutor"},Status:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",NOTGRADED:"NOTGRADED"}};CTAT.Component.Base.Tutorable.EventType={correct:"CTAT_CORRECT",incorrect:"CTAT_INCORRECT",highlight:"CTAT_HIGHLIGHT",ungrade:"CTAT_NOTGRADED",action:"CTAT_ACTION"};CTAT.Component.Base.Tutorable.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);
CTAT.Component.Base.Tutorable.prototype.constructor=CTAT.Component.Base.Tutorable;CTAT.Component.Base.Clickable=function(a,g,f,c,d,b,e){CTAT.Component.Base.Tutorable.call(this,a,g,f,c,d,b,e);var h=this;this.processClick=function(b){h.ctatdebug("processClick ("+b.currentTarget.getAttribute("id")+" -> "+b.eventPhase+")");!0===h.getEnabled()?h.processAction():h.ctatdebug("Component is disabled, not grading")};this.setClickable=function(b){h.setEnabled(b)}};CTAT.Component.Base.Clickable.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTAT.Component.Base.Clickable.prototype.constructor=CTAT.Component.Base.Clickable;var CTATButtonBasedComponent=function(a,g,f,c,d,b,e){CTAT.Component.Base.Clickable.call(this,a,g,f,c,d,b,e);var h=this,l="",m="black";this.setActionInput("ButtonPressed","-1");this.setImage=function(b){h.ctatdebug("assignImage ("+b+")");h.getDivWrap().setAttribute("data-ctat-img",b);b&&(b="url('"+b+"')");$(h.getComponent()).css("background-image",b);$(h.getComponent()).css("background-size","cover")};this.assignImage=function(b){h.ctatdebug("assignImage ()");h.assignImages(b,b,b,b)};this.assignImageURL=
function(b){h.ctatdebug("assignImageURL ()");h.assignImages(b,b,b,b)};this.assignImages=function(b,a,c,e){h.ctatdebug("assignImages ()");h.getDivWrap().setAttribute("data-ctat-image-hover",b);h.getDivWrap().setAttribute("data-ctat-image-clicked",a);h.getDivWrap().setAttribute("data-ctat-image-default",c);h.getDivWrap().setAttribute("data-ctat-image-disabled",e);this.setImage(c)};this.processBaseMousedown=function(){h.ctatdebug("processMousedown ()");h.component.classList.add("CTAT-button--clicked");
var b=h.getDivWrap().getAttribute("data-ctat-image-clicked");h.getEnabled()&&b&&void 0!==b&&""!==b&&null!==b&&(h.getComponent().style.backgroundImage="url('"+b+"')")};this.processBaseMouseup=function(){h.ctatdebug("processMouseup ()");h.component.classList.remove("CTAT-button--clicked");var b=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&b&&void 0!==b&&""!==b&&null!==b&&(h.getComponent().style.backgroundImage="url('"+b+"')")};this.processBaseMouseover=function(){h.ctatdebug("processBaseMouseover ()");
h.component.classList.add("CTAT-button--hover");var b=h.getDivWrap().getAttribute("data-ctat-image-hover");h.getEnabled()&&b&&void 0!==b&&""!==b&&(h.getComponent().style.backgroundImage="url('"+b+"')")};this.processBaseMouseout=function(){h.ctatdebug("processBaseMouseout ()");h.component.classList.remove("CTAT-button--hover");h.component.classList.remove("CTAT-button--clicked");var b=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&b&&void 0!==b&&""!==b&&(h.getComponent().style.backgroundImage=
"url('"+b+"')")};this.setText=function(b){h.ctatdebug("setText ("+b+")");l=b;null!==h.getComponent()&&(h.getComponent().innerHTML=l)};this.setFontColor=function(b){m=b;$(h.getComponent()).css("color",b)};this.getFontColor=function(){return m};this.setStyleHandler("labelText",this.setText);this.getText=function(){return l};this.processClick=function(b){h.ctatdebug("processClick ("+b.currentTarget.getAttribute("id")+" -> "+b.eventPhase+")");!0===h.getEnabled()?(null!==CTATGlobals.Tab.Focus&&("CTATTextArea"==
CTATGlobals.Tab.Focus.getClassName()||"CTATTextInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextField"==CTATGlobals.Tab.Focus.getClassName()?CTATGlobals.Tab.Focus.processAction():h.ctatdebug("Info: CTATGlobals.Tab.Focus==null")),b=$(h.getDivWrap()).attr("value"),h.setInput(b?b:"-1"),h.processAction()):h.ctatdebug("Component is disabled, not grading")};this.ButtonPressed=function(){}};CTATButtonBasedComponent.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATButtonBasedComponent.prototype.constructor=CTATButtonBasedComponent;CTAT.ComponentRegistry={};CTAT.ComponentRegistry.addComponentType=function(){};Object.defineProperty(CTAT.ComponentRegistry,"addComponentType",{enumerable:!1,value:function(a,g){"string"==typeof a&&(this.hasOwnProperty(a)?alert(a+" is already a registered component"):this[a]=g)}});var CTATAudioButton=function(a,g,f,c,d){CTATButtonBasedComponent.call(this,"CTATAudioButton","audiobutton",a,g,f,c,d);var b=this;b.setActionInput("play","-1");var e=null,h="",l=CTATConfiguration.get("previewMode");this.setSource=function(b){this.getDivWrap().setAttribute("data-ctat-src",b);return this};this.getSource=function(){return this.getDivWrap().getAttribute("data-ctat-src")};this.setParameterHandler("SoundFile",this.setSource);this.init=function(){var a=document.createElement("button");a.value=
"-1";a.name=b.getName();a.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setAttribute("onkeypress","return noenter(event)");a.classList.add("CTAT-button");if(this.getDivWrap().getAttribute("data-ctat-label"))a.textContent=this.getDivWrap().getAttribute("data-ctat-label");else if(b.getText())a.textContent=b.getText();else if(b.getDivWrap()&&b.getDivWrap().innerHTML&&!l){var c=b.getDivWrap().innerHTML;b.getDivWrap().innerHTML="";a.innerHTML=c}b.setInitialized(!0);b.setComponent(a);b.addComponentReference(b,
a);b.getDivWrap().appendChild(a);b.ctatdebug("Final location: "+b.getX()+","+b.getY()+" with text: "+b.getText());l||(a.addEventListener("click",b.processClick),a.addEventListener("focus",b.processFocus));e=document.createElement("audio");e.addEventListener("canplay",function(){b.ctatdebug("Audio loaded and ready for play");""!==h&&(b.logAudioEvent(h),h="")},!0);e.onended=function(){b.ctatdebug("Audio ended");b.logAudioEvent("end")};this.getDivWrap().appendChild(e)};this.getConfigurationActions=function(){var b=
[],a;0<this.component.innerHTML.trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(this.component.innerHTML.toString()),a.setAction("setText"),b.push(a));0<this.getSource().trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(this.getSource()),a.setAction("setSource"),b.push(a));return b};this.reset=function(){b.configFromDescription();b.processSerialization();b.setEnabled(!0);h="reset"};this.logAudioEvent=function(a){b.ctatdebug("logAudioEvent ("+a+")");if(void 0!==
e.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(b.getName(),a,b.toHHMMSS(e.currentTime)+".000","");a.addSelection(encodeURIComponent(e.currentSrc),"media_file");a.addSelection(b.toHHMMSS(e.duration)+".000","clip_length");var c=a.getInputObject();null!==c&&c.setType("time");CTATCommShell.commShell.processComponentAction(a,!1,!0,b,"AUDIO_ACTION","USER")}else b.ctatdebug("Error: commShell is null, can't send untutored tool message");else b.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};
this.processClick=function(a){b.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===b.getEnabled()?(a=this.getSource(),b.ctatdebug("Playing audio file: "+a),e.setAttribute("src",a),e.play(),h="play",b.processAction()):b.ctatdebug("Component is disabled, not grading")}.bind(this);this.play=function(){b.ctatdebug("play");var a=this.getSource();e.setAttribute("src",a);e.load();e.play();h="play"};this.playClip=function(a){b.ctatdebug("playClip");e.setAttribute("src",
a);e.load();e.play();h="play"};this.pause=function(){b.ctatdebug("pause");e.pause();h="pause"}};CTATAudioButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATAudioButton.prototype.constructor=CTATAudioButton;CTAT.ComponentRegistry.addComponentType("CTATAudioButton",CTATAudioButton);var CTATButton=function(a,g,f,c,d){CTATButtonBasedComponent.call(this,"CTATButton","aButton",a,g,f,c,d);var b=this,e=null,h=CTATConfiguration.get("previewMode");this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setActionInput("ButtonPressed","-1");e=document.createElement("button");e.type="button";e.name=b.getName();e.value=$(this.getDivWrap()).attr("value")||"-1";this.setInput(e.value);e.id=CTATGlobalFunctions.gensym.div_id();e.setAttribute("onkeypress","return noenter(event)");e.classList.add("CTAT-button");
b.setInitialized(!0);if(b.getDivWrap().getAttribute("data-ctat-label"))e.innerHTML=b.getDivWrap().getAttribute("data-ctat-label");else if(b.getText())e.innerHTML=b.getText();else if(b.getDivWrap()&&b.getDivWrap().innerHTML&&!h){var a=b.getDivWrap().innerHTML;b.getDivWrap().innerHTML="";e.innerHTML=a}b.setComponent(e);b.addComponentReference(b,e);b.getDivWrap().appendChild(e);e.addEventListener("click",b.processClick);e.addEventListener("focus",b.processFocus);e.addEventListener("mousedown",this.processBaseMousedown);
e.addEventListener("mouseup",this.processBaseMouseup);e.addEventListener("mouseover",b.processBaseMouseover);e.addEventListener("mouseout",b.processBaseMouseout)}.bind(this);this.render=function(){};this.getConfigurationActions=function(){var b=[],a;0<e.innerHTML.trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(e.innerHTML.toString()),a.setAction("setText"),b.push(a));return b};this.reset=function(){b.configFromDescription();b.processSerialization();b.setEnabled(!0)}};
CTATButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATButton.prototype.constructor=CTATButton;CTAT.ComponentRegistry.addComponentType("CTATButton",CTATButton);var CTATCheckBox=function(a,g,f,c,d){CTAT.Component.Base.Clickable.call(this,"CTATCheckBox","__undefined__",a,g,f,c,d);var b=null,e=null,h=CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var l=this;this.setSelection(this.getComponentGroup());this.setAction("UpdateCheckBox");
this.getCheckBox=function(){return b};this.setStyleHandler("labelPlacement",null);var m=function(b){this.updateSAI();this.processClick(b)};this.init=function(){l.setInitialized(!0);b=document.createElement("input");b.type="checkbox";b.setAttribute("id",this.getName()+"_check");b.classList.add("CTATCheckBox--button");this.getText()?b.value=l.getText():this.getDivWrap()&&this.getDivWrap().textContent?b.value=this.getDivWrap().textContent:b.value=b.id;this.getComponentGroup()?b.name=l.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?b.name=$(this.getDivWrap()).attr("name"):b.name="checkBoxGroup";!0===l.getEnabled()?b.disabled=!1:b.disabled=!0;l.ctatdebug("Final location: "+l.getX()+","+l.getY()+" with text: "+l.getText());l.addComponentReference(l,b);if(!h){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML=""}$(l.getDivWrap()).append(b);e=document.createElement("label");e.htmlFor=b.id;e.classList.add("CTATCheckBox--label");this.getText()?e.textContent=this.getText():
a&&!h?e.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&this.setText(this.getDivWrap().getAttribute("data-ctat-label"));$(this.getDivWrap()).append(e);l.setComponent(b);b.addEventListener("click",m.bind(this));b.addEventListener("focus",l.processFocus);b.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup())};this.resize=function(){var b=$(this.getDivWrap()).height();$(e).css("font-size",b-5+"px");$(this.getComponent()).css("height",b-10+"px");$(this.getComponent()).css("width",
b-10+"px")};this.getConfigurationActions=function(){var b=[],a;0<e.innerHTML.trim().length&&(a=new CTATSAI,a.setSelection(this.getName()),a.setInput(e.innerHTML.toString()),a.setAction("setText"),b.push(a));return b};var n=this.setText;this.setText=function(a){l.ctatdebug("setText ("+a+")");n(a);b&&(b.value=a,e.innerHTML=a)};this.setStyleHandler("labelText",this.setText);var p=this.setEnabled;this.setEnabled=function(a){p(a);b&&(b.disabled=!this.getEnabled())};this.getCheckBoxInput=function(){return e.innerHTML+
": "+b.checked};this.reset=function(){b.checked=!1;l.setEnabled(!0)};this.UpdateCheckBox=function(a){var c=new RegExp("(^|;)"+CTATCheckBox.escape(b.value)+"\\s*:\\s*true");b.checked=0<=a.search(c)};this.SetSelected=function(a){a=CTATGlobalFunctions.toBoolean(a);b.checked=a};this.updateSAI=function(){var a=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="checkbox"][name="'+b.name+'"])').sort(function(b,a){var c=b.id,e=a.id;return c>e?1:c<e?-1:0}),a=$.map(a,function(b){b=$(b).data("CTATComponent").getCheckBox();
return b.value+": "+b.checked});this.setSelection(b.name);this.setAction("UpdateCheckBox");this.setInput(a.join(";"))};var v=function(a){e.classList.add(a);b.classList.add(a)},r=function(a){e.classList.remove(a);b.classList.remove(a)};this.showCorrect=function(b){r("CTAT--incorrect");r("CTAT--hint");v("CTAT--correct")};this.removeCorrect=r.bind(this,"CTAT--correct");this.showInCorrect=function(b){r("CTAT--correct");r("CTAT--hint");v("CTAT--incorrect")};this.removeInCorrect=r.bind(this,"CTAT--incorrect");
this.showHintHighlight=function(b){r("CTAT--incorrect");r("CTAT--correct");b?v("CTAT--hint"):r("CTAT--hint")}};CTATCheckBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATCheckBox.prototype.constructor=CTATCheckBox;CTATCheckBox.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s\/]/g,"\\$&")};CTAT.ComponentRegistry.addComponentType("CTATCheckBox",CTATCheckBox);var CTATComboBox=function(a,g,f,c,d){CTAT.Component.Base.Clickable.call(this,"CTATComboBox","__undefined__",a,g,f,c,d);var b=this,e=null;this.component=null;var h="",l=CTATConfiguration.get("previewMode");this.setAction("UpdateComboBox");var m=",";a=function(b){m=b;e&&(e.innerHTML="",this.addLabels(n,m))}.bind(this);this.setStyleHandler("SplitCharacter",a);this.data_ctat_handlers["split-on"]=a;var n=null;this.setLabels=function(b){n=b;e&&(e.innerHTML="",this.addLabels(n,m))}.bind(this);this.setStyleHandler("Labels",
this.setLabels);this.data_ctat_handlers.labels=this.setLabels;var p=null;a=function(b){b=parseInt(b);p=isNaN(b)?null:b;e&&e.setAttribute("size",p)};this.setStyleHandler("DropDownSize",a);this.data_ctat_handlers.size=a;this.setStyleHandler("DropDownWidth",null);this.setNumOptions=a;this.setGradeOnNextClick=function(a){b.ctatdebug("CTATComboBox["+b.getName()+"].setGradeOnNextClick("+a+")");h=a};this.getGradeOnNextClick=function(){b.ctatdebug("CTATComboBox["+b.getName()+"].getGradeOnNextClick() to return "+
h);return h};this.processAssociatedRules=function(a,c,e){a=a.getProperty("OutOfOrder");b.ctatdebug("CB["+b.getName()+"] processAssociatedRules indicator "+c+", outOfOrder "+a+", tutorAdvice '"+e+"'");c&&"incorrect"==c.toString().toLowerCase()&&(a||e&&e.toString().toLowerCase().includes(" the step you "))&&b.setGradeOnNextClick("at "+(new Date).toString()+": sai "+b.getSAI().toString())};this.init=function(){b.setInitialized(!0);e=document.createElement("select");e.name=b.getName();e.setAttribute("id",
CTATGlobalFunctions.gensym.div_id());e.setAttribute("onkeypress","return noenter(event)");e.onchange=this.processComboSelection;e.addEventListener("click",function(a){b.ctatdebug("CB["+b.getName()+"].onclick() "+a+", gradeOnNextClickInfo "+b.getGradeOnNextClick());b.getGradeOnNextClick()&&b.processComboSelection()});e.classList.add("CTAT-combobox");p&&!l&&e.setAttribute("size",p);if(!l){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML="";a.trim()&&(e.innerHTML=a)}n&&this.addLabels(n,
m);!0===b.getEnabled()?e.disabled=!1:e.disabled=!0;b.addComponentReference(b,e);b.setComponent(e);b.getDivWrap().appendChild(e);this.component=e;e.addEventListener("focus",b.processFocus)};this.getConfigurationActions=function(){var b=[];if(n){var a=new CTATSAI;a.setSelection(this.getName());a.setInput(n);a.setAction("setLabels");b.push(a)}return b};this.getHTMLComponent=function(){return e};this.addLabels=function(b,a){for(var c=b.split(a?a:m),e=0;e<c.length;e++)this.addItem(c[e])};this.addBlank=
function(b){for(var a=0;a<b;a++)this.addItem("")};this.addItem=function(a){b.ctatdebug("addItem ("+a+")");var c=document.createElement("option");c.setAttribute("value",a);c.textContent=a;e.appendChild(c)};this.setFontSize=function(b){isNaN(b)||($(this.getComponent()).css("font-size",b+"px"),this.getDivWrap().setAttribute("data-ctat-font-size",b))};this.valid_selection=function(){return 0<=e.selectedIndex&&!CTATGlobalFunctions.isBlank(e.value)};this.processComboSelection=function(){b.ctatdebug("processComboSelection ()");
b.setGradeOnNextClick("");b.setInput(e.options[e.selectedIndex].value);b.valid_selection()?b.processAction():this.ctatdebug("Empty component, nothing to grade")};this.UpdateComboBox=function(b){e.value=b};this.updateSAI=function(){b.setInput(e.value)}};CTATComboBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATComboBox.prototype.constructor=CTATComboBox;CTAT.ComponentRegistry.addComponentType("CTATComboBox",CTATComboBox);var CTATDoneButton=function(a,g,f,c,d){CTAT.Component.Base.Clickable.call(this,"done","CTATDoneButton",a,g,f,c,d);this.setName("done");this.setClassName("CTATDoneButton");this.setText(CTATGlobals.languageManager.getString("DONE"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);var b=this;this.init=function(){this.setInitialized(!0);var b=document.createElement("button");b.classList.add("unselectable");b.classList.add("CTAT-done-button");this.setComponent(b);var a=
document.createElement("div");a.classList.add("CTAT-done-button--content");b.appendChild(a);var c=document.createElement("div");c.textContent="\u2714";c.classList.add("CTAT-done-button--icon");a.appendChild(c);this.getText()&&(c=document.createElement("div"),c.classList.add("CTAT-done-button--text"),c.textContent=this.getText(),a.appendChild(c));this.getDivWrap().appendChild(b);b.addEventListener("mouseenter",function(b){b.target.classList.add("CTAT-done-button--hover")});b.addEventListener("mouseleave",
function(b){b.target.classList.remove("CTAT-done-button--hover");b.target.classList.remove("CTAT-done-button--clicked")});b.addEventListener("mousedown",function(b){b.target.classList.add("CTAT-done-button--clicked")});b.addEventListener("mouseup",function(b){b.target.classList.remove("CTAT-done-button--clicked")});b.addEventListener("click",function(b){b.target.classList.remove("CTAT-done-button--clicked")});b.addEventListener("click",this.processClick);b.addEventListener("focus",this.processFocus)};
this.processClick=function(a){b.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.processDone(b.getCompletionStatus())};this.getCompletionStatus=function(){return this.getDivWrap()?this.getDivWrap().getAttribute("data-ctat-completion-status"):""};this.setCompletionStatus=function(b){this.getDivWrap()&&this.getDivWrap().setAttribute("data-ctat-completion-status",String(b));return this}};CTATDoneButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATDoneButton.prototype.constructor=CTATDoneButton;CTAT.ComponentRegistry.addComponentType("CTATDoneButton",CTATDoneButton);var CTATDragNDrop=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragNDrop","aDnD");this.setParameterHandler("groupname",function(b){this.getDivWrap()&&$(this.getDivWrap()).attr("name",b)});this.set_child_limit=function(b){b=parseInt(b);isNaN(b)||$(this.component).attr("data-ctat-max-cardinality",b)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var b=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(b)?-1:b};var a=function(b){return b.split("").reduce(function(b,
a){b=(b<<5)-b+a.charCodeAt(0);return b&b},0)},g=function(b){var c=$(this).parent().attr("name"),e=$(this).parent().attr("id");b.dataTransfer.setData("ctat/group",c);b.dataTransfer.setData("ctat/source",e);b.dataTransfer.setData("text",this.id);var d=a(this.id);CTATDragNDrop.dragging[d]={id:this.id,group:c,source:e};b.dataTransfer.setData("ctat/id/"+d,d)},f=function(b){for(var a,c=0;c<b.dataTransfer.types.length;c++)if(a=/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))a=a[1],CTATDragNDrop.dragging.hasOwnProperty(a)&&
delete CTATDragNDrop.dragging[a]},c=null;this.init=function(){c=this.getDivWrap();if(!$(c).attr("name")){var b=CTATDragNDrop.default_groupname;this.getComponentGroup()&&(b=this.getComponentGroup());$(c).attr("name",b)}this.setComponent(c);CTATComponentReference.add(this,c);CTATConfiguration.get("previewMode")||$(c).children().addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",
g,!1);this.addEventListener("dragend",f,!1)});this.component.addEventListener("dragover",function(b){var a=!1;if($(this).data("CTATComponent").getEnabled()){var c=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(c)||0>c||$(this).children().length<c)&&(new Set(b.dataTransfer.types)).has("ctat/group"))if(b.dataTransfer.getData("text"))b.dataTransfer.getData("ctat/group")===$(this).attr("name")&&b.dataTransfer.getData("ctat/source")!==this.id&&(a=!0);else for(var e,c=0;c<b.dataTransfer.types.length;c++)if(e=
/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))e=e[1],CTATDragNDrop.dragging.hasOwnProperty(e)&&CTATDragNDrop.dragging[e].group===$(this).attr("name")&&CTATDragNDrop.dragging[e].source!==this.id&&(a=!0)}a&&(b.preventDefault(),b.dataTransfer.effectAllowed="move",b.dataTransfer.dropEffect="move",this.classList.add("CTATDragNDrop--valid-drop"))},!1);this.component.addEventListener("drop",function(b){b.preventDefault();this.classList.remove("CTATDragNDrop--valid-drop");var a=$(this).data("CTATComponent");
if(a.getEnabled()){var c=b.dataTransfer.getData("text");b.dataTransfer.getData("ctat/source");b=document.getElementById(c);this.appendChild(b);$("#"+c).removeClass("CTAT--correct CTAT--incorrect CTAT--hint");a.setActionInput("Add",c);a.processAction()}},!1);this.component.addEventListener("dragleave",function(b){this.classList.remove("CTATDragNDrop--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var b=[],a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});
if(0<a.length){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("SetChildren");c.setInput(a.sort().join(";"));b.push(c)}return b};var d=this.setEnabled;this.setEnabled=function(b){d(b);c&&($(c).children().attr("draggable",b),this.getDisableOnCorrect()&&$(c).find(".CTAT--correct").attr("draggable",!1))};this.Add=function(b){b=$("#"+b);0<b.length&&b.appendTo(this.getDivWrap());$(b).hasClass("CTATDragNDrop--item")||($(b).addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}),
b.addEventListener("dragstart",g,!1),b.addEventListener("dragend",f,!1))};this.SetChildren=function(b){b.split(";").forEach(function(b){this.Add(b)},this)};this.updateSAI=function(){var b=[];$(this.component).children().each(function(){b.push($(this).attr("id"))});this.setActionInput("SetChildren",b.sort().join(";"))};var b=this.showCorrect.bind(this);this.showCorrect=function(a){switch(a.getAction()){case "Add":this.setEnabled(!0);a=a.getInput();$("#"+a).addClass("CTAT--correct");this.getDisableOnCorrect()&&
$("#"+a).attr("draggable",!1);break;default:b(a)}};var e=this.showInCorrect.bind(this);this.showInCorrect=function(b){switch(b.getAction()){case "Add":b=b.getInput();$("#"+b).addClass("CTAT--incorrect");break;default:e(b)}}};CTATDragNDrop.dragging={};CTATDragNDrop.default_groupname="DragNDropGroup";CTATDragNDrop.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragNDrop.prototype.constructor=CTATDragNDrop;CTAT.ComponentRegistry.addComponentType("CTATDragNDrop",CTATDragNDrop);var CTATDragSource=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragSource","aDnD");this.setParameterHandler("groupname",function(b){this.getDivWrap()&&$(this.getDivWrap()).attr("name",b)});this.set_child_limit=function(b){b=parseInt(b);isNaN(b)||$(this.component).attr("data-ctat-max-cardinality",b)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var b=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(b)?-1:b};this.set_child_overflow=
function(b){b=parseInt(b);isNaN(b)||$(this.component).attr("data-ctat-max-overflow",b)};this.setParameterHandler("MaxOverflow",this.set_child_overflow);this.get_child_overflow=function(){var b=parseInt($(this.component).attr("data-ctat-max-overflow"));return isNaN(b)?-1:b};this.set_purpose=function(b){b?$(this.component).attr("data-ctat-purpose",b):$(this.component).attr("data-ctat-purpose","destination")};this.setParameterHandler("Purpose",this.set_purpose);this.get_purpose=function(){return $(this.component).attr("data-ctat-purpose")?
$(this.component).attr("data-ctat-purpose"):"destination"};var a=function(b){return b.split("").reduce(function(b,a){b=(b<<5)-b+a.charCodeAt(0);return b&b},0)},g=function(b){var c=$(this).parent().attr("name"),e=$(this).parent().attr("id");b.dataTransfer.setData("ctat/group",c);b.dataTransfer.setData("ctat/source",e);b.dataTransfer.setData("original",this.id);if("source"===$("#"+e).attr("data-ctat-purpose")){var d=this.id+"--"+CTATGlobalFunctions.gensym.div_id().slice(7);b.dataTransfer.setData("text",
d);var f=a(d);b.dataTransfer.setData("ctat/id/"+f,f);CTATDragSource.dragging[f]={id:d,group:c,source:e}}else b.dataTransfer.setData("text",this.id),f=a(this.id),b.dataTransfer.setData("ctat/id/"+f,f),CTATDragSource.dragging[f]={id:this.id,group:c,source:e}},f=function(b){for(var a,c=0;c<b.dataTransfer.types.length;c++)if(a=/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))a=a[1],CTATDragSource.dragging.hasOwnProperty(a)&&delete CTATDragSource.dragging[a]},c=this;c.setDisabled=function(b){try{if("button"!==
b.type&&(b.disabled=!0),0<b.children.length)for(var a=0;a<b.children.length;a++)c.setDisabled(b.children[a])}catch(n){}};c.removeDisabled=function(b){b.disabled=!1;if(0<b.children.length)for(var a=0;a<b.children.length;a++)c.removeDisabled(b.children[a])};c.animatedRemove=function(b){$("#"+b).animate({opacity:.1,zoom:1.3},500,"swing",function(){var a=document.getElementById(b);a.parentNode.removeChild(a)})};var d=null;this.init=function(){d=this.getDivWrap();if(!$(d).attr("name")){var b=CTATDragSource.default_groupname;
this.getComponentGroup()&&(b=this.getComponentGroup());$(d).attr("name",b)}this.setComponent(d);CTATComponentReference.add(this,d);CTATConfiguration.get("previewMode")||$(d).children().addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",g,!1);this.addEventListener("dragend",f,!1)});"source"===d.getAttribute("data-ctat-purpose")&&(window.onload=function(){c.setDisabled(d)});
this.component.addEventListener("dragover",function(b){var a=!1;if($(this).data("CTATComponent").getEnabled()){var c=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(c)||0>c||$(this).children().length<c)&&(new Set(b.dataTransfer.types)).has("ctat/group"))if(b.dataTransfer.getData("text"))b.dataTransfer.getData("ctat/group")===$(this).attr("name")&&b.dataTransfer.getData("ctat/source")!==this.id&&(a=!0);else for(var e,c=0;c<b.dataTransfer.types.length;c++)if(e=/^ctat\/id\/(.+)$/.exec(b.dataTransfer.types[c]))e=
e[1],CTATDragSource.dragging.hasOwnProperty(e)&&CTATDragSource.dragging[e].group===$(this).attr("name")&&CTATDragSource.dragging[e].source!==this.id&&(a=!0)}"source"===$(b.target).attr("data-ctat-purpose")&&(a=!1);a&&(b.preventDefault(),b.dataTransfer.effectAllowed="move",b.dataTransfer.dropEffect="move",this.classList.add("CTATDragSource--valid-drop"))},!1);this.component.addEventListener("drop",function(b){b.preventDefault();this.classList.remove("CTATDragSource--valid-drop");var a=$(this).data("CTATComponent");
if(a.getEnabled()){var e=b.dataTransfer.getData("text"),d;document.getElementById(e)&&(d=document.getElementById(e),this.appendChild(d));if(!document.getElementById(e)){b=document.getElementById(b.dataTransfer.getData("original"));d=b.cloneNode(!1);this.append(d);d.id=e;d.addEventListener("dragstart",g,!1);d.addEventListener("dragend",f,!1);var h,m=/(CTAT[A-z]*)(\s|$)/g.exec(d.className);if(m)for(var l=0;l<m.length;l++)CTAT.ComponentRegistry[m[l]]&&(h=m[l]);h&&CTATTutor.initializeHTMLComponent(d,
h);d.setAttribute("draggable",!0);d.setAttribute("unselectable","on");h=b.childNodes.length;m=d.childNodes.length;b.classList.remove("CTAT--correct");b.classList.remove("CTAT--incorrect");b.classList.remove("CTAT--hint");if(m===h)for(l=0;l<m;l++)d.childNodes[l].setAttribute("class",b.childNodes[l].className),d.childNodes[l].setAttribute("value",b.childNodes[l].value),d.childNodes[l].innerHTML=b.childNodes[l].innerHTML;if(h!==m){for(;d.hasChildNodes();)d.removeChild(d.lastChild);for(l=0;l<h;l++)d.appendChild(b.childNodes[l].cloneNode(!0))}}"trashcan"===
$(this).attr("data-ctat-purpose")&&this.removeChild(d);"source"===$(this).attr("data-ctat-purpose")&&this.removeChild(d);"destination"!==$(this).attr("data-ctat-purpose")&&$(this).attr("data-ctat-purpose")||($("#"+d.id).removeClass("CTAT--correct CTAT--incorrect CTAT--hint"),c.removeDisabled(d),a.setActionInput("Add",e),a.processAction(),null!==$(this).attr("data-ctat-max-overflow")&&this.childNodes.length>$(this).attr("data-ctat-max-overflow")&&c.animatedRemove(this.firstChild.id))}},!1);this.component.addEventListener("dragleave",
function(b){this.classList.remove("CTATDragSource--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var b=[],a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});if(0<a.length){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("SetChildren");c.setInput(a.sort().join(";"));b.push(c)}return b};var b=this.setEnabled;this.setEnabled=function(a){b(a);d&&($(d).children().attr("draggable",a),this.getDisableOnCorrect()&&$(d).find(".CTAT--correct").attr("draggable",
!1))};this.Add=function(b){b=$("#"+b);0<b.length&&b.appendTo(this.getDivWrap());$(b).hasClass("CTATDragSource--item")||($(b).addClass("CTATDragSource--item").attr({unselectable:"on",draggable:!0}),b.addEventListener("dragstart",g,!1),b.addEventListener("dragend",f,!1))};this.SetChildren=function(b){b.split(";").forEach(function(b){this.Add(b)},this)};this.updateSAI=function(){var b=[];$(this.component).children().each(function(){b.push($(this).attr("id"))});this.setActionInput("SetChildren",b.sort().join(";"))};
var e=this.showCorrect.bind(this);this.showCorrect=function(b){switch(b.getAction()){case "Add":this.setEnabled(!0);b=b.getInput();$("#"+b).addClass("CTAT--correct");this.getDisableOnCorrect()&&$("#"+b).attr("draggable",!1);break;default:e(b)}};var h=this.showInCorrect.bind(this);this.showInCorrect=function(b){switch(b.getAction()){case "Add":b=b.getInput();$("#"+b).addClass("CTAT--incorrect");break;default:h(b)}}};CTATDragSource.dragging={};CTATDragSource.default_groupname="DragNDropGroup";
CTATDragSource.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragSource.prototype.constructor=CTATDragSource;CTAT.ComponentRegistry.addComponentType("CTATDragSource",CTATDragSource);CTAT.Math={LeastCommonMultiple:function(a,g){return a*g/CTAT.Math.GreatestCommonDivisor(a,g)},GreatestCommonDivisor:function(a,g){if(0>a||0>g)return CTAT.Math.GreatestCommonDivisor(Math.abs(a),Math.abs(g));if(1===a||1===g)return 1;if(0===a)return g;if(0===g)return a;var f=function(a,d){return d?f(d,a%d):a};return f(a,g)},round10:function(a,g){if("undefined"===typeof g||0===Number(g))return Math.round(a);a=Number(a);g=Number(g);if(isNaN(a)||"number"!==typeof g||0!==g%1)return NaN;a=a.toString().split("e");
a=Math.round(Number(a[0])+"e"+(a[1]?Number(a[1])-g:-g));a=a.toString().split("e");return Number(a[0]+"e"+(a[1]?Number(a[1])+g:g))},precision:4,round:function(a){return CTAT.Math.round10(a,-CTAT.Math.precision)},rad2deg:function(a){return CTAT.Math.round(180*a/Math.PI)},deg2rad:function(a){return a*Math.PI/180}};CTAT.Math.Fraction=function(a,g){this._numerator=0;this._denominator=1;this.set(a,g)};
CTAT.Math.Fraction.prototype=Object.create(CTAT.Math.Fraction.prototype,{numerator:{get:function(){return this._numerator},set:function(a){this._numerator=a}},denominator:{get:function(){return this._denominator},set:function(a){this._denominator=a}},toString:{value:function(){return 1===this.denominator?String(this._numerator):String(this._numerator)+"/"+String(this._denominator)}},valueOf:{value:function(){return this.numerator/this.denominator}},fromString:{value:function(a){var g=a.match(/(\d*\.?\d*)\s*\/\s*(\d*\.?\d*)/);
g?(this._numerator=Number(g[1]),this._denominator=Number(g[2])):this.fromValue(a)}},fromValue:{value:function(a){this._numerator=Number(a.valueOf());this._denominator=1}},toMathML:{value:function(){var a=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),g=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");g.textContent=this.numerator;if(1==this.denominator)a.appendChild(g);else{var f=document.createElementNS("http://www.w3.org/1998/Math/MathML","mfrac"),c=document.createElementNS("http://www.w3.org/1998/Math/MathML",
"mrow");c.appendChild(g);f.appendChild(c);g=document.createElementNS("http://www.w3.org/1998/Math/MathML","mrow");c=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");c.textContent=this.denominator;g.appendChild(c);f.appendChild(g);a.appendChild(f)}return a}},is_proper:{get:function(){return Math.abs(this._numerator)<Math.abs(this._denominator)}},whole_part:{get:function(){return Math.floor(this.valueOf())}},remainder_part:{get:function(){return new CTAT.Math.Fraction(this._numerator%
this._denominator,this._denominator)}},set_denominator:{value:function(a){this._numerator=this.numerator*a/this.denominator;1E-9>Math.abs(this.numerator-Math.round(this.numerator))&&(this.numerator=Math.round(this.numerator));this._denominator=a;return this}},scale:{value:function(a){this._numerator*=a;this._denominator=0===a?1:Math.abs(this._denominator*a)}},set:{value:function(a,g){this._numerator=0;this._denominator=1;"undefined"!==typeof a&&g?(this.numerator="number"===typeof a?a:"string"===typeof a?
Number(a):a?a.valueOf():0,this.denominator="number"===typeof g?g:"string"===typeof g?Number(g):g.valueOf()):a&&(a instanceof CTAT.Math.Fraction?(this.numerator=a.numerator,this.denominator=a.denominator):"number"===typeof a?(this.numerator=a,this.denominator=1):"string"===typeof a?this.fromString(a):(this.numerator=a?a.valueOf():0,this.denominator=1));isNaN(this._numerator)&&(this._numerator=0);isNaN(this._denominator)&&(this._denominator=1);return this}},reduce:{value:function(){var a=CTAT.Math.GreatestCommonDivisor(this.numerator,
this.denominator);this._numerator/=a;this._denominator/=a;return this}},reduced:{value:function(){var a=new CTAT.Math.Fraction(this);a.reduce();return a}},reciprocal:{value:function(){return new CTAT.Math.Fraction(this.denominator,this.numerator)}},negative:{value:function(){return new CTAT.Math.Fraction(-this.numerator,this.denominator)}},add:{value:function(a){var g=new CTAT.Math.Fraction;a instanceof CTAT.Math.Fraction?0===this.numerator||isNaN(this.numerator)?g.set(a.numerator,a.denominator):
0===a.numerator||isNaN(a.numerator)?g.set(this.numerator,this.denominator):this.denominator==a.denominator?g.set(this.numerator+a.numerator,this.denominator):(g.set(this.numerator*a.denominator+a.numerator*this.denominator,this.denominator*a.denominator),g.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),g=this.add(a)):g.set(a.valueOf()*this.denominator+this.numerator,this.denominator);return g}},subtract:{value:function(a){return a instanceof CTAT.Math.Fraction?this.add(a.negative()):"string"===
typeof a?(a=new CTAT.Math.Fraction(a),this.add(a.negative())):this.add(-a.valueOf())}},multiply:{value:function(a){a instanceof CTAT.Math.Fraction?(a=new CTAT.Math.Fraction(this.numerator*a.numerator,this.denominator*a.denominator),a.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),a=this.multiply(a)):(a=new CTAT.Math.Fraction(a.valueOf()*this.numerator,this.denominator),a.reduce());return a}},divide:{value:function(a){return a instanceof CTAT.Math.Fraction?this.multiply(a.reciprocal()):
"string"===typeof a?(a=new CTAT.Math.Fraction(a),this.multiply(a.reciprocal())):this.multiply(new CTAT.Math.Fraction(1,a.valueOf()))}},equals:{value:function(a){return CTAT.Math.round(this.valueOf())===CTAT.Math.round(a.valueOf())}},deepEquals:{value:function(a){return a instanceof CTAT.Math.Fraction&&this.numerator===a.numerator&&this.denominator===a.denominator}},clone:{value:function(){return new CTAT.Math.Fraction(this.numerator,this.denominator)}}});
CTAT.Math.Fraction.FromString=function(a){var g=new CTAT.Math.Fraction;g.setFromString(String(a));return g};CTAT.Math.Fraction.FromNumber=function(a){a=new CTAT.Math.Fraction(a);a.reduce();return a};CTAT.Math.Fraction.Sum=function(){for(var a=new CTAT.Math.Fraction,g=0;g<arguments.length;g++)a=a.add(arguments[g]);return a};CTAT.Math.Fraction.Product=function(){for(var a=new CTAT.Math.Fraction(1,1),g=0;g<arguments.length;g++)a=a.multiply(arguments[g]);return a};CTAT.Component.Base.SVG=function(a,g,f,c,d,b,e){CTAT.Component.Base.Clickable.call(this,a,g,f,c,d,b,e);var h=null;this.initSVG=function(){this.setInitialized(!0);var b=CTATGlobals.NameSpace.svg,a=CTATGlobals.NameSpace.xml,c=CTATGlobals.NameSpace.xlink,e=CTATGlobals.NameSpace.ev,d=document.createDocumentFragment();h=document.createElementNS(b,"svg");d.appendChild(h);h.classList.add("CTAT-gen-component");h.classList.add("CTAT-svg");h.classList.add("unselectable");h.setAttributeNS(a,"xmlns",b);h.setAttributeNS(a,
"xmlns:xlink",c);h.setAttributeNS(a,"xmlns:ev",e);b=document.createElementNS(b,"defs");h.appendChild(b);this.getDivWrap().appendChild(d);this.setComponent(h)};this.genName=function(b){return this.getName()+"_"+b};this.getBoundingBox=function(){var b=new DOMRect(0,0,this.getWidth(),this.getHeight()),a=this.getComponent(),c=window.getComputedStyle(a),a=parseInt(c.getPropertyValue("padding-left")),e=parseInt(c.getPropertyValue("padding-right")),d=parseInt(c.getPropertyValue("padding-bottom")),f=parseInt(c.getPropertyValue("padding-right")),
g=parseInt(c.getPropertyValue("border-left-width")),h=parseInt(c.getPropertyValue("border-right-width")),B=parseInt(c.getPropertyValue("border-bottom-width")),c=parseInt(c.getPropertyValue("border-right-width"));b.width-=a+f+g+c;b.height-=e+d+h+B;return b}};CTAT.Component.Base.SVG.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTAT.Component.Base.SVG.prototype.constructor=CTAT.Component.Base.SVG;CTAT.Component.Base.UnitDisplay=function(a,g,f,c,d,b,e){CTAT.Component.Base.SVG.call(this,a,g,f,c,d,b,e);var h="1/2+1/4+(0*1/8)";this.setActionInput("SetPieces",h);var l="#800080";this.color=l;var m=1;this.colorAlpha=m;var n="#800080";this.deselectedColor=n;var p=.3;this.deselectedColorAlpha=p;var v="black";this.piece_border_color=v;this.piece_border_thickness=1;this.getPieceBorderColor=function(){return v};this.setPieceBorderColor=function(b){v=CTATGlobalFunctions.formatColor(b);return this};var r=
[],u=this;this.generateClassname=function(){return this.getName()+" UnitPart"};this.getPieces=function(){return r};var w=function(b){if(b.hasAttributeNS(null,"data-selected"))return CTATGlobalFunctions.toBoolean(b.getAttributeNS(null,"data-selected"));b.setAttributeNS(null,"data-selected",!0);return!0};this.getPiecesBySelected=function(b){for(var a=this.getPieces(),c=[],e,d=0;d<a.length;d++)e=a[d],w(e)===b&&c.push(e);return c};this.getSelectedPieces=this.getPiecesBySelected.bind(this,!0);this.getDeselectedPieces=
this.getPiecesBySelected.bind(this,!1);this.getColor=function(){return l};this.getColorAlpha=function(){return m};this.getDeselectedColor=function(){return n};this.getDeselectedColorAlpha=function(){return p};this.setColor=function(b){this.color=l=CTATGlobalFunctions.formatColor(b);b=this.getSelectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill",l)};this.setColorAlpha=function(b){m=Number(b);this.colorAlpha=m=isNaN(m)?1:m;b=this.getSelectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill-opacity",
m)};this.setDeselectedColor=function(b){this.deselectedColor=n=CTATGlobalFunctions.formatColor(b);b=this.getDeselectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill",l)};this.setDeselectedColorAlpha=function(b){p=Number(b);isNaN(p)&&(p=.3);this.deselectedColorAlpha=p;b=this.getDeselectedPieces();for(var a=0;a<b.length;a++)$(b[a]).css("fill-opacity",p)};this.valueOf=function(){return this.evaluate()};this.getValue=function(){return h};this.setValue=function(b){h=String(b);this.setInput(h);this.clear();
this.drawPieces();return h};this.setParameterHandler("Value",this.setValue);this.data_ctat_handlers.value=function(b){this.setValue(b)};this.drawPieces=function(){};this.evaluate=function(){return this.parseValue().reduce(function(b,a){return a.selected?b.add(a):b},new CTAT.Math.Fraction)};this.numActive=function(){return this.getSelectedPieces().length};this.parseValue=function(){var b=[];h.split("+").forEach(function(a){var c=!0;-1!=a.search(/(\(\s*0\s*\*)|(\*\s*0\s*\))/)&&(c=!1,a=a.replace(/(\(\s*0\s*\*)|(\*\s*0\s*\))/,
""),a=a.replace(/[() ]/g,""));a=new CTAT.Math.Fraction(a);a.selected=c;0<a&&b.push(a);return a});return b};this.updateValue=function(){return h=this.getPieces().map(function(b){return z(b.getAttributeNS(null,"data-value"),CTATGlobalFunctions.toBoolean(b.getAttributeNS(null,"data-selected")))}).join("+")};var B=function(b,a){var c=CTATGlobalFunctions.toBoolean(a);CTATGlobalFunctions.toBoolean(b.getAttributeNS(null,"data-selected"));!0===c?(b.setAttributeNS(null,"data-selected",!0),$(b).css("fill",
u.color),$(b).css("fill-opacity",u.colorAlpha)):($(b).css("fill",u.deselectedColor),$(b).css("fill-opacity",u.deselectedColorAlpha),b.setAttributeNS(null,"data-selected",!1))};this.clickHandler=function(b){!0===u.getEnabled()&&(b=CTATGlobalFunctions.toBoolean(this.getAttributeNS(null,"data-selected")),B(this,!b),u.setActionInput("SetPieces",u.updateValue()),u.processAction())};this.updateSAI=function(){u.setActionInput("SetPieces",u.updateValue())};this.addPieceElem=function(b,a,c){b.setAttributeNS(null,
"data-selected",c);b.setAttributeNS(null,"data-value",a.toString());b.dataValue=a;this.getEnabled()&&(b.style.cursor="pointer");b.addEventListener("click",this.clickHandler);r.push(b)};var y=this.setEnabled;this.setEnabled=function(b){y(b);r.forEach(function(a){a.style.cursor=b?"pointer":"default"})};this.clear=function(){r=[]};var z=function(b,a){var c=b.toString();!1===a&&(c="(0*"+c+")");return c};this.AddPiece=function(b,a){if(b){var c=new CTAT.Math.Fraction(b);if(0<CTAT.Math.round(c.valueOf())){var e=
h.split("+");e.push(z(c,a));u.setValue(e.join("+"))}}};this.AddToValue=function(b,a){if(b){var c=new CTAT.Math.Fraction(b);if(0<CTAT.Math.round(c.valueOf())){var e=h.split("+");e.push(z(c,a));h=e.join("+")}}return h};var q=-1,F=function(b){isNaN(b)&&this.get_denominator();b=Math.max(b,1);1<q&&(b=Math.min(b,q));return b}.bind(this);this.set_max_denominator=function(b){b=parseInt(b);isNaN(b)||(q=b)};this.set_denominator=function(b){u.setHintHighlight(!1);var a="string"===typeof b?parseInt(b):b;if(!isNaN(a)&&
(a=F(a),this.get_denominator()!=b)){var c=u.evaluate();u.clear();b=[];c.set_denominator(a);for(var e=new CTAT.Math.Fraction(1,a),d=Math.floor(c.numerator),f=a-d,g=0;g<d;g++)b.push(z(e,!0));a=new CTAT.Math.Fraction(c.numerator-d,a);a.equals(0)||(b.push(z(a,!0)),b.push(z(e.subtract(a),!1)),f--);for(a=0;a<f;a++)b.push(z(e,!1));this.setValue(b.join("+"));u.setActionInput("SetPieces",h);u.processAction();return h}};this.get_denominator=function(){return r.reduce(function(b,a,c,e){return Math.min(b,a.dataValue.denominator)},
Infinity)};this.change_denominator=function(b){return this.set_denominator(this.get_denominator()+Number(b))};this.set_number_pieces=function(b){u.setHintHighlight(!1);b="string"===typeof b?parseInt(b):b;if(!isNaN(b)){b=F(b);var a=u.numActive();u.clear();for(var c=[],e=new CTAT.Math.Fraction(1,b),d=0;d<b;d++)c.push(z(e,0<a)),a--;this.setValue(c.join("+"));u.setActionInput("SetPieces",h);u.processAction();return h}};this.change_number_pieces=function(b){this.set_number_pieces(r.length+b)};this.set_numerator=
function(b){return this.change_numerator(b-this.getSelectedPieces().length)};this.change_numerator=function(b){0!==b&&(0<b?r.every(function(a){!1===w(a)&&(B(a,!0),b--);return 0<b}):(r.reverse(),r.every(function(a){!0===w(a)&&(B(a,!1),b++);return 0>b}),r.reverse()))};this.SetPieces=function(b){u.setValue(b)};f=function(b){return(b=$(this.getDivWrap()).attr(b))?b.split(/\s*;\s*/).map(function(b){return b.trim()}):[]};a=f.bind(this,"data-ctat-ctrl-denominator");g=f.bind(this,"data-ctat-ctrl-partition");
f=f.bind(this,"data-ctat-ctrl-numerator");c=function(b,a){return 0<=b().indexOf(a)};var C=c.bind(null,a),A=c.bind(null,g),E=c.bind(null,f),I=function(b){var a=null;if(b instanceof CTAT.Component.Base.Tutorable)b!=this&&(a=b.getName());else if(b instanceof CTATSAI)b.getSelection()!=u.getName()&&(a=b.getSelection());else if(b instanceof String)b!=u.getName()&&(a=b);else if(b instanceof Element)b!=u.getComponent()&&(a=b.id);else return null;if(a){if(C(a))return G.bind(this,this.change_denominator,this.set_denominator);
if(E(a))return G.bind(this,this.change_numerator,this.set_numerator);if(A(a))return G.bind(this,this.change_number_pieces,this.set_number_pieces)}return null}.bind(this);a=CTAT.Component.Base.Tutorable.EventType;CTATConfiguration.get("previewMode")||document.addEventListener(a.action,function(b){var a=b.detail.sai;b=I(b.detail.component);a&&null!==b&&b(a)},!1);var G=function(b,a,c){var e=parseInt(c.getInput());if(!isNaN(e)){switch(c.getAction()){case "ButtonPressed":b.call(this,e);break;case "Update":case "UpdateTextField":case "UpdateTextArea":a.call(this,
e)}this.updateSAI();this.processAction()}};this.setNumeratorControllers=function(b){this.getDivWrap().setAttribute("data-ctat-ctrl-numerator",b);return this};this.setParameterHandler("NumeratorControllers",this.setNumeratorControllers);this.setDenominatorControllers=function(b){this.getDivWrap().setAttribute("data-ctat-ctrl-denominator",b);return this};this.setParameterHandler("DenominatorControllers",this.setDenominatorControllers);this.setPartitionControllers=function(b){this.getDivWrap().setAttribute("data-ctat-ctrl-partition",
b);return this};this.setParameterHandler("PartitionControllers",this.setPartitionControllers);this.getConfigurationActions=function(){var b=this.getDivWrap().getAttribute("data-ctat-value");if(b){var a=new CTATSAI;a.setSelection(this.getName());a.setAction("SetPieces");a.setInput(b);return[a]}this.updateSAI();return[this.getSAI()]}};CTAT.Component.Base.UnitDisplay.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTAT.Component.Base.UnitDisplay.prototype.constructor=CTAT.Component.Base.UnitDisplay;var CTATFractionBar=function(a,g,f,c,d){CTAT.Component.Base.UnitDisplay.call(this,"CTATFractionBar","aFractionBar",a,g,f,c,d);var b=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(b,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATFractionBar--container");this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};
this.drawPieces=function(){if(this.baseGroup){this.clear();for(var a=this.parseValue(),c=0,d=document.createDocumentFragment(),f=0;f<a.length;f++){var g=a[f],p=100*g,v=document.createElementNS(b,"rect");v.classList.add("CTATFractionBar--piece");v.setAttributeNS(null,"height","100%");v.setAttributeNS(null,"width",p+"%");v.setAttributeNS(null,"y",0);v.setAttributeNS(null,"x",c+"%");this.addPieceElem(v,g,g.selected);d.appendChild(v);var r=document.createElementNS(b,"text");r.classList.add("CTATFractionBar--label");
r.setAttributeNS(null,"text-anchor","middle");r.setAttributeNS(null,"dominant-baseline","middle");d.appendChild(r);var v=""+String(g.numerator),g=""+String(g.denominator),u=document.createElementNS(b,"tspan"),w=document.createElementNS(b,"tspan");u.appendChild(document.createTextNode(v));w.appendChild(document.createTextNode(g));r.appendChild(u);r.appendChild(w);r=c+p/2;u.setAttributeNS(null,"x",r+"%");u.setAttributeNS(null,"y","60%");u.setAttributeNS(null,"dy","-1em");w.setAttributeNS(null,"x",r+
"%");w.setAttributeNS(null,"y","60%");v.length>g.length?u.style.textDecoration="underline":w.style.textDecoration="overline";c+=p}this.baseGroup.innerHTML="";this.baseGroup.appendChild(d);var B=this.baseGroup.getBBox().width-1;Array.prototype.slice.call(this.baseGroup.childNodes).forEach(function(b){if("rect"==b.nodeName){var a=window.getComputedStyle(b),c=parseFloat(a.getPropertyValue("padding-left")),e=parseFloat(a.getPropertyValue("stroke-width")),a=b.getBBox();b.setAttributeNS(null,"y",a.y+e/
2);b.setAttributeNS(null,"height",a.height-e);var d=a.x+e/2,e=a.width-e;1>a.x?e-=c/2:(d+=c/2,e=a.x+a.width>=B?e-c/2:e-c);b.setAttributeNS(null,"x",d);b.setAttributeNS(null,"width",e)}})}};this.setShowFractionLabel=function(b){};this.setStyleHandler("showFractionLabel",this.setShowFractionLabel)};CTATFractionBar.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);CTATFractionBar.prototype.constructor=CTATFractionBar;CTAT.ComponentRegistry.addComponentType("CTATFractionBar",CTATFractionBar);var CTATGroupingComponent=function(a,g,f,c,d){CTAT.Component.Base.SAIHandler.call(this,"CTATGroupingComponent","__undefined__",a,g,f,c,d);var b=this,e=b.executeSAI;this.isTabIndexable=!1;this.getComponentList=function(){var a=[],c=b.getDivWrap().getAttribute("data-ctat-componentlist");c&&(a=c.split(/\s*[,;]\s*/).map(function(b){return $("#"+b.trim()).data("CTATComponent")}));$(b.getDivWrap()).children(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return[].concat($jscomp.arrayFromIterable(new Set(a)))};
this.init=function(){b.setInitialized(!0)};this.executeSAI=function(a){b.getComponentList().forEach(function(c){c&&"function"==typeof c.executeSAI?c.executeSAI(a):b.ctatdebug("CTATGroupingComponent "+b.getName()+".executeSAI: comp doesn't implement executeSAI: "+c)});e.call(b,a)}};CTATGroupingComponent.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);CTATGroupingComponent.prototype.constructor=CTATGroupingComponent;CTAT.ComponentRegistry.addComponentType("CTATGroupingComponent",CTATGroupingComponent);var CTATHintButton=function(a,g,f,c,d){CTAT.Component.Base.Clickable.call(this,"hint","CTATHintButton",a,g,f,c,d);this.setName("hint");this.setClassName("CTATHintButton");this.isTabIndexable=!1;this.setText(CTATGlobals.languageManager.getString("HINT"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("FontFace",null);this.setStyleHandler("TextColor",null);this.init=function(){this.setInitialized(!0);
var b=document.createElement("button");this.setComponent(b);b.classList.add("unselectable");b.classList.add("CTAT-hint-button");var a=document.createElement("div");a.classList.add("CTAT-hint-button--icon");a.textContent="?";b.appendChild(a);this.getText()&&(a=document.createElement("div"),a.textContent=this.getText(),b.appendChild(a));this.getDivWrap().appendChild(b);b.addEventListener("mouseenter",function(b){b.target.classList.add("CTAT-hint-button--hover")});b.addEventListener("mouseleave",function(b){b.target.classList.remove("CTAT-hint-button--hover");
b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("mousedown",function(b){b.target.classList.add("CTAT-hint-button--clicked")});b.addEventListener("mouseup",function(b){b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("click",function(b){b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("click",this.processClick)};var b=this;this.processClick=function(a){b.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.requestHint()}};
CTATHintButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATHintButton.prototype.constructor=CTATHintButton;CTAT.ComponentRegistry.addComponentType("CTATHintButton",CTATHintButton);var CTATHintWindow=function(a,g,f,c,d){CTAT.Component.Base.Graphical.call(this,"CTATHintWindow","__undefined__",a,g,f,c,d);var b=this;b.isTabIndexable=!1;var e=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON,h=new CTATTutorMessageBuilder,l=null,m=null,n=null,p=null,v=CTATGlobals.languageManager.getString("NEXT"),r=CTATGlobals.languageManager.getString("PREVIOUS"),u=null;this.data_ctat_handlers["next-content"]=function(b){u=b;n&&(n.innerHTML=b)};var w=null;this.data_ctat_handlers["previous-content"]=
function(b){w=b;m&&(m.innerHTML=b)};this.getCurrentHint=function(){return l.innerHTML};this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setInitialized(!0);b.setIsAbstractComponent(!0);p=this.getDivWrap();p.id||p.setAttribute("id",CTATGlobalFunctions.gensym.div_id());p.setAttribute("onkeypress","return noenter(event)");b.setComponent(p);b.addComponentReference(b,p);l=document.createElement("div");p.appendChild(l);l.classList.add("CTATHintWindow--hint-content");var a=document.createElement("div");
a.classList.add("CTATHintWindow--hint-button-area");p.appendChild(a);if(w)m=document.createElement("button"),m.classList.add("CTATHintWindow--previous"),m.innerHTML=w;else{m=document.createElement("button");m.classList.add("CTATHintWindow--previous");var c=document.createElement("span");c.classList.add("CTATHintWindow--button-icon");c.textContent="\u25c0";m.appendChild(c);r&&(c.style.cssFloat="left",m.appendChild(document.createTextNode(r)))}m.addEventListener("click",function(b){CTATShellTools.showPrevHint()},
!1);a.appendChild(m);u?(n=document.createElement("button"),n.classList.add("CTATHintWindow--next"),n.innerHTML=u):(n=document.createElement("button"),n.classList.add("CTATHintWindow--next"),c=document.createElement("span"),c.classList.add("CTATHintWindow--button-icon"),c.textContent="\u25b6",v&&(c.style.cssFloat="right",n.appendChild(document.createTextNode(v))),n.appendChild(c));n.addEventListener("click",function(b){CTATShellTools.showNextHint()},!1);a.appendChild(n);var e=function(b){this.disabled=
!b;b||(this.classList.remove("CTAT-hint-button--hover"),this.classList.remove("CTAT-hint-button--clicked"))};[m,n].forEach(function(b){b.setEnabled=e.bind(b);b.classList.add("CTATHintWindow--button");b.classList.add("CTAT-hint-button");b.addEventListener("mouseenter",function(b){b.target.classList.add("CTAT-hint-button--hover")});b.addEventListener("mouseleave",function(b){b.target.classList.remove("CTAT-hint-button--hover");b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("mousedown",
function(b){b.target.classList.add("CTAT-hint-button--clicked")});b.addEventListener("mouseup",function(b){b.target.classList.remove("CTAT-hint-button--clicked")});b.addEventListener("click",function(b){b.target.classList.remove("CTAT-hint-button--clicked")})});CTATShellTools.registerFeedbackComponent(this,this.goNext,this.goPrevious,this.showHint,this.showFeedback);b.ctatdebug("Disabling previous and next ...");m.setEnabled(!1);n.setEnabled(!1)};this.setStyleHandler("OuterBorderColor",this.setBorderColor);
this.SetText=this.showFeedback=function(a){b.ctatdebug("showFeedback ("+a+")");l&&(l.innerHTML=CTATGlobals.languageManager.filterString(a));m.setEnabled(!1);n.setEnabled(!1)};this.showHint=function(a){b.ctatdebug("showHint ()");hints=a;hintIndex=0;m.setEnabled(!1);n.setEnabled(!1);if(!hints||0>=hints.length)hints=[],l.innerHTML="";else{for(this.setEnabled(!0);hintIndex<hints.length&&""===hints[hintIndex];)++hintIndex;hintIndex>=hints.length?b.ctatdebug("All hints in list empty, bump"):(0<hintIndex&&
(b.ctatdebug("First "+hintIndex+" hints in list empty, excising"),hints.splice(0,hintIndex),hintIndex=0),l.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]),hintIndex+1<hints.length?(b.ctatdebug("We have more than one hint, enabling next button"),n.setEnabled(!0)):b.ctatdebug("We only have one hint, leaving next button disabled"))}};this.setEnabled=function(a){b.assignEnabled(a);null===b.getComponent()?b.ctatdebug("Error pointer.getComponent()==null"):b.getComponent().disabled=
!a};this.goPrevious=function(){b.ctatdebug("goPrevious ()");hintIndex--;n.setEnabled(!0);0>=hintIndex?(hintIndex=0,m.setEnabled(!1)):m.setEnabled(!0);l.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);var a=new CTATTutoringServiceMessageBuilder,c=CTATGuid.guid(),d=new CTATSAI("previousButton","ButtonPressed","-1"),a=a.createInterfaceActionMessage(c,d),d=new CTATSAI("previousButton","ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(c,d,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",
a);d=b.getCurrentHint();c=h.createAssociatedRulesMessageForHint([d],logHintSAI,"student",null,"",c,hints.length,hintIndex+1);c=new CTATMessage(e.parse(c));CTATCommShell.commShell.processAssociatedRules(c,"HintWindow",d);CTATCommShell.commShell.propagateShellEvent("PreviousPressed",c)};this.goNext=function(){b.ctatdebug("goNext ()");hintIndex++;m.setEnabled(!0);hintIndex>hints.length-1&&(hintIndex=hints.length-1);hintIndex>hints.length-2?n.setEnabled(!1):n.setEnabled(!0);l.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);
var a=new CTATTutoringServiceMessageBuilder,c=CTATGuid.guid(),d=new CTATSAI("nextButton","ButtonPressed","-1"),a=a.createInterfaceActionMessage(c,d),d=new CTATSAI("nextButton","ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(c,d,"HINT_REQUEST","");CTATCommShell.commShell.propagateShellEvent("InterfaceAction",a);d=b.getCurrentHint();c=h.createAssociatedRulesMessageForHint([d],logHintSAI,"student",null,"",c,hints.length,hintIndex+1);c=new CTATMessage(e.parse(c));CTATCommShell.commShell.processAssociatedRules(c,
"HintWindow",d);CTATCommShell.commShell.propagateShellEvent("NextPressed",c)}};CTATHintWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATHintWindow.prototype.constructor=CTATHintWindow;CTAT.ComponentRegistry.addComponentType("CTATHintWindow",CTATHintWindow);var CTATIFrameManager=function(){var a={},g=this;this.initFrame=function(f,c,d){var b=f?f.getAttribute("id"):null;b?a[b]={domNode:f,initialDom:c,initialMode:d}:console.error("iFrames managed by CTATIFrameManager must exist and have unique ids");f.setAttribute("data-ctat-target",d);this.writeData(f,c)};this.refresh=function(f){var c=a[f];c.domNode?(c.domNode.setAttribute("src","about:blank"),this.writeData(c.domNode,c.initialDom)):console.warn("CTATIFrameManager: iFrame id "+f+" not found")};this.writeData=
function(a,c){if(a){var d=a.contentDocument||a.contentWindow.document;d.open();d.write(c);d.close()}};document.addEventListener("refreshIframe",function(a){a=a.detail;console.log("refresh event for iframe "+a);g.refresh(a)})};var CTATImageButton=function(a,g,f,c,d){CTATButtonBasedComponent.call(this,"CTATImageButton","__undefined__",a,g,f,c,d);var b=this;this.init=function(){b.setInitialized(!0);b.setComponent(b.getDivWrap());b.addComponentReference(b,b.getDivWrap());b.setImage(b.getDivWrap().getAttribute("data-ctat-image-default"));var a=b.component;a.setAttribute("role","button");a.classList.add("CTAT-button");a.addEventListener("click",b.processClick);a.addEventListener("focus",b.processFocus);a.addEventListener("mousedown",
b.processBaseMousedown);a.addEventListener("mouseup",b.processBaseMouseup);a.addEventListener("mouseover",b.processBaseMouseover);a.addEventListener("mouseout",b.processBaseMouseout)};var e=this.setEnabled;this.setEnabled=function(a){e(a);b.getEnabled()?b.setImage(b.getDivWrap().getAttribute("data-ctat-image-default")):b.setImage(b.getDivWrap().getAttribute("data-ctat-image-disabled"))};this.getConfigurationActions=function(){var b=this.getDivWrap(),a=b.getAttribute("data-ctat-image-hover"),c=b.getAttribute("data-ctat-image-clicked"),
e=b.getAttribute("data-ctat-image-default"),b=b.getAttribute("data-ctat-image-disabled");if(e){var d=new CTATSAI;d.setSelection(this.getName());a||c||b?(d.setAction("assignImages"),d.setInputArray([a,c,e,b])):(d.setAction("assignImage"),d.setInput(e));return[d]}return[]}};CTATImageButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATImageButton.prototype.constructor=CTATImageButton;CTAT.ComponentRegistry.addComponentType("CTATImageButton",CTATImageButton);var CTATJumble=function(a,g,f,c,d){CTAT.Component.Base.Tutorable.call(this,"CTATJumble","aJumble",a,g,f,c,d);var b=this;this.setActionInput("SetOrder","");var e=null;this.init=function(){this.setInitialized(!0);e=this.getDivWrap();this.setComponent(e);this.addComponentReference(this,e);CTATConfiguration.get("previewMode")||$(e).children().addClass("CTATJumble--item").attr({unselectable:"on",draggable:!0}).each(function(){this.addEventListener("dragstart",l,!1);this.addEventListener("dragenter",n,
!1);this.addEventListener("dragover",m,!1);this.addEventListener("dragleave",p,!1);this.addEventListener("drop",v,!1);this.addEventListener("dragend",r,!1)});this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){this.updateSAI();return[this.getSAI()]};var h=null,l=function(b){/CTATJumble/.test(b.target.className)&&(b.target.classList.add("CTATJumble--item--home"),h=b.target,b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/html",b.target.innerHTML))},
m=function(b){b.preventDefault&&b.preventDefault();b.dataTransfer.dropEffect="move";return!1},n=function(b){this.classList.add("CTATJumble--item--over")},p=function(b){this.classList.remove("CTATJumble--item--over")},v=function(a){a.stopPropagation&&a.stopPropagation();if(h&&($(e).children().removeClass("CTATJumble--item--over"),h!=this)){h.innerHTML=this.innerHTML;var c=h.id;h.id=this.id;this.innerHTML=a.dataTransfer.getData("text/html");this.id=c;b.setInput(b.getOrder());b.processAction()}return!1},
r=function(b){this.classList.remove("CTATJumble--item--home");$(e).children().removeClass("CTATJumble--item--over");h=null},u=this.setEnabled;this.setEnabled=function(b){u(b);e&&$(e).children().attr("draggable",b)};this.init_items=function(b){if(e){var a=document.createDocumentFragment();b=b.split(";");for(var c=b.length,d=0;d<c;d++){var f=document.createElement("div");f.textContent=b[d];f.id=this.getName()+d;f.setAttribute("unselectable","on");f.setAttribute("draggable",!0);f.classList.add("CTATJumble--item");
f.addEventListener("dragstart",l,!1);f.addEventListener("dragenter",n,!1);f.addEventListener("dragover",m,!1);f.addEventListener("dragleave",p,!1);f.addEventListener("drop",v,!1);f.addEventListener("dragend",r,!1);a.appendChild(f)}e.innerHTML="";e.appendChild(a)}};this.setParameterHandler("textItems",this.init_items);this.SetOrder=function(b){b.split(";").forEach(function(b){$(e).append($("#"+b))})};this.getOrder=function(){var a=[];$(e).children().each(function(){this.draggable&&(this.id?a.push(this.id):
console.log("ERROR: The CTATJumble "+b.getName()+" has a child with no id attribute: "+this+"!!!"))});return a.join(";")};this.updateSAI=function(){b.setInput(b.getOrder())}};CTATJumble.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATJumble.prototype.constructor=CTATJumble;CTAT.ComponentRegistry.addComponentType("CTATJumble",CTATJumble);var CTATMathInput=function(){CTAT.Component.Base.Tutorable.call(this,"CTATMathInput","myComponent");CTATMathInput.guppyInitialized||(Guppy.init({path:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/",symbols:"https://cdn.ctat.cs.cmu.edu/releases/latest/guppy/symbols.json"}),CTATMathInput.guppyInitialized=!0);var a=this,g=null,f=CTATConfiguration.get("previewMode"),c,d,b,e=!1;this.init=function(){this.ctatdebug("init ("+a.getName()+")");c=a.getDivWrap();a.setComponent(c);a.setInitialized(!0);a.addComponentReference(a,
c);d=document.createElement("div");d.id=c.id+"_math";c.appendChild(d);g=new Guppy(d.id);b=document.createElement("div");b.id=a.getDivWrap().id+"_new";c.appendChild(b);this.ctatdebug("Final location: "+a.getX()+","+a.getY()+" with text: "+a.getValue());c.addEventListener("keydown",function(b){b=b.key;"Enter"===b&&(a.setActionInput("UpdateTextField",a.getValue()),a.processAction(),g.import_text(a.GuppyStyleInput(a.getValue())));"Tab"===b&&(a.setActionInput("UpdateTextField",a.getValue()),a.processAction(),
g.import_text(a.GuppyStyleInput(a.getValue())))});d.addEventListener("blur",function(b){e||(a.setActionInput("UpdateTextField",a.getValue()),a.processAction(),g.import_text(a.GuppyStyleInput(a.getValue())))});a.observer.observe(a.getDivWrap(),{attributeOldValue:!0});f&&this.addEventScreen(!1)};this.GuppyStyleInput=function(b){if(b.includes("/")){for(var c=b.indexOf("/"),e=c;0<e;e--)if("+"===b[e]||"-"===b[e])return b.slice(0,e+1)+"("+b.slice(e+1,c)+")/"+a.GuppyStyleInput(b.slice(c+1,b.length));return"("+
b.slice(0,c)+")/"+a.GuppyStyleInput(b.slice(c+1,b.length))}return b};this.getValue=function(){try{return g.asciimath()}catch(h){return""}};this.updateSAI=function(){this.setActionInput("UpdateTextField",a.getValue())};this.setMath=function(b){a.ctatdebug("setMath ("+b+")");g.import_text(b)};this.getConfigurationActions=function(){var b=[],a=$(this.getDivWrap());if(a.attr("value")){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("UpdateTextField");c.setInput(a.attr("value"));b.push(c)}return b};
this.UpdateTextField=function(b){this.setMath(b)};this.reset=function(){a.configFromDescription();a.processSerialization();g.import_text("")};this.observer=new MutationObserver(function(c,f){c.forEach(function(c){null!==c.target.getAttribute("data-ctat-highlight")&&"false"===c.target.getAttribute("data-ctat-highlight")?"attributes"===c.type&&"data-ctat-enabled"===c.attributeName&&"false"===c.target.getAttribute("data-ctat-enabled")&&(Guppy.Doc.render(g.xml(),b.id),e=!0,a.getDivWrap().removeChild(d),
f.disconnect()):("attributes"===c.type&&"data-ctat-enabled"===c.attributeName&&"false"===c.target.getAttribute("data-ctat-enabled")&&(Guppy.Doc.render(g.xml(),b.id),e=!0,b.style.color="limegreen",a.getDivWrap().removeChild(d),f.disconnect()),"attributes"===c.type&&"class"===c.attributeName&&(c.target.classList.contains("CTAT--hint")&&(d.style.color="initial"),c.target.classList.contains("CTAT--incorrect")&&(d.style.color="red")))})})};CTATMathInput.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATMathInput.prototype.constructor=CTATMathInput;CTAT.ComponentRegistry.addComponentType("CTATMathInput",CTATMathInput);var CTATMobileTutorHandler=function(a,g){CTATBase.call(this,"CTATMobileTutorHandler","mobiletutorhandler");this.ctatdebug("CTATMobileTutorHandler ()");var f="",c=g?g:"disabled",d=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(d=!0);this.error=function(b){this.ctatdebug(b);alert(b)};this.processOrientationChange=function(b){this.ctatdebug("processOrientationChange ("+b+")")};this.getEnabled=function(){return"disabled"==c||"auto"==c&&0==d?!1:!0};this.processTextFocus=
function(b,a,g,l,m){this.ctatdebug("processTextFocus ("+b+","+a+","+g+","+l+","+m+")");"disabled"==c||"auto"==c&&0==d||(f="",this.manipulateKeyboard())};this.processEnter=function(){this.ctatdebug("processEnter ()");if("disabled"!=c&&("auto"!=c||0!=d)){var b=getSafeElementById(a);if(null!=b)try{b.processExternalEnter(),this.ctatdebug("Successfully called AS3 method")}catch(e){this.ctatdebug("Error description: "+e.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")}};this.setText=
function(b){this.ctatdebug("setText ("+b+")");if("disabled"!=c&&("auto"!=c||0!=d))if(null!=CTATGlobals.selectedTextInput){this.ctatdebug("Attempting to call HTML5 method on text object ...");var e=CTATGlobals.selectedTextInput.getText();CTATGlobals.selectedTextInput.setText(e+b)}else if(this.ctatdebug("Attempting to call AS3 method ..."),e=getSafeElementById(a),null!=e)try{f+=b,this.ctatdebug(f),e.processExternalKeyboard(f),this.ctatdebug("Successfully called AS3 method")}catch(h){this.ctatdebug("Error description: "+
h.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")};this.manipulateKeyboard=function(){this.ctatdebug("manipulateKeyboard()");if("disabled"!=c&&("auto"!=c||0!=d)){this.hideKeyboard();var b=getSafeElementById("keyboardUI");b&&(b.style.visibility="visible")}};this.hideKeyboard=function(){document.activeElement.blur();var b=getSafeElementById("input");b&&b.blur()};this.hideCustomKeyboard=function(){getSafeElementById("keyboardUI").style.visibility="visible"}};
CTATMobileTutorHandler.prototype=Object.create(CTATBase.prototype);CTATMobileTutorHandler.prototype.constructor=CTATMobileTutorHandler;function processTextFocus(a,g,f,c,d){mobileAPI.processTextFocus(a,g,f,c,d)}function processFocusOut(){closeK()};var CTATMovieClip=function(a,g,f,c,d){CTATBase.call(this,"CTATMovieClip",a);var b=CTATGlobalFunctions.gensym.z_index(),e=CTATGlobalFunctions.gensym.div_id(),h=CTATGlobalFunctions.gensym.z_index();CTATGlobalFunctions.gensym.div_id();var l=[],m=this,n=null;this.wrapComponent=function(a){n=document.createElement("div");n.setAttribute("id",e);n.setAttribute("name",this.getName());n.setAttribute("style","z-index: "+b);n.setAttribute("width",c+"px");n.setAttribute("height",d+"px");n.setAttribute("style",
"border: 0px; position: absolute; left:"+g+"px; top:"+f+"px; z-index:"+h+";");a.appendChild(n);return n};this.getDivWrapper=function(){return n};this.addComponent=function(b){m.ctatdebug("addComponent ("+b+")");l.push(b)};this.isRegistered=function(b){for(var a=0;a<l.length;a++)if(l[a]==b)return!0;return!1}};CTATMovieClip.prototype=Object.create(CTATBase.prototype);CTATMovieClip.prototype.constructor=CTATMovieClip;CTAT.Geom={};CTAT.Geom.Point={};try{new DOMPoint}catch(a){if(console.log("WARNING: new DOMPoint():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("   Using shim!");var DOMPoint=function(g,f,c,d){this.z=this.y=this.x=0;this.w=1;if(g instanceof DOMPoint)for(var b in g)this[b]=g[b];else this.x=g||0,this.y=f||0,this.z=c||0,this.w=d||1}}}CTAT.Geom.Point.useDOMMatrix=!0;try{new DOMMatrix}catch(a){a instanceof ReferenceError&&(CTAT.Geom.Point.useDOMMatrix=!1)}
CTAT.Geom.Point.add=function(){if(CTAT.Geom.Point.useDOMMatrix){for(var a=new DOMMatrix,g,f=0;f<arguments.length;f++)g=arguments[f],a.translateSelf(g.x/g.w,g.y/g.w,g.z/g.w);return a.transformPoint(new DOMPoint)}return Array.prototype.reduce.call(arguments,function(a,d){for(var b in a)"w"!=b&&0!==d[b]&&(a[b]+=d[b]/d.w);return a},new DOMPoint)};
DOMPoint.prototype.add||Object.defineProperty(DOMPoint.prototype,"add",{enumerable:!1,value:function(a){return CTAT.Geom.Point.useDOMMatrix?(new DOMMatrix).translate(a.x/a.w,a.y/a.w,a.z/a.w).transformPoint(this):CTAT.Geom.Point.add(this,a)}});CTAT.Geom.Point.angle=function(a,g){return Math.acos(DOMPoint.dot(a,g)/(a.magnitude*g.magnitude))};CTAT.Geom.Point.angle_degrees=function(a,g){return CTAT.Math.rad2deg(CTAT.Geom.Point.angle(a,g))};
CTAT.Geom.Point.angle_between_2d=function(a,g){return CTAT.Math.rad2deg(Math.atan2(g.y,g.x)-Math.atan2(a.y,a.x))};DOMPoint.prototype.clone||Object.defineProperty(DOMPoint.prototype,"clone",{value:function(){return new DOMPoint(this.x,this.y,this.z,this.w)}});CTAT.Geom.Point.distance=function(a,g){var f=CTAT.Geom.Point.add(a,CTAT.Geom.Point.scale(g,-1));return Math.sqrt(CTAT.Geom.Point.dot(f,f))};
DOMPoint.prototype.distance||Object.defineProperty(DOMPoint.prototype,"distance",{value:function(a){return CTAT.Geom.Point.distance(this,a)}});CTAT.Geom.Point.dot=function(a,g){return(a.x*g.x+a.y*g.y+a.z*g.z)/(a.w*g.w)};CTAT.Geom.Point.equals=function(a,g){var f=!0,c;for(c in a)if(c in g?"w"!=c&&(f&=a[c]/a.w==g[c]/g.w):f=!1,!f)break;return f};CTAT.Geom.Point.interpolate=function(a,g,f){return CTAT.Geom.Point.add(a.scale(f),g.scale(1-f))};
"magnitude"in DOMPoint.prototype||Object.defineProperty(DOMPoint.prototype,"magnitude",{enumerable:!1,get:function(){return CTAT.Math.round(Math.sqrt(CTAT.Geom.Point.dot(this,this)))}});DOMPoint.prototype.normalize||Object.defineProperty(DOMPoint.prototype,"normalize",{value:function(a){return this.scale((a?a:1)/this.magnitude)}});
CTAT.Geom.Point.scale=function(a,g){if(CTAT.Geom.Point.useDOMMatrix)return(new DOMMatrix).scale(g).transformPoint(a);var f=new DOMPoint(a),c;for(c in f)"w"!=c&&(f[c]=CTAT.Math.round(a[c]*g));return f};DOMPoint.prototype.scale||Object.defineProperty(DOMPoint.prototype,"scale",{value:function(a){return CTAT.Geom.Point.scale(this,a)}});CTAT.Geom.Point.polar=function(a,g){return new DOMPoint(CTAT.Math.round(a*Math.cos(g)),CTAT.Math.round(a*Math.sin(g)))};
CTAT.Geom.Point.is_on_line=function(a,g,f){return 1E-4>Math.abs(a.distance(f)+g.distance(f)-a.distance(g))};CTAT.Geom.Point.circle_intersection=function(a,g,f,c){g=g.add(a.scale(-1)).normalize();var d=CTAT.Geom.Point.dot(g,f.add(a.scale(-1))),b=a.add(g.scale(d));f=CTAT.Geom.Point.distance(f,b);return f<c?(c=Math.sqrt(c*c-f*f),[a.add(g.scale(d-c)),a.add(g.scale(d+c))]):f==c?[b]:[]};CTAT.Geom.Point.to2DString=function(a,g){var f=[a.x/a.w,a.y/a.w].join();g&&(f="("+f+")");return f};CTAT.Geom.Rectangle={};try{new DOMRect}catch(a){if(console.log("WARNING: new DOMRect():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("    Using shim!");var DOMRect=function(g,f,c,d){this.x=g||0;this.y=f||0;this.width=c||0;this.height=d||0;return this}}}"left"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"left",{get:function(){return Math.min(this.x,this.x+this.width)}});
"right"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"right",{get:function(){return Math.max(this.x,this.x+this.width)}});"top"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"top",{get:function(){return Math.min(this.y,this.y+this.height)}});"bottom"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"bottom",{get:function(){return Math.max(this.y,this.y+this.height)}});
CTAT.Geom.Rectangle.contains=function(a,g,f){var c=CTAT.Geom.Rectangle.contains;if(g instanceof DOMRect)return c(a,g.left,g.top)&c(a,g.right,g.bottom);if(g instanceof DOMPoint){var d=!0;if(f instanceof DOMPoint)d=c(a,f.x/f.w,f.y/f.w);else if("number"==typeof f)return c(a,g.x-f,g.y-f)&c(a,g.x+f,g.y+f);return d&c(a,g.x,g.y)}return a.left<=g&a.right>=g&a.top<=f&a.bottom>=f};
DOMRect.prototype.contains||Object.defineProperty(DOMRect.prototype,"contains",{value:function(a,g){return CTAT.Geom.Rectangle.contains(this,a,g)}});DOMRect.prototype.clone||Object.defineProperty(DOMRect.prototype,"clone",{value:function(){return new DOMRect(this.x,this.y,this.width,this.height)}});DOMRect.prototype.copyFrom||Object.defineProperty(DOMRect.prototype,"copyFrom",{value:function(a){this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height;return this}});
CTAT.Geom.Rectangle.equals=function(a,g){return a.left==g.left&&a.top==g.top&&a.right==g.right&&a.bottom==g.bottom};CTAT.Geom.Rectangle.inflate=function(a,g,f){g=g?g:0;f=f?f:0;g instanceof DOMPoint&&(f=g.y,g=g.x);a=a.clone();a.x-=g;a.y-=f;a.width+=2*g;a.height+=2*f;return a};CTAT.Geom.Rectangle.isEmpty=function(a){return 0===a.width||0===a.height};CTAT.Geom.Rectangle.setEmpty=function(a){a.x=0;a.y=0;a.width=0;a.height=0;return a};
CTAT.Geom.Rectangle.setTo=function(a,g,f,c,d){a.x=g;a.y=f;a.width=c;a.height=d;return a};CTAT.Geom.Rectangle.offset=function(a,g,f){g=g?g:0;f=f?f:0;g instanceof DOMPoint&&(f=g.y,g=g.x);a=a.clone();a.x+=g;a.y+=f;return a};CTAT.Geom.Rectangle.union=function(a,g){var f=new DOMRect;f.x=Math.min(a.x,g.x);f.y=Math.min(a.y,g.y);f.width=Math.max(a.right,g.right)-f.x;f.height=Math.max(a.bottom,g.bottom)-f.y;return f};var CTATNumberLine=function(a,g,f,c,d){CTAT.Component.Base.SVG.call(this,"CTATNumberLine","aNumberLine",a,g,f,c,d);var b=CTAT.Math.Fraction,e=CTATGlobals.NameSpace.svg;a=function(a,c,d,f,g){this.numberline=a;this.step=new b(c);this.size=d;this.origin=new b(0);f=f?f:null;g=g?g:null;this.g=null;this.setStep=function(a){this.step=new b(a)};this.setSize=function(b){b=Number(b);isNaN(b)&&(b=d);this.size=b};this.setOrigin=function(a){this.origin=new b(a)};this.generate=function(){if(this.numberline){var a=
new b,c=document.createDocumentFragment(),d=document.createElementNS(e,"g");d.setAttributeNS(null,"data-step-size",this.step.toString());d.setAttributeNS(null,"pointer-events","none");f&&d.classList.add(f);c.appendChild(d);if(0<this.step){for(a.set(this.origin).reduce();a<=this.numberline.Maximum;)a>=this.numberline.Minimum&&d.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.add(this.step);a.set(this.origin).reduce();for(a=a.subtract(this.step);a>=this.numberline.Minimum;)a<=this.numberline.Maximum&&
d.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.subtract(this.step)}g&&$(d).find("text.CTATNumberLine--tickmark-label").each(function(){this.classList.add(g)});return c}}};var h=new a(this,new b(1),30,"CTATNumberLine--large-tickmark","CTATNumberLine--large-tickmark-label");this.setLargeTickSize=function(b){h.setSize(s);this.render();return this};this.setParameterHandler("LargeTickmarkSize",this.setLargeTickSize);this.setParameterHandler("LargeTickmarkStep",function(b){h.setStep(b);
this.render();return this});this.data_ctat_handlers["large-tick-step"]=function(b){h.setStep(b);this.render()};var l=new a(this,new b(1,2),20,"CTATNumberLine--small-tickmark","CTATNumberLine--small-tickmark-label");this.setSmallTickSize=function(b){l.setSize(s);this.render();return this};this.setParameterHandler("SmallTickmarkSize",this.setSmallTickSize);this.setParameterHandler("SmallTickmarkStep",function(b){l.setStep(b);this.render();return this});this.data_ctat_handlers["small-tick-step"]=function(b){l.setStep(b);
this.render()};var m=new a(this,new b(0),25,"CTATNumberLine--denominator-tickmark","CTATNumberLine--denominator-tickmark-label");this.setParameterHandler("DenominatorTickmarkSize",function(b){m.setSize(b);this.render();return this});this.setParameterHandler("DenominatorTickmarkStep",function(a){m.setStep((new b(a)).reciprocal())});this.data_ctat_handlers.denominator=function(a){a=new b(a);m.setStep(a.reciprocal())};this.setColor=function(b){console.log("numberline.setColor");this.color=b=CTATGlobalFunctions.formatColor(b);
for(var a=$(this.getDivWrap()).find("g"),c=0;c<a.length;c++)$(a[c]).css("stroke",b)};this.getColor=function(){console.log("numberline.getColor");return this.color};this.X_Axis=new function(b,a,c,e){var d={};this.svg_group=null;var f=b;Object.defineProperty(this,"start",{get:function(){return f},set:function(b){d={};f=b}});Object.defineProperty(this,"min_loc",{get:function(){if(!d.hasOwnProperty("min_loc")){var b=this.start.clone(),a=CTAT.Geom.Point.polar(20,this.angle()),b=b.add(a);b.x=CTAT.Math.round(b.x);
b.y=CTAT.Math.round(b.y);d.min_loc=b}return d.min_loc}});var g=a;Object.defineProperty(this,"end",{get:function(){return g},set:function(b){d={};g=b}});Object.defineProperty(this,"max_loc",{get:function(){if(!d.hasOwnProperty("max_loc")){var b=this.end.clone(),a=CTAT.Geom.Point.polar(20,this.angle()),b=b.add(a.scale(-1));b.x=CTAT.Math.round(b.x);b.y=CTAT.Math.round(b.y);d.max_loc=b}return d.max_loc}});var h=c;Object.defineProperty(this,"min",{get:function(){return h},set:function(b){d={};h=b}});var m=
e;Object.defineProperty(this,"max",{get:function(){return m},set:function(b){d={};m=b}});Object.defineProperty(this,"length",{get:function(){d.hasOwnProperty("length")||(d.length=CTAT.Math.round(this.min_loc.distance(this.max_loc)));return d.length}});this.isHorizontal=function(){return this.start.y===this.end.y};this.isVertical=function(){return this.start.x===this.end.x};Object.defineProperty(this,"range",{get:function(){return this.max.subtract(this.min)}});Object.defineProperty(this,"step_size",
{get:function(){return CTAT.Geom.Point.equals(this.min_loc,this.max_loc)?this.length:CTAT.Math.round(this.length/this.range)}});this.s_vec=function(){return this.max_loc.add(this.min_loc.scale(-1))};this.slope=function(){var b=this.s_vec();return b.y/b.x};this.step=function(){d.hasOwnProperty("step")||(d.step=this.s_vec().normalize(this.step_size));return d.step};this.scalar=function(){d.hasOwnProperty("scalar")||(d.scalar=this.range/this.length);return d.scalar};this.zero=function(){d.hasOwnProperty("zero")||
(d.zero=this.min_loc.add(this.step().scale(-this.min)),d.zero.x=CTAT.Math.round(d.zero.x),d.zero.y=CTAT.Math.round(d.zero.y));return d.zero};this.angle=function(){if(!d.hasOwnProperty("angle")){var b=this.end.add(this.start.scale(-1));d.angle=Math.atan2(b.y,b.x)}return d.angle};this.angle_deg=function(){return CTAT.Math.rad2deg(this.angle())};this.getPosition=function(b){b=this.zero().add(this.step().scale(1*b));b.x=CTAT.Math.round(b.x);b.y=CTAT.Math.round(b.y);return b};this.projected_point=function(b){var a=
this.s_vec(),c=b.add(this.min_loc.scale(-1)),c=0+(a.y*c.x-a.x*c.y)/(a.y*a.y+a.x*a.x);return b.add(new DOMPoint(-c*a.y,c*a.x))};this.getProjectedPoint=function(b){b=this.projected_point(b);return b.distance(this.max_loc)>this.length?this.min_loc:b.distance(this.min_loc)>this.length?this.max_loc:b};this.getAxisValue=function(b){return CTAT.Math.round(h+this.scalar()*this.min_loc.distance(this.getProjectedPoint(b)))}}(new DOMPoint(0,0),new DOMPoint(0,0),new b(0),new b(3));Object.defineProperty(this,
"Maximum",{get:function(){return this.X_Axis.max},set:function(a){this.X_Axis.max=new b(a)}});this.setMaximum=function(b){this.Maximum=b};this.setParameterHandler("Maximum",this.setMaximum);this.data_ctat_handlers.maximum=this.setMaximum;Object.defineProperty(this,"Minimum",{get:function(){return this.X_Axis.min},set:function(a){this.X_Axis.min=new b(a)}});this.setMinimum=function(b){this.Minimum=b};this.setParameterHandler("Minimum",this.setMinimum);this.data_ctat_handlers.minimum=this.setMinimum;
var n=1;Object.defineProperty(this,"Max_Points",{get:function(){return n},set:function(b){b=parseInt(b);isNaN(b)||(n=b)}});this.setMaxPoints=function(b){this.Max_Points=b};this.setParameterHandler("Max_Points",this.setMaxPoints);this.data_ctat_handlers["max-points"]=this.setMaxPoints;var p=7;this.setPointSize=function(b){p=Number(b);w&&(w.setAttributeNS(null,"r",p),$(this._point_group).find("circle").each(function(){$(this).attr("r",p)}))};this.setStyleHandler("PointSize",this.setPointSize);this.data_ctat_handlers["point-size"]=
this.setPointSize;var v=!1;this.setSnapToTickMark=function(b){v=CTATGlobalFunctions.toBoolean(b)};this.setParameterHandler("SnapToTickmark",this.setSnapToTickMark);this.data_ctat_handlers.snap=this.setSnapToTickMark;this.theta=0;Object.defineProperty(this,"Orientation",{get:function(){return 180*this.theta/Math.PI},set:function(b){b=Number(b);isNaN(b)&&(b=0);this.theta=Math.PI*b/180}});this.setOrientation=function(b){this.Orientation=b;this.render()};this.setParameterHandler("Orientation",this.setOrientation);
this.data_ctat_handlers.rotation=this.setOrientation;this._tickmarks=[];this.genTickmark=function(b,a,c){var d=document.createDocumentFragment();if(!this._tickmarks.some(function(a){return a.data.equals(b)})){var f=document.createElementNS(e,"line"),g=this.X_Axis.getPosition(b),h=CTAT.Geom.Point.polar(c/2,this.theta+Math.PI/2).add(g);c=CTAT.Geom.Point.polar(-c/2,this.theta+Math.PI/2).add(g);f.setAttributeNS(null,"x1",h.x);f.setAttributeNS(null,"y1",h.y);f.setAttributeNS(null,"x2",c.x);f.setAttributeNS(null,
"y2",c.y);f.setAttributeNS(null,"data-value",b.toString());f.data=b;f.location=g;f.label=null;this._tickmarks.push(f);d.appendChild(f);if(""!==a){g=document.createElementNS(e,"text");g.classList.add("CTATNumberLine--tickmark-label");g.setAttributeNS(null,"text-anchor","middle");d.appendChild(g);if(null===a||void 0===a)if(1==b.denominator)g.appendChild(document.createTextNode(String(b.numerator.toPrecision(P)))),g.setAttributeNS(null,"x",c.x),g.setAttributeNS(null,"y",c.y);else{a=""+String(b.numerator);
h=""+String(b.denominator);g.style.fontSize="0.6em";g.setAttributeNS(null,"text-align","center");var m=document.createElementNS(e,"tspan"),l=document.createElementNS(e,"tspan");m.appendChild(document.createTextNode(a));l.appendChild(document.createTextNode(h));g.appendChild(m);g.appendChild(l);m.setAttributeNS(null,"text-anchor","middle");m.setAttributeNS(null,"x",c.x);m.setAttributeNS(null,"y",c.y);m.setAttributeNS(null,"dy","-1em");l.setAttributeNS(null,"text-anchor","middle");l.setAttributeNS(null,
"x",c.x);l.setAttributeNS(null,"y",c.y);a.length>h.length?m.style.textDecoration="underline":l.style.textDecoration="overline"}else g.appendChild(document.createTextNode(a.toString())),d.appendChild(tlabel),g.setAttributeNS(null,"x",c.x),g.setAttributeNS(null,"y",c.y);f.label=g}}return d};var r=function(){if(null!==this.X_Axis&&null!==this.X_Axis.svg_group){var b=this.getBoundingBox(),a=window.getComputedStyle(this._axis_line_group),a=parseInt(a.getPropertyValue("stroke-width")),b=CTAT.Geom.Rectangle.inflate(b,
-a,-a),c=new DOMPoint(b.width/2,b.height/2),d=c.add(CTAT.Geom.Point.polar(Math.min(40,b.height,b.width)/4,this.theta)),f=Math.sin(this.theta),g=-Math.cos(this.theta),n=f*c.x+g*c.y,p=-b.height*g,r=-f*b.width,a=new DOMPoint(b.left,c.y),c=new DOMPoint(b.right,c.y);if(0<Math.abs(CTAT.Math.round(p))){var p=new DOMPoint(b.left,(n-f*b.left)/g),u=new DOMPoint(b.right,(n-f*b.right)/g);if(b.contains(p)||b.contains(u))d.distance(p)<d.distance(u)?(a=u,c=p):(a=p,c=u)}0<Math.abs(CTAT.Math.round(r))&&(r=new DOMPoint((n-
g*b.top)/f,b.top),f=new DOMPoint((n-g*b.bottom)/f,b.bottom),b.contains(r)||b.contains(f))&&(d.distance(r)<d.distance(f)?(a=f,c=r):(a=r,c=f));if(this.X_Axis.start.x!=a.x||this.X_Axis.start.y!=a.y||this.X_Axis.end.x!=c.x||this.X_Axis.end.y!=c.y)this.X_Axis.start=a,this.X_Axis.end=c,this.X_Axis.svg_group.innerHTML="",b=document.createDocumentFragment(),d=document.createElementNS(e,"line"),d.setAttributeNS(null,"x1",a.x),d.setAttributeNS(null,"y1",a.y),d.setAttributeNS(null,"x2",c.x),d.setAttributeNS(null,
"y2",c.y),b.appendChild(d),d=document.createElementNS(e,"path"),d.setAttributeNS(null,"d","M 10,6 L 0,0 L 10,-6"),d.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(a)+") rotate("+this.Orientation+")"),b.appendChild(d),a=document.createElementNS(e,"path"),a.setAttributeNS(null,"d","M -10,6 L 0,0 L -10,-6"),a.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(c)+") rotate("+this.Orientation+")"),b.appendChild(a),this.X_Axis.svg_group.appendChild(b);this._tickmarks=
[];a=document.createDocumentFragment();a.appendChild(h.generate());a.appendChild(l.generate());a.appendChild(m.generate());this._tick_mark_group.innerHTML="";this._tick_mark_group.appendChild(a);a=this._point_group.children;for(c=0;c<a.length;c++)b=a[c],d=this.X_Axis.getPosition(b.value),f=new DOMPoint(b.cx.baseVal.value,b.cy.baseVal.value),1<d.distance(f)&&(b.cx.baseVal.value=d.x,b.cy.baseVal.value=d.y)}}.bind(this),u=0,w=null,B=new DOMPoint(-30,-30),y=!1,z=function(b){B.x=b.clientX;B.y=b.clientY},
q=function(b){cancelAnimationFrame(u);w.style.visibility="hidden";y=!1},F=function(b){if(!0===this.getEnabled()&&0<n){this.setHintHighlight(!1);var a;v?(b=I(b.clientX,b.clientY),a=b.location,b=b.data):(b=A(b.clientX,b.clientY),a=this.X_Axis.getProjectedPoint(b),b=this.X_Axis.getAxisValue(b));var c=document.createElementNS(e,"circle");c.classList.add("CTATNumberLine--point");c.setAttributeNS(null,"cx",a.x);c.setAttributeNS(null,"cy",a.y);c.setAttributeNS(null,"r",p);c.value=b;if(this._point_group.children.length>=
this.Max_Points){a=[].slice.call(this._point_group.children);var d=a.filter(function(b,a,c){return b.classList.contains("CTAT--incorrect")});0<d.length?this._point_group.removeChild(d[0]):(a=a.filter(function(b,a,c){return!b.classList.contains("CTAT--correct")}),0<a.length&&this._point_group.removeChild(a[0]))}this._point_group.appendChild(c);this.setActionInput("AddPoint",b.toString());this.processAction()}}.bind(this);this.init=function(){this.initSVG();this.component.classList.add("CTATNumberLine--container");
this._axis_line_group=document.createElementNS(e,"g");this._axis_line_group.classList.add("CTATNumberLine--axis");this._tick_mark_group=document.createElementNS(e,"g");this._tick_mark_group.classList.add("CTATNumberLine--tickmark");this._point_group=document.createElementNS(e,"g");w=document.createElementNS(e,"circle");w.setAttributeNS(null,"r",p);w.classList.add("CTATNumberLine--cursor");w.setAttributeNS(null,"transform","translate(-30,-30)");this.component.appendChild(this._axis_line_group);this.component.appendChild(this._tick_mark_group);
this.component.appendChild(this._point_group);this.component.appendChild(w);this.X_Axis.svg_group=this._axis_line_group;r();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("mousemove",z);this.component.addEventListener("mouseleave",q);var b=this.getEnabled;this.component.addEventListener("mouseenter",function(){!0===b()&&0<n&&(y=!0,w.style.visibility=null,u=requestAnimationFrame(G))});this.component.addEventListener("click",F);this.component.addEventListener("focus",
this.processFocus)};this.getConfigurationActions=function(){var b=[],a,c=$(this.getDivWrap());c.attr("data-ctat-minimum")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_minimum"),a.setInput(c.attr("data-ctat-minimum")),b.push(a));c.attr("data-ctat-maximum")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_maximum"),a.setInput(c.attr("data-ctat-maximum")),b.push(a));c.attr("data-ctat-max-points")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_max_user_entries"),
a.setInput(c.attr("data-ctat-max-points")),b.push(a));c.attr("data-ctat-large-tick-step")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_large_step"),a.setInput(c.attr("data-ctat-large-tick-step")),b.push(a));c.attr("data-ctat-small-tick-step")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_small_step"),a.setInput(c.attr("data-ctat-small-tick-step")),b.push(a));c.attr("data-ctat-denominator")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_denominator"),
a.setInput(c.attr("data-ctat-denominator")),b.push(a));return b};var C=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),A=function(b,a){this.svgPoint=this.svgPoint?this.svgPoint:this.component.createSVGPoint();this.svgPoint.x=b;this.svgPoint.y=a;var c=this._axis_line_group.getScreenCTM().inverse();this.svgPoint=this.svgPoint.matrixTransform(c);c=new DOMPoint(this.svgPoint.x,this.svgPoint.y);if(C){var e=$(this.component),d=parseInt(e.css("borderLeftWidth"))+parseInt(e.css("paddingLeft"))+parseInt(e.css("marginLeft")),
e=parseInt(e.css("borderTopWidth"))+parseInt(e.css("paddingTop"))+parseInt(e.css("marginTop"));c.x-=d;c.y-=e}return c}.bind(this),E=function(b,a){return this.getProjectedPoint(A(b,a))}.bind(this.X_Axis),I=function(b,a){for(var c=E(b,a),e=null,d=Number.POSITIVE_INFINITY,f,g,h=0;h<this._tickmarks.length;h++)f=this._tickmarks[h],g=c.distance(f.location),g<d&&(e=f,d=g);return e}.bind(this),G=function(){if(y&&!0===this.getEnabled()){if(v){var b=I(B.x,B.y);w.setAttributeNS(null,"transform","translate"+
CTAT.Geom.Point.to2DString(b.location,!0))}else w.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(E(B.x,B.y),!0));u=requestAnimationFrame(G)}}.bind(this);this.render=function(){r()};this.calcXCoordinate=function(a){a=new b(a);var c=this.getWidth()-30,c=Math.abs(c-30),e=max.subtract(min);return 30+a.subtract(min).divide(e)/c};this.calcNum=function(b){var a=this.getWidth()-30,a=Math.abs(a-30);b=max.subtract(min).multiply((b-30)/a);return min.add(b)};var x=function(b,a){switch(a.getClassName()){case "CTATMessage":a=
a.getSAI()}var c=a.clone();c.setAction(b.getSAI().getAction());c.setSelection(b.getName());return c};this.showCorrect=function(b){b.getInput();var a=b.getAction(),c=function(a){a.setCorrect(x(a,b))};switch(a){case "AddPoint":0<this._point_group.children.length&&(a=[].slice.call(this._point_group.children),c=a[a.length-1],c.classList.remove("CTAT--incorrect"),c.classList.remove("CTAT--hint"),c.classList.add("CTAT--correct"),this.getDisableOnCorrect()&&(a.length>=this.Max_Points&&a.every(function(b){return b.classList.contains("CTAT--correct")})?
this.setEnabled(!1):this.setEnabled(!0)));break;case "Points":a=this._point_group.children;for(c=0;c<a.length;c++){var e=a[c];e.classList.remove("CTAT--incorrect");e.classList.remove("CTAT--hint");e.classList.add("CTAT--correct")}break;case "set_minimum":W(R()).forEach(c);break;case "set_maximum":W(Q()).forEach(c);break;case "set_large_step":W(U()).forEach(c);break;case "set_small_step":W(M()).forEach(c);break;case "set_denominator":W(V()).forEach(c);break;default:console.log("Unhandled Action in",
this.getName(),a)}};this.showInCorrect=function(b){b.getInput();var a=b.getAction(),c=function(a){a.setIncorrect(x(a,b))};switch(a){case "AddPoint":0<this._point_group.children.length&&(a=[].slice.call(this._point_group.children),a=a[a.length-1],a.classList.remove("CTAT--correct"),a.classList.remove("CTAT--hint"),a.classList.add("CTAT--incorrect"));break;case "Points":a=this._point_group.children;for(c=0;c<a.length;c++){var e=a[c];e.classList.remove("CTAT--correct");e.classList.remove("CTAT--hint");
e.classList.add("CTAT--incorrect")}break;case "set_minimum":W(R()).forEach(c);break;case "set_maximum":W(Q()).forEach(c);break;case "set_large_step":W(U()).forEach(c);break;case "set_small_step":W(M()).forEach(c);break;case "set_denominator":W(V()).forEach(c);break;default:console.log("Unhandled Action in",this.getName(),a)}};var H=this.setEnabled;this.setEnabled=function(b){H(b);w&&y&&(w.style.visibility=this.getEnabled()?null:"hidden")};this.set_minimum=function(b){this.Minimum=b;this.render()};
this.change_minimum=function(a){a=new b(a);0!==a.valueOf()&&(this.Minimum=this.Minimum.add(a),this.render())};var J=function(){this.setActionInput("set_minimum",this.Minimum)}.bind(this);this.set_maximum=function(b){this.Maximum=b;this.render()};this.change_maximum=function(a){a=new b(a);0!==a.valueOf()&&(this.Maximum=this.Maximum.add(a),this.render())};var S=function(){this.setActionInput("set_maximum",this.Maximum)}.bind(this);this.set_max_user_entries=function(b){this.setMaxPoints(parseInt(b))};
a=function(b,a){b.setStep(a);this.render()};this.set_large_step=a.bind(this,h);var O=function(){this.setActionInput("set_large_step",h.step.toString())}.bind(this);this.set_small_step=a.bind(this,l);var L=function(){this.setActionInput("set_small_step",l.step.toString())}.bind(this);this.set_denominator=function(a){0===parseInt(a)?m.setStep(0):m.setStep((new b(a)).reciprocal());this.render()};var D=function(){var b=0===m.step.valueOf()?0:m.step.reciprocal();this.setActionInput("set_denominator",b.toString())}.bind(this);
a=function(a,c){if(0!==(new b(c)).valueOf()){var e=a.step.add(c);0>e.valueOf()&&e.set(0,1);a.setStep(e);this.render()}};this.change_large_step=a.bind(this,h);this.change_small_step=a.bind(this,l);this.change_denominator=function(a){a=new b(a);0!==a.valueOf()&&(a=a.add(m.step.denominator),m.setStep(a.reciprocal()),this.render())};var P=void 0;this.set_precision=function(b){P=parseInt(b);this.render()};this.AddPoint=function(a,c){var d=new b(a),f=this.X_Axis.getPosition(d),g=document.createElementNS(e,
"circle");g.classList.add("CTATNumberLine--point");g.setAttributeNS(null,"cx",f.x);g.setAttributeNS(null,"cy",f.y);g.setAttributeNS(null,"r",p);g.value=d;[].slice.call(this._point_group.children).some(function(b){return d.equals(b.value)})||this._point_group.appendChild(g)};this.Points=function(b,a){this._point_group.innerHTML="";var c=b.split(";"),e;for(e in c)this.AddPoint(c[e],a)};var T=function(b,a,c,e){switch(e.getAction()){case "ButtonPressed":b.call(this,e.getInput());break;case "Update":case "UpdateTextField":case "UpdateTextArea":a.call(this,
e.getInput())}c.call();this.processAction(!1,!0)};a=function(b){return(b=$(this.getDivWrap()).attr(b))?b.split(/\s*;\s*/).map(function(b){return b.trim()}):[]};var Q=a.bind(this,"data-ctat-ctrl-max"),R=a.bind(this,"data-ctat-ctrl-min"),U=a.bind(this,"data-ctat-ctrl-large-tick"),M=a.bind(this,"data-ctat-ctrl-small-tick"),V=a.bind(this,"data-ctat-ctrl-denominator"),W=function(b){return b.map(function(b){return $("#"+b).data("CTATComponent")})},aa=function(b){var a=null;if(b instanceof CTAT.Component.Base.Tutorable)b!=
this&&(a=b.getName());else if(b instanceof CTATSAI)b.getSelection()!=pointer.getName()&&(a=b.getSelection());else if(b instanceof String)b!=pointer.getName()&&(a=b);else if(b instanceof Element)b!=pointer.getComponent()&&(a=b.id);else return null;if(a){if(ga(a))return T.bind(this,this.change_denominator,this.set_denominator,D);if(pa(a))return T.bind(this,this.change_small_step,this.set_small_step,L);if(ea(a))return T.bind(this,this.change_large_step,this.set_large_step,O);if(ha(a))return T.bind(this,
this.change_minimum,this.set_minimum,J);if(ja(a))return T.bind(this,this.change_maximum,this.set_maximum,S)}return null}.bind(this);CTATConfiguration.get("previewMode")||document.addEventListener(CTAT.Component.Base.Tutorable.EventType.action,function(b){var a=b.detail.sai;b=aa(b.detail.component);a&&null!==b&&b(a)},!1);this.setMaxControllers=function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-max",b)};this.setParameterHandler("MaxValueControllers",this.setMaxControllers);this.setMinControllers=
function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-min",b)};this.setParameterHandler("MinValueControllers",this.setMinControllers);this.setLargeTickControllers=function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-large-tick",b)};this.setParameterHandler("LargeTickmarkControllers",this.setLargeTickControllers);this.setSmallTickControllers=function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-small-tick",b)};this.setParameterHandler("SmallTickmarkControllers",this.setSmallTickControllers);this.setDenominatorControllers=
function(b){$(this.getDivWrap()).attr("data-ctat-ctrl-denominator",b)};this.setParameterHandler("DenominatorTickmarkControllers",this.setDenominatorControllers);a=function(b,a){return 0<=b().indexOf(a)};var ja=a.bind(null,Q),ha=a.bind(null,R),ea=a.bind(null,U),pa=a.bind(null,M),ga=a.bind(null,V);this.grade=function(b){b=b.getDivWrap().id;ja(b)?(this.setAction("set_maximum"),this.setInput(this.Maximum.toString())):ha(b)?(this.setAction("set_minimum"),this.setInput(this.Minimum.toString())):ea(b)?(this.setAction("set_large_step"),
this.setInput(h.step.toString())):pa(b)?(this.setAction("set_small_step"),this.setInput(l.step.toString())):ga(b)?(this.setAction("set_denominator"),this.setInput(m.step.reciprocal().toString())):this.updateSAI();this.processAction(!0)};this.updateSAI=function(){for(var b=this._point_group.children,a=[],c=0;c<b.length;c++)a.push(b[c].value);a.sort(function(b,a){return b-a});this.setActionInput("Points",a.join(";"))}};CTATNumberLine.prototype=Object.create(CTAT.Component.Base.SVG.prototype);
CTATNumberLine.prototype.constructor=CTATNumberLine;CTAT.ComponentRegistry.addComponentType("CTATNumberLine",CTATNumberLine);var CTATNumericStepper=function(a,g,f,c,d){CTAT.Component.Base.Tutorable.call(this,"CTATNumericStepper","__undefined__",a,g,f,c,d);this.setAction("Update");var b=document.createElement("input");b.type="number";this.set_maximum=function(a){a=Number(a);isNaN(a)||(b.max=a)};this.setParameterHandler("maximum",this.set_maximum);this.set_minimum=function(a){a=Number(a);isNaN(a)||(b.min=a)};this.setParameterHandler("minimum",this.set_minimum);this.set_step=function(a){a=Number(a);isNaN(a)||(b.step=a)};this.setParameterHandler("stepSize",
this.set_step);this.update_value=function(a){a=Number(a);isNaN(a)||(b.value=a,this.setInput(a))};this.setParameterHandler("value",this.update_value);this.updateSAI=function(){this.setInput(b.value)};this.Update=this.update_value;this.init=function(){b.id=this.getName()+"_spinner";this.setComponent(b);this.setInitialized(!0);var a=$(this.getDivWrap()),c=$(b);"autofocus defaultValue placeholder value max min readOnly step".split(" ").forEach(function(b){var e=a.attr(b);e&&c.attr(b,e)});CTATConfiguration.get("previewMode")||
(this.getDivWrap().innerHTML="");this.getDivWrap().appendChild(b);this.component.addEventListener("focus",this.processFocus);var d=this;b.addEventListener("change",function(b){var a=Number(this.min);isNaN(a)&&(a=0);b=Number(this.value);if(isNaN(b))this.value=a;else if(""!==this.min&&b<a)this.value=a;else if(""!==this.max&&!isNaN(Number(this.max))&&b>Number(this.max))this.value=this.max;else{var c=Number(this.step);if(isNaN(c)||0>=c)c=1;a=(b-a)%c;0!==a&&(this.value=b-a)}d.updateSAI();d.processAction();
return!1});CTATConfiguration.get("previewMode")&&this.addEventScreen(!1)};this.getConfigurationActions=function(){var b=[],a,c=$(this.getDivWrap());c.attr("min")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_minimum"),a.setInput(c.attr("min")),b.push(a));c.attr("max")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_maximum"),a.setInput(c.attr("max")),b.push(a));c.attr("step")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_step"),a.setInput(c.attr("step")),
b.push(a));c.attr("value")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("Update"),a.setInput(c.attr("value")),b.push(a));return b}};CTATNumericStepper.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATNumericStepper.prototype.constructor=CTATNumericStepper;CTAT.ComponentRegistry.addComponentType("CTATNumericStepper",CTATNumericStepper);var CTATPieChart=function(a,g,f,c,d){CTAT.Component.Base.UnitDisplay.call(this,"CTATPieChart","aPieChart",a,g,f,c,d);var b=3,e=3,h=this,l,m,n,p=null,v=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(v,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATPieChart--container");l=document.createElementNS(v,"filter");l.id=this.genName("Shadow");m="#"+l.id;n="url("+m+")";l.setAttributeNS(null,"width","200%");l.setAttributeNS(null,
"height","200%");p=document.createElementNS(v,"feOffset");p.setAttributeNS(null,"in","SourceAlpha");p.setAttributeNS(null,"result","offOut");p.setAttributeNS(null,"dx",e);p.setAttributeNS(null,"dy",e);l.appendChild(p);var b=document.createElementNS(v,"feGaussianBlur");b.setAttributeNS(null,"in","offOut");b.setAttributeNS(null,"result","blurOut");b.setAttributeNS(null,"stdDeviation",4);l.appendChild(b);b=document.createElementNS(v,"feBlend");b.setAttributeNS(null,"in","SourceGraphic");b.setAttributeNS(null,
"in2","blurOut");b.setAttributeNS(null,"mode","normal");l.appendChild(b);this.getComponent().getElementsByTagName("defs")[0].appendChild(l);0<e&&this.baseGroup.setAttributeNS(null,"filter",n);this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};this.drawPieces=function(){if(this.baseGroup){this.clear();var a=window.getComputedStyle(this.getComponent()),a=parseFloat(a.getPropertyValue("stroke-width")),
c=this.getBoundingBox(),d=Math.min(c.width/2,c.height/2)-(a+e+4),f=new DOMPoint(c.width/2,c.height/2),a=this.parseValue(),g=document.createDocumentFragment();a.reduce(function(a,c,e,m){if(1<=c.valueOf())e=document.createElementNS(v,"circle"),e.classList.add("CTATPieChart--piece"),e.cx.baseVal.value=f.x,e.cy.baseVal.value=f.y,e.r.baseVal.value=d,this.addPieceElem(e,c,c.selected),g.appendChild(e);else{e=document.createElementNS(v,"path");e.classList.add("CTATPieChart--piece");g.appendChild(e);window.getComputedStyle(e);
var l=2*Math.PI*a.valueOf();m=f.add(CTAT.Geom.Point.polar(d,l));c.reduce();var n=f.add(CTAT.Geom.Point.polar(d,2*Math.PI*c.valueOf()+l)),p=f.clone();if(0<b&&b<d){l=CTAT.Geom.Point.polar(b,l+Math.PI*c.valueOf());p=p.add(l);m=m.add(l);var u=function(b,a,c){return b.distance(a)<b.distance(c)?a:c};m=CTAT.Geom.Point.circle_intersection(p,m,f,d).reduce(u.bind(this,m));n=n.add(l);n=CTAT.Geom.Point.circle_intersection(p,n,f,d).reduce(u.bind(this,n))}l=CTAT.Geom.Point.to2DString;p="M "+l(p);u=new DOMPoint(d,
d);p+=" L "+l(m);p+=" A "+l(u)+" 0 "+(.5<c.valueOf()?1:0)+",1 "+l(n);e.setAttributeNS(null,"d",p+" Z");h.addPieceElem(e,c,c.selected)}return a.add(c)},new CTAT.Math.Fraction);this.baseGroup.innerHTML="";this.baseGroup.appendChild(g)}};this.getExplode=function(){return b};this.getDropShadowDistance=function(){return e};this.setExplode=function(a){a=Number(a);if(!isNaN(a)){var c=a!==b;b=a;c&&this.drawPieces()}return this};this.setStyleHandler("explode",this.setExplode);this.data_ctat_handlers.explode=
function(b){this.setExplode(b)};this.setDropShadowDistance=function(b){e=parseInt(b);e=isNaN(e)?0:e;p&&(p.setAttributeNS(null,"dx",e),p.setAttributeNS(null,"dy",e),0>=e&&this.baseGroup?this.baseGroup.removeAttributeNS(null,"filter"):this.baseGroup.hasAttributeNS(null,"filter")||this.baseGroup.setAttributeNS(null,"filter",n))};this.data_ctat_handlers["shadow-distance"]=function(b){this.setDropShadowDistance(b)}};CTATPieChart.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);
CTATPieChart.prototype.constructor=CTATPieChart;CTAT.ComponentRegistry.addComponentType("CTATPieChart",CTATPieChart);var CTATRadioButton=function(a,g,f,c,d){CTAT.Component.Base.Clickable.call(this,"CTATRadioButton","__undefined__",a,g,f,c,d);var b=CTATConfiguration.get("previewMode"),e=this,h=null,l=null,m="#000000";this.setSelection(this.getComponentGroup());this.setAction("UpdateRadioButton");this.setStyleHandler("BackgroundColor",null);this.init=function(){e.setInitialized(!0);h=document.createElement("input");h.type="radio";h.id=this.getName()+"_radio";h.value=e.getName();this.getComponentGroup()?h.name=e.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?h.name=$(this.getDivWrap()).attr("name"):h.name="radioButtonGroup";!0===e.getEnabled()?h.disabled=!1:h.disabled=!0;e.addComponentReference(e,h);var a;b||(a=this.getDivWrap().innerHTML,this.getDivWrap().innerHTML="");e.getDivWrap().appendChild(h);l=document.createElement("label");l.htmlFor=h.id;this.getText()?l.textContent=e.getText():a&&!b?l.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&(l.textContent=this.getDivWrap().getAttribute("data-ctat-label"));
e.setComponent(h);this.getDivWrap().appendChild(l);h.addEventListener("click",function(b){e.updateSAI();e.processAction()});h.addEventListener("focus",this.processFocus);h.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup());this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){var b=[];if(0<l.innerHTML.trim().length){var a=new CTATSAI;a.setSelection(this.getName());a.setInput(l.innerHTML.toString());a.setAction("setText");b.push(a)}return b};
this.setFontColor=function(b){m=b;$(l).css("color",b)};this.getFontColor=function(){return m};this.resize=function(){var b=$(this.getDivWrap()).height();$(l).css("font-size",b-5+"px");$(this.getComponent()).css("height",b-10+"px");$(this.getComponent()).css("width",b-10+"px")};var n=this.setText;this.setText=function(b){n(b);null!==l&&(l.innerHTML=this.getText())};this.setStyleHandler("buttonLabel",this.setText);var p=this.setEnabled;this.setEnabled=function(b){p(b);null!==h&&(h.disabled=!this.getEnabled())};
this.setChecked=function(b){null!==h&&(h.checked=b)};this.getChecked=function(){return h.checked};this.getRadioInput=function(){return h.checked?h.value+": "+l.textContent:""};this.setStyleHandler("labelPlacement",null);this.reset=function(){e.ctatdebug(" reset ( "+e.getName()+")");h.checked=!1;e.setEnabled(!0)};this.UpdateRadioButton=function(b){0<=b.indexOf(h.value)&&e.setChecked(!0);e.ctatdebug("UpdateRadioButton ()")};this.updateSAI=function(){var b=$("."+this.getClassName()+'[data-ctat-component]:has(input[type="radio"][name="'+
h.name+'"]:checked)'),a="";1===b.length&&(a=$(b[0]).data("CTATComponent").getRadioInput());e.setSelection(h.name);e.setInput(a)};var v=function(b){l&&l.classList.add(b);h&&h.classList.add(b)},r=function(b){l&&l.classList.remove(b);h&&h.classList.remove(b)};this.showCorrect=function(b){r("CTAT--hint");r("CTAT--incorrect");(b?0===b.getInput().indexOf(h.value):1)?v("CTAT--correct"):r("CTAT-correct")};this.removeCorrect=function(){r("CTAT--correct")};this.showInCorrect=function(b){r("CTAT--hint");r("CTAT--correct");
(b?0===b.getInput().indexOf(h.value):1)?v("CTAT--incorrect"):r("CTAT-incorrect")};this.removeInCorrect=r.bind(this,"CTAT--incorrect");this.showHintHighlight=function(b){this.removeCorrect();this.removeInCorrect();b?v("CTAT--hint"):r("CTAT--hint")}};CTATRadioButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATRadioButton.prototype.constructor=CTATRadioButton;CTAT.ComponentRegistry.addComponentType("CTATRadioButton",CTATRadioButton);var CTATScrollPaneComponent=function(a,g,f,c,d){CTAT.Component.Base.Tutorable.call(this,"CTATScrollPaneComponent","__undefined__",a,g,f,c,d);var b=0,e=this;e.isTabIndexable=!1;this.getAlpha=function(){return b};this.setAlpha=function(a){b=a};this.init=function(){e.ctatdebug("init ("+e.getName()+")");e.ctatdebug("Final location: "+e.getX()+","+e.getY()+" with text: "+e.getText());e.setInitialized(!0)};this.processCommShellEvent=function(b,a){e.ctatdebug("processCommShellEvent ("+b+")")};this.processSerialization=
function(){e.ctatdebug("processSerialization()")};this.postProcess=function(){e.ctatdebug("postProcess ()");for(var b in this.parameters){var a=this.parameters[b];e.ctatdebug("Checking style name: "+b);if("TargetMovieClip"==b)if(e.ctatdebug("Loading sub element: ["+a.trim()+"] ..."),a=findMovieClip(a.trim()),null!==a){if(e.ctatdebug("Found target movieclip, temporarily removing ..."),null!==a.getDivWrapper().parentNode){try{a.getDivWrapper().parentNode.removeChild(a.getDivWrapper())}catch(p){CTATScrim.scrim.errorScrimUp(p.message);
return}e.getDivWrap().setAttribute("id","scrollsubdiv");e.ctatdebug("Adding ...");e.getDivWrap().appendChild(a.getDivWrapper());var c=a.getDivWrapper().style.left,d=a.getDivWrapper().style.top;a.getDivWrapper().style.left="0px";a.getDivWrapper().style.top="0px";e.ctatdebug("Moving canvas from: "+c+","+d+" to: 0,0");a=a.getDivWrapper().childNodes;for(c=0;c<a.length;c++);}}else e.ctatdebug("Unable to find the target movieclip to reparent the content from")}e.ctatdebug("Final location: "+e.getX()+","+
e.getY()+" with text: "+e.getText());null===CTATCommShell.commShell||void 0===CTATCommShell.commShell?e.ctatdebug("Error: can't add event listener to commshell, pointer is invalid"):CTATCommShell.commShell.addGlobalEventListener(this)};this.configFromDescription()};CTATScrollPaneComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATScrollPaneComponent.prototype.constructor=CTATScrollPaneComponent;CTAT.ComponentRegistry.addComponentType("CTATScrollPaneComponent",CTATScrollPaneComponent);var CTATSkillWindow=function(a,g,f,c,d){CTAT.Component.Base.Graphical.call(this,"CTATSkillWindow","__undefined__",a,g,f,c,d);var b=this;b.isTabIndexable=!1;this.getThreshold=function(){var b=parseFloat($(this.getDivWrap()).attr("data-ctat-threshold"));return isNaN(b)?.95:b};this.setThreshold=function(b){$(this.getDivWrap()).attr("data-ctat-threshold",b)};var e=null;this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setIsAbstractComponent(!0);b.setInitialized(!0);e=this.getDivWrap();this.setComponent(e);
this.drawComponent();this.component.addEventListener("focus",this.processFocus)};this.assignSkillSet=function(b){CTATSkillSet.skills=b;this.drawComponent()};this.updateSkillSet=function(a){if(CTATSkillSet.skills){b.ctatdebug("updateSkillSet ("+a.getSkillSet().length+")");a=a.getSkillSet();for(var c=0;c<a.length;c++){var e=a[c];b.ctatdebug("Updating skill "+e.getSkillName()+" to level: "+e.getLevel()+" ...");CTATSkillSet.skills.setSkillLevel(e.getSkillName(),e.getLevel(),1)}this.drawComponent()}else b.ctatdebug("Error: updateSkillSet () no initial skill set given, can't update")};
this.drawComponent=function(){b.ctatdebug("drawComponent ()");if(null===CTATSkillSet.skills)ctatdebug("Info: no skillSet object available, bumping out");else{var a=CTATSkillSet.skills.getSkillSet();if(null===a)b.ctatdebug("Error: list of skills is null in skills object");else if(0>=a.length)b.ctatdebug("Error: list of skills is 0 length");else{for(var c=document.createDocumentFragment(),d=this.getThreshold(),f=0;f<a.length;f++){var g=a[f];b.ctatdebug("Drawing skill "+f+" "+g.getDisplayName()+" level: "+
g.getLevel()+" ...");var v=document.createElement("div");v.classList.add("CTATSkillWindow--skill");var r=document.createElement("div");r.classList.add("CTATSkillWindow--bar");var u=document.createElement("div"),w=g.getLevel();w<d?u.classList.add("CTATSkillWindow--bar--nonmastered"):u.classList.add("CTATSkillWindow--bar--mastery");u.style.width=w>d?"100%":100*w+"%";r.appendChild(u);v.appendChild(r);c.appendChild(v);r=document.createElement("div");r.textContent=g.getDisplayName()||"no-name";r.classList.add("CTATSkillWindow--label");
v.appendChild(r)}e.innerHTML="";e.appendChild(c)}}}};CTATSkillWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATSkillWindow.prototype.constructor=CTATSkillWindow;CTAT.ComponentRegistry.addComponentType("CTATSkillWindow",CTATSkillWindow);var CTATSubmitButton=function(a,g,f,c,d){CTATButton.call(this,a,g,f,c,d);this.setClassName("CTATSubmitButton");CTATConfiguration.get("previewMode");var b=this;this.setParameterHandler("target_components",function(b){this.getDivWrap().setAttribute("data-ctat-target",b);return this});var e=this.init;this.init=function(){e();this.setParameter("tutorComponent",CTAT.Component.Base.Tutorable.Options.DO_NOT_TUTOR);this.component.addEventListener("focus",this.processFocus)};var h=function(a){var c=b.getTargets();
return 0===Object.keys(c).length?!1:a===b?!1:a instanceof CTAT.Component.Base.Tutorable?c.hasOwnProperty(a.getName())||c.hasOwnProperty(a.getComponentGroup()):a instanceof CTATSAI?a.getSelection()!=b.getName()&&c.hasOwnProperty(a.getSelection()):a instanceof String?a!=b.getName()&&c.hasOwnProperty(a):a instanceof Element?a!=b.getComponent()&&(c.hasOwnProperty(a.id)||c.hasOwnProperty(a.getAttribute("name"))):!1};a=CTAT.Component.Base.Tutorable.EventType;document.addEventListener(a.correct,function(a){a.detail.sai&&
h(a.detail.component)&&b.isNotGraded()&&b.setCorrect()},!1);document.addEventListener(a.incorrect,function(a){a.detail.sai&&h(a.detail.component)&&(b.setIncorrect(),b.setEnabled(!0))},!1);document.addEventListener(a.ungrade,function(a){(a=a.detail.component)&&h(a)&&b.setNotGraded()},!1);document.addEventListener(a.highlight,function(a){var c=a.detail.component;c&&h(c)&&b.setHintHighlight(a.detail.isHighlighted)},!1);this.getTargets=function(){var b={},a=this.getDivWrap().getAttribute("data-ctat-target");
a&&String(a).split(/\s*[;,]\s*/).forEach(function(a){return b[a.trim()]=1});return b};this.processClick=function(a){if(!0===b.getEnabled()){a=b.getTargets();for(var c in a)a=CTATShellTools.findComponent(c),null!==a&&0<a.length&&(a=a[0],a instanceof CTAT.Component.Base.Tutorable?a.getEnabled()&&a.grade(b):b.ctatdebug("Invalid target component: "+a))}}};CTATSubmitButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATSubmitButton.prototype.constructor=CTATSubmitButton;
CTAT.ComponentRegistry.addComponentType("CTATSubmitButton",CTATSubmitButton);var CTATTextBasedComponent=function(a,g,f,c,d,b,e){CTAT.Component.Base.Tutorable.call(this,a,g,f,c,d,b,e);var h=this,l="",m="#000000",n=16,p=!0,v=255,r=!0;this.setAction("UpdateTextField");this.backgrade=!0;this.setFontColor=function(b){m=b;$(h.getComponent()).css("color",b)};this.getFontColor=function(){return m};this.setFontSize=function(b){b.includes("px")||(b+="px");n=b;$(h.getComponent()).css("font-size",b)};this.getFontSize=function(){return n};this.assignText=function(b){l=b;this.setInput(b)};
this.UpdateTextArea=this.UpdateTextField=function(b){this.setText(b)};this.setTabOnEnter=function(b){p=CTATGlobalFunctions.toBoolean(b)};this.setStyleHandler("TabOnEnter",this.setTabOnEnter);this.data_ctat_handlers["tab-on-enter"]=this.setTabOnEnter;this.assignEditable=function(b){r=b};this.setMaxCharacters=function(b){v=b};this.setStyleHandler("MaxCharacters",this.setMaxCharacters);this.getText=function(){return l};this.getEditable=function(){return r};this.getTabOnEnter=function(){return p};this.getMaxCharacters=
function(){return v};this.setEditable=function(b){h.assignEditable(CTATGlobalFunctions.toBoolean(b));null!==h.getComponent()&&(!0===h.getEditable()?h.getComponent().contentEditable="true":h.getComponent().contentEditable="false")};this.setStyleHandler("Enabled",this.setEditable);this.setEnabled=function(b){h.assignEnabled(b);null!==h.getComponent()&&(h.getComponent().disabled=!b,this.setEditable(b))};var u=this.processAction.bind(this);this.processAction=function(b,a){h.ctatdebug("processAction ()");
this.updateSAI();CTATGlobalFunctions.isBlank(this.getValue())||u(b,a)};this.processKeypress=function(b){h.ctatdebug("processKeypress ()");var a=b.target.getAttribute("id");h.ctatdebug(a);var c=h.getComponentFromID(a);if(null===c)h.ctatdebug("Error: component reference is null");else switch(h.ctatdebug(c.getName()+" keydown ("+("google"==CTATConfig.platform?0:window.event?window.event.keyCode:b.which)+" -> "+b.eventPhase+") ID: "+a),b.which){case 37:h.ctatdebug("left arrow key pressed!");break;case 39:h.ctatdebug("right arrow key pressed!");
break;case 13:return p?(h.component.blur(),CTATGlobals.Tab.Focus=null,h.processAction(),!1):!0;case 0:h.component.blur();CTATGlobals.Tab.Focus=null;h.processAction();break;default:h.ctatdebug('Key pressed! "'+b.which+'"')}};this.updateSAI=function(){h.ctatdebug("updateSAI ()");this.setInput(this.getValue());var b=this.getSAI();h.ctatdebug("SAI: "+b.toTSxmlString())}};CTATTextBasedComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATTextBasedComponent.prototype.constructor=CTATTextBasedComponent;var CTATTextArea=function(a,g,f,c,d){CTATTextBasedComponent.call(this,"CTATTextArea","__undefined__",a,g,f,c,d);this.setDefaultWidth(100);this.setDefaultHeight(44);var b=this,e=null,h=null,l=CTATConfiguration.get("previewMode");this.setAction("UpdateTextArea");this.init=function(c){e=document.createElement("textarea");a&&(e.name=a.name);e.setAttribute("id",CTATGlobalFunctions.gensym.div_id());(c=this.getDivWrap())&&$(c).attr("maxlength")&&(e.maxlength=$(c).attr("maxlength"));c&&$(c).attr("rows")&&
(e.rows=$(c).attr("rows"));c&&$(c).attr("cols")&&(e.cols=$(c).attr("cols"));b.setComponent(e);c&&$(c).attr("value")?this.setText($(c).attr("value")):e.value=this.getText();b.setInitialized(!0);b.addComponentReference(b,e);c.appendChild(e);$(e).keypress(b.processKeypress);e.addEventListener("focus",b.processFocus);$(e).on("input",function(a){b.setNotGraded()});l&&this.addEventScreen(!1)};this.processBlur=function(a){b.processAction()};this.setCellContainer=function(b){h=b};this.getCellContainer=function(){return h};
this.setText=function(a){b.ctatdebug("setText ("+a+")");b.assignText(a);e.value=a};this.getValue=function(){return e.value};this.reset=function(){b.configFromDescription();b.processSerialization();e.value=""}};CTATTextArea.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextArea.prototype.constructor=CTATTextArea;CTAT.ComponentRegistry.addComponentType("CTATTextArea",CTATTextArea);var CTATTable=function(a,g,f,c,d){CTAT.Component.Base.Tutorable.call(this,"CTATTable","__undefined__",a,g,f,c,d);var b=this,e=[],h=[],l=0;this.get_first_row_is_header=function(){return CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-has-header"))};this.set_first_row_is_header=function(b){$(this.getDivWrap()).attr("data-ctat-has-header",b);this.get_first_row_is_header()?(p(),l=1):(v(),l=0)};this.setParameterHandler("FirstRowIsHeader",this.set_first_row_is_header);a=function(b){b=
parseInt($(this.getDivWrap()).attr(b));return isNaN(b)?2:b};var m=a.bind(this,"data-ctat-num-rows");this.get_row_count=m;this.set_row_count=function(b){$(this.getDivWrap()).attr("data-ctat-num-rows",b)};this.setNumRows=function(b){b=Number(b);if(!isNaN(b)){for(;this.get_row_count()<b;)this.addRow();for(;this.get_row_count()>b;)this.deleteRow()}};var n=a.bind(this,"data-ctat-num-cols");this.get_col_count=n;this.set_col_count=function(b){$(this.getDivWrap()).attr("data-ctat-num-cols",b)};this.setNumCols=
function(b){b=Number(b);if(!isNaN(b)){for(;this.get_col_count()<b;)this.addColumn();for(;this.get_col_count()>b;)this.deleteColumn()}};this.super_setName=this.setName;this.setName=function(b){this.super_setName(b);if(e&&e[0])for(var a=0;a<e.length;a++)for(var c=0;c<e[0].length;c++)e[a][c].setAttribute("id",b+".R"+a+"C"+c)};this.init=function(){b.ctatdebug("init ("+b.getName()+")");b.setInitialized(!0);var a=b.getDivWrap();b.setComponent(a);b.addComponentReference(b,a);b.render();b.ctatdebug("table name = "+
this.getName());this.adjustTableContents();this.get_first_row_is_header()?(p(),l=1):l=0};this.getConfigurationActions=function(){var b=[],a,c=$(this.getDivWrap());c.attr("data-ctat-num-rows")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setNumRows"),a.setInput(c.attr("data-ctat-num-rows")),b.push(a));c.attr("data-ctat-num-cols")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setNumCols"),a.setInput(c.attr("data-ctat-num-cols")),b.push(a));c.attr("data-ctat-has-header")&&
(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("set_first_row_is_header"),a.setInput(c.attr("data-ctat-has-header")),b.push(a));return b};var p=function(){b.ctatdebug("fix_header()");h[0].classList.add("CTATTable--headers");for(var a=0;a<e[0].length;a++)e[0][a].classList.add("CTATTable--header")}.bind(this),v=function(){b.ctatdebug("remove_header()");h[0].classList.remove("CTATTable--headers");for(var a=0;a<e[0].length;a++)e[0][a].classList.remove("CTATTable--header")}.bind(this);this.fixHeader=
p;this.removeHeader=v;var r=function(b,a){var c=document.createElement("div"),e=this.getName()+".R"+b+"C"+a;c.id=e;c.classList.add("CTATTable--cell");c.classList.add("CTATTextArea");var d=new CTATTextArea;d.setName(e);d.setDivWrapper(c);(e=this.getTabIndex())&&d.setTabIndex(e);d.processAttributes();d.init(!0);d.processTabOrder();d.setEnabled(this.getEnabled());$(c).data("CTATComponent",d);return c}.bind(this);this.addRow=function(){var b=document.createElement("div");b.classList.add("CTATTable--row");
var a=m();parseInt(a,10);e[a]=[];for(var c=0;c<n();c++){var d=r(a,c);e[a].push(d);b.appendChild(d)}$(this.getDivWrap()).append(b);h.push(b);this.set_row_count(a+1)};this.deleteRow=function(){var b=this.getDivWrap();b.removeChild(b.lastChild);h.pop();e.pop();this.set_row_count(this.get_row_count()-1)};this.addColumn=function(){var b=n(),a=0;h.forEach(function(c){var d=r(a,b);e[a].push(d);a<l&&d.classList.add("CTATTable--header");c.appendChild(d);a++});this.set_col_count(b+1)};this.deleteColumn=function(){this.getDivWrap();
for(var b=h.length,a=0;a<b;a++)h[a].removeChild(h[a].lastChild),e[a].pop();this.set_col_count(this.get_col_count()-1)};this.adjustTableContents=function(){b.ctatdebug("adjustTableContents()");for(var a=m(),c=0;c<a;c++){var d=document.createElement("div");d.classList.add("CTATTable--row");$(this.getDivWrap()).append(d);h.push(d);for(var f=0;f<n();f++){var g=b.getName()+".R"+c+"C"+f,l=CTATShellTools.findComponent(g);l&&0!==l.length&&l[0].getName()===g?(g=l[0].getDivWrap(),g.classList.add("CTATTable--cell")):
g=r(c,f);d.appendChild(g);e[c]||(e[c]=[]);e[c].push(g)}}}};CTATTable.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATTable.prototype.constructor=CTATTable;CTAT.ComponentRegistry.addComponentType("CTATTable",CTATTable);var CTATTextField=function(a,g,f,c,d){CTATTextBasedComponent.call(this,"CTATTextBasedComponent","__undefined__",a,g,f,c,d);var b=this,e=null,h,l,m=null;this.setAction("UpdateTextArea");this.init=function(){e=this.getDivWrap();b.setComponent(e);this.getText()&&(e.innerHTML=b.getText());var a=e.getAttribute("data-ctat-selectable");a&&"true"==a.toLowerCase()&&p();b.setInitialized(!0);b.addComponentReference(b,e);b.setEditable(!1);a=(a=e.getAttribute("data-ctat-enabled"))&&"true"==a.toLowerCase();b.setEnabled(a);
b.render();b.addSafeEventListener("focus",b.processFocus,e)};var n=this.setEnabled.bind(this);this.setEnabled=function(a){n(a);b.setEditable(!1)};var p=function(){[h,l].forEach(function(b,a){var c=document.createElement("span"),e=document.createElement("div"),d=0==a;c.className="ctattextfield-marker";c.id=d?"start-marker":"end-marker";e.className="handle";c.appendChild(e);d?(e.className+=" start-handle",h=c):(e.className+=" end-handle",l=c);c.addEventListener("click",function(b){b.stopPropagation()});
c.addEventListener("mouseup",function(b){b.stopPropagation()})});b.addSafeEventListener("mouseup",v,e)},v=function(a){if(b.getEnabled()){a=null;b.clearSelectionMarkers();if(window.getSelection){var c=window.getSelection();c.getRangeAt&&(a=c.getRangeAt(0))}else document.selection&&document.selection.createRange&&(a=document.selection.createRange());a&&!a.collapsed&&e.contains(a.startContainer)&&a.startContainer==a.endContainer?(m=a.startOffset+","+a.endOffset,b.processAction(),b.setSelectionMarkers(a)):
(m="0,0",b.processAction())}};this.setSelectionMarkers=function(b){b.insertNode(h);b.collapse(!1);b.insertNode(l)};this.clearSelectionMarkers=function(){h.parentNode&&h.parentNode.removeChild(h);l.parentNode&&l.parentNode.removeChild(l);e.normalize();m=null};this.getConfigurationActions=function(){return 0<e.innerHTML.trim().length?(console.log(e.innerHTML),this.setInput(e.innerHTML.toString()),[this.getSAI()]):[]};this.setText=function(a){b.ctatdebug("setText ("+a+")");b.assignText(a);null!==e&&
(e.innerHTML=a)};this.getValue=function(){var b=content=""+this.getDivWrap().innerHTML;m&&(content=content.replace(/<span.*?class="ctattextfield-marker".*?>.*?<\/span>/g,""),b=m+";"+content);return b};var r=this.updateSAI.bind(this);this.updateSAI=function(){m?b.setAction("TextSelected"):b.setAction("UpdateTextArea");r()};this.setStyleHandler("ShowScrollbars",function(a){!0===CTATGlobalFunctions.toBoolean(a)?b.modifyCSSAttribute("overflow","scroll"):b.modifyCSSAttribute("overflow","hidden")})};
CTATTextField.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextField.prototype.constructor=CTATTextField;CTAT.ComponentRegistry.addComponentType("CTATTextField",CTATTextField);var CTATTextInput=function(a,g,f,c,d){CTATTextBasedComponent.call(this,"CTATTextInput","__undefined__",a,g,f,c,d);var b=this,e=null,h=null,l=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+b.getName()+")");e=document.createElement("input");e.type="text";a&&(e.name=a.name);e.setAttribute("maxlength",b.getMaxCharacters());e.setAttribute("id",CTATGlobalFunctions.gensym.div_id());b.setComponent(e);this.ctatdebug("Final location: "+b.getX()+","+b.getY()+" with text: "+
b.getText());var c=$(this.getDivWrap());c.attr("value")&&this.setText(c.attr("value"));var d=$(e);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(b){var a=c.attr(b);a&&d.attr(b,a)});b.setInitialized(!0);b.addComponentReference(b,e);b.getDivWrap().appendChild(e);b.addSafeEventListener("keypress",b.processKeypress,e);b.addSafeEventListener("focus",b.processFocus,e);$(e).on("input",function(a){b.setNotGraded()});l&&this.addEventScreen(!1)};this.getConfigurationActions=
function(){var b=[],a=$(this.getDivWrap());if(a.attr("value")){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("UpdateTextField");c.setInput(a.attr("value"));b.push(c)}return b};this.setCellContainer=function(b){h=b};this.getCellContainer=function(){return h};this.setText=function(a){b.ctatdebug("setText ("+a+")");b.assignText(a);e.value=a};this.getValue=function(){return e.value};this.reset=function(){b.configFromDescription();b.processSerialization();e.value=""};this.setStyleHandler("DrawBorder",
null)};CTATTextInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextInput.prototype.constructor=CTATTextInput;CTAT.ComponentRegistry.addComponentType("CTATTextInput",CTATTextInput);var CTATVideo=function(a,g,f,c,d){CTAT.Component.Base.Tutorable.call(this,"CTATVideo","__undefined__",a,g,f,c,d);var b=0,e=this,h=null;this.getAlpha=function(){return b};this.setAlpha=function(a){b=a};this.ctatdebug(this.getClassName()+" ("+this.getX()+","+this.getY()+","+this.getWidth()+","+this.getHeight()+")");this.setTutorComponent(CTAT.Component.Base.Tutorable.Options.TutorComponent.DO_NOT_TUTOR);this.configFromDescription();this.init=function(){e.ctatdebug("init ("+e.getName()+")");e.addCSSAttribute("z-index",
CTATGlobalFunctions.gensym.z_index());h=document.createElement("video");this.getDivWrap()&&$(this.getDivWrap()).attr("src")&&!CTATConfiguration.get("previewMode")&&(h.src=$(this.getDivWrap()).attr("src"));this.getDivWrap()&&$(e.getDivWrap()).attr("data-ctat-controls")?h.controls=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-controls")):h.controls=!0;h.autocontrols=!1;e.ctatdebug("Auto play: "+$(e.getDivWrap()).attr("data-ctat-autoplay"));this.getDivWrap()&&$(e.getDivWrap()).attr("data-ctat-autoplay")?
h.autoplay=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-autoplay")):h.autoplay=!0;e.setComponent(h);h.name=e.getName();h.setAttribute("id",CTATGlobalFunctions.gensym.div_id());h.setAttribute("onkeypress","return noenter(event)");e.addComponentReference(e,h);e.ctatdebug("Final location: "+e.getX()+","+e.getY()+" with text: "+e.getText());e.setInitialized(!0);e.getDivWrap().appendChild(h);e.ctatdebug("Resizing component to: "+$(e.getDivWrap()).width()+","+$(e.getDivWrap()).height());
h.addEventListener("focus",this.processFocus);h.addEventListener("canplay",function(){e.ctatdebug("Video loaded and ready for play")},!0);h.addEventListener("play",function(){e.ctatdebug("Video loaded and ready for play");e.logVideoEvent("play")},!0);h.addEventListener("pause",function(){e.ctatdebug("Video loaded and ready for play");e.logVideoEvent("pause")},!0);e.sizeToDiv()};this.sizeToDiv=function(){h&&(h.setAttribute("width",$(e.getDivWrap()).width()),h.setAttribute("height",$(e.getDivWrap()).height()))};
var l=this.render;this.render=function(){l.call(this);this.sizeToDiv()};this.getConfigurationActions=function(){var b=[],a;$(e.getDivWrap()).attr("data-ctat-controls")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("showControls"),a.setInput($(e.getDivWrap()).attr("data-ctat-controls")),b.push(a));$(e.getDivWrap()).attr("data-ctat-autoplay")&&(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setAutoplay"),a.setInput($(e.getDivWrap()).attr("data-ctat-autoplay")),b.push(a));$(this.getDivWrap()).attr("src")&&
(a=new CTATSAI,a.setSelection(this.getName()),a.setAction("setURL"),a.setInput($(this.getDivWrap()).attr("src")),b.push(a));return b};this.logVideoEvent=function(b){e.ctatdebug("logVideoEvent ("+b+")");if(void 0!==h.duration)if(null!==CTATCommShell.commShell){b=new CTATSAI(e.getName(),b,e.toHHMMSS(h.currentTime)+".000","");b.addSelection(encodeURIComponent(h.currentSrc),"media_file");b.addSelection(e.toHHMMSS(h.duration)+".000","clip_length");var a=b.getInputObject();null!==a&&a.setType("time");CTATCommShell.commShell.processComponentAction(b,
e.getTutorComponent(),!0,e,"VIDEO_ACTION","USER")}else e.ctatdebug("Error: commShell is null, can't send untutored tool message");else e.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};this.PlayMedia=function(b){h.src=b};this.showControls=function(b){b=CTATGlobalFunctions.toBoolean(b);$(e.getDivWrap()).attr("data-ctat-controls",b);h.controls=b};this.setAutoplay=function(b){b=CTATGlobalFunctions.toBoolean(b);$(e.getDivWrap()).attr("data-ctat-autoplay",b);h.autoplay=b};this.setURL=
function(b){$(this.getDivWrap()).attr("src",b);h.src=b};this.play=function(b){e.ctatdebug("play ()");var a="0";b&&(a="number"===typeof b?String(b):"string"===typeof b?b:"0");h.currentTime=a;h.play()};this.pause=function(b){e.ctatdebug("pause ()");h.pause();var a="0";b&&(a="number"===typeof b?String(b):"string"===typeof b?b:"0");h.currentTime=a};this.stop=function(){e.ctatdebug("stop ()");e.pause()}};CTATVideo.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTATVideo.prototype.constructor=CTATVideo;CTAT.ComponentRegistry.addComponentType("CTATVideo",CTATVideo);var CTATAssistments={},assistmentsTimerVar,assistmentsJSONpreface='{ "version" : "AS.1", "action" : ';function iframeToParent(a){window.parent.postMessage(a,"https://test1.assistments.org")}function iframeLoaded(){iframeToParent(assistmentsJSONpreface+'"loaded" }');assistmentsTimerVar=window.setInterval("iframeHeartbeat()",1E4)}function iframeHeartbeat(){iframeToParent(assistmentsJSONpreface+'"heartbeat"}')}
function iframeCompleted(){var a=document.getElementById("MyScore").value;iframeToParent(assistmentsJSONpreface+'"completed", "answer" : "<b>Student worked hard on this problem.</b>","score" : '+a+" }");window.clearTimeout(assistmentsTimerVar)};var CTATEnabledInPreview={},ctatEnabledInPreview={CTATButton:!0,CTATComboBox:!0,CTATAudioButton:!0,CTATImageButton:!0,CTATSubmitButton:!0,CTATTextArea:!0,CTATTextInput:!0,CTATNumericStepper:!0,CTATTable:!0,CTATHintButton:!0,CTATDoneButton:!0};var CTATTutor={drawing:!1,onMobile:!1,tutorInitialized:!1,flashVars:null};Object.defineProperty(CTATTutor,"parser",{get:function(){this._parser||(CTATConfig.parserType_is_XML()?(ctatdebug("Creating XML parser ..."),this._parser=new CTATXML):CTATConfig.parserType_is_JSON()&&(this._parser=new CTATJSON));return this._parser}});
CTATTutor.removeComponent=function(a){var g=[],f=CTATShellTools.findComponent(a);console.log("CTATTutor.removeComponent("+a+") cList",f);if(!a||!f)return g;for(var c=a=null,c=null,d=0;d<f.length;++d)if(a=f[d]){console.log("CTATTutor.removeComponent()[",d,"] ",a.getName&&a.getName(),a);(a.getComponentList?a.getComponentList():[]).forEach(function(b){CTATTutor.removeComponent(b.getName?b.getName():"")});if(c=a.getName&&a.getName())delete CTATShellTools.component_descriptions[c],g.push(c);if(c=a.getDivWrap&&
a.getDivWrap())a.setDivWrapper(null),$(c).data("CTATComponent",null),$(c).remove();console.log("CTATTutor.removeComponent()[",d,"] divWrap",c)}return g};
CTATTutor.initializeHTMLComponent=function(a,g){var f=CTAT.ComponentRegistry[g],c;if(c=$(a).data("CTATComponent"))return c;c=new f;$(a).attr("id")?c.setName($(a).attr("id")):(a.setAttribute("id",CTATGlobalFunctions.gensym.div_id()),c.setName(a.getAttribute("id")));c.setDivWrapper(a);c.processAttributes();c.init();c.processTabOrder();c.setEnabled(c.getEnabled());0==c.isFeedbackComponent()&&(f=new CTATComponentDescription,f.type=c.getClassName(),f.name=c.getName(),f.setComponentPointer(c),CTATShellTools.registerComponentDescription(f));
$(a).data("CTATComponent",c);if(CTATConfiguration.get("previewMode")){var f=c.getDivWrap().getAttribute("data-ctat-enabled"),d=ctatEnabledInPreview[c.getClassName()];d||(d=!1);c.setEnabled(d);c.getDivWrap().setAttribute("data-ctat-enabled",f)}return c};CTATTutor.initializeHTMLComponents=function(){for(var a in CTAT.ComponentRegistry)$("."+a).each(function(){$(this).data("CTATComponent")||CTATTutor.initializeHTMLComponent(this,a)});CTATShellTools.listComponents();ctatdebug("initializeHTMLComponents () done")};
var CTATComponentMutObserver=new MutationObserver(function(a,g){a.forEach(function(a){if(a.addedNodes){a=a.addedNodes;for(var c=a.length,d=0;d<c;d++){var b=a[d];if(b.nodeType===Node.ELEMENT_NODE){b.childNodes&&(a=Array.prototype.concat.call(a,Array.from(b.childNodes)));for(var c=a.length,e=/(CTAT[A-z]*)(\s|$)/g;ctatClass=e.exec(b.className);)if(CTAT.ComponentRegistry[ctatClass[1]]){CTATComponentMutObserver.disconnect();CTATTutor.initializeHTMLComponent(b,ctatClass[1]);CTATComponentMutObserver.observe(document.body,
{childList:!0,subtree:!0});break}}}}})});function addMutObserver(){console.log("adding ctatcomponent mutation observer");CTATComponentMutObserver.observe(document.body,{childList:!0,subtree:!0})}"loading"!==document.readyState?addMutObserver():document.addEventListener("DOMContentLoaded",addMutObserver);CTATTutor.callComponentFunction=function(a,g,f){if((a=CTATShellTools.findComponent(a.id))&&0<a.length){a=a[0];var c=null;g&&(c=g(a,f));return c}};
function assignNameTranslator(a){nameTranslator=a}CTATTutor.drawTutor=function(){if(!0!==this.drawing){this.drawing=!0;for(var a in CTATShellTools.component_descriptions){var g=CTATShellTools.component_descriptions[a].getComponentPointer();null!==g&&g.drawComponent()}this.drawing=!1}};
CTATTutor.initialize=function(){var a=navigator.userAgent.toLowerCase();0<a.search("iphone")?CTATTutor.onMobile=!0:0<a.search("ipod")?CTATTutor.onMobile=!0:0<a.search("android")&&(CTATTutor.onMobile=!0);a=getSafeElementById("pageor");null!==a&&!1===CTATTutor.onMobile&&(a.style.display="none");ctatdebug("initialize ()");this.initializeHTMLComponents();flashVars.getRawFlashVars();a=!0;CTATConfiguration.get("previewMode")&&(ctatdebug("In preview mode..."),a=!1);1==a?(CTATCommShell.commShell=new CTATCommShell,
CTATCommShell.commShell.init(CTATTutor)):CTATScrim.scrim.scrimDown()};
CTATTutor.createInterface=function(){ctatdebug("createInterface ("+Object.keys(CTATShellTools.component_descriptions).length+")");if(1==CTATGlobals.ignoreInterfaceDescriptions)ctatdebug("No need to process interface description messages, the interface should already be ready."),this.postProcess(),this.drawTutor();else{if(CTATGlobals.interfaceElement){ctatdebug("Re-creating interface ...");var a=CTATTutor.parser.getElementChildren(CTATGlobals.interfaceElement);CTATTutor.createStaticInterface(null,
a,null)}for(var g in CTATShellTools.component_descriptions){a=CTATShellTools.component_descriptions[g];if(!a){alert("Internal error parsing component at index "+g);return}if(!a.name){alert("Internal error parsing component at index "+g+" (no name attribute available)");return}if(-1==a.name.indexOf("null."))if(ctatdebug("Component: "+a.name+", type: "+a.type),"CTATCommShell"==a.type){if(CTATCommShell.commShell&&CTATCommShell.commShell.setName(a.name),"CTATCommShell"==a.type){ctatdebug("Tutor dimensions: "+
a.width+"x"+a.height);var f=getSafeElementById(ctatcontainer);null!==f?(ctatdebug("Setting canvas dimensions from: "+f.width+"px, "+f.height+"px, to: "+a.width+"px, "+a.height+"px"),f.width=a.width,f.height=a.height,f.style.width=a.width,f.style.height=a.height,ctatdebug("Canvas dimensions now: "+f.width+"px, "+f.height+"px")):ctatdebug("Error: tutor canvas is null, can't adjust size");f=getSafeElementById(ctatcontainer);null!==f?(f.style.width=a.width+"px",f.style.height=a.height+"px"):ctatdebug("Error: tutor container is null, can't adjust size")}}else CTAT.ComponentRegistry.hasOwnProperty(a.type)?
(ctatdebug("Creating ("+a.type+") :"+a.name),f=new CTAT.ComponentRegistry[a.type](a,a.x,a.y,a.width,a.height),f.setName(a.name),"CTATTextInput"!=a.type&&"CTATTextArea"!=a.type||f.setEnabled(!0),f.setTabIndex(a.tabIndex),a.setComponentPointer(f),f.initialize(),ctatdebug(f.getDivWrap())):ctatdebug("ERROR: Unrecognized component type "+a.type+" for "+a.name)}this.postProcess();this.drawTutor();ctatdebug("Tutor has been intialized from BRD, recalculating canvas position and size ...")}};
CTATTutor.postProcess=function(){ctatdebug("postProcess ()");for(var a in CTATShellTools.component_descriptions){var g=CTATShellTools.component_descriptions[a].getComponentPointer();null!==g?(g.getClassName(),g.postProcess&&g.postProcess()):ctatdebug("Error: component pointer "+a+" is null")}};
CTATTutor.createStaticInterface=function(a,g,f){ctatdebug("createStaticInterface ()");var c=getSafeElementById(ctatcontainer);null!==a&&(c=a);for(a=0;a<g.length;a++){var d=g[a];ctatdebug(this.parser.getElementName(d));if("timeline"==this.parser.getElementName(d)){ctatdebug("Timeline node found, obtaining visual elements ...");g=this.parser.getElementChildren(d);this.createStaticInterface(null,g,null);break}if("ctatcomponent"==this.parser.getElementName(d)){var b=this.parser.getElementAttr("instance");
f&&(ctatdebug("Registering existence of CTAT component on MovieClip container: "+b),f.addComponent(b))}var e,h,l,m;"shape"==this.parser.getElementName(d)&&(e=this.parser.getElementAttr(d,"x"),h=this.parser.getElementAttr(d,"y"),l=this.parser.getElementAttr(d,"width"),m=this.parser.getElementAttr(d,"height"),b=this.parser.getElementAttr(d,"instance"),ctatdebug("Creating shape: "+b+" at: "+e+","+h+","+l+","+m),l="data:image/png;base64, "+this.parser.getNodeTextValue(d),m=new Image,m.setAttribute("style",
"position: absolute; top: "+h+"px; left:"+e+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),m.setAttribute("id",b),m.setAttribute("src",l),c.appendChild(m));"statictext"==this.parser.getElementName(d)&&(e=this.parser.getElementAttr(d,"x"),h=this.parser.getElementAttr(d,"y"),l=this.parser.getElementAttr(d,"width"),m=this.parser.getElementAttr(d,"height"),b=this.parser.getElementAttr(d,"instance"),ctatdebug("Creating static text: "+b+" at: "+e+","+h+","+l+","+m),l="data:image/png;base64, "+
this.parser.getNodeTextValue(d),m=new Image,m.setAttribute("style","position: absolute; top: "+h+"px; left:"+e+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),m.setAttribute("id",b),m.setAttribute("src",l),c.appendChild(m));"statictext"==this.parser.getElementName(d)&&(b=this.parser.getElementAttr("instance"),ctatdebug("Creating movieclip: "+b),e=this.parser.getElementAttr(d,"x"),h=this.parser.getElementAttr(d,"y"),l=this.parser.getElementAttr(d,"width"),m=this.parser.getElementAttr(d,"height"),
e=new CTATMovieClip(b,e,h,l,m),h=e.wrapComponent(c),ctatdebug("Created movieclip: "+b+" at: "+e.x+","+e.y+","+e.width+","+e.height),movieclips.push(e),d=this.parser.getElementChildren(d),this.createStaticInterface(h,d,e))}};
CTATTutor.runTutor=function(){ctatdebug("runTutor ()");!0===CTATGlobals.tutorRunning?ctatdebug("The tutor is already running"):(null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),window.onerror=function(a,g,f){var c=new CTATHTMLManager;ctatdebug(c.htmlEncode(a)+" in "+g+", line "+f);ctatdebug(c.htmlEncode(a)+" in "+g+", line "+f)},centerTutorContainer(),CTATTutor.initialize(),CTATGlobals.tutorRunning=!0,ctatdebug("runTutor () ... all set"))};var idleTime=0;
CTATTutor.setIdleTimeout=function(){setInterval(CTATTutor.timerIncrement,6E4);$(document).mousemove(function(a){idleTime=0});$(document).keypress(function(a){idleTime=0})};
CTATTutor.timerIncrement=function(){if(!(0>idleTime)){var a=1140,g=CTATConfiguration.get("session_timeout");if(g&&!isNaN(g))a=parseInt(g)+60;else if(!CTATLMS.identifier||0>parseInt(CTATLMS.identifier))a=1E20;idleTime+=60;idleTime>a&&(idleTime=-1,CTATScrim.scrim.OKScrimUp("The tutor timed out due to inactivity, click 'Ok' to reload the page.",function(){window.location.reload()}))}};
CTATTutor.initTutor=function(a,g,f,c){ctatdebug("initTutor() #aFlashVars "+(a?a.length:null)+", usingFlash "+c);if(1==CTATTutor.tutorInitialized)ctatdebug("Tutor already initialized, probably in author mode"),"undefined"!=typeof a&&a.previewMode&&(CTATScrim.scrim.scrimDown(),ctatdebug("In preview mode..."));else{CTATConfiguration.generateDefaultConfigurationObject(a,"undefined"==typeof CTATTarget?void 0:CTATTarget);switch(CTATConfiguration.get("show_debug_traces")){case "true":case "basic":useDebuggingBasic=
!0;break;case "on":case "full":useDebugging=!0;break;case "false":case "off":useDebuggingBasic=useDebugging=!1;break;default:useDebuggingBasic=!0}null==c&&(c=CTATConfiguration.usingFlash());c&&CTATScrim.scrim.scrimDown();CTATCommLibrary.setAuthenticityToken(CTATConfiguration.get("authenticity_token"));g&&(ctatcontainer=g);(a=document.getElementById(ctatcontainer))&&a.classList.add("CTATTutorContainer");a=getSafeElementById("debugtraces");null!==a&&(useDebugging=!0===a.checked?!0:!1);ctatdebug("initTutor() CTATConfiguration.get('mode')="+
CTATConfiguration.get("mode")+", window.sendToTutor="+window.sendToTutor);CTATConfiguration.get("swf_name")&&!window.sendToTutor&&(window.sendToTutor=function(a){ctatdebug("window.sendToTutor("+a+") CTAT.ToolTutor.tutor "+CTAT.ToolTutor.tutor);return CTAT.ToolTutor.tutor?CTAT.ToolTutor.tutor.receiveFromInterface(a):CTAT.ToolTutor.tutorMessages.push(a)},window.registerInterface=function(a){CTAT.ToolTutor.registerInterfaceMessageHandler(a)});"javascript"==String(CTATConfiguration.get("tutoring_service_communication")).toLowerCase()&&
("undefined"!=typeof CTATExampleTracer&&CTATExampleTracer?CTAT.ToolTutor.registerTutor(new CTATExampleTracer):CTATScrim.scrim.warningScrimUp('Tutoring service communication parameter is "JavaScript" but class\nCTATExampleTracer is missing. Use a different ctat-*.js script.'));ctatdebug("initTutor ()");"applet"==CTATConfiguration.get("tutoring_service_communication")&&deployJava.runApplet({id:"TSApplet",width:150,height:10},{jnlp_href:"/ctat_applet/TSApplet.jnlp"},"1.6");c||CTATTutor.runTutor();CTATTutor.setIdleTimeout();
CTATTutor.tutorInitialized=!0}};window.hasOwnProperty("initTutor")||(window.initTutor=CTATTutor.initTutor);function receiveFromTutor(){ctatdebug("receiveFromTutor ()")}function saveAndQuit(){ctatdebug("saveAndQuit ()")}function prepTutorArea(){initTutor()}window.prepTutorArea=prepTutorArea;function assignAnonymousGradingProcessor(a){CTATCommShell.commShell.assignAnonymousGradingProcessor(a)}
function gradeAnonymousComponent(a,g,f){ctatdebug("gradeAnonymousComponent ()");a=new CTATSAI(a,g,f);CTATCommShell.commShell.processComponentAction(a)}function testTutor(a){ctatdebug("testTutor ()");window.onerror=function(a,f,c){var d=new CTATHTMLManager;ctatdebug(d.htmlEncode(a)+" in "+f+", line "+c)};null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet);(new CTATCommLibrary).send("http://augustus.pslc.cs.cmu.edu/crossdomain.xml")}
function centerTutorContainer(){ctatdebug("centerTutorContainer ()");var a=getSafeElementById(ctatcontainer);if(null==a)ctatdebug("Tutor container not found, bump");else{var g;if(flashVars){g=flashVars.getRawFlashVars();var f,c;f=a.offsetWidth;c=a.offsetHeight;g&&g.width&&g.height&&(ctatdebug("We have raw width and height variables in our flashvars: "+g.width+","+g.height),f=g.width,c=g.height);g.centerTutor?1==g.centerTutor&&(ctatdebug("Moving tutor over by: "+("-"+Number(f/2)+"px 0 0 -"+Number(c/
2)+"px;")),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"):ctatdebug("The tutor is not configured to center the container, bump")}else ctatdebug("No flashvars yet, bump")}}
function checkTutorCanvas(){ctatdebug("checkTutorCanvas ()");var a=getSafeElementById(ctatcontainer),g=getSafeElementById("main-canvas"),f=flashVars.getRawFlashVars(),c="550",d="450";a&&(ctatdebug("Recording the actual CSS width and height: "+a.offsetWidth+" , "+a.offsetHeight),c=a.offsetWidth,d=a.offsetHeight);f&&f.width&&f.height&&(ctatdebug("We have tutor size flashvars, using those instead: "+f.width+" , "+f.height),c=f.width,d=f.height);null===g?(ctatdebug("No canvas available, creating ..."),
g=document.createElement("canvas"),g.id="main-canvas",g.innerHTML="Your browser does not support CTAT. Please update or use another browser.",ctatdebug("Setting canvas to: 0,0,"+c+" , "+d),getSafeElementById(ctatcontainer).appendChild(g)):(ctatdebug("Setting canvas to: 0 , 0, "+c+" , "+d),g.style.top="0",g.style.left="0");g.style.width=c+"px";g.style.height=d+"px";return g};(function(a){function g(){var b=arguments[0],a=g.cache;a[b]&&a.hasOwnProperty(b)||(a[b]=g.parse(b));return g.format.call(null,a[b],arguments)}function f(b){return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()}var c=/[^s]/,d=/[def]/,b=/^[^\x25]+/,e=/^\x25{2}/,h=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/,l=/^([a-z_][a-z_\d]*)/i,m=/^\.([a-z_][a-z_\d]*)/i,n=/^\[(\d+)\]/,p=/^[\+\-]/;g.format=function(b,a){var e=1,h=b.length,m,l=[],n,r,v,u,E=!0,
I="";for(n=0;n<h;n++)if(m=f(b[n]),"string"===m)l[l.length]=b[n];else if("array"===m){v=b[n];if(v[2])for(m=a[e],r=0;r<v[2].length;r++){if(!m.hasOwnProperty(v[2][r]))throw Error(g("[sprintf] property '%s' does not exist",v[2][r]));m=m[v[2][r]]}else m=v[1]?a[v[1]]:a[e++];"function"==f(m)&&(m=m());if(c.test(v[8])&&"number"!=f(m)&&isNaN(m))throw new TypeError(g("[sprintf] expecting number but found %s",f(m)));d.test(v[8])&&(E=0<=m);switch(v[8]){case "b":m=m.toString(2);break;case "c":m=String.fromCharCode(m);
break;case "d":m=parseInt(m,10);break;case "e":m=v[7]?m.toExponential(v[7]):m.toExponential();break;case "f":m=v[7]?parseFloat(m).toFixed(v[7]):parseFloat(m);break;case "o":m=m.toString(8);break;case "s":m=(m=String(m))&&v[7]?m.substring(0,v[7]):m;break;case "u":m>>>=0;break;case "x":m=m.toString(16);break;case "X":m=m.toString(16).toUpperCase()}if(!E||d.test(v[8])&&v[3])I=E?"+":"-",m=m.toString().replace(p,"");r=v[4]?"0"==v[4]?"0":v[4].charAt(1):" ";u=v[6]-(I+m).length;u=v[6]?Array(u+1).join(r):
"";l[l.length]=v[5]?I+m+u:0==r?I+u+m:u+I+m}return l.join("")};g.cache={};g.parse=function(a){for(var c,d=[],f=0;a;){if(null!==(c=b.exec(a)))d[d.length]=c[0];else if(null!==(c=e.exec(a)))d[d.length]="%";else if(null!==(c=h.exec(a))){if(c[2]){var f=f|1,g=[],p=c[2],r;if(null!==(r=l.exec(p)))for(g[g.length]=r[1];""!==(p=p.substring(r[0].length));)if(null!==(r=m.exec(p)))g[g.length]=r[1];else if(null!==(r=n.exec(p)))g[g.length]=r[1];else throw new SyntaxError("[sprintf] failed to parse named argument key");
else throw new SyntaxError("[sprintf] failed to parse named argument key");c[2]=g}else f|=2;if(3===f)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");d[d.length]=c}else throw new SyntaxError("[sprintf] unexpected placeholder");a=a.substring(c[0].length)}return d};var v=function(b,a,c){c=(a||[]).slice(0);c.splice(0,0,b);return g.apply(null,c)};"undefined"!==typeof exports?(exports.sprintf=g,exports.vsprintf=v):(a.sprintf=g,a.vsprintf=v,"function"===typeof define&&
define.amd&&define(function(){return{sprintf:g,vsprintf:v}}))})("undefined"===typeof window?this:window);var CTATNoolsTracerUtil=function(){var a={},g=/^(?:[a-z]+:\/)?\//i;this.setTypes=function(f,c){console.log("setTypes()");c.forEach(function(c){a[c]=f.getDefined(c);a[c]?console.log("set type "+c):console.log("couldn't get "+c)})};this.getFactType=function(f){var c=typeof f;if("object"===c)if(c=null,f instanceof Array)c="Array";else if(f instanceof RegExp)c="RegExp";else if(f instanceof Date)c="Date";else for(t in a)if(a.hasOwnProperty(t)&&a[t]===f.constructor){c=t;break}return c};this.getTypeConstructor=
function(f){return a[f]};this.relativeToAbsolute=function(a,c){if(this.isAbsoluteURL(a))return a;c=c||window.location.origin+window.location.pathname;var d=c.split("/"),b=a.split("/");d.pop();for(var e=0;e<b.length;e++)"."!=b[e]&&(".."==b[e]?d.pop():d.push(b[e]));return d.join("/")};this.isAbsoluteURL=function(a){return g.test(a)};this.buildStartStateMsg=function(){var a=0,c=new CTATTutoringServiceMessageBuilder;return function(d){return c.createInterfaceActionMessage(a++,new CTATSAI(d.selection,
d.action,d.input))}}();this.buildStateGraphMsg=function(a){var c="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>",d;for(d in a)a.hasOwnProperty(d)&&(c+="<"+d+">"+a[d]+"</"+d+">");return c+"</properties></message>"};this.printAgenda=function(a){return JSON.stringify(a.getAgenda())};this.printConflictTree=function(a,c){return a.getConflictTree().toString(c)};this.printFact=function(a,c,d){var b=a.getFact(c),e="";if(b){d&&(e="id: "+c+", ");var e=e+("type: "+a.getFactType(b.object)+
", "),f;try{f="values: "+JSON.stringify(b.object)}catch(l){f="< Error converting fact to JSON >"}e+=f}else e="no fact found with ID "+c;return e};this.getFacts=function(a,c){var d=[];if(Array.isArray(c)){for(var b=$jscomp.makeIterator(c),e=b.next();!e.done;e=b.next())type=e.value,d=d.concat(this.getFacts(a,type));return d}if(Number.isInteger(c))return this.getFact(a,c);d=a.getFacts(c,!0);c||(d=d.filter(function(b){b=a.getFactType(b.object);return!("hint"===b||"tpa"===b||"customfield"===b||"skill"===
b)}));return d.map(function(b){return b.object})};this.getFact=function(a,c){var d=null,b;"number"===typeof c?(d=a.getFact(c))&&(d=d.object):c&&"string"!==typeof c||(b=this.getFacts(a,c))&&(d=b[0]);return d};this.printFacts=function(a,c){var d=c,b="";if(Array.isArray(d)){for(var d=$jscomp.makeIterator(d),e=d.next();!e.done;e=d.next())c=e.value,b+=Number.isInteger(c)?this.printFact(a,c,!0):this.printFacts(a,c),b+="\n";return b}if(Number.isInteger(c))return this.printFact(a,c);d=a.getFacts(c,!0);c||
(d=d.filter(function(b){b=a.getFactType(b.object);return!("hint"===b||"tpa"===b||"customfield"===b||"skill"===b)}));b="got "+d.length+(c?" "+c:"")+" fact(s):\n";d.forEach(function(e){b+="id: "+e.id+", "+(c?"":"type: "+a.getFactType(e.object)+", ");var d;try{d="values: "+JSON.stringify(e.object)+"\n"}catch(m){d="< Error converting fact to JSON >\n"}b+=d});return b};this.printRules=function(a,c){var d=a.getRuleNames();c&&(d=d.filter(function(b){return b.toLowerCase().includes(c)}));return d.join(", ")};
this.printCtNodeMatch=function(a,c){var d=a.getNodeMatcherResult(c),b,e;d&&"no match"!==d?(b=d.student,e=d.tutor,d="rule: "+d.rule+"\nstudent: "+b.selection+", "+b.action+", "+b.input+"\ntutor:   "+e.selection+", "+e.action+", "+e.input+"\nresult: "+(d.isMatch?"match":"no match")):d="no match"===d?"No match found at node "+c:"No conflict tree node found for ID "+c;return d};this.printRuleNodes=function(){function a(a){var b={};a.facts.forEach(function(c,d){var e;for(d=0;!e&&d<a.aliases.length;d++)a.factHash[a.aliases[d]]===
c.object&&(e=a.aliases[d]);e?b[e]=c:console.warn("no alias found for "+JSON.stringify(c))});return b}function c(c,b){var e={},d="NotNode"===b.nodeType||"FromNotNode"===b.nodeType;switch(b.nodeType){case "BetaNode":case "NotNode":case "ExistsNode":var f=b.rightMemory,g,n=[],p;for(p in f)g=f[p].data.match,n.push(a(g));e.factBindings=n;break;case "JoinNode":var n=b.leftMemory,v,r=[];for(f in n)for(g in v=n[f].data.rightMatches,v)p=v[g].match,r.push(a(p));e.factBindings=r;break;case "FromNode":case "FromNotNode":f=
b.fromMemory;r=[];for(n in f)for(v in g=f[n],g)p=g[v][1],p.match&&r.push(a(p.match));e.factBindings=r;break;default:e.factBindings=[]}e.isMatch=e.factBindings.length&&!d||!e.factBindings.length&&d;return e}return function(a,b){var e=!0,d=a.getRuleData(b),f="";if(d){var g=d.memoryNodes,d=[].concat(d.patterns),n={},p=null,v,r,u,w=/("([^"]*)"):/g;try{for(var B=0;B<d.length;B++){var f=f+(p?"\n\t":'\npattern: "'),y=d[B];y.disjuncts&&(f+="or (\n\t",p=B-1+y.disjuncts.length,d.splice.apply(d,[].concat([B,
1],$jscomp.arrayFromIterable(y.disjuncts))),y=d[B]);f+=y.string+(p?"":'"');v=y.alias;n[v]||(n[v]=0);r=c(y,g[v][n[v]++]);r.isMatch||(f+=" NOT");f+=" MATCHED";(u=r.factBindings).length&&(f+=" - Possible bindings: ",u.forEach(function(b,a){for(var c in b)if("__i__"!==c){for(var e=JSON.stringify(b[c].object),d;d=w.exec(e);)e=e.replace(d[1],d[2]);f+="\n\t"+(p?"\t":"")+c+": "+e+" (fact ID "+b[c].id+")"}f+="\n"}));B===p&&(f+='\n)"',p=null);if(!r.isMatch){e=!1;break}}return f+"\nRule "+(e?"":"not ")+"matched"}catch(z){throw console.log("got here: "+
f),z;}}else return"Rule "+b+" not found"}}();this.printBreakpoints=function(a){return"breakpoints set for rules: "+a.getBreakpoints().join(", ")}};var CTATNoolsTracerWrapper=function(a){this.printAgenda=function(){a.printAgenda("override")};this.printConflictTree=function(g,f){a.printConflictTree("override",g,f)};this.printPregenTrees=function(g,f){a.printPregenTrees("override",g,f)};this.printTutorSAIs=function(){a.printTutorSAIs("override")};this.printFact=function(g){a.printFact(g)};this.getFact=function(g){return a.getFact(g)};this.printFacts=function(g){a.printFacts(g)};this.getFacts=function(g){return a.getFacts(g)};this.printRules=function(g){a.printRules(g)};
this.printMatch=function(g){a.printCtNodeMatch(g)};this.printRuleNodes=function(g){a.printRuleNodes(g)};this.setStepperMode=function(g){a.setInStepMode(g)};this.takeSteps=function(g,f){a.takeSteps(g,f)};this.setBreakpoint=function(g,f){a.setBreakpoint(g,f)};this.printBreakpoints=function(){a.printBreakpoints()};this.resume=function(){a.resume()};this.getProblemStateStatus=function(){return a.getProblemStateStatus()}};var CTATNoolsTracer=function(a,g,f){var c,d,b,e;function h(b){va=[];N.setDoBacktracking(!1);K("debug","starting initial match");wa=function(){K("debug","done initial match");ka=la=!0;N.setPruneOldActivations(Y.prune_old_activations);N.setDoBacktracking(Y.use_backtracking);N.setSearchAllPermutations(Y.search_all_permutations);fa=!0;"function"===typeof b&&b()};q()}function l(){K("debug","start conflict tree pregeneration...");ia=!0;da=[];var b=0;0===ma.length&&ma.push({selection:"not_specified",action:"not_specified",
input:"not_specified"});var a=function(){++b>=ma.length?c():m(ma[b],a)},c=function(){K("debug","done conflict tree pregeneration");ia=!1;xa();xa=function(){}};Y.use_hint_fact?(b--,m(null,a,!0)):m(ma[b],a)}function m(b,a,c){N.prepForMatch();G();var e;e=c?z():y(b,!0);q(null,function(){N.retract(e);ka=!0;var d=N.getConflictTree();c?da.__hintTree=[X,d]:da.push([b,X,d]);a()})}function n(b,a,c){var e=null,d=null,f=null;if("untutored_action"===c)return y(b,!1),l(),!0;"hint"===c&&da.__hintTree&&(d=A(!0,b.selection,
da.__hintTree[0]));if(!d)for(var g=0;g<da.length;g++){var h=da[g][0],m=da[g][1],n=m.firstPredictedSolution,m=m.selectionMap;!f&&("hint"!==c||0<n.hints.length)&&(f=n);if(I(b,h).isMatch){!d&&("hint"!==c||0<n.hints.length)&&(d=n);for(var p in m){if(m.hasOwnProperty(p))for(h=m[p],n=0;n<h.length;n++){var r=h[n];if("tutored_action"===c){if(I(b,r.sai,r.saiComparator).isMatch){e=r;break}}else!d&&0<r.hints.length&&(d=r)}if(e||"hint"===c&&d)break}}}if(e)K("debug","Matched w/ pregen tree, refiring chain: "+
e.activationIds.join(" , ")),ra=e,ma=[],N.prepForMatch(),G(),y(b,!0),q(null,function(){K("debug","done refiring activations, returning result");var b=ra.sai.isCorrect?"correct":"bug";1===e.halted&&(e.halted=2);la="correct"===b;ka=!0;ra=ba=null;a(b,e);l()},e.activationIds);else return d||(f||(f=new ua),d=f),"tutored_action"===c?(K("debug","didn't get a match :( "),a("no_model",d)):a(d),!0}function p(b,a){"string"===typeof b&&(c[c.length-1].successOrBugMsg={message:b,priority:a||0})}function v(b){var a=
c[c.length-1].sai;b.selection&&(a.selection=b.selection);b.action&&(a.action=b.action);b.input&&(a.input=b.input)}function r(b,a,c,e,d,f,g){K("debug","handleImports for "+a);c=c||{};d=d||{count:0,chunks:[]};f=f||0;g=g||0;for(var h=/\bimport\s?\(('|")?([^()'"\s]*)\1?\);/g,m,l=[];null!=(m=h.exec(b));){var n=Z.relativeToAbsolute(m[2],a);c[n]?K("debug","skipping duplicate import: "+n):(l.push(n),c[n]=!0);b=b.replace(m[0],"");h.lastIndex-=m[0].length}d.chunks[f]||(d.chunks[f]=[]);d.chunks[f][g]=b;d.count+=
l.length;K("debug",a+" is importing "+l.length+" files");if(0<l.length)for(b={i:0};b.i<l.length;b={url$11:b.url$11,i:b.i},b.i++)b.url$11=l[b.i],$.ajax(b.url$11,{dataType:"text",success:function(b){return function(a){r(a,b.url$11,c,e,d,f+1,b.i);d.count--;0==d.count&&e(u(d.chunks))}}(b),error:function(b,a,c){K("error","Error in _handleImports() : ");K("error",a)}});else 0==f&&e(u(d.chunks))}function u(b){for(var a="",c;0<b.length;)for(c=b.pop();0<c.length;)a+=c.shift()+"\n";return a}function w(b,a){var c=
{getRuntime:function(){return Da},getStudentInput:function(){return ca.getLastStudentSAI()},getStudentSAIs:function(){return ca.getStudentSAIs()},checkSAI:E,setTutorSAI:v,setSuccessOrBugMsg:p,setProblemAttribute:x,getInitialized:function(){return ca.getInitialized()},backtrack:function(){N.setAboutToBacktrack()},assert:J,modify:O,retract:S,undoAll:D,addPregenSAI:P,halt:L};[CTATAlgebraParser,CTATLogicParser,CTATChemParser,CTATFormulaParser].forEach(function(b){var a=new b;b={};for(var e in a)b.f=e,
"function"===typeof a[b.f]&&(c[b.f]=function(b){return function(){return a[b.f].apply(a,arguments)}}(b)),b={f:b.f}});try{oa=nools.compile(b,{name:a||"CTATFlow",scope:c})}catch(Ha){return K("error","Error compiling rule file"),fa=!1,Ha}B();return!0}function B(){var b,a;b=oa.__scope;var c={};oa.__rules.forEach(function(b){c[b.name]=!0});if(b&&b.skill_definitions)if(b=b.skill_definitions,b instanceof Array)b.forEach(function(b){a=b.ruleName.split(",");a.forEach(function(a){a=a.trim();if(c[a])ya[a]={name:b.skillName||
b.ruleName,category:b.category,label:b.label||b.skillName,description:b.description||"",mastery:b.mastery||CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,level:b.pKnown||CTATExampleTracerSkill.DEFAULT_P_KNOWN,pGuess:b.pGuess||CTATExampleTracerSkill.DEFAULT_P_GUESS,pLearn:b.pLearn||CTATExampleTracerSkill.DEFAULT_P_LEARN,pSlip:b.pSlip||CTATExampleTracerSkill.DEFAULT_P_SLIP};else throw Error("Rule "+b.ruleName+" named by skill "+b.skillName+" does not exist in model");})});else throw Error("Global variable 'skill_definitions' must be of type Array");
}function y(b,a){K("debug","Assert sai ("+(a?"":"un")+"tutored) : "+JSON.stringify(b));var c=sa[b.selection];if(c&&N.factExists(c))c.input=b.input,c.tutored=a,N.modify(c);else{c=oa.getDefined("StudentValues");if(!c)throw Error("StudentValues type not defined");c=new c(b.selection,b.action,b.input);c.tutored=a;N.assert(c,"_student_input_"+Ea);sa[b.selection]=c;ia||Ea++}return ba=c}function z(){K("debug","Asserting hint fact...");if(!ta){var b=oa.getDefined("IsHintMatch");if(!b)throw Error("IsHintMatch type not defined");
ta=new b}return N.assert(ta,"_isHintMatch")}function q(b,a,c){na=!1;N.match(function(b){ia||(za=N.getConflictTree());if(b)throw K("error","nools encountered an error: "+b),b;a&&"function"===typeof a?a():na&&(qa&&K("override","search complete, returning result"),wa())},b,!1,ka,c);ka=!1}function F(b){var a="no_model",c,e;X.matchChain?(c=X.matchChain,a="correct"):(X.bugMatchChain&&(c=X.bugMatchChain,a="bug",e=c.msg),c=A(!1),e&&(c.msg=e));la="correct"===a;c.tpas=Aa;ka=!0;ba=null;b(a,c)}function C(b,a,
c){c=A(!0,c);a&&(la=Ba=!1,ka=!0,ba=null,Y.use_hint_fact&&N.retract(ta));b(c)}function A(b,a,c){var e;c=c||X;var d=c.selectionMap;a=a||(ba?ba.selection:"");var f=c.firstPredictedSolution,g=c.firstTutorSelection,h=function(a){a=d[a];for(var c=0;c<a.length;c++)if(a[c].sai.isCorrect&&(!b||0<a[c].hints.length))return a[c];return null};"hint"!==a&&d[a]&&(e=h(a));if(!e){f&&(e=b?h(g):f);for(s in d){if(e)break;e=h(s)}if(!e)for(c=c.numChains,a=0;a<c&&(!(f=d["_default_key"+a])||!(e=f[0])||b&&!(0<e.hints.length));a++);
e||(e=new ua)}return e}function E(a,e,d){var f=!1,g=a.selection,h=a.action,m=a.input,l=c,l=l[l.length-1],n="not_specified"===g||"not_specified"===h||"not_specified"===m;K("sai_check","check SAI against: "+JSON.stringify(a));if(Y.pregen_conflict_tree)return K("sai_check","in pregen mode, skipping check  (was "+(d?"":"not")+" a buggy step)"),l.sai={selection:g,action:h,input:m,isCorrect:!d&&!n},l.comparator=e,ra&&(K("sai_check","currently re-firing; updating sai in matched chain..."),ra.sai=l.sai),
!0;if(!ba)return K("sai_check","no student input to check, returning false"),!1;K("sai_check","student input: "+JSON.stringify(ba));l.sai={selection:null!==g&&void 0!==g&&"not_specified"!==g&&"don't_care"!==g?g:"",action:null!==h&&void 0!==h&&"not_specified"!==h&&"don't_care"!==h?h:"",input:null!==m&&void 0!==m&&"not_specified"!==m&&"don't_care"!==m?m:"",isCorrect:!d&&!n};Ba?K("sai_check","Skipping check, we're hint matching"):(f=I(ba,a,e),K("sai_check",(f.isMatch?"Match":"No match")+", "+(d?"was":
"was not")+" a buggy step"),b=f.isMatch?d?"buggy":"match":null,N.setNodeMatcherResult(f));return f.isMatch}function I(b,a,c){var e=a.selection,d=a.action,f=a.input,g=b.selection,h=b.action,m=b.input,l=["-","-","-"],n={student:b,tutor:a,isMatch:!1,matchedFields:null},m=isNaN(m)?m:parseInt(m,10),f=isNaN(f)?f:parseInt(f,10),p=function(b,a,c){return"don't_care"===b?"*":"not_specified"===b?" ":b===a?c:"-"};l[0]=p(e.toLowerCase(),g.toLowerCase(),"S");l[1]=p(d.toLowerCase(),h.toLowerCase(),"A");l[2]=p(f,
m,"I");n.matchedFields=l;if(c&&"function"===typeof c)n.isMatch=c(b,a);else for(n.isMatch=!0,b=0;3>b;b++)if("-"===l[b]){n.isMatch=!1;break}return n}function G(){X=new ga;c=[];d=[];b=null;na=e=!1}function x(b,a){K("debug","setProblemAttribute ("+b+", "+a+")");Y[b]=a}function H(){for(var a=c,d=X.selectionMap,f,g,h={message:"",priority:Number.NEGATIVE_INFINITY},m,l=[],n=[],p=[],r=[],v=[],u,q={selection:"",action:"",input:""},w=null,z={},B=e?ia?1:2:0,A=0;A<a.length;A++)f=a[A],g=f.sai,n.push(f.ruleName),
(m=ya[f.ruleName])&&p.push(m.name+" "+m.category),p=p.concat(f.skills),r=r.concat(f.hints),v=v.concat(f.tpas),l.push(f.activationId),f.successOrBugMsg&&f.successOrBugMsg.priority>h.priority&&(h=f.successOrBugMsg),g&&(g.selection&&(u=q.selection=g.selection),g.action&&(q.action=g.action),g.input&&(q.input=g.input),q.isCorrect=g.isCorrect,f.comparator&&"function"===typeof f.comparator&&(w=f.comparator)),f.customFields.forEach(function(b){return z[b.name]=b.value});r.sort(function(b,a){var c=a.precedence-
b.precedence;0===c&&(c=b.pos-a.pos);return c});u?X.firstTutorSelection||(X.firstTutorSelection=u):u="_default_key"+X.numChains;d[u]||(d[u]=[]);a=new ua(q,n,p,r,h,z,l,w,v,B);q.isCorrect&&!X.firstPredictedSolution&&(X.firstPredictedSolution=a);d[u].push(a);switch(b){case "buggy":X.bugMatchChain=a;break;case "match":X.matchChain=a}X.numChains++;Aa=v;K("debug","stored last chain: \n\trules: "+n+"\n\tskills: "+p+"\n\tfinalSAI: "+JSON.stringify(q)+"\n\tmatchType: "+b)}function J(b){Y.use_backtracking&&
N.pushUndo("assert",b);return N.assert(b)}function S(b){Y.use_backtracking&&N.pushUndo("retract",b);return N.retract(b)}function O(b,a,c){if(Y.use_backtracking)N.pushUndo("modify",b,a);else if(3>arguments.length)return N.modify.apply(N,arguments);b[a]=c;return N.modify(b)}function L(){e=!0;ia?N.setAboutToBacktrack():(N.halt(!0),na=!0)}function D(){N.undoAll(!0)}function P(){if(!ia)for(var b=0;b<arguments.length;b++){var a=arguments[b];!a.selection&&(a.selection="not_specified");!a.action&&(a.action=
"not_specified");!a.input&&(a.input="not_specified");ma.push(a)}}function T(){H()}function Q(b){Ca||d.pop();Ca=!1;Aa=[];K("backtrack","backtracking, initiated by "+(b?"model":"engine"))}function R(b,a,e,d){var f;try{f=JSON.stringify(b)}catch(Ia){f="< Error converting fact to JSON >"}K("assert",a+" fact asserted with ID "+d+": "+f);e=c[c.length-1];switch(a){case "tpa":K("tpa","TPA asserted: "+JSON.stringify(b));fa?Y.use_backtracking?e.tpas.push(b):Ga(b):va.push(Z.buildStartStateMsg(b));break;case "hint":fa&&
(b.pos=+(c.length+"."+e.hints.length),e.hints.push(b));break;case "skill":fa&&e.skills.push(b.name+" "+b.category);break;case "customfield":fa&&e.customFields.push(b)}}function U(b,a,c,e){K("modify",a+" fact modified with ID "+e)}function M(b,a,c,e){K("retract",a+" fact retracted with ID "+e)}function V(a){K("state_save","Hit branch point, agenda: "+JSON.stringify(a.agenda)+", factIdCntr: "+a.state.factIdCounter);d.push({numLinks:c.length,matchType:b})}function W(a){K("state_restore","State restored, agenda: "+
JSON.stringify(a.agenda)+", factIdCntr: "+a.state.factIdCounter);a=d;a=a[a.length-1];links=c;links.splice(a.numLinks);b=a.matchType}function aa(b,a,e){K("fire","Firing activation: "+e);c.push(new Fa(b,e));Ca=!0}function ja(b,a,c){K("agenda_insert",b+" added to agenda, is "+(a?" ":"not ")+"new, was "+(c?" ":"not ")+"skipped")}function ha(b){K("agenda_retract",b+" removed from agenda")}function ea(){K("agenda_empty","No more activations in agenda, all branches have been explored");na=!0}function pa(b){K("override",
"hit breakpoint on rule "+b+" (call resume() to resume matching)")}var ga=function(){this.firstTutorSelection=null;this.selectionMap={};this.bugMatchChain=this.matchChain=null;this.numChains=0;this.firstPredictedSolution=null},ua=function(b,a,c,e,d,f,g,h,m,l){this.sai=b||{selection:"",action:"",input:""};this.rules=a||[];this.skills=c||[];this.hints=e||[];this.msg=d?d.message:"";this.customFields=f||{};this.activationIds=g||[];this.saiComparator=h||null;this.tpas=m||[];this.halted=l},Fa=function(b,
a){this.ruleName=b;this.activationId=a;this.hints=[];this.tpas=[];this.skills=[];this.customFields=[]},K=a,Ga=g,Da=f,ca=this,fa=!1,oa=null,N=null,sa={},X=new ga,ba=null,Ea=0;c=[];d=[];b=null;var Ca=e=!1,Z=null,va=[],Y={use_backtracking:!1,prune_old_activations:!1,use_hint_fact:!1,search_all_permutations:!0,hint_out_of_order:!1,substitute_input:!1},la=!0,Ba=!1,ta=null,ya={},Aa=[],qa=!1,ka=!0,wa=function(){},na=!1,ma=[],ia=!1,xa=function(){},da=[],ra=null,za=null;this.getSession=function(){return N};
this.getInitialized=function(){return fa};this.getSkills=function(){return ya};this.getProblemAttribute=function(b){return Y[b]};this.getProblemStateStatus=function(){return Da.getOutputStatus()};this.init=function(b,a,c){K("debug","noolstracer init w/ source file: "+b);if(nools){Z=new CTATNoolsTracerUtil;var e=Z.relativeToAbsolute(b);$.ajax(b,{dataType:"text",success:function(d){r(d,e,null,function(e){K("debug","compiling model...");!0!==(e=w(e,b))?(K("error","CTATNoolsTracer: Error compiling model"),
c(e)):(K("debug","done compile"),ca.createSession()||c("CTATNoolsTracer: Error creating session"),registerTracerWrapper(new CTATNoolsTracerWrapper(ca)),h(function(){K("override","tracer initialized, log flags: ");getTracerLogFlags();printBreakpoints();a(va,Y);var b=new Event("noolsModelLoaded");window.dispatchEvent(b);Y.pregen_conflict_tree&&l()}))})},error:function(b,a,e){ctatdebug("Error retrieving rule file: ");ctatdebug(a);c(a)}})}else K("error","Error: nools is not defined"),c("nools is not defined")};
this.createSession=function(){K("debug","creating session...");(N=oa.getSession({iAmEventListeners:!0,assert:R,retract:M,modify:U,state_save:V,state_restore:W,backtrack:Q,fire:aa,agenda_insert:ja,agenda_retract:ha,agenda_empty:ea,endOfChain:T,breakpoint:pa}))&&K("debug","session created");return!!N};this.evaluate=function(b,a,c){K("debug","noolsTracer.evaluate, matchType = "+c+", sai "+JSON.stringify(b)+", "+la);if(Y.pregen_conflict_tree)return n(b,a,c);var e=F.bind(ca,a);N.prepForMatch();switch(c){case "hint":if(la||
Y.use_hint_fact)Ba=!0,e=C.bind(ca,a,!0),Y.use_hint_fact&&z();else return K("debug","re-using hints from last match"),C(a,!1,b.selection),!0;case "tutored_action":G();y(b,!0);wa=function(){N.prepForMatch();N.restoreAgenda();ca.printAgenda("agenda_post");ca.printConflictTree("conflict_tree");e()};qa||(ca.printAgenda("agenda_pre"),q());break;case "untutored_action":return y(b,!1),!0}return!1};this.setListener=function(b,a){N&&N.on(b,a)};this.getStudentSAIs=function(){return sa};this.getLastStudentSAI=
function(){return ba};this.getTutorSAIs=function(){return X.selectionMap};this.reset=function(b){ca.createSession();fa=!1;sa={};X=new ga;ba=null;la=!0;h(b)};this.printAgenda=function(b){K(b,("override"!==b?"["+b+"]: ":"")+Z.printAgenda(N))};this.printConflictTree=function(b,a,c){K(b,"\n"+za.toString(a,c))};this.printPregenTrees=function(b,a,c){da.__hintTree&&K(b," hint tree: \n"+da.__hintTree[1].toString(a,c));da.forEach(function(e){K(b," tree for sai: "+JSON.stringify(e[0])+"\n"+e[2].toString(a,
c))})};this.printTutorSAIs=function(b){var a="";za.getMatchChains().forEach(function(b){var c=b.match.tutor;a+="\n"+c.selection+" ; "+c.action+" ; "+c.input+" \n "+b.rules.join(",")+"\n"});K(b,a)};this.printFact=function(b){K("override",Z.printFact(N,b))};this.printFacts=function(b){K("override",Z.printFacts(N,b))};this.printRules=function(b){K("override",Z.printRules(N,b))};this.getFact=function(b){return Z.getFact(N,b)};this.getFacts=function(b){return Z.getFacts(N,b)};this.printCtNodeMatch=function(b){K("override",
Z.printCtNodeMatch(N,b))};this.printRuleNodes=function(b){K("override",Z.printRuleNodes(N,b))};this.printBreakpoints=function(){K("override",Z.printBreakpoints(N))};this.setInStepMode=function(b){b=b&&"false"!==b;K("override","Stepper mode "+(b?"on":"off"));!qa||b||na||q();qa=b};this.takeSteps=function(b){qa?ba?(b=b||1,K("override","taking "+b+" steps"),q(b)):K("override","no new student input, ignoring"):K("override","not in step mode, ignoring")};this.setBreakpoint=function(b,a){b?(a=a||"first",
N.setBreakpoint(b,a)?K("override","breakpoint "+("none"===a?"cleared":"set")+" for rule "+b):K("override","breakpoint not "+("none"===a?"cleared":"set")+" -- rule "+b+" doesn't exist")):K("override","need a rule name to break on")};this.resume=function(){qa?K("override","can't resume; engine is in stepper mode"):na?K("override","not at a breakpoint, ignoring"):q()};this.getIAmPregenerating=function(){return ia};this.setDonePregenCallback=function(b){K("debug","setDonePregenCallback()");xa=b}};var CTATLogger=function(a){var g={},f=0;a&&a.forEach(function(a){g[a]=!1});this.isSet=function(a){return!!g[a]};this.set=function(c){if(a&&!(c in g))return!1;f++;return g[c]=!0};this.unset=function(c){if(a&&!(c in g))return!1;f--;return!(g[c]=!1)};this.getFlags=function(){return g};this.getNFlagsSet=function(){return f};this.log=function(a,d){(g[a]||"override"===a)&&console.log(("override"!==a?"["+a+"]: ":"")+d)}};var CTATRuleTracerGlobals={},NOOLS_LOG_FLAGS="conflict_tree assert modify retract state_save state_restore backtrack agenda_insert agenda_retract agenda_empty fire error debug sai_check agenda_pre agenda_post tpa".split(" "),CTATNoolsTracerLogger=new CTATLogger(NOOLS_LOG_FLAGS),globalTracerRef=null;function registerTracerWrapper(a){globalTracerRef=a}function setTracerLogFlag(a){a=CTATNoolsTracerLogger.set(a)?"set flag "+a:"Error - invalid flag: "+a;CTATNoolsTracerLogger.log("override",a)}
function setTracerLogFlags(a){var g=[],f=[];(a instanceof Array?a:Array.prototype.slice.call(arguments)).forEach(function(a){CTATNoolsTracerLogger.set(a)?g.push(a):f.push(a)});g.length&&CTATNoolsTracerLogger.log("override","set flags: "+g.join(","));f.length&&CTATNoolsTracerLogger.log("override","Error - invalid flag(s): "+f.join(","))}
function getTracerLogFlags(){var a=CTATNoolsTracerLogger.getFlags(),g=[],f=[],c;for(c in a)a[c]?g.push(c):f.push(c);CTATNoolsTracerLogger.log("override","set: "+g.join(",")+"\nunset: "+f.join(","))}function unsetTracerLogFlag(a){CTATNoolsTracerLogger.unset(a)}function unsetTracerLogFlags(a){(a instanceof Array?a:Array.prototype.slice.call(arguments)).forEach(function(a){unsetTracerLogFlag(a)})}function printAgenda(){globalTracerRef.printAgenda()}
function printConflictTree(a,g){globalTracerRef.printConflictTree(a,g)}function printPregenTrees(a,g){globalTracerRef.printPregenTrees(a,g)}function printTutorSAIs(){globalTracerRef.printTutorSAIs()}function printFact(a){globalTracerRef.printFact(a)}function getFact(a){return globalTracerRef.getFact(a)}function printFacts(a){globalTracerRef.printFacts(a)}function getFacts(a){return globalTracerRef.getFacts(a)}function printRules(a){globalTracerRef.printRules(a)}
function printMatch(a){globalTracerRef.printMatch(a)}function whyNot(a){globalTracerRef.printRuleNodes(a)}function setStepperMode(a){globalTracerRef.setStepperMode(a)}function takeSteps(a,g){globalTracerRef.takeSteps(a,g)}function setBreakpoint(a,g){globalTracerRef.setBreakpoint(a,g)}function printBreakpoints(){globalTracerRef.printBreakpoints()}function resume(){globalTracerRef.resume()}function getProblemStateStatus(){return globalTracerRef.getProblemStateStatus()};var CTATRuleTracer=function(a,g){function f(a,e,d,f){var g=f.msg,h=f.sai,n=new CTATSAI(h.selection,h.action,h.input),p=a.getStudentSAI(),r=f.customFields,v=""+h.selection+(h.selection&&h.action?" ":"")+h.action+"";l("debug","ruleTracer.handleResult, result = "+d+"\n\ttutorSAI = "+JSON.stringify(h)+"\n\tmsg = "+g+"\n\tassociated rules = "+f.rules+"\n\tassociated skills = "+f.skills+"\n\tstep ID = "+v+"\n\ttpas = "+f.tpas+"\n\tcustom fields = "+JSON.stringify(r)+"\n\thalted = "+f.halted);0<CTATNoolsTracerLogger.getNFlagsSet()&&
l("override","------ end of trace ------\n");a.setStepID(v);a.setTutorSAI("correct"!==d||m.getProblemAttribute("substitute_input")?n:p);a.setSuccessOrBuggyMsg(g);a.setAssociatedRules(f.rules);a.setAssociatedSkills(f.skills);a.setCustomFields(r);switch(d){case "correct":a.setResult(CTATExampleTracerLink.CORRECT_ACTION);a.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION);break;case "bug":c(a,p,!0);break;case "no_model":c(a,p,!1)}2===f.halted&&f.tpas.forEach(function(a){b(a)});e()}function c(b,a,
c){a.getSelection().includes("done")&&"ButtonPressed"===a.getAction()&&b.setDoneStepFailed(!0);c?(b.setResult(CTATExampleTracerLink.BUGGY_ACTION),b.setTraceOutcome(CTATExampleTracerLink.BUGGY_ACTION)):(b.setResult(CTATExampleTracerLink.NO_MODEL),b.setTraceOutcome(CTATExampleTracerLink.NO_MODEL))}function d(b,a,c){var e=c.hints.map(function(b){return b.msg}),d=c.rules,f=c.skills;c=c.sai;b.getStudentSAI();var g=""+c.selection+(c.selection&&c.action?" ":"")+c.action+"";l("debug","ruleTracer.handleHintResult,\n\ttutorSAI = "+
JSON.stringify(c)+"\n\tassociated rules = "+d+"\n\tassociated skills = "+f+"\n\tstep ID = "+g+"\n\thints = "+JSON.stringify(e));b.setTutorSAI(new CTATSAI(c.selection,c.action,c.input));b.setResult(CTATExampleTracerLink.HINT_ACTION);b.setTraceOutcome(e.length?CTATExampleTracerLink.HINT_ACTION:CTATExampleTracerLink.NO_MODEL);b.setReportableHints(e);b.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR);b.setStepID(g);b.setAssociatedSkills(f);b.setAssociatedRules(d);a(b,b.getTransactionID())}function b(b){h&&
h.addTPAToMessageTank(b.selection,b.action,b.input,"tutor-performed")}function e(b){return{selection:b.getSelection()||"",action:b.getAction()||"",input:b.getInput()||""}}var h=g,l=CTATNoolsTracerLogger.log,m=null,n=null,p=this;this.getEngine=function(){return m};this.initEngine=function(c,e,d){switch(a){case "nools":m=new CTATNoolsTracer(l,b,h)}var f=function(b,a){console.log("CTATRuleTracer.doneInit");var c=m.getSkills();if(!CTATConfiguration.get("skills"))if(CTATSkillSet.skills){l("debug","skills not defined in flashVars, using model definitions");
var d=[];for(skillName in c){var f=c[skillName];CTATSkillSet.skills.addSkillAsObject(f);d.push(new CTATExampleTracerSkill(f.category,f.name,f.pGuess,f.level,f.pSlip,f.pLearn,null))}h.getProblemSummary().setSkills(new CTATSkills(d));CTATCommShell.commShell.updateSkillWindow(null)}else l("debug","CTATSkillSet.skills not defined, skipping initSkills");e(b,a)};m&&m.init(c,f,d)};this.getModelInitialized=function(){return m&&m.getInitialized()};this.getProblemStateStatus=function(){return h.getOutputStatus()};
this.setListener=function(b,a){m.setListener(b,a)};this.evaluate=function(b,a){var c=e(b.getStudentSAI()),d=f.bind(p,b,a),c=m.evaluate.bind(m,c,d,"tutored_action");if(m.getIAmPregenerating())m.setDonePregenCallback(c);else return c()};this.doHint=function(b,a,c){b.setTransactionID(a);return m.evaluate(e(b.getStudentSAI()),d.bind(this,b,c),"hint")};this.handleUntutoredAction=function(b){l("debug","ruleTracer.handleUntutoredAction( "+JSON.stringify(b)+" )");m.evaluate({selection:b.selection[0],action:b.action[0],
input:b.input[0]},null,"untutored_action")};this.checkOutOfOrder=function(b,a){var c;m.getProblemAttribute("hint_out_of_order")?(c=e(b.getStudentSAI()),c=!m.getTutorSAIs()[c.selection]):c=!1;a(c)};this.setDefaultBuggyMsg=function(b){b&&"string"===typeof b&&(n=b)};this.getDefaultBuggyMsg=function(){return n};this.reset=function(b){m.reset(b)}};var CTATHintPolicyEnum=function(){};Object.defineProperty(CTATHintPolicyEnum,"HINTS_UNBIASED",{enumerable:!0,configurable:!1,writable:!1,value:"Always Follow Best Path"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_CURRENT_SELECTION_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Current Selection Only"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_PRIOR_ERROR_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Prior Error Only"});
Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_ALL",{enumerable:!0,configurable:!1,writable:!1,value:"Use Both Kinds of Bias"});Object.defineProperty(CTATHintPolicyEnum,"DEFAULT",{enumerable:!0,configurable:!1,writable:!1,value:CTATHintPolicyEnum.HINTS_BIASED_BY_ALL});CTATHintPolicyEnum.prototype=Object.create(Object.prototype);CTATHintPolicyEnum.prototype.constructor=CTATHintPolicyEnum;
CTATHintPolicyEnum.lookup=function(a){for(policy in CTATHintPolicyEnum)if(CTATHintPolicyEnum[policy]==a)return CTATHintPolicyEnum[policy];return CTATHintPolicyEnum.DEFAULT};"undefined"!==typeof module&&(module.exports=CTATHintPolicyEnum);var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(a,g){var f=a.toLowerCase(),c="<"+g.toLowerCase()+">",d=f.indexOf(c)+c.length,f=f.indexOf("</"+g.toLowerCase()+">");if(d<c.length||0>f)return null;c={};c.start=d;c.end=f;return c};
CTATMsgType.makeValues=function(a){if(null==a)return"";if("string"==typeof a)return a;if(a.constructor&&"Array"==a.constructor.name){if(!a.length)return"";for(var g=0,f,c="<value>"+(null==(f=a[g++])?"":f.toString());g<a.length;)c+="</value><value>"+(null==(f=a[g++])?"":f.toString());return c+"</value>"}return a.outerHTML?a.outerHTML:a.toString()};
CTATMsgType.setProperty=function(a,g,f){var c=CTATMsgType.findProperty(a,g),d;c?(d=a.slice(0,c.start),d+=CTATMsgType.makeValues(f),d+=a.slice(c.end,a.length)):(c=a.indexOf("</properties>"),d=a.slice(0,c),d+="<"+g+">"+CTATMsgType.makeValues(f)+"</"+g+">",d+=a.slice(c,a.length));return d};CTATMsgType.getProperty=function(a,g){var f=CTATMsgType.findProperty(a,g);return f?a.slice(f.start,f.end):""};
CTATMsgType.valueToArray=function(a){if(!a.startsWith("<value>"))return null;var g=a.substring(7);if(!a.endsWith("</value>"))return null;g=g.substring(0,g.length-8);g=g.split("</value><value>");ctatdebug("valueToArray("+a+") returns "+g);return g};CTATMsgType.getValue=function(a,g){var f=CTATMsgType.valueToArray(a);return!f||f.length<=g?null:f[g]};CTATMsgType.getMessageType=function(a){return CTATMsgType.getProperty(a,"MessageType")};
CTATMsgType.getTransactionID=function(a){return CTATMsgType.getProperty(a,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(a,g){return CTATMsgType.setProperty(a,CTATMessage.TRANSACTION_ID_TAG,g)};CTATMsgType.isCorrectOrIncorrect=function(a){return"string"==typeof a?CTATMsgType.CorrectTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(a){return"string"==typeof a?CTATMsgType.TextFeedbackTypes[a.toLowerCase()]?!0:!1:!1};
CTATMsgType.isHintResponse=function(a){return"string"==typeof a?CTATMsgType.HintResponseTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.isDoneMessage=function(a){var g=CTATMsgType.getProperty(a,"Selection");a=CTATMsgType.getProperty(a,"Action");if(!g||!a)return!1;g=g.toString().toLowerCase();a=a.toString().toLowerCase();var f=CTATMsgType.DONE.toLowerCase();if(f!=g&&f!=CTATMsgType.getValue(g,0))return!1;g=CTATMsgType.BUTTON_PRESSED.toLowerCase();return g!=a&&g!=CTATMsgType.getValue(a,0)?!1:!0};
CTATMsgType.getSAIArraysFromElement=function(a,g){for(var f={selection:[],action:[],input:[]},c=g.getElementChildren(a),d=0;d<c.length;d++){var b=c[d];switch(g.getElementName(b)){case "Selection":for(var b=g.getElementChildren(b),e=0;e<b.length;e++)f.selection.push(g.getNodeTextValue(b[e]));break;case "Action":b=g.getElementChildren(b);for(e=0;e<b.length;e++)f.action.push(g.getNodeTextValue(b[e]));break;case "Input":b=g.getElementChildren(b);for(e=0;e<b.length;e++)f.input.push(g.getNodeTextValue(b[e]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(b,g)}}return f};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,successmessage:1,buggymessage:1,wrongusermessage:1,nohintmessage:1,highlightmsg:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});
Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});
Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});
Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});Object.defineProperty(CTATMsgType,"TRACE_OUTCOME",{enumerable:!1,configurable:!1,writable:!1,value:"TraceOutcome"});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});
Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});
Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});
Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});
Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});
Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});
Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(a,g){if(null===a||"undefined"===typeof a)return null===g||"undefined"===typeof g?0:-1;if(null===g||"undefined"===typeof g)return 1;var f=0,c=a.split("."),d=g.split("."),b;for(b=0;b<Math.min(c.length,d.length);b++)try{var e=parseInt(c[b]),h=parseInt(d[b]),f=e<h?-1:e>h?1:0;if(0!==f)return f}catch(l){if(f=c[b].toString()<d[b].toString()?-1:c[b].toString()>d[b].toString()?1:0,0!==f)return f}return b<
c.length?1:b<d.length?-1:a.toString()<g.toString()?-1:a.toString()>g.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(a,g,f,c,d,b,e){CTATBase.call(this,"CTATExampleTracerSkill",g);var h=null==a||""==a.trim()?g:g+" "+a,l=Number(f);Number.isNaN(l)&&(l=CTATExampleTracerSkill.DEFAULT_P_GUESS);var m=Number(c);Number.isNaN(m)&&(m=CTATExampleTracerSkill.DEFAULT_P_KNOWN);var n=Number(b);Number.isNaN(n)&&(n=CTATExampleTracerSkill.DEFAULT_P_LEARN);var p=Number(d);Number.isNaN(p)&&(p=CTATExampleTracerSkill.DEFAULT_P_SLIP);var v=/^0*[xX]([0-9a-fA-F]+)$/.test(e)?parseInt(e,16):/^(\-|\+)?[0-9]+$/.test(e)?
parseInt(e,10):CTATExampleTracerSkill.DEFAULT_HISTORY,r=0,u=0,w=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11,B=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,y=null,z=null,q=this;this.getSkillName=function(){return h};this.getCategory=function(){var b=h.indexOf(" ");return 0>b?"":h.substring(b+1)};this.setTransactionNumber=function(b){r=b};this.updatePKnown=function(b){return m=CTATExampleTracerSkill.updatePKnownStatic(b,l,m,p,n)};this.updateHistory=function(b){return v=CTATExampleTracerSkill.updateHistoryStatic(b,
v)};this.changeOpportunityCount=function(b){return u+=b};this.getTransactionNumber=function(){return r};this.getSkillBarString=function(b){var a=this.getSkillName(),a=a+this.getSkillBarDelimiter()+m,a=a+this.getSkillBarDelimiter()+(this.hasReachedMastery()?"1":"0");!0===b&&(a=a+this.getSkillBarDelimiter()+this.getLabel());return a.toString()};this.getSkillBarDelimiter=function(){return w};this.toXML=function(b){var a;a=""+(' name="'+CTATExampleTracerSkill.getName(h)+'"');a+=' category="'+q.getCategory()+
'"';a+=' label="'+q.getLabel()+'"';a+=' description="'+q.getDescription()+'"';a+=' pKnown="'+Number(m).toString()+'"';a+=' pLearn="'+Number(n).toString()+'"';a+=' pGuess="'+Number(l).toString()+'"';a+=' pSlip="'+Number(p).toString()+'"';a+=' history="'+v+'"';a+=' opportunityCount="'+u+'"';return b?"&lt;Skill"+a+" /&gt;":"<Skill"+a+" />"};this.getPKnown=function(){return m};this.getPLearn=function(){return n};this.getPGuess=function(){return l};this.getPSlip=function(){return p};this.getHistory=function(){return v};
this.getOpportunityCount=function(){return u};this.hasReachedMastery=function(){return null===m||"undefined"===typeof m?!1:m>=B};this.getLabel=function(){return!y||1>y.length?CTATExampleTracerSkill.getName(h):y};this.getDescription=function(){return!z||1>z.length?h:z};this.setVersion=function(b){null!==b&&"undefined"!==typeof b&&0<b.length&&(w=CTATExampleTracerSkill.versionToSkillBarDelimiter(b))};this.setLabel=function(b){y=b};this.setDescription=function(b){z=b};CTATExampleTracerSkill.makeStepID=
function(b,a){for(var c="",e=0,d=b;2>e++;d=a)if(!(null===d||"undefined"===typeof d||1>d.length)){for(var f=!1,g=0;g<d.length;g++)if(null!==d[g]&&"undefined"!==typeof d[g]){var h=d[g].toString();1>h.length||d===b&&("hint".toString().toUpperCase()===h.toString().toUpperCase()||"help".toString().toUpperCase()===h.toString().toUpperCase())||d===a&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===h.toString().toUpperCase()||(c=c+(f?",":"[")+h,f=!0)}!0===f&&(c+="]")}return c.toString()};CTATExampleTracerSkill.updateHistoryStatic=
function(b,a){var c,e=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;c=a<<1|(b.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return c&e?c^e:c};CTATExampleTracerSkill.updatePKnownStatic=function(b,a,c,e,d){var f=0;if(b.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())b=+(c*(1-e)),f=+(b/(b+ +(a*(1-c))));else if(b.toString().toUpperCase()===CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||b.toString().toUpperCase()===
CTATExampleTracerSkill.HINT.toString().toUpperCase())b=+(c*e),f=+(b/(b+ +((1-c)*(1-a))));return+(f+d*(1-f))};CTATExampleTracerSkill.getName=function(b){var a=b.indexOf(" ");return 0>a?b:b.substring(0,a)};CTATExampleTracerSkill.versionToSkillBarDelimiter=function(b){return null===b||"undefined"===typeof b?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(b,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10}};
Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});
Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATVariableTableCount=0,CTATVariableTable=function(){function a(c){var d={},b;for(b in c)!0===c.hasOwnProperty(b)&&(d[b]="object"!==typeof c[b]?c[b]:a(c[b]));return d}CTATBase.call(this,"CTATVariableTable","");CTATVariableTableCount++;var g={},f=this;this.toString=function(){var a="",d;for(d in g)0<a.length&&(a+=", "),a=a+d+"="+g[d];return"{ "+a+" }"};this.clone=function(){ctatdebug("CTATVariableTable --\x3e in clone; this "+this+", this.getTable() "+this.getTable);var c=new CTATVariableTable;
ctatdebug("CTATVariableTable --\x3e in clone; copy "+c+", copy.setTable() "+c.setTable);c.setTable(a(g));ctatdebug("CTATVariableTable --\x3e out of clone");return c};this.put=function(a,d){f.ctatdebug("CTATVariableTable.put("+a+", "+d+") typeof value "+typeof d);var b;if(a)if(0>a.indexOf("."))g[a]=d;else{var c=a.split(".");if("object"!==typeof g[c[0]]||null===g[c[0]])g[c[0]]={};b=g[c[0]];for(var h=1;h<c.length-1;h++)if("object"!==typeof b[c[h]]||null===b[c[h]])b[c[h]]={},b=b[c[h]];b[c[h]]=d}else console.log("CTATVariableTable.put() warning: null or empty variable name '"+
a+"'");return f};this.getTable=function(){return g};this.setTable=function(a){g=a};this.get=function(a){if(0>a.indexOf("."))return null===g[a]||"undefined"===typeof g[a]?null:g[a];var c=a.split(".");if(null===g[c[0]]||"undefined"===typeof g[c[0]])return null;a=g[c[0]];for(var b=1;b<c.length-1;b++){if(null===a[c[b]]||"undefined"===typeof a[c[b]])return null;a=a[c[b]]}return null===a[c[b]]||"undefined"===typeof a[c[b]]?null:a[c[b]]}};
Object.defineProperty(CTATVariableTable,"serialVersionUID",{enumerable:!1,configurable:!1,writable:!1,value:"201403071830L"});CTATVariableTable.standardizeType=function(a){if("string"!=typeof a||1>a.trim().length)return a;if((!0).toString()==a)return!0;if((!1).toString()==a)return!1;if("null"==a)return null;var g=Number(a);return isNaN(g)?a:g};CTATVariableTable.valueAsString=function(a){return"string"==typeof a?a:String(a)};CTATVariableTable.nameAsString=function(a){return a?a+"_String":null};
CTATVariableTable.prototype=Object.create(CTATBase.prototype);CTATVariableTable.prototype.constructor=CTATVariableTable;"undefined"!==typeof module&&(module.exports=CTATVariableTable);var CTATMatcher=function(a,g,f){CTATBase.call(this,"CTATMatcher","");this.lastResult=null;var c=new CTATSAI("","",""),d=f,b=CTATMsgType.DEFAULT_ACTOR,e=!1,h=this;this.resetMatcher=function(){};this.MatcherSAItoXML=function(b){return b+"<matcher>\n"+(b+"    <matcherType>Matcher</matcherType>\n")+(b+'    <matcherParameter name="single">null</matcherParameter>\n')+(b+"</matcher>\n")};this.getSelection=function(){return h.getDefaultSelection()};this.getAction=function(){return h.getDefaultAction()};this.getInput=
function(){return h.getDefaultInput()};this.getActor=function(){return b};this.setCaseInsensitive=function(b){d=b};this.getEvaluatedInput=function(b,a){return h.getInput()};this.getTraversalIncrement=function(){return 1};this.getTutorSAI=function(b,a,c){b=String(c).toLowerCase()==CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()?b:h.getDefaultSAI();console.log("CTATMatcher.getTutorSAI() superclass method called, should be subclass;\n  returning: "+b);return b};this.getDefaultSelection=function(){return h.getDefaultSAI().getSelection()};
this.getDefaultAction=function(){return h.getDefaultSAI().getAction()};this.getDefaultInput=function(){return h.getDefaultSAI().getInput()};this.getDefaultSAI=function(){return c};this.setDefaultSAI=function(b){c=b};this.getDefaultActor=function(){switch(String(getActor()).toLowerCase()){case CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_STUDENT_ACTOR;case CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;
case CTATMsgType.ANY_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;default:return console.log("CTATMatcher.getDefaultActor() unexpected value for actor: "+b+"; returning "+CTATMsgType.DEFAULT_ACTOR),CTATMsgType.DEFAULT_ACTOR}};this.getInput=function(){return h.getDefaultInput()};this.getCaseInsensitive=function(){return d};this.match=function(b,a,c,e,d){console.log("CTATMatcher superclass method called: match("+b+", "+a+", "+c+", "+e+")");return!1};this.matchForHint=function(b,a,c,e){console.log("CTATMatcher superclass method called: matchForHint("+
b+", "+a+", "+c+", vt)");return!1};this.matchActor=function(b){b=String(b).toUpperCase();var a=String(h.getActor()).toUpperCase();ctatdebug("CTATMatcher.matchActor("+b+") myActor is "+a);return CTATMsgType.ANY_ACTOR.toString().toUpperCase()==a||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==a&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==b||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==b&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==a?!0:a==b};this.getDefaultSelectionArray=
function(){return h.getDefaultSAI().getSelectionArray()};this.getDefaultActionArray=function(){return h.getDefaultSAI().getActionArray()};this.getDefaultInputArray=function(){return h.getDefaultSAI().getInputArray()};this.getLastResult=function(){return null===h.lastResult||"undefined"===typeof h.lastResult?"":h.lastResult.toString()};this.setActor=function(a){ctatdebug("CTATMatcher --\x3e in setActor("+a+")");if(null===a||"undefined"===typeof a)a=CTATMsgType.DEFAULT_ACTOR;a=String(a).toLowerCase().trim();
b="tool"==a?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_STUDENT_ACTOR:a==CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase()?CTATMsgType.UNGRADED_TOOL_ACTOR:a==CTATMsgType.ANY_ACTOR.toLowerCase()?CTATMsgType.ANY_ACTOR:CTATMsgType.DEFAULT_ACTOR};this.array2ConcatString=function(b){var a="";if(null==b)return a;if(!Array.isArray(b))return b.toString();b.forEach(function(b){null!=
b&&(a+=b.toString()+"\n")});return a.substring(0,0<a.length?a.length-1:0)};this.matchConcatenation=function(b){return h.matchSingle(h.array2ConcatString(b))};this.isLinkTriggered=function(){return e};this.setLinkTriggered=function(b){e=b};this.evaluateReplacement=function(b,a,c){return""};this.replaceInput=function(){return!!h.getReplacementFormula()};this.getReplacementFormula=function(){return""}};
CTATMatcher.prototype.toString=function(){console.log("Error: CTATMatcher.toString() called; should be overridden in subclass");return"This is CTATMatcher."};CTATMatcher.prototype.setParameter=function(a,g,f){};CTATMatcher.isTutorActor=function(a,g){return CTATMsgType.DEFAULT_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||g&&CTATMsgType.ANY_ACTOR.toUpperCase()===a.toUpperCase()?!0:!1};
Object.defineProperty(CTATMatcher,"NON_SINGLE",{enumerable:!1,configurable:!1,writable:!1,value:-1});Object.defineProperty(CTATMatcher,"SELECTION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATMatcher,"ACTION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATMatcher,"INPUT",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATMatcher,"VECTOR",{enumerable:!1,configurable:!1,writable:!1,value:3});
Object.defineProperty(CTATMatcher,"ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Actor"});CTATMatcher.prototype=Object.create(CTATBase.prototype);CTATMatcher.prototype.constructor=CTATMatcher;"undefined"!==typeof module&&(module.exports=CTATMatcher);var CTATAlgebraTreeNode={};
(function(){var a,g=[].slice;a=function(){function a(){}a.operators=[["UNKNOWN"],["CONST"],["VAR"],["EXP","ROOT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];a.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");a.operatorPrecedence=function(a,d){return Math.sign(this.operators.findIndex(function(b){return b.includes(a)})-this.operators.findIndex(function(b){return b.includes(d)}))};a.operatorStrings=
{EXP:["^","**"],ROOT:["|","\u221a"],UPLUS:["+"],UMINUS:["-"],ITIMES:[""],TIMES:["*","\u00d7"],DIVIDE:["/","\u00f7"],IDIVIDE:["//"],REM:["%"],PLUS:["+"],MINUS:["-"],LESS:["<"],LESSEQUAL:["<=","\u2264"],EQUAL:["=","=="],NOTEQUAL:["!=","/=","<>","\u2260"],GREATEREQUAL:[">=","\u2265"],GREATER:[">"]};a.toOperatorString=function(a){return this.operatorStrings[a][0]||""};a.toOperator=function(a,d){var b;return null!=(b=Object.entries(this.operatorStrings).find(function(b){return function(b){return b[1].includes(a)&&
(!["UPLUS","UMINUS"].includes(b[0])||1===d)}}(this)))?b[0]:void 0};a.diff=function(a,d){return a.filter(function(b){return!d.includes(b)})};a.createExpression=function(){var a,d;d=arguments[0];a=2<=arguments.length?g.call(arguments,1):[];try{return function(){switch(d=this.toOperator(d,a.length)||d){case "LESS":case "LESSEQUAL":case "EQUAL":case "NOTEQUAL":case "GREATEREQUAL":case "GREATER":return new CTATRelationNode(d,a[0],a[1]);case "PLUS":case "MINUS":return new CTATAdditionNode(d,a);case "UPLUS":case "UMINUS":return new CTATUnaryNode(d,
a[0]);case "TIMES":case "DIVIDE":return new CTATMultiplicationNode(d,a);case "IDIVIDE":case "REM":return new CTATIntDivisonNode(d,a[0],a[1]);case "EXP":return new CTATPowerNode(d,a[0],a[1]);case "ROOT":return new CTATPowerNode(d,a[0],2)}}.call(this).simpleFlatten()}catch(b){return null}};a.prototype.toString=function(a){var c,b;this.checkParens()&&(a="("+a+")");this.inverted()&&(a="1/"+a);this.negated()&&(a="-"+a);c=0;for(b=this.parens;0<=b?c<b:c>b;0<=b?++c:--c)a="("+a+")";return a};a.prototype.setParens=
function(a,d){null==d&&(d=!1);this.checkParens(a,d)&&(this.parens=1);return this};a.prototype.checkParens=function(c,d){var b;null==d&&(d=!1);null!=c?b=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator:(c=this.negated()?"MINUS":this.inverted()?"DIVIDE":null,b=this.operator);b=a.operatorPrecedence(c,b);return null!=c&&(0>b||0===b&&d)};a.prototype.evaluate=function(a){return this.sign*Math.pow(a,this.exp)};a.prototype.applyOperator=function(a,d){switch(this.operator){case "LESS":return a<
d;case "GREATER":return a>d;case "LESSEQUAL":return a<=d;case "GREATEREQUAL":return a>=d;case "EQUAL":return a===d;case "NOTEQUAL":return a!==d;case "PLUS":return a+d;case "MINUS":return a-d;case "TIMES":case "ITIMES":return a*d;case "DIVIDE":return a/d;case "EXP":return Math.pow(a,d);case "ROOT":return Math.pow(a,1)/d;case "REM":return a%d;case "IDIVIDE":return Math.floor(a/d);case "UPLUS":return a;case "UMINUS":return-a}};a.prototype.equals=function(a){return a&&this.operator===a.operator&&this.sign===
a.sign&&this.exp===a.exp&&this.parens===a.parens};a.prototype.subEquals=function(a,d){return!1};a.prototype.subNode=function(a,d){return this};a.prototype.getOperator=function(a){null==a&&(a=!1);return!a&&this.operator||this.string};a.prototype.getOperands=function(){return[]};a.prototype.findExpression=function(a,d,b){var c,f,g;null==b&&(b=null);return!b&&this.equals(a)?[Object.assign(this,{path:d})]:null!=b&&this.subEquals(a,b)?[Object.assign(this.subNode(b,c=b+(null!=(f=a.terms)?f.length:void 0)),
{path:d.concat([["terms",b,c]])})]:null!=b&&this.subEquals(a,b)?[Object.assign(this.subNode(b,c=b+(null!=(g=a.factors)?g.length:void 0)),{path:d.concat([["factors",b,c]])})]:[]};a.prototype.replaceExpression=function(a,d,b){var c,f,g,m,n;"number"===typeof b&&(b=null!=(c=this.findExpression(a,[])[b])?c.path:void 0);if(0===(null!=b?b.length:void 0))return d;if(null!=(n=null!=b?b.shift():void 0))return c=this.clone(!1),"string"===typeof n?(c[n]=null!=(f=this[n])?f.replaceExpression(a,d,b):void 0,c.simpleFlatten()):
"object"===typeof n&&2===n.length?(c[n[0]]=c[n[0]].slice(0),c[n[0]][n[1]]=null!=(g=this[n[0]])?g[n[1]].replaceExpression(a,d,b):void 0,c.simpleFlatten()):"object"===typeof n&&3===n.length?(c[n[0]]=c[n[0]].slice(0),[].splice.apply(c[n[0]],[m=n[1],n[2]-m].concat(d)),d,c.simpleFlatten()):this};a.prototype.deleteExpression=function(a,d){var b,c,f,g,m;"number"===typeof d&&(d=null!=(b=this.findExpression(a,[])[d])?b.path:void 0);if(0===(null!=d?d.length:void 0))return null;if(null!=(m=null!=d?d.shift():
void 0))return b=this.clone(!1),"string"===typeof m?(b[m]=null!=(c=this[m])?c.deleteExpression(a,d):void 0,b.removeNull()):"object"===typeof m&&2===m.length?(b[m[0]]=b[m[0]].slice(0),b[m[0]][m[1]]=null!=(f=this[m[0]])?f[m[1]].deleteExpression(a,d):void 0,b.removeNull()):"object"===typeof m&&3===m.length?(b[m[0]]=b[m[0]].slice(0),[].splice.apply(b[m[0]],[g=m[1],m[2]-g].concat(null)),null,b.removeNull()):this};a.prototype.simplifyRules=function(a,d){var b,c,f,g,m;this.rules=a;g=this;f=this.rules;b=
0;for(c=f.length;b<c;b++)m=f[b],g=g[m].call(g),g.rules=this.rules;delete g.rules;return g};a.prototype.removeNull=function(){return this};a.prototype.simpleFlatten=function(){return this};a.prototype.flatten=function(){return this};a.prototype.computeConstants=function(){return this};a.prototype.combineSimilar=function(){return this};a.prototype.expand=function(){return this};a.prototype.distribute=function(){return this};a.prototype.removeIdentity=function(){return this};a.prototype.sort=function(){return this};
a.prototype.spreadIdentity=function(){return this};a.prototype.stripIdentity=function(){return this};a.prototype.multiplyOne=function(a){null==a&&(a=!1);return(new CTATMultiplicationNode("TIMES",[new CTATConstantNode(1,a),this])).popNegation().pushNegation()};a.prototype.powerOne=function(a){null==a&&(a=!1);return(new CTATPowerNode("EXP",this,new CTATConstantNode(1,a))).popInversion().pushInversion().popNegation()};a.prototype.compare=function(c,d){return a.operatorPrecedence(this.operator,c.operator)};
a.prototype.compareSigns=function(a,d){return(Math.sign(this.sign-a.sign)||Math.sign(this.exp-a.exp))*d};a.prototype.countVariables=function(){return 0};a.prototype.pushNegation=function(){return this};a.prototype.popNegation=function(){return this};a.prototype.pushInversion=function(){return this};a.prototype.popInversion=function(){return this};a.prototype.negate=function(){this.sign=-this.sign;return this};a.prototype.invert=function(){this.exp=-this.exp;return this};a.prototype.addition=function(){return"PLUS"===
this.operator};a.prototype.subtraction=function(){return"MINUS"===this.operator};a.prototype.multiplication=function(){return"TIMES"===this.operator};a.prototype.division=function(){return"DIVIDE"===this.operator};a.prototype.intDivision=function(){return"IDIVIDE"===this.operator};a.prototype.power=function(){return"EXP"===this.operator};a.prototype.root=function(){return"ROOT"===this.operator};a.prototype.negation=function(){return"UMINUS"===this.operator};a.prototype.unary=function(){var a;return"UPLUS"===
(a=this.operator)||"UMINUS"===a};a.prototype.constant=function(a){return!1};a.prototype.unknown=function(){return!1};a.prototype.integer=function(){return!1};a.prototype.negated=function(){return 0>this.sign};a.prototype.inverted=function(){return 0>this.exp};a.prototype.parented=function(){return 0<this.parens};a.prototype.even=function(){return!1};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATAlgebraTreeNode=a}).call(this);var CTATRelationNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f,g){this.operator=b;this.left=a;this.right=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.left.clone():this.left,b?this.right.clone():this.right,this.parens,
this.sign,this.exp)};c.prototype.toString=function(){this.left.setParens(this.operator);this.right.setParens(this.operator);return c.__super__.toString.call(this,""+this.left.toString()+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.right.toString())};c.prototype.evaluate=function(){return this.applyOperator(this.left.evaluate(),this.right.evaluate())};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.left.equals(b.left)&&this.right.equals(b.right)};c.prototype.getOperands=
function(){return[this.left,this.right]};c.prototype.findExpression=function(b,a){return this.left.findExpression(b,a.concat(["left"])).concat(c.__super__.findExpression.call(this,b,a),this.right.findExpression(b,a.concat(["right"])))};c.prototype.removeNull=function(){var b,a;this.left=null!=(b=this.left)?b.removeNull():void 0;this.right=null!=(a=this.right)?a.removeNull():void 0;return null!=this.left&&null!=this.right?this:this.left||this.right||null};c.prototype.simplifyRules=function(b,a){this.rules=
b;null==a&&(a=!0);a&&(this.left=this.left.simplifyRules(this.rules),this.right=this.right.simplifyRules(this.rules));return c.__super__.simplifyRules.apply(this,arguments)};c.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATConstantNode(this.evaluate()):this};c.prototype.sort=function(){var b;switch(this.operator){case "GREATER":this.operator="LESS";b=[this.right,this.left];this.left=b[0];this.right=b[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";
b=[this.right,this.left];this.left=b[0];this.right=b[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(b=[this.right,this.left],this.left=b[0],this.right=b[1])}return this};c.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATRelationNode=a}).call(this);var CTATAdditionNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f){this.operator=b;this.terms=a;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}g(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.terms.map(function(b){return b.clone()}):this.terms,this.parens,this.sign,this.exp)};
c.prototype.toString=function(){return c.__super__.toString.call(this,this.terms.reduce(function(b){return function(a,c){c.setParens(b.operator);return""+a+(a&&!c.negated()?"+":"")+c.toString()}}(this)))};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.terms.reduce(function(b){return function(a,c){return b.applyOperator(a,c.evaluate())}}(this),0))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.terms.length===b.terms.length&&this.terms.every(function(a,
c){return a.equals(b.terms[c])})};c.prototype.subEquals=function(b,a){return this.operator===b.operator&&!b.negated()&&this.terms.length>=b.terms.length&&b.terms.every(function(b){return function(c,e){return c.equals(b.terms[a+e])}}(this))};c.prototype.subNode=function(b,a){return null!=b?Object.assign(this.clone(!1),{terms:this.terms.slice(b,a)}):this};c.prototype.getOperands=function(){return this.terms.slice(0)};c.prototype.findExpression=function(b,a){return this.terms.slice(1).reduce(function(e){return function(d,
f,g){return d.concat(c.__super__.findExpression.call(e,b,a,g),f.findExpression(b,a.concat([["terms",g+1]])))}}(this),this.terms[0].findExpression(b,a.concat([["terms",0]])))};c.prototype.removeNull=function(){this.terms=this.terms.map(function(b){return null!=b?b.removeNull():void 0}).filter(function(b){return b});return 1<this.terms.length?this:this.terms[0]||null};c.prototype.simplifyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.terms=this.terms.map(function(b){return function(a){return a.simplifyRules(b.rules)}}(this)));
return c.__super__.simplifyRules.apply(this,arguments)};c.prototype.simpleFlatten=function(){this.terms[0].negation()&&!this.terms[0].inverted()&&(this.terms[0]=this.terms[0].base.negate());this.subtraction()&&(this.terms[1].negate(),this.operator="PLUS");this.terms=this.terms.reduce(function(b,a){a.inverted()||a.parented()||!a.addition()?b.push(a):b.push.apply(b,a.pushNegation().terms);return b},[]);return this};c.prototype.flatten=function(){this.simpleFlatten();return this.pushNegation()};c.prototype.computeConstants=
function(){var b,a;0<=(a=this.terms.findIndex(function(b){return b.constant()}))&&(b=this.terms[a].evaluate(),this.terms=this.terms.filter(function(c,e){return e<=a||!c.constant()||(b+=c.evaluate())&&!1}),0===b&&1<this.terms.length?this.terms.splice(a,1):this.terms[a].set(b));return 1<this.terms.length?this:this.pushInversion().terms[0]};c.prototype.combineSimilar=function(){var b;b=[];this.terms.forEach(function(a){var c,e,d;d=a.constant()?[null,a]:(a=a.multiplyOne(),[a,a.factors.shift()]);return null!=
(e=d[0])&&e.unknown()||!(c=b.find(function(b){var a;return null!=(a=b[0])?a.equals(d[0]):void 0}))?b.push([d[0],d[1].evaluate()]):c[1]+=d[1].evaluate()});this.terms=b.reduce(function(b,a){0!==a[1]&&(a[1]=(new CTATConstantNode(a[1])).popNegation(),a[0]?(a[0].factors.unshift(a[1]),b.push(a[0].removeIdentity())):b.push(a[1]));return b},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATConstantNode(0));return this.pushInversion().terms[0]};c.prototype.removeIdentity=
function(b){var a;null==b&&(b=!1);a=this.terms.filter(function(a){return!a.constant(0,b)});this.terms=a.length?a:this.terms.slice(0,1);return 1<this.terms.length?this:this.pushInversion().terms[0]};c.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(b,a){return-b.compare(a,!0)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(b){return b.multiplyOne(!0)});return this};c.prototype.stripIdentity=function(){this.terms=
this.terms.map(function(b){return b.removeIdentity(!0)});return this};c.prototype.compare=function(b,a){var e;return(e=c.__super__.compare.apply(this,arguments))||this.countVariables()-b.countVariables()||this.terms.some(function(c,d){return e=c.compare(b.terms[d],a)})&&e||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.terms.reduce(function(b,a){return b+a.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.terms.forEach(function(b){return b.negate()}));
return this};c.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(b){return b.negate()}));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};c.prototype.unknown=function(){return this.terms.some(function(b){return b.unknown()})};c.prototype.even=function(){return!this.inverted&&this.terms.every(function(b){return b.even()})};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&
null!==module?module.exports=a:this.CTATAdditionNode=a}).call(this);var CTATMultiplicationNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f){this.operator=b;this.factors=a;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}g(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.factors.map(function(b){return b.clone()}):this.factors,this.parens,this.sign,
this.exp)};c.prototype.toString=function(){return c.__super__.toString.call(this,this.factors.reduce(function(b){return function(a,c){var e,d;d=c.inverted()?(c.invert(),c.setParens("DIVIDE",!!a),e=c.toString(),c.invert(),"/"):(c.setParens(b.operator,!!a),/^[\d+-]/.test(e=c.toString())&&/\d$/.test(a)?"*":"");return""+a+d+e}}(this),this.factors[0].inverted()?"1":""))};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.factors.reduce(function(b){return function(a,c){return b.applyOperator(a,
c.evaluate())}}(this),1))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.factors.length===b.factors.length&&this.factors.every(function(a,c){return a.equals(b.factors[c])})};c.prototype.subEquals=function(b,a){return this.operator===b.operator&&!b.inverted()&&this.factors.length>=b.factors.length&&b.factors.every(function(b){return function(c,e){return c.equals(b.factors[a+e])}}(this))};c.prototype.subNode=function(b,a){return null!=b?Object.assign(this.clone(!1),{factors:this.factors.slice(b,
a)}):this};c.prototype.getOperands=function(){return this.factors.slice(0)};c.prototype.findExpression=function(b,a){return this.factors.slice(1).reduce(function(e){return function(d,f,g){return d.concat(c.__super__.findExpression.call(e,b,a,g),f.findExpression(b,a.concat([["factors",g+1]])))}}(this),this.factors[0].findExpression(b,a.concat([["factors",0]])))};c.prototype.removeNull=function(){this.factors=this.factors.map(function(b){return null!=b?b.removeNull():void 0}).filter(function(b){return b});
return 1<this.factors.length?this:this.factors[0]||null};c.prototype.simplifyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.factors=this.factors.map(function(b){return function(a){return a.simplifyRules(b.rules)}}(this)));return c.__super__.simplifyRules.apply(this,arguments)};c.prototype.simpleFlatten=function(){this.division()&&this.factors[1].invert();this.operator="TIMES";this.factors=this.factors.reduce(function(b,a){a.parented()||!a.multiplication()?b.push(a):b.push.apply(b,a.pushNegation().pushInversion().factors);
return b},[]);return this};c.prototype.flatten=function(){this.simpleFlatten();return this.popNegation()};c.prototype.computeConstants=function(){var b,a;0<=(a=this.factors.findIndex(function(b){return b.constant()}))&&(b=this.factors[a].evaluate(),this.factors=this.factors.filter(function(c,e){return e<=a||!c.constant()||(b*=c.evaluate())&&!1}),1===b&&1<this.factors.length?this.factors.splice(a,1):this.factors[a].set(b));return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};
c.prototype.combineSimilar=function(){var b;b=[];this.factors.forEach(function(a){var c,e,d,f,g;g=a.constant()?[null,a]:a.power()?a.exponent.constant()?(a.pushInversion(),[a.base,a.exponent]):(a.exponent=a.exponent.multiplyOne(),[a,a.exponent.factors.shift()]):(a=a.powerOne(),[a.base,a.exponent]);return null!=(e=g[0])&&e.unknown()||!(c=b.find(function(b){var a;return null!=(a=b[0])?a.equals(g[0]):void 0}))?b.push([g[0],(null!=(f=g[1])?f.evaluate():void 0)||1]):c[1]+=(null!=(d=g[1])?d.evaluate():void 0)||
1});this.factors=b.reduce(function(b,a){0!==a[1]&&(a[1]=(new CTATConstantNode(a[1])).popNegation(),a[0]?a[1].constant(1)?b.push(a[0]):a[1].constant(-1)?b.push(a[0].invert()):a[0].power()?(a[0].exponent.factors.unshift(a[1]),b.push(a[0])):b.push((new CTATPowerNode("EXP",a[0],a[1])).popInversion()):b.push(a[1]));return b},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATConstantNode(1));return this.pushNegation().pushInversion().factors[0]};c.prototype.distribute=
function(){var b,a;b=this.factors.filter(function(b){return!b.inverted()});a=this.factors.filter(function(b){return b.inverted()});return!this.distributedOrSingle(b)||!this.distributedOrSingle(a)||this.single(b)&&a.length&&this.distributed(a)?(this.distributed(a)?(b=this.distributeFactors(this.factors),a=[]):this.distributed(b)?(a=this.distributeFactors(this.factors),b=[]):(b=this.distributeFactors(b),a=this.distributeFactors(a)),this.factors=a.length?b.length?[this.packTerms(b),this.packTerms(a).invert()]:
[this.packTerms(a).invert()]:[this.packTerms(b)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]):this};c.prototype.distributedOrSingle=function(b){return this.distributed(b)||this.single(b)};c.prototype.distributed=function(b){return b.every(function(b){return!b.addition()})};c.prototype.single=function(b){return 1===b.length&&b[0].addition()};c.prototype.distributeFactors=function(b){var a;a=b[0].addition()?b[0].terms.map(function(b){return b.multiplication()?b.pushNegation().factors:
[b]}):[[b[0]]];b.slice(1).forEach(function(b){var c;return b.addition()?1===a.length?a=b.terms.map(function(b){var c;c=a[0].map(function(b){return b.clone()});b.multiplication()?c.push.apply(c,b.pushNegation().factors):c.push(b);return c}):a=a.reduce(function(a,c){a.push.apply(a,b.terms.map(function(b){var a;a=c.map(function(b){return b.clone()});b.multiplication()?a.push.apply(a,b.pushNegation().factors.map(function(b){return b.clone()})):a.push(b.clone());return a}));return a},[]):1===a.length?
b.multiplication()?(c=a[0]).push.apply(c,b.pushNegation().factors):a[0].push(b):a.forEach(function(c,e){var d;return b.multiplication()?(d=a[e]).push.apply(d,b.pushNegation().factors.map(function(b){return b.clone()})):a[e].push(b.clone())})});return a};c.prototype.packTerms=function(b){var a;a=CTATAlgebraTreeNode.diff(this.rules,["flatten","distribute"]);return(new CTATAdditionNode("PLUS",b.map(function(b){return(new c("TIMES",b)).popNegation().simplifyRules(a,!1)}))).simplifyRules(a,!1)};c.prototype.removeIdentity=
function(b){var a;null==b&&(b=!1);this.popNegation();a=this.factors.filter(function(a){return!a.constant(1,b)});this.factors=a.length?a:this.factors.slice(0,1);(a=this.factors.find(function(a){return a.constant(0,b)}))&&this.factors.every(function(b){return!b.inverted()&&(!b.power()||b.exponent.constant())})&&(this.factors=[a]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};c.prototype.sort=function(){this.spreadIdentity();this.factors=this.factors.sort(function(b,
a){return b.compare(a)});return this.stripIdentity()};c.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(b){return b.powerOne(!0)});return this};c.prototype.stripIdentity=function(){this.factors=this.factors.map(function(b){return b.removeIdentity(!0)});return this.popNegation()};c.prototype.multiplyOne=function(b){null==b&&(b=!1);this.factors[0].constant()||this.factors.unshift(new CTATConstantNode(1,b));return this.pushNegation()};c.prototype.compare=function(b,a){var e,
d;return(d=c.__super__.compare.apply(this,arguments))||this.countVariables()-b.countVariables()||(e=b.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(b,c){return d=b.compare(e[c],a)})&&d||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.factors.reduce(function(b,a){return b+a.countVariables()},0)};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};c.prototype.popNegation=function(){this.factors.forEach(function(b){return function(a){if(a.negated())return b.negate(),
a.negate()}}(this));return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(b){return b.invert()}));return this};c.prototype.unknown=function(){return this.factors.some(function(b){return b.unknown()})};c.prototype.even=function(){return!this.inverted()&&this.factors.every(function(b){return b.integer()})&&this.factors.some(function(b){return b.even()})};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=
a:this.CTATMultiplicationNode=a}).call(this);var CTATIntDivisionNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f,g){this.operator=b;this.dividend=a;this.divisor=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.dividend.clone():this.dividend,b?this.divisor.clone():this.divisor,
this.parens,this.sign,this.exp)};c.prototype.toString=function(){this.dividend.setParens(this.operator);this.divisor.setParens(this.operator,!0);return c.__super__.toString.call(this,""+this.dividend.toString()+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.divisor.toString())};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.dividend.evaluate(),this.divisor.evaluate()))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&
this.dividend.equals(b.dividend)&&this.divisor.equals(b.divisor)};c.prototype.getOperands=function(){return[this.dividend,this.divisor]};c.prototype.findExpression=function(b,a){return this.dividend.findExpression(b,a.concat(["dividend"])).concat(c.__super__.findExpression.call(this,b,a),this.divisor.findExpression(b,a.concat(["divisor"])))};c.prototype.removeNull=function(){var b,a;this.dividend=null!=(b=this.dividend)?b.removeNull():void 0;this.divisor=null!=(a=this.divisor)?a.removeNull():void 0;
return null!=this.dividend&&null!=this.divisor?this:this.dividend||this.divisor||null};c.prototype.simplifyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.dividend=this.dividend.simplifyRules(this.rules),this.divisor=this.divisor.simplifyRules(this.rules));return c.__super__.simplifyRules.apply(this,arguments)};c.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATConstantNode(this.evaluate()):this};c.prototype.removeIdentity=function(b){null==
b&&(b=!1);return this.divisor.constant(1,b)?(this.intDivision()||(this.dividend=new CTATConstantNode(0,b)),this.pushNegation().pushInversion().dividend):this.popNegation()};c.prototype.compare=function(b,a){return c.__super__.compare.apply(this,arguments)||this.dividend.compare(b.dividend,a)||this.divisor.compare(b.divisor,a)||this.operator!==b.operator&&(this.intDivision()&&-1||1)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.dividend.countVariables()+divisor.countVariables()};
c.prototype.pushNegation=function(){this.intDivision()&&this.negated()&&(this.negate(),this.dividend.negate());return this};c.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};c.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};c.prototype.unknown=function(){return this.dividend.unknown()||this.divisor.unknown()};c.prototype.even=function(){return!this.inverted&&
"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATIntDivisionNode=a}).call(this);var CTATUnaryNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f){this.operator=b;this.base=a;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1}g(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.base.clone():this.base,this.parens,this.sign,this.exp)};c.prototype.toString=function(){this.base.setParens(this.operator);
return c.__super__.toString.call(this,""+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.base.toString())};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate()))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.base.equals(b.base)};c.prototype.getOperands=function(){return[this.base]};c.prototype.findExpression=function(b,a){return this.base.findExpression(b,a.concat(["base"])).concat(c.__super__.findExpression.call(this,
b,a))};c.prototype.removeNull=function(){var b;this.base=null!=(b=this.base)?b.removeNull():void 0;return null!=this.base?this:null};c.prototype.simplifyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.base=this.base.simplifyRules(this.rules));return c.__super__.simplifyRules.apply(this,arguments)};c.prototype.flatten=function(){this.negation()&&(this.negate(),this.operator="UPLUS");return this.pushNegation().pushInversion().base};c.prototype.compare=function(b,a){return b.unary()&&this.base.compare(b.base,
a)||c.__super__.compare.apply(this,arguments)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.base.countVariables()};c.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.constant=function(b,a){null==a&&(a=!1);return this.base.constant(b,a)};c.prototype.unknown=function(){return this.base.unknown()};return c}(CTATAlgebraTreeNode);
"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATUnaryNode=a}).call(this);var CTATPowerNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f,g){this.operator=b;this.base=a;this.exponent=c;this.parens=null!=d?d:0;this.sign=null!=f?f:1;this.exp=null!=g?g:1}g(c,a);c.prototype.clone=function(b){null==b&&(b=!0);return new c(this.operator,b?this.base.clone():this.base,b?this.exponent.clone():this.exponent,this.parens,
this.sign,this.exp)};c.prototype.toString=function(){this.base.setParens(this.operator);this.exponent.setParens(this.operator);return c.__super__.toString.call(this,""+this.base.toString()+CTATAlgebraTreeNode.toOperatorString(this.operator)+this.exponent.toString())};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.applyOperator(this.base.evaluate(),this.exponent.evaluate()))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.base.equals(b.base)&&
this.exponent.equals(b.exponent)};c.prototype.getOperands=function(){return[this.base,this.exponent]};c.prototype.findExpression=function(b,a){return this.base.findExpression(b,a.concat(["base"])).concat(c.__super__.findExpression.call(this,b,a),this.exponent.findExpression(b,a.concat(["exponent"])))};c.prototype.removeNull=function(){var b,a;this.base=null!=(b=this.base)?b.removeNull():void 0;this.exponent=null!=(a=this.exponent)?a.removeNull():void 0;return null!=this.base&&null!=this.exponent?
this:this.base||this.exponent||null};c.prototype.simplifyRules=function(b,a){this.rules=b;null==a&&(a=!0);a&&(this.base=this.base.simplifyRules(this.rules),this.exponent=this.exponent.simplifyRules(this.rules));return c.__super__.simplifyRules.apply(this,arguments)};c.prototype.flatten=function(){var b,a;this.root()&&(this.exponent.invert(),this.operator="EXP");this.popNegation().popInversion();return this.base.power()?(a=CTATAlgebraTreeNode.diff(this.rules,["flatten"]),b=this.base.exponent.multiplication()?
this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?b.push.apply(b,this.exponent.pushNegation().pushInversion().factors):b.push(this.exponent),this.base.exponent=(new CTATMultiplicationNode("TIMES",b)).simplifyRules(a,!1),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.computeConstants=function(){return this.base.constant()&&(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?
(this.exponent.constant()?(this.base=new CTATConstantNode(this.evaluate()),this.exponent=null):(this.base=new CTATConstantNode((new c("EXP",this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.powerOne=function(b){null==b&&(b=!1);this.exponent=this.exponent.multiplyOne(b);return this.pushInversion()};c.prototype.expand=
function(){var b,a,c;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&1<this.exponent.factors[0].value)){this.exponent.integer()?(b=this.exponent,this.exponent=null):(b=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));a=[this.base];c=1;for(b=b.evaluate();1<=b?c<b:c>b;1<=b?++c:--c)a.push(this.base.clone());this.base=(new CTATMultiplicationNode("TIMES",
a)).simplifyRules(["distribute"],!1);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};c.prototype.distribute=function(){var b;return this.base.multiplication()||this.exponent.addition()?(b=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],b=this.exponent.addition()?b.reduce(function(b){return function(a,c){a.push.apply(a,b.exponent.terms.map(function(b){return[c.clone(),b.clone()]}));return a}}(this),[]):b.map(function(b){return function(a){return[a,
b.exponent.clone()]}}(this)),this.base=this.packFactors(b),this.pushBaseNegation().pushBaseInversion().base):this};c.prototype.packFactors=function(b){var a;a=CTATAlgebraTreeNode.diff(this.rules,["flatten"]);return new CTATMultiplicationNode("TIMES",b.map(function(b){return(new c("EXP",b[0],b[1])).simplifyRules(a,!1)}))};c.prototype.removeIdentity=function(b){null==b&&(b=!1);this.popInversion();if(this.exponent.constant(0,b))return this.base=new CTATConstantNode(1,b),this.pushBaseNegation().base;
if(this.base.constant(0,b))return this.pushBaseInversion().base;if(this.exponent.constant(1,b))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity(b);return this};c.prototype.compare=function(b,a){return c.__super__.compare.apply(this,arguments)||(this.countVariables()-b.countVariables())*(a?-1:1)||this.exponent.compare(b.exponent,a)||this.base.compare(b.base,a)||this.compareSigns(b,a)};c.prototype.countVariables=function(){return this.base.countVariables()*
(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};c.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};c.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};c.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||
this.negate());return this};c.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};c.prototype.unknown=function(){return this.base.unknown()||this.exponent.unknown()};c.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATPowerNode=a}).call(this);var CTATVariableNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f){this.variableTable=b;this.variable=a;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1;this.operator="VAR"}g(c,a);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.parens,this.sign,this.exp)};c.prototype.toString=function(){return c.__super__.toString.call(this,
this.variable)};c.prototype.evaluate=function(){var b;return c.__super__.evaluate.call(this,(null!=(b=this.variableTable)?b.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(e){return NaN}}.call(this))};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.variable===b.variable};c.prototype.compare=function(b,a){a=null!=a?-1:1;return c.__super__.compare.apply(this,arguments)||this.variable>b.variable&&a||this.variable<b.variable&&-a||this.compareSigns(b,
a)};c.prototype.countVariables=function(){return 1};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATVariableNode=a}).call(this);var CTATConstantNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c,d,f){this.value=b;this.marked=null!=a?a:!1;this.parens=null!=c?c:0;this.sign=null!=d?d:1;this.exp=null!=f?f:1;this.operator="CONST"}g(c,a);c.prototype.clone=function(){return new c(this.value,this.marked,this.parens,this.sign,this.exp)};c.prototype.toString=function(){return c.__super__.toString.call(this,
this.value.toString())};c.prototype.evaluate=function(){return c.__super__.evaluate.call(this,this.value)};c.prototype.equals=function(b){return c.__super__.equals.call(this,b)&&this.value===b.value};c.prototype.multiplyOne=function(){return this};c.prototype.powerOne=function(){return this};c.prototype.compare=function(b,a){a=null!=a?1:-1;return c.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(b.evaluate()))*a||this.compareSigns(b,a)};c.prototype.popNegation=
function(){0>this.value&&(this.negate(),this.value=-this.value);return this};c.prototype.constant=function(b,a){null==a&&(a=!1);return null==b||this.evaluate()===b&&this.marked===a};c.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};c.prototype.even=function(){return 0===this.evaluate()%2};c.prototype.set=function(b){this.exp=1;this.value=Math.abs(b);return this.sign=Math.sign(b)};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=
a:this.CTATConstantNode=a}).call(this);var CTATUnknownNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(b,a,c){this.parens=null!=b?b:0;this.sign=null!=a?a:1;this.exp=null!=c?c:1;this.operator="UNKNOWN"}g(c,a);c.prototype.clone=function(){return new c(this.parens,this.sign,this.exp)};c.prototype.toString=function(){return c.__super__.toString.call(this,"?")};c.prototype.evaluate=
function(){return NaN};c.prototype.compare=function(b,a){a=null!=a?1:-1;return c.__super__.compare.apply(this,arguments)||this.compareSigns(b,a)};c.prototype.unknown=function(){return!0};return c}(CTATAlgebraTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATUnknownNode=a}).call(this);var CTATAlgebraGrammar=function(){function a(){this.yy={}}var g=function(b,a,c,e){c=c||{};for(e=b.length;e--;c[b[e]]=a);return c},f=[1,6],c=[1,7],d=[1,10],b=[1,11],e=[1,12],h=[1,13],l=[1,14],m=[1,22],n=[1,23],p=[5,7,8,9,10,11,12,13,15,26],v=[1,24],r=[1,25],u=[1,27],w=[1,28],B=[5,7,8,9,10,11,12,13,15,16,18,20,21,24,25,26,27,28,29],y=[5,7,8,9,10,11,12,13,15,16,18,20,21,23,24,25,26,27,28,29],g={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,
GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedfactor:17,DIVIDE:18,factor:19,IDIVIDE:20,REM:21,atom:22,EXP:23,SQRT:24,LPAREN:25,RPAREN:26,VARIABLE:27,NUMBER:28,UNKNOWN:29,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",20:"IDIVIDE",21:"REM",23:"EXP",24:"SQRT",25:"LPAREN",26:"RPAREN",27:"VARIABLE",28:"NUMBER",29:"UNKNOWN"},productions_:[0,[3,2],[4,
3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[19,3],[19,2],[19,1],[22,3],[22,1],[22,1],[22,1]],performAction:function(b,a,c,e,d,f,g){b=f.length-1;switch(d){case 1:return f[b-1];case 2:this.$=new e.CTATRelationNode("LESS",f[b-2],f[b]);break;case 3:this.$=new e.CTATRelationNode("GREATER",f[b-2],f[b]);break;case 4:this.$=new e.CTATRelationNode("LESSEQUAL",f[b-2],f[b]);break;case 5:this.$=new e.CTATRelationNode("GREATEREQUAL",
f[b-2],f[b]);break;case 6:this.$=new e.CTATRelationNode("EQUAL",f[b-2],f[b]);break;case 7:this.$=new e.CTATRelationNode("NOTEQUAL",f[b-2],f[b]);break;case 8:case 11:case 17:case 20:case 23:this.$=f[b];break;case 9:this.$=new e.CTATAdditionNode("PLUS",[f[b-2],f[b]]);break;case 10:this.$=new e.CTATAdditionNode("MINUS",[f[b-2],f[b]]);break;case 12:this.$=new e.CTATMultiplicationNode("TIMES",[f[b-2],f[b]]);break;case 13:this.$=new e.CTATMultiplicationNode("DIVIDE",[f[b-2],f[b]]);break;case 14:this.$=
new e.CTATMultiplicationNode("ITIMES",[f[b-1],f[b]]);break;case 15:this.$=new e.CTATIntDivisionNode("IDIVIDE",f[b-2],f[b]);break;case 16:this.$=new e.CTATIntDivisionNode("REM",f[b-2],f[b]);break;case 18:this.$=new e.CTATUnaryNode("UPLUS",f[b]);break;case 19:this.$=new e.CTATUnaryNode("UMINUS",f[b]);break;case 21:this.$=new e.CTATPowerNode("EXP",f[b-2],f[b]);break;case 22:this.$=new e.CTATPowerNode("ROOT",f[b],new e.CTATConstantNode(2));break;case 24:this.$=f[b-1];break;case 25:this.$=new e.CTATVariableNode(e.variableTable,
f[b]);break;case 26:this.$=new e.CTATConstantNode(Number(f[b]));break;case 27:this.$=new e.CTATUnknownNode}},table:[{3:1,4:2,6:3,13:f,14:4,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{1:[3]},{5:[1,15]},{5:[2,8],7:[1,16],8:[1,17],9:[1,18],10:[1,19],11:[1,20],12:[1,21],13:m,15:n},g(p,[2,11],{22:9,19:26,16:v,18:r,20:u,21:w,24:d,25:b,27:e,28:h,29:l}),g(B,[2,17]),{13:f,15:c,17:29,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{13:f,15:c,17:30,19:8,22:9,24:d,25:b,27:e,28:h,29:l},g(B,[2,20]),g(B,[2,23],{23:[1,31]}),
{13:f,15:c,17:32,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{6:33,13:f,14:4,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},g(y,[2,25]),g(y,[2,26]),g(y,[2,27]),{1:[2,1]},{6:34,13:f,14:4,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{6:35,13:f,14:4,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{6:36,13:f,14:4,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{6:37,13:f,14:4,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{6:38,13:f,14:4,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{6:39,13:f,14:4,15:c,17:5,19:8,
22:9,24:d,25:b,27:e,28:h,29:l},{13:f,14:40,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{13:f,14:41,15:c,17:5,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{13:f,15:c,17:42,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{13:f,15:c,17:43,19:8,22:9,24:d,25:b,27:e,28:h,29:l},g(B,[2,14]),{13:f,15:c,17:44,19:8,22:9,24:d,25:b,27:e,28:h,29:l},{13:f,15:c,17:45,19:8,22:9,24:d,25:b,27:e,28:h,29:l},g(B,[2,18]),g(B,[2,19]),{13:f,15:c,17:46,19:8,22:9,24:d,25:b,27:e,28:h,29:l},g(B,[2,22]),{13:m,15:n,26:[1,47]},{5:[2,2],13:m,15:n},
{5:[2,3],13:m,15:n},{5:[2,4],13:m,15:n},{5:[2,5],13:m,15:n},{5:[2,6],13:m,15:n},{5:[2,7],13:m,15:n},g(p,[2,9],{22:9,19:26,16:v,18:r,20:u,21:w,24:d,25:b,27:e,28:h,29:l}),g(p,[2,10],{22:9,19:26,16:v,18:r,20:u,21:w,24:d,25:b,27:e,28:h,29:l}),g(B,[2,12]),g(B,[2,13]),g(B,[2,15]),g(B,[2,16]),g(B,[2,21]),g(y,[2,24])],defaultActions:{15:[2,1]},parseError:function(b,a){if(a.recoverable)this.trace(b);else{var c=Error(b);c.hash=a;throw c;}},parse:function(b){var a=[0],c=[null],e=[],d=this.table,f="",g=0,h=0,
m=0,l=e.slice.call(arguments,1),n=Object.create(this.lexer),p={},r;for(r in this.yy)Object.prototype.hasOwnProperty.call(this.yy,r)&&(p[r]=this.yy[r]);n.setInput(b,p);p.lexer=n;p.parser=this;"undefined"==typeof n.yylloc&&(n.yylloc={});r=n.yylloc;e.push(r);var v=n.options&&n.options.ranges;this.parseError="function"===typeof p.parseError?p.parseError:Object.getPrototypeOf(this).parseError;for(var u,w,B,z,y={},U,M;;){B=a[a.length-1];if(this.defaultActions[B])z=this.defaultActions[B];else{if(null===
u||"undefined"==typeof u)u=n.lex()||1,"number"!==typeof u&&(u=this.symbols_[u]||u);z=d[B]&&d[B][u]}if("undefined"===typeof z||!z.length||!z[0]){var V;M=[];for(U in d[B])this.terminals_[U]&&2<U&&M.push("'"+this.terminals_[U]+"'");V=n.showPosition?"Parse error on line "+(g+1)+":\n"+n.showPosition()+"\nExpecting "+M.join(", ")+", got '"+(this.terminals_[u]||u)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==u?"end of input":"'"+(this.terminals_[u]||u)+"'");this.parseError(V,{text:n.match,token:this.terminals_[u]||
u,line:n.yylineno,loc:r,expected:M})}if(z[0]instanceof Array&&1<z.length)throw Error("Parse Error: multiple actions possible at state: "+B+", token: "+u);switch(z[0]){case 1:a.push(u);c.push(n.yytext);e.push(n.yylloc);a.push(z[1]);u=null;w?(u=w,w=null):(h=n.yyleng,f=n.yytext,g=n.yylineno,r=n.yylloc,0<m&&m--);break;case 2:M=this.productions_[z[1]][1];y.$=c[c.length-M];y._$={first_line:e[e.length-(M||1)].first_line,last_line:e[e.length-1].last_line,first_column:e[e.length-(M||1)].first_column,last_column:e[e.length-
1].last_column};v&&(y._$.range=[e[e.length-(M||1)].range[0],e[e.length-1].range[1]]);B=this.performAction.apply(y,[f,h,g,p,z[1],c,e].concat(l));if("undefined"!==typeof B)return B;M&&(a=a.slice(0,-2*M),c=c.slice(0,-1*M),e=e.slice(0,-1*M));a.push(this.productions_[z[1]][0]);c.push(y.$);e.push(y._$);z=d[a[a.length-2]][a[a.length-1]];a.push(z);break;case 3:return!0}}}},f=function(){return{EOF:1,parseError:function(b,a){if(this.yy.parser)this.yy.parser.parseError(b,a);else throw Error(b);},setInput:function(b,
a){this.yy=a||this.yy||{};this._input=b;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var b=this._input[0];this.yytext+=b;this.yyleng++;this.offset++;this.match+=b;this.matched+=b;b.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):
this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return b},unput:function(b){var a=b.length,c=b.split(/(?:\r\n?|\n)/g);this._input=b+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-a);this.offset-=a;b=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,
last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===b.length?this.yylloc.first_column:0)+b[b.length-c.length].length-c[0].length:this.yylloc.first_column-a};this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-a]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+
this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(b){this.unput(this.match.slice(b))},pastInput:function(){var b=this.matched.substr(0,this.matched.length-this.match.length);return(20<b.length?"...":"")+b.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var b=this.match;20>b.length&&(b+=this._input.substr(0,20-b.length));return(b.substr(0,20)+(20<b.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var b=this.pastInput(),a=Array(b.length+1).join("-");
return b+this.upcomingInput()+"\n"+a+"^"},test_match:function(b,a){var c,e;this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&
(e.yylloc.range=this.yylloc.range.slice(0)));if(c=b[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length};this.yytext+=b[0];this.match+=b[0];this.matches=b;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=
this._more=!1;this._input=this._input.slice(b[0].length);this.matched+=b[0];c=this.performAction.call(this,this.yy,this,a,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(c)return c;if(this._backtrack)for(var d in e)this[d]=e[d];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var b,a,c;this._more||(this.match=this.yytext="");for(var e=this._currentRules(),d=0;d<e.length;d++)if((a=this._input.match(this.rules[e[d]]))&&(!b||
a[0].length>b[0].length))if(b=a,c=d,this.options.backtrack_lexer){b=this.test_match(a,e[d]);if(!1!==b)return b;if(this._backtrack)b=!1;else return!1}else if(!this.options.flex)break;return b?(b=this.test_match(b,e[c]),!1!==b?b:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return b?b:this.lex()},begin:function(b){this.conditionStack.push(b)},
popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(b){b=this.conditionStack.length-1-Math.abs(b||0);return 0<=b?this.conditionStack[b]:"INITIAL"},pushState:function(b){this.begin(b)},stateStackSize:function(){return this.conditionStack.length},
options:{},performAction:function(b,a,c,e){switch(c){case 1:return 25;case 2:return 26;case 3:return 23;case 4:return 23;case 5:return 24;case 6:return 24;case 7:return 16;case 8:return 16;case 9:return 20;case 10:return 18;case 11:return 18;case 12:return 21;case 13:return 15;case 14:return 13;case 15:return 9;case 16:return 9;case 17:return 10;case 18:return 10;case 19:return 7;case 20:return 8;case 21:return 12;case 22:return 12;case 23:return 12;case 24:return 12;case 25:return 11;case 26:return 11;
case 27:return 28;case 28:return 28;case 29:return 27;case 30:return 29;case 31:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,/^(?:\u221a)/,/^(?:\*)/,/^(?:\u00d7)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:\u00f7)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:\u2264)/,/^(?:>=)/,/^(?:\u2265)/,/^(?:<)/,/^(?:>)/,/^(?:!=)/,/^(?:\/=)/,/^(?:<>)/,/^(?:\u2260)/,/^(?:==)/,/^(?:=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,
/^(?:([A-Za-z]))/,/^(?:\?)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!0}}}}();g.lexer=f;a.prototype=g;g.Parser=a;return new a}();var CTATAlgebraParser={};
(function(){var a,g=[].slice;a=function(){function a(a){this.parser=new CTATAlgebraGrammar.Parser;this.parser.yy={CTATRelationNode:CTATRelationNode,CTATAdditionNode:CTATAdditionNode,CTATMultiplicationNode:CTATMultiplicationNode,CTATIntDivisionNode:CTATIntDivisionNode,CTATUnaryNode:CTATUnaryNode,CTATPowerNode:CTATPowerNode,CTATVariableNode:CTATVariableNode,CTATConstantNode:CTATConstantNode,CTATUnknownNode:CTATUnknownNode,CTATAlgebraTreeNode:CTATAlgebraTreeNode};this.parser.yy.variableTable=a}a.none=
["simpleFlatten"];a.partial=["flatten","removeIdentity"];a.full="flatten computeConstants combineSimilar expand distribute removeIdentity".split(" ");a.prototype.getTree=function(c,d,b){null==d&&(d=!1);null==b&&(b=!1);if(c instanceof CTATAlgebraTreeNode)c=b?c.clone():c;else{var e;if(c instanceof String)try{e=Object.assign(this.parser.parse(c),{path:c.path})}catch(h){e=null}else try{e=this.parser.parse(String(c))}catch(h){e=null}c=e}null!=c&&c.simplifyRules(a.none.concat(d?"sort":[]));return c};a.prototype.getExpression=
function(a,d){return a instanceof CTATAlgebraTreeNode?d:"string"===typeof d?d:null!=(null!=d?d.path:void 0)?Object.assign(new String(d.toString()),{path:d.path}):null!=d?d.toString():d};a.prototype.equalExpressions=function(a,d){return a instanceof CTATAlgebraTreeNode?a.toString()===d.toString():a instanceof String?a.toString()===d.toString():a===d};a.prototype.algParse=function(a,d){null==d&&(d=!1);return this.getTree(a,d)};a.prototype.algGetError=function(a){try{return a instanceof CTATAlgebraTreeNode||
this.parser.parse(String(a)),null}catch(d){return d}};a.prototype.algStringify=function(a){return this.getExpression("",a)};a.prototype.algEvaluate=function(a,d){null==d&&(d=null);try{return this.getTree(a,order).evaluate(d)}catch(b){return null}};a.prototype.algSort=function(a){return this.getExpression(a,this.getTree(a,!0,!0))};a.prototype.algGetOperator=function(a,d){var b;null==d&&(d=!1);return null!=(b=this.getTree(a))?b.getOperator(d):void 0};a.prototype.algGetOperands=function(a){var c;return null!=
(c=this.getTree(a))?c.getOperands().map(function(b){return function(c){return b.getExpression(a,c)}}(this)):void 0};a.prototype.algFindExpression=function(a,d){var b,c;return null!=(b=this.getTree(a))?null!=(c=b.findExpression(this.getTree(d),[]))?c.map(function(b){return function(c){return b.getExpression(a,c)}}(this)):void 0:void 0};a.prototype.algCreateExpression=function(){var a,d;d=arguments[0];a=2<=arguments.length?g.call(arguments,1):[];return this.getExpression(a[0],CTATAlgebraTreeNode.createExpression.apply(CTATAlgebraTreeNode,
[d].concat(g.call(a.map(function(b){return function(a){return b.getTree(a)}}(this)))))||null)};a.prototype.algReplaceExpression=function(a,d,b,e){var c,f;null==e&&(e=null);e=(null!=e?e:null!=(c=d.path)?c.slice(0):void 0)||0;return this.getExpression(a,(null!=(f=this.getTree(a))?f.replaceExpression(this.getTree(d),this.getTree(b),e):void 0)||null)};a.prototype.algDeleteExpression=function(a,d,b){var c,f;null==b&&(b=null);b=(null!=b?b:null!=(c=d.path)?c.slice(0):void 0)||0;return this.getExpression(a,
(null!=(f=this.getTree(a))?f.deleteExpression(this.getTree(d),b):void 0)||null)};a.prototype.algSimplifyRules=function(a,d,b,e){null==b&&(b=!1);null==e&&(e=!0);return this.getExpression(a,function(){try{return this.getTree(a,!1,!0).simplifyRules(d.concat(b?"sort":[]),e)}catch(h){return null}}.call(this))};a.prototype.algPartiallySimplify=function(c,d){null==d&&(d=!1);return this.algSimplifyRules(c,a.partial,d)};a.prototype.algSimplify=function(c,d){null==d&&(d=!1);return this.algSimplifyRules(c,a.full,
d)};a.prototype.algValid=function(a,d){var b,c;null==d&&(d=!1);return null!=(b=this.algParse(a,!0))&&null!=(c=this.algParse(a,!d))?b.toString()===c.toString():null};a.prototype.algValued=function(a){var c;return null!=(c=this.algEvaluate(a))?!isNaN(c):null};a.prototype.algPartiallySimplified=function(a,d){var b,c;null==d&&(d=!1);return null!=(b=this.algPartiallySimplify(a,!0))&&null!=(c=this.algParse(a,!d))?b===c.toString():null};a.prototype.algSimplified=function(a,d){var b,c;null==d&&(d=!1);return null!=
(b=this.algSimplify(a,!0))&&null!=(c=this.algParse(a,!d))?b===c.toString():null};a.prototype.algIdentical=function(a,d,b){var c,f;null==b&&(b=!1);return null!=(c=this.algParse(a,!b))&&null!=(f=this.algParse(d,!b))?c.toString()===f.toString():null};a.prototype.algEqual=function(a,d){var b,c;return null!=(b=this.algEvaluate(a))&&null!=(c=this.algEvaluate(d))?b===c:null};a.prototype.algPartiallyEquivalent=function(a,d,b){var c,f;null==b&&(b=!1);return null!=(c=this.algPartiallySimplify(a,!b))&&null!=
(f=this.algPartiallySimplify(d,!b))?c===f:null};a.prototype.algEquivalent=function(a,d,b){var c,f;null==b&&(b=!1);return null!=(c=this.algSimplify(a,!b))&&null!=(f=this.algSimplify(d,!b))?c===f:null};a.prototype.isAlgValid=a.prototype.algValid;a.prototype.algEval=a.prototype.algEvaluate;a.prototype.algStrictEquivTermsSameOrder=function(a,d){return this.algPartiallyEquivalent(a,d,!0)};a.prototype.algEquivTermsSameOrder=a.prototype.algStrictEquivTermsSameOrder;a.prototype.algStrictEquivTerms=a.prototype.algPartiallyEquivalent;
a.prototype.algEquivTerms=a.prototype.algStrictEquivTerms;a.prototype.algEquiv=a.prototype.algEquivalent;a.prototype.isSimplified=function(a){return this.algSimplified(a,!0)};a.prototype.calc=a.prototype.algEvaluate;a.prototype.calca=function(a){return(+this.algEvaluate(a)).toFixed(2)};a.prototype.simplify=function(a){return this.algSimplify(a,!0)};a.prototype.algebraicEqual=a.prototype.algEqual;a.prototype.patternMatches=function(a,d){return this.algIdentical(a,d,!0)};a.prototype.polyTermsEqual=
function(c,d){return this.parser.parse(c).simplifyRules(a.partial).equals(this.parser.parse(d).simplifyRules(a.partial))};a.prototype.algebraicMatches=function(a,d){return this.algEquivalent(a,d,!0)};a.prototype.expressionMatches=a.prototype.algebraicMatches;return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATAlgebraParser=a}).call(this);var CTATLogicTreeNode={};
(function(){var a;a=function(){function a(f){null!=this.string?a.operatorStrings[f]=this.string:this.string=a.operatorStrings[f]}a.operators=[["CONST"],["VAR"],["NOT"],["AND","NAND"],["OR","NOR"],["IF"],["IFF","XOR"]];a.operatorStrings={NOT:"\u00ac",AND:"\u2227",OR:"\u2228",NAND:"\u22bc",NOR:"\u22bd",XOR:"\u2295",IF:"\u2192",IFF:"\u2194","true":"\u22a4","false":"\u22a5"};a.toOperatorString=function(a){return this.operatorStrings[a]||""};a.diff=function(a,c){return a.filter(function(a){return!c.includes(a)})};a.removeIndex=
function(a,c){var d;a=a.slice(0);[].splice.apply(a,[c,c-c+1].concat(d=[]));d;return a};a.difference=function(a,c){return a.filter(function(a){return!c.some(function(b){return b===a})})};a.intersection=function(a){return a[0].filter(function(c){return a.every(function(a){return a.some(function(b){return b.equals(c)})})})};a.commonLength=function(a){var c;c=null;return a.every(function(a){return(null!=c?c:c=a.length)===a.length})&&c};a.sameNegation=function(a){return 2===a.length&&a[0].negationNode()===
a[1].negationNode()};a.oppositeNegation=function(a){return 2===a.length&&a[0].negationNode()!==a[1].negationNode()};a.replaceTerms=function(a,c,d){var b,e,f,g,m;g=[];b=0;for(e=a.length;b<e;b++)m=a[b],(!(f=c.find(function(a){return a[0]===m}))||d&&(m=m.junctionNode(this.removeIndex(m.terms,f[1]))))&&g.push(m);return g};a.prototype.addOperand=function(a,c,d){null==d&&(d=null);return new CTATLogicFlattenNode(a,[this,c],d)};a.prototype.setParens=function(){this.parens=!0;return this};a.prototype.checkParens=
function(){var a;return"NOT"===(a=this.operator)||"VAR"===a||"CONST"===a||this.parens};a.prototype.toString=function(f,c,d,b){null==c&&(c=!1);null==d&&(d=null);null==b&&(b=!1);this.addParens(c,d,b)&&(f="("+f+")");this.negated&&(f=""+a.operatorStrings.NOT+f);return f};a.prototype.addParens=function(a,c,d){return(null!=this.left||null!=this.terms)&&null!=c&&(a||this.precedence()>c.precedence()||d&&this.precedence()===c.precedence())};a.prototype.operatorString=function(){return""+(this.binaryOp()?" ":
"")+this.string+(this.binaryOp()?" ":"")};a.prototype.evaluate=function(a){return this.negated?applyOperator("NOT",a):a};a.prototype.applyOperator=function(a,c,d){switch(a){case "NOT":if(null!=c)return!c;break;case "AND":return null!=c?c&&d:d&&c;case "OR":return null!=c?c||d:d||c}};a.prototype.equals=function(a,c){return a&&this.operator===a.operator&&c!==(this.negated===a.negated)};a.prototype.inverse=function(a){return this.negationOp()?this.right.equals(a):a.negationOp()?this.equals(a.right):!1};
a.prototype.subEquals=function(a,c){return!1};a.prototype.subNode=function(a,c){return this};a.prototype.getOperator=function(a){null==a&&(a=!1);return!a&&this.operator||this.string};a.prototype.getOperators=function(a){return[]};a.prototype.getVariables=function(){return[]};a.prototype.getOperands=function(){return[]};a.prototype.findOperator=function(a,c,d,b){null==d&&(d=null);null==b&&(b="none");return d||this.operator!==a||null!=this.terms&&2!==this.terms.length&&"none"!==b?null!=d&&this.operator===
a&&"none"!==b?(d="left"===b?[0,d+2]:[d,this.terms.length],a=d[0],d=d[1],[Object.assign(this.subNode(a,d),{path:c.concat([[a,d]])})]):[]:[Object.assign(this,{path:c})]};a.prototype.findExpression=function(a,c,d){var b;null==d&&(d=null);return!d&&this.equals(a)?[Object.assign(this,{path:c})]:null!=d&&this.subEquals(a,d)?[Object.assign(this.subNode(d,b=d+a.terms.length),{path:c.concat([[d,b]])})]:[]};a.prototype.findRule=function(a,c,d,b){null==d&&(d=!1);null==b&&(b=null);return!b&&this.testRule(a,d)?
[Object.assign(this,{path:c})]:null!=b&&this.testRule(a,d,b)?[Object.assign(this.subNode(b,b+2),{path:c.concat([[b,b+2]])})]:[]};a.prototype.replaceExpression=function(a,c,d){var b,e,f;"number"===typeof d&&(d=null!=(e=this.findExpression(a,[])[d])?e.path:void 0);return 0===(null!=d?d.length:void 0)&&c||null!=(f=null!=d?d.shift():void 0)&&(b=this.clone(!1))&&function(){var e,g,h;switch(!1){case "string"!==typeof f:return b[f]=null!=(e=this[f])?e.replaceExpression(a,c,d):void 0;case "number"!==typeof f:return b.terms=
b.terms.slice(0),b.terms[f]=null!=(g=this.terms[f])?g.replaceExpression(a,c,d):void 0;case "object"!==typeof f:return b.terms=b.terms.slice(0),[].splice.apply(b.terms,[h=f[0],f[1]-h].concat(c)),c;default:return null}}.call(this)&&b||this};a.prototype.applyTests=function(a){return a.every(function(a){return function(c){return a[c]()}}(this))};a.prototype.applyRules=function(a,c,d){null==c&&(c=!1);null==d&&(d=!1);d=("string"===typeof a?[a]:a).reduce(function(b,e){b.rules=a;return b=b[e](c)},this);delete d.rules;
return d};a.prototype.testRule=function(a,c,d){null==c&&(c=!1);null==d&&(d=null);return this.subNode(d)[a](c,!0)};a.prototype.findCounterExample=function(a){return this.checkExpressions(a,this.getVariables().concat(a.getVariables()).uniq(),{})};a.prototype.checkExpressions=function(a,c,d){var b,e;if(c.length)return this.checkExpressions(a,c.slice(1),Object.assign(d,(b={},b[""+c[0]]=!0,b)))||this.checkExpressions(a,c.slice(1),Object.assign(d,(e={},e[""+c[0]]=!1,e)));if(this.evaluate(d)!==a.evaluate(d))return d};
a.prototype.truth=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.domination=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.negation=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.identity=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a?c||new CTATLogicFlattenNode("OR",this,new CTATLogicConstantNode(!0)):!c&&this};a.prototype.idempotence=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a?c||new CTATLogicFlattenNode("OR",[this,this]):!c&&this};a.prototype.absorption=
function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.inverseAbsorption=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.commutativity=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.associativity=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.distributivity=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.deMorgan=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.doubleNegation=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a&&!this.negationOp()?
c||this.negateNode().negateNode():!c&&this};a.prototype.implication=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.biimplication=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.biimplicationToImplication=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.exclusiveDisjunction=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.exclusiveDisjunctionToImplication=function(a,c){null==c&&(c=!1);return!c&&this};a.prototype.findPairs=function(a,c,d){var b,e,f,g,m;g=[];b=
0;for(f=c.length;b<f;b++)m=c[b],m.operator===a&&-1!==(e=m.terms.findIndex(function(a){return function(b){return b[d](a)}}(this)))&&g.push([m,e]);return g};a.prototype.normalFormOperators=function(){var a;return"NOT"===(a=this.operator)||"AND"===a||"OR"===a||"VAR"===a||"CONST"===a};a.prototype.atomicNegation=function(){return!0};a.prototype.atomicConjunction=function(){return!0};a.prototype.atomicDisjunction=function(){return!0};a.prototype.replaceNodes=function(){return this};a.prototype.flatten=
function(){return this};a.prototype.pushNegation=function(){return this};a.prototype.distributeDisjunction=function(){return this};a.prototype.distributeConjunction=function(){return this};a.prototype.sort=function(){return this};a.prototype.absorb=function(){return this};a.prototype.compare=function(a){return Math.sign(this.countLevels()-a.countLevels()||this.precedence(!0)-a.precedence(!0)||this.countVariables()-a.countVariables())};a.prototype.compareNegations=function(a){return this.negationNode()-
a.negationNode()};a.prototype.precedence=function(f){null==f&&(f=!1);return a.operators.findIndex(function(a){return function(c){return c.includes(a.operator)}}(this))};a.prototype.countVariables=function(){return 0};a.prototype.countLevels=function(){return 0};a.prototype.invertOperator=function(){this.operator=this.inverseOperator();this.string=a.operatorStrings[this.operator];return this};a.prototype.inverseOperator=function(){return this.conjunctionOp()?"OR":this.disjunctionOp()?"AND":this.operator};
a.prototype.negateNode=function(){return new CTATLogicRelationNode("NOT",null,this)};a.prototype.unnegateNode=function(){return this.negationOp()?this.right:this};a.prototype.unnegateOperator=function(){return this.negativeConjunctionOp()?"AND":this.negativeDisjunctionOp()?"OR":this.operator};a.prototype.negationNode=function(){return this.negationOp()&&!this.right.negationNode()||this.negated};a.prototype.negate=function(){this.negated&&this.setSteps(this.steps+1);this.negated=!this.negated;return this};
a.prototype.setSteps=function(a){isNaN(a)||(this.steps=a);return this};a.prototype.atomic=function(){var a,c;return"VAR"===(a=this.operator)||"CONST"===a||"NOT"===this.operator&&("VAR"===(c=this.right.operator)||"CONST"===c)};a.prototype.negationOp=function(){return"NOT"===this.operator};a.prototype.conjunctionOp=function(){return"AND"===this.operator};a.prototype.disjunctionOp=function(){return"OR"===this.operator};a.prototype.negativeConjunctionOp=function(){return"NAND"===this.operator};a.prototype.negativeDisjunctionOp=
function(){return"NOR"===this.operator};a.prototype.junctionOp=function(){var a;return"AND"===(a=this.operator)||"OR"===a};a.prototype.negativeJunctionOp=function(){var a;return"NAND"===(a=this.operator)||"NOR"===a};a.prototype.exclusiveDisjunctionOp=function(){return"XOR"===this.operator};a.prototype.implicationOp=function(){return"IF"===this.operator};a.prototype.biimplicationOp=function(){return"IFF"===this.operator};a.prototype.binaryOp=function(){var a;return"AND"===(a=this.operator)||"OR"===
a||"NAND"===a||"NOR"===a||"IF"===a||"IFF"===a||"XOR"===a};a.prototype.constant=function(a){return!1};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicTreeNode=a}).call(this);var CTATLogicRelationNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(a,e,d,f,g){this.operator=a;this.left=e;this.right=d;this.string=null!=f?f:null;this.negated=null!=g?g:!1;c.__super__.constructor.call(this,this.operator)}g(c,a);c.prototype.clone=function(a){var b;null==a&&(a=!0);return new c(this.operator,a?(null!=(b=this.left)?b.clone():void 0)||
null:this.left,a?this.right.clone():this.right,this.string,this.negated)};c.prototype.toString=function(a,e,d){var b,f,g;null==a&&(a=!1);null==e&&(e=null);null==d&&(d=!1);return c.__super__.toString.call(this,""+((null!=(b=this.left)?b.toString(a,this,"IF"===(f=this.operator)||"IFF"===f||"XOR"===f):void 0)||"")+(""+this.operatorString())+this.right.toString(a,this,"AND"===(g=this.operator)||"NAND"===g||"OR"===g||"NOR"===g),a,e,d)};c.prototype.evaluate=function(a){var b,d,f;null==a&&(a=null);b=null!=
(d=this.left)?d.evaluate(a):void 0;f=this.right.evaluate(a);return c.__super__.evaluate.call(this,function(){switch(this.operator){case "NOT":return this.applyOperator("NOT",f);case "NAND":return this.applyOperator("NOT",this.applyOperator("AND",b,f));case "NOR":return this.applyOperator("NOT",this.applyOperator("OR",b,f));case "IF":return this.applyOperator("OR",this.applyOperator("NOT",b),f);case "IFF":return this.applyOperator("OR",this.applyOperator("AND",b,f),this.applyOperator("AND",this.applyOperator("NOT",
b),this.applyOperator("NOT",f)));case "XOR":return this.applyOperator("OR",this.applyOperator("AND",b,this.applyOperator("NOT",f)),this.applyOperator("AND",this.applyOperator("NOT",b),f))}}.call(this))};c.prototype.equals=function(a,e){return c.__super__.equals.call(this,a,e)&&(null==this.left||this.left.equals(a.left,!1))&&this.right.equals(a.right,!1)};c.prototype.getOperators=function(a){var b,c;null==a&&(a=!1);return(null!=(b=null!=(c=this.left)?c.getOperators(a):void 0)?b:[]).concat(this.getOperator(a),
this.right.getOperators(a))};c.prototype.getVariables=function(){var a,c;return(null!=(a=null!=(c=this.left)?c.getVariables():void 0)?a:[]).concat(this.right.getVariables())};c.prototype.getOperands=function(){return null!=this.left?[this.left,this.right]:[this.right]};c.prototype.findOperator=function(a,e,d){var b,f;null==d&&(d="none");return(null!=(b=null!=(f=this.left)?f.findOperator(a,e.concat(["left"]),d):void 0)?b:[]).concat(c.__super__.findOperator.call(this,a,e,null,d),this.right.findOperator(a,
e.concat(["right"]),d))};c.prototype.findExpression=function(a,e){var b,d;return(null!=(b=null!=(d=this.left)?d.findExpression(a,e.concat(["left"])):void 0)?b:[]).concat(c.__super__.findExpression.call(this,a,e),this.right.findExpression(a,e.concat(["right"])))};c.prototype.findRule=function(a,e,d){var b,f;null==d&&(d=!1);return(null!=(b=null!=(f=this.left)?f.findRule(a,e.concat(["left"]),d):void 0)?b:[]).concat(c.__super__.findRule.call(this,a,e,d),this.right.findRule(a,e.concat(["right"]),d))};
c.prototype.applyRules=function(a,e,d){var b,f,g;this.rules=a;null==e&&(e=!1);null==d&&(d=!1);d&&(this.left=(null!=(b=this.left)?null!=(f=b.setSteps(this.steps))?f.applyRules(this.rules,e,!0):void 0:void 0)||null,this.right=this.right.setSteps((null!=(g=this.left)?g.steps:void 0)||this.steps).applyRules(this.rules,e,!0),this.setSteps(this.right.steps));return c.__super__.applyRules.apply(this,arguments)};c.prototype.truth=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return!a&&this.negationOp()&&
this.right.constant()?c||this.right.clone().negate():!c&&this};c.prototype.deMorgan=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return!a&&this.negationOp()&&this.right.junctionOp()?c||this.right.reverseNode():!c&&this};c.prototype.doubleNegation=function(a,e){null==a&&(a=!1);null==e&&(e=!1);return!a&&this.negationOp()&&this.right.negationOp()?e||this.unnegateNode().unnegateNode():c.__super__.doubleNegation.apply(this,arguments)};c.prototype.negativeConjunction=function(a,e){null==a&&(a=!1);null==
e&&(e=!1);return!a&&this.negativeConjunctionOp()?e||(new CTATLogicFlattenNode("AND",[this.left,this.right])).negateNode():a&&this.negationOp()&&this.right.conjunctionOp()&&2===this.right.terms.length?e||new c("NAND",this.right.terms[0],this.right.terms[1]):!e&&this};c.prototype.negativeDisjunction=function(a,e){null==a&&(a=!1);null==e&&(e=!1);return!a&&this.negativeDisjunctionOp()?e||(new CTATLogicFlattenNode("OR",[this.left,this.right])).negateNode():a&&this.negationOp()&&this.right.disjunctionOp()&&
2===this.right.terms.length?e||new c("NOR",this.right.terms[0],this.right.terms[1]):!e&&this};c.prototype.implication=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return!a&&this.implicationOp()?c||new CTATLogicFlattenNode("OR",[this.left.negateNode(),this.right]):!c&&this};c.prototype.biimplication=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return!a&&this.biimplicationOp()?c||new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",[this.left.negateNode(),
this.right.negateNode()])]):!c&&this};c.prototype.biimplicationToImplication=function(a,e){null==a&&(a=!1);null==e&&(e=!1);return!a&&this.biimplicationOp()?e||new CTATLogicFlattenNode("AND",[new c("IF",this.left,this.right),new c("IF",this.right,this.left)]):!e&&this};c.prototype.exclusiveDisjunction=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return!a&&this.exclusiveDisjunctionOp()?c||new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right.negateNode()]),new CTATLogicFlattenNode("AND",
[this.left.negateNode(),this.right])]):!c&&this};c.prototype.exclusiveDisjunctionToImplication=function(a,e){null==a&&(a=!1);null==e&&(e=!1);return!a&&this.exclusiveDisjunctionOp()?e||new CTATLogicFlattenNode("AND",[new c("IF",this.left,this.right.negateNode()),new c("IF",this.right.negateNode(),this.left)]):!e&&this};c.prototype.normalFormOperators=function(){return c.__super__.normalFormOperators.apply(this,arguments)&&(null==this.left||this.left.normalFormOperators())&&this.right.normalFormOperators()};
c.prototype.atomicNegation=function(){return this.atomic()||!this.negationOp()&&!this.negated&&this.left.atomicNegation()&&this.right.atomicNegation()};c.prototype.atomicConjunction=function(){return this.atomic()||(null==this.left||this.left.atomicConjunction())&&this.right.atomicConjunction()};c.prototype.atomicDisjunction=function(){return this.atomic()||(null==this.left||this.left.atomicDisjunction())&&this.right.atomicDisjunction()};c.prototype.replaceNodes=function(){var a,c,d,f;f=CTATLogicTreeNode.diff(this.rules,
["replaceNodes"]);switch(this.operator){case "NOT":return this.right.setSteps(this.steps).negate();case "NAND":case "NOR":return(new CTATLogicFlattenNode(this.unnegateOperator(),[this.left,this.right])).setSteps(this.steps+1).negate().applyRules(f);case "IF":return(new CTATLogicFlattenNode("OR",[a=this.left.setSteps(this.steps).negate().applyRules(f),this.right])).setSteps(a.steps+1);case "IFF":return c=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,this.right]),new CTATLogicFlattenNode("AND",
[a=this.left.clone().setSteps(this.steps).negate().applyRules(f),d=this.right.clone().setSteps(a.steps).negate().applyRules(f)])]),c.setSteps(d.steps).terms=c.terms.map(function(a){return function(a){a=a.setSteps(c.steps).applyRules(f);c.setSteps(a.steps);return a}}(this)),c.setSteps(c.steps+1);case "XOR":return c=new CTATLogicFlattenNode("OR",[new CTATLogicFlattenNode("AND",[this.left,d=this.right.clone().setSteps(this.steps).negate().applyRules(f)]),new CTATLogicFlattenNode("AND",[a=this.left.clone().setSteps(d.steps).negate().applyRules(f),
this.right])]),c.setSteps(a.steps).terms=c.terms.map(function(a){return function(a){a=a.setSteps(c.steps).applyRules(f);c.setSteps(a.steps);return a}}(this)),c.setSteps(c.steps+1)}};c.prototype.sort=function(){var a;("NAND"===(a=this.operator)||"NOR"===a||"IFF"===a||"XOR"===a)&&0<this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1]);return this};c.prototype.compare=function(a){return c.__super__.compare.apply(this,arguments)||("NOT"===this.operator&&"NOT"===a.operator?
this.right.compare(a.right):"NOT"===this.operator?this.right.compare(a):"NOT"===a.operator?this.compare(a.right):this.left.compare(a.left)||this.right.compare(a.right))||this.compareNegations(a)};c.prototype.precedence=function(a){null==a&&(a=!1);return a&&"NOT"===this.operator?this.right.precedence():c.__super__.precedence.apply(this,arguments)};c.prototype.countVariables=function(){var a;return((null!=(a=this.left)?a.countVariables():void 0)||0)+this.right.countVariables()};c.prototype.countLevels=
function(){var a;return"NOT"===this.operator?this.right.countLevels():1+Math.max((null!=(a=this.left)?a.countLevels():void 0)||0,this.right.countLevels())};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicRelationNode=a}).call(this);var CTATLogicVariableNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(a,c,d){this.variableTable=a;this.variable=c;this.negated=null!=d?d:!1;this.operator="VAR"}g(c,a);c.prototype.clone=function(){return new c(this.variableTable,this.variable,this.negated)};c.prototype.toString=function(a,e,d){null==a&&(a=!1);null==e&&(e=null);null==d&&(d=!1);
return c.__super__.toString.call(this,this.variable,a,e,d)};c.prototype.evaluate=function(a){null==a&&(a=null);return c.__super__.evaluate.call(this,function(){if(null!=a)return("function"===typeof a.get?a.get(this.variable):void 0)||a[this.variable];if(null!=this.variableTable)return this.variableTable.get(this.variable);try{return eval(this.variable)}catch(e){}}.call(this))};c.prototype.equals=function(a,e){return c.__super__.equals.call(this,a,e)&&this.variable===a.variable};c.prototype.getVariables=
function(){return[this.variable]};c.prototype.compare=function(a){return c.__super__.compare.apply(this,arguments)||this.variable>a.variable&&1||this.variable<a.variable&&-1||this.compareNegations(a)};c.prototype.countVariables=function(){return 1};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicVariableNode=a}).call(this);var CTATLogicConstantNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(a,e,d){this.value=a;this.string=null!=e?e:null;this.negated=null!=d?d:!1;this.operator="CONST";c.__super__.constructor.call(this,this.value)}g(c,a);c.prototype.clone=function(){return new c(this.value,this.string,this.negated)};c.prototype.toString=function(a,e,d){null==a&&
(a=!1);null==e&&(e=null);null==d&&(d=!1);return c.__super__.toString.call(this,this.string,a,e,d)};c.prototype.evaluate=function(a){return c.__super__.evaluate.call(this,this.value)};c.prototype.equals=function(a,e){return c.__super__.equals.call(this,a,e)&&e!==(this.value===a.value)};c.prototype.truth=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a?c||this.negateNode():!c&&this};c.prototype.compare=function(a){return c.__super__.compare.apply(this,arguments)||this.value-a.value};c.prototype.negate=
function(){this.setSteps(this.steps+1);this.value=!this.value;this.string=CTATLogicTreeNode.toOperatorString(this.value);return this};c.prototype.constant=function(a){null==a&&(a=null);return null==a||this.value===a};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicConstantNode=a}).call(this);var CTATLogicGrammar=function(){function a(){this.yy={}}var g=function(a,b,c,e){c=c||{};for(e=a.length;e--;c[a[e]]=b);return c},f=[1,3],c=[1,5],d=[1,6],b=[1,7],e=[1,8],h=[1,10],l=[1,11],m=[1,12],n=[1,13],p=[1,14],v=[1,15],r=[1,16],u=[5,6,7,8,9,10,11,12,16],w=[5,7,9,10,11,12,16],g={trace:function(){},yy:{},symbols_:{error:2,expression:3,logical:4,EOF:5,AND:6,OR:7,NAND:8,NOR:9,XOR:10,IF:11,IFF:12,NOT:13,atom:14,LPAREN:15,RPAREN:16,VARIABLE:17,TRUE:18,FALSE:19,$accept:0,$end:1},terminals_:{2:"error",
5:"EOF",6:"AND",7:"OR",8:"NAND",9:"NOR",10:"XOR",11:"IF",12:"IFF",13:"NOT",15:"LPAREN",16:"RPAREN",17:"VARIABLE",18:"TRUE",19:"FALSE"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,1],[14,3],[14,1],[14,1],[14,1]],performAction:function(a,b,c,e,d,f,g){a=f.length-1;switch(d){case 1:return f[a-1];case 2:e.parser.checkStrict(f[a-2],g[a-2],e.lexer.matched);e.parser.checkStrict(f[a],g[a],e.lexer.matched);this.$=f[a-2].addOperand("AND",f[a],f[a-1]);break;case 3:e.parser.checkStrict(f[a-
2],g[a-2],e.lexer.matched);e.parser.checkStrict(f[a],g[a],e.lexer.matched);this.$=f[a-2].addOperand("OR",f[a],f[a-1]);break;case 4:e.parser.checkStrict(f[a-2],g[a-2],e.lexer.matched);e.parser.checkStrict(f[a],g[a],e.lexer.matched);this.$=new e.CTATLogicRelationNode("NAND",f[a-2],f[a],f[a-1]);break;case 5:e.parser.checkStrict(f[a-2],g[a-2],e.lexer.matched);e.parser.checkStrict(f[a],g[a],e.lexer.matched);this.$=new e.CTATLogicRelationNode("NOR",f[a-2],f[a],f[a-1]);break;case 6:e.parser.checkStrict(f[a-
2],g[a-2],e.lexer.matched);e.parser.checkStrict(f[a],g[a],e.lexer.matched);this.$=new e.CTATLogicRelationNode("XOR",f[a-2],f[a],f[a-1]);break;case 7:e.parser.checkStrict(f[a-2],g[a-2],e.lexer.matched);e.parser.checkStrict(f[a],g[a],e.lexer.matched);this.$=new e.CTATLogicRelationNode("IF",f[a-2],f[a],f[a-1]);break;case 8:e.parser.checkStrict(f[a-2],g[a-2],e.lexer.matched);e.parser.checkStrict(f[a],g[a],e.lexer.matched);this.$=new e.CTATLogicRelationNode("IFF",f[a-2],f[a],f[a-1]);break;case 9:e.parser.checkStrict(f[a],
g[a],e.lexer.matched);this.$=new e.CTATLogicRelationNode("NOT",null,f[a],f[a-1]);break;case 10:this.$=f[a];break;case 11:this.$=f[a-1].setParens();break;case 12:this.$=new e.CTATLogicVariableNode(e.variableTable,f[a]);break;case 13:this.$=new e.CTATLogicConstantNode(!0,f[a]);break;case 14:this.$=new e.CTATLogicConstantNode(!1,f[a])}},table:[{3:1,4:2,13:f,14:4,15:c,17:d,18:b,19:e},{1:[3]},{5:[1,9],6:h,7:l,8:m,9:n,10:p,11:v,12:r},{4:17,13:f,14:4,15:c,17:d,18:b,19:e},g(u,[2,10]),{4:18,13:f,14:4,15:c,
17:d,18:b,19:e},g(u,[2,12]),g(u,[2,13]),g(u,[2,14]),{1:[2,1]},{4:19,13:f,14:4,15:c,17:d,18:b,19:e},{4:20,13:f,14:4,15:c,17:d,18:b,19:e},{4:21,13:f,14:4,15:c,17:d,18:b,19:e},{4:22,13:f,14:4,15:c,17:d,18:b,19:e},{4:23,13:f,14:4,15:c,17:d,18:b,19:e},{4:24,13:f,14:4,15:c,17:d,18:b,19:e},{4:25,13:f,14:4,15:c,17:d,18:b,19:e},g(u,[2,9]),{6:h,7:l,8:m,9:n,10:p,11:v,12:r,16:[1,26]},g(u,[2,2]),g(w,[2,3],{6:h,8:m}),g(w,[2,4],{6:h}),g([5,10,11,12,16],[2,5],{6:h,7:l,8:m}),g([5,11,12,16],[2,6],{6:h,7:l,8:m,9:n,
10:p}),g([5,12,16],[2,7],{6:h,7:l,8:m,9:n,10:p,11:v}),g([5,16],[2,8],{6:h,7:l,8:m,9:n,10:p,11:v,12:r}),g(u,[2,11])],defaultActions:{9:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else{var c=Error(a);c.hash=b;throw c;}},parse:function(a){var b=[0],c=[null],e=[],d=this.table,f="",g=0,h=0,m=0,l=e.slice.call(arguments,1),n=Object.create(this.lexer),p={},r;for(r in this.yy)Object.prototype.hasOwnProperty.call(this.yy,r)&&(p[r]=this.yy[r]);n.setInput(a,p);p.lexer=n;p.parser=this;"undefined"==
typeof n.yylloc&&(n.yylloc={});r=n.yylloc;e.push(r);var v=n.options&&n.options.ranges;this.parseError="function"===typeof p.parseError?p.parseError:Object.getPrototypeOf(this).parseError;for(var u,w,B,P,T={},Q,R;;){B=b[b.length-1];if(this.defaultActions[B])P=this.defaultActions[B];else{if(null===u||"undefined"==typeof u)u=n.lex()||1,"number"!==typeof u&&(u=this.symbols_[u]||u);P=d[B]&&d[B][u]}if("undefined"===typeof P||!P.length||!P[0]){var U;R=[];for(Q in d[B])this.terminals_[Q]&&2<Q&&R.push("'"+
this.terminals_[Q]+"'");U=n.showPosition?"Parse error on line "+(g+1)+":\n"+n.showPosition()+"\nExpecting "+R.join(", ")+", got '"+(this.terminals_[u]||u)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==u?"end of input":"'"+(this.terminals_[u]||u)+"'");this.parseError(U,{text:n.match,token:this.terminals_[u]||u,line:n.yylineno,loc:r,expected:R})}if(P[0]instanceof Array&&1<P.length)throw Error("Parse Error: multiple actions possible at state: "+B+", token: "+u);switch(P[0]){case 1:b.push(u);c.push(n.yytext);
e.push(n.yylloc);b.push(P[1]);u=null;w?(u=w,w=null):(h=n.yyleng,f=n.yytext,g=n.yylineno,r=n.yylloc,0<m&&m--);break;case 2:R=this.productions_[P[1]][1];T.$=c[c.length-R];T._$={first_line:e[e.length-(R||1)].first_line,last_line:e[e.length-1].last_line,first_column:e[e.length-(R||1)].first_column,last_column:e[e.length-1].last_column};v&&(T._$.range=[e[e.length-(R||1)].range[0],e[e.length-1].range[1]]);B=this.performAction.apply(T,[f,h,g,p,P[1],c,e].concat(l));if("undefined"!==typeof B)return B;R&&(b=
b.slice(0,-2*R),c=c.slice(0,-1*R),e=e.slice(0,-1*R));b.push(this.productions_[P[1]][0]);c.push(T.$);e.push(T._$);P=d[b[b.length-2]][b[b.length-1]];b.push(P);break;case 3:return!0}}},checkStrict:function(a,b,c){var e=c+"\n"+"-".repeat(b.first_column)+"^",d=["'LPAREN'","'VARIABLE'","'TRUE'","'FALSE'"],e="Parse error on line "+b.first_line+":\n"+e+"\nExpecting "+d.join(", ")+" got '"+c[b.first_column]+"'";this.yy.strictMode&&!a.checkParens()&&this.parseError(e,{text:c,token:a.operator,line:b.first_line,
loc:b,expected:d})}},f=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=
this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-
1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=
!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<
a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,e;this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,
last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(e.yylloc.range=this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?
c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(a[0].length);this.matched+=a[0];c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(c)return c;
if(this._backtrack)for(var d in e)this[d]=e[d];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var e=this._currentRules(),d=0;d<e.length;d++)if((b=this._input.match(this.rules[e[d]]))&&(!a||b[0].length>a[0].length))if(a=b,c=d,this.options.backtrack_lexer){a=this.test_match(b,e[d]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,e[c]),!1!==
a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?
this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,e){switch(c){case 1:return 15;case 2:return 16;case 3:return 12;case 4:return 12;case 5:return 12;case 6:return 12;case 7:return 12;case 8:return 12;
case 9:return 12;case 10:return 10;case 11:return 10;case 12:return 10;case 13:return 10;case 14:return 10;case 15:return 10;case 16:return 11;case 17:return 11;case 18:return 11;case 19:return 11;case 20:return 11;case 21:return 8;case 22:return 8;case 23:return 8;case 24:return 8;case 25:return 8;case 26:return 8;case 27:return 8;case 28:return 8;case 29:return 8;case 30:return 8;case 31:return 8;case 32:return 6;case 33:return 6;case 34:return 6;case 35:return 6;case 36:return 6;case 37:return 6;
case 38:return 9;case 39:return 9;case 40:return 9;case 41:return 9;case 42:return 9;case 43:return 9;case 44:return 9;case 45:return 9;case 46:return 9;case 47:return 9;case 48:return 9;case 49:return 7;case 50:return 7;case 51:return 7;case 52:return 7;case 53:return 7;case 54:return 13;case 55:return 13;case 56:return 13;case 57:return 13;case 58:return 18;case 59:return 18;case 60:return 18;case 61:return 18;case 62:return 19;case 63:return 19;case 64:return 19;case 65:return 19;case 66:return 17;
case 67:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:=)/,/^(?:<=>)/,/^(?:<->)/,/^(?:\u21d4)/,/^(?:\u2194)/,/^(?:\u2261)/,/^(?:\u2299)/,/^(?:\u2260)/,/^(?:\u2262)/,/^(?:\u22bb)/,/^(?:\u2295)/,/^(?:\^)/,/^(?:<~>)/,/^(?:=>)/,/^(?:->)/,/^(?:\u21d2)/,/^(?:\u2192)/,/^(?:\u2283)/,/^(?:\u2191)/,/^(?:\u22bc)/,/^(?:~\/\\)/,/^(?:~&&)/,/^(?:~&)/,/^(?:!\/\\)/,/^(?:!&&)/,/^(?:!&)/,/^(?:-\/\\)/,/^(?:-&&)/,/^(?:-&)/,/^(?:&&)/,/^(?:&)/,/^(?:\u2227)/,/^(?:\/\\)/,/^(?:\*)/,/^(?:\.)/,/^(?:\u2193)/,/^(?:\u22bd)/,
/^(?:~\\\/)/,/^(?:~\|\|)/,/^(?:~\|)/,/^(?:!\\\/)/,/^(?:!\|\|)/,/^(?:!\|)/,/^(?:-\\\/)/,/^(?:-\|\|)/,/^(?:-\|)/,/^(?:\|\|)/,/^(?:\|)/,/^(?:\u2228)/,/^(?:\\\/)/,/^(?:\+)/,/^(?:~)/,/^(?:\u00ac)/,/^(?:!)/,/^(?:-)/,/^(?:([Tt][Rr][Uu][Ee]))/,/^(?:T\b)/,/^(?:\u22a4)/,/^(?:1\b)/,/^(?:([Ff][Aa][Ll][Ss][Ee]))/,/^(?:F\b)/,/^(?:\u22a5)/,/^(?:0\b)/,/^(?:([A-Za-z][0-9]*))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,
37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67],inclusive:!0}}}}();g.lexer=f;a.prototype=g;g.Parser=a;return new a}();var CTATLogicFlattenNode={};
(function(){var a,g=function(a,d){function b(){this.constructor=a}for(var c in d)f.call(d,c)&&(a[c]=d[c]);b.prototype=d.prototype;a.prototype=new b;a.__super__=d.prototype;return a},f={}.hasOwnProperty;a=function(a){function c(a,e,d,f){this.operator=a;this.terms=e;this.string=null!=d?d:null;this.negated=null!=f?f:!1;c.__super__.constructor.call(this,this.operator)}g(c,a);c.prototype.addOperand=function(a,e,d){null==d&&(d=null);if(a!==this.operator||this.parens)return c.__super__.addOperand.apply(this,arguments);
this.terms.push(e);return this};c.prototype.clone=function(a){null==a&&(a=!0);return new c(this.operator,a?this.terms.map(function(a){return a.clone()}):this.terms,this.string,this.negated)};c.prototype.toString=function(a,e,d){null==a&&(a=!1);null==e&&(e=null);null==d&&(d=!1);return c.__super__.toString.call(this,this.terms.reduce(function(b){return function(c,e){return""+c+(c?""+b.operatorString():"")+e.toString(a,b,!0)}}(this),""),a,e,d)};c.prototype.evaluate=function(a){null==a&&(a=null);return c.__super__.evaluate.call(this,
this.terms.reduce(function(b){return function(c,e){return b.applyOperator(b.operator,c,e.evaluate(a))}}(this),this.conjunctionOp()))};c.prototype.equals=function(a,e){return c.__super__.equals.call(this,a,e)&&this.terms.length===a.terms.length&&this.terms.every(function(b,c){return b.equals(a.terms[c],!1)})};c.prototype.subEquals=function(a,c){return this.operator===a.operator&&!a.negated&&this.terms.length>=a.terms.length&&a.terms.every(function(a){return function(b,e){return b.equals(a.terms[c+
e],!1)}}(this))};c.prototype.subNode=function(a,c){return null!=a?Object.assign(this.clone(!1),{terms:this.terms.slice(a,c)}):this};c.prototype.getOperators=function(a){null==a&&(a=!1);return this.terms.slice(1).reduce(function(b){return function(c,e,d){return c.concat(b.getOperator(a),e.getOperators(a))}}(this),this.terms[0].getOperators(a))};c.prototype.getVariables=function(){return this.terms.slice(1).reduce(function(a){return function(a,b,c){return a.concat(b.getVariables())}}(this),this.terms[0].getVariables())};
c.prototype.getOperands=function(){return this.terms.slice(0)};c.prototype.findOperator=function(a,e,d){null==d&&(d="none");return this.terms.slice(1).reduce(function(b){return function(f,g,h){return f.concat(c.__super__.findOperator.call(b,a,e,h,d),g.findOperator(a,e.concat([h+1]),d))}}(this),this.terms[0].findOperator(a,e.concat([0]),d))};c.prototype.findExpression=function(a,e){return this.terms.slice(1).reduce(function(b){return function(d,f,g){return d.concat(c.__super__.findExpression.call(b,
a,e,g),f.findExpression(a,e.concat([g+1])))}}(this),this.terms[0].findExpression(a,e.concat([0])))};c.prototype.findRule=function(a,e,d){null==d&&(d=!1);return this.terms.slice(1).reduce(function(b){return function(f,g,h){return f.concat(c.__super__.findRule.call(b,a,e,d,h),g.findRule(a,e.concat([h+1]),d))}}(this),this.terms[0].findRule(a,e.concat([0]),d))};c.prototype.applyRules=function(a,e,d){this.rules=a;null==e&&(e=!1);null==d&&(d=!1);d&&(this.terms=this.terms.map(function(a){return function(b){b=
b.setSteps(a.steps).applyRules(a.rules,e,!0);a.setSteps(b.steps);return b}}(this)));return c.__super__.applyRules.apply(this,arguments)};c.prototype.domination=function(a,c){var b;null==a&&(a=!1);null==c&&(c=!1);return!a&&this.junctionOp()&&(b=this.terms.find(function(a){return function(b){return b.constant(a.disjunctionOp())}}(this)))?c||b:!c&&this};c.prototype.negation=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return!a&&this.junctionOp()&&this.terms.some(function(a){return function(b,c){return a.terms.slice(c+
1).some(function(a){return a.inverse(b)})}}(this))?c||new CTATLogicConstantNode(this.disjunctionOp()):!c&&this};c.prototype.identity=function(a,e){var b;null==a&&(a=!1);null==e&&(e=!1);return!a&&this.junctionOp()&&(b=this.terms.filter(function(a){return function(b){return b.constant(a.conjunctionOp())}}(this))).length?e||this.junctionNode(CTATLogicTreeNode.difference(this.terms,b)):a&&this.junctionOp()?e||this.junctionNode(this.terms.push(new CTATLogicConstantNode(this.conjunctionOp()))):c.__super__.identity.apply(this,
arguments)};c.prototype.idempotence=function(a,e){var b;null==a&&(a=!1);null==e&&(e=!1);return!a&&this.junctionOp()&&(b=this.terms.filter(function(a){return function(b,c){return a.terms.slice(c+1).some(function(a){return a.equals(b)})}}(this))).length?e||this.junctionNode(CTATLogicTreeNode.difference(this.terms,b)):a&&this.junctionOp()?e||this.junctionNode(this.terms.concat(this.terms)):c.__super__.idempotence.apply(this,arguments)};c.prototype.absorption=function(a,c){var b;null==a&&(a=!1);null==
c&&(c=!1);return!a&&this.junctionOp()&&(b=this.terms.reduce(function(a){return function(b,c){return b.concat(c.findPairs(a.inverseOperator(),a.terms,"equals"))}}(this),[])).length?c||this.junctionNode(CTATLogicTreeNode.replaceTerms(this.terms,b,!1)):!c&&this};c.prototype.inverseAbsorption=function(a,c){var b;null==a&&(a=!1);null==c&&(c=!1);return!a&&this.junctionOp()&&(b=this.terms.reduce(function(a){return function(b,c){return b.concat(c.findPairs(a.inverseOperator(),a.terms,"inverse"))}}(this),
[])).length?c||this.junctionNode(CTATLogicTreeNode.replaceTerms(this.terms,b,!0)):!c&&this};c.prototype.junctionNode=function(a){return 1===a.length?a[0]:Object.assign(this.clone(),{terms:a})};c.prototype.commutativity=function(a,e){null==e&&(e=!1);return this.junctionOp()?e||new c(this.operator,this.terms.slice(0).reverse()):!e&&this};c.prototype.associativity=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return this.junctionOp()&&this.terms.some(function(a){return function(b){return b.operator===
a.operator}}(this))?c||this.clone().flatten():!c&&this};c.prototype.distributivity=function(a,e){var b,d,f,g,p,v;null==a&&(a=!1);null==e&&(e=!1);return!a&&this.junctionOp()&&-1!==(d=this.terms.findIndex(function(a){return function(b){return b.junctionOp()&&b.operator!==a.operator}}(this)))?(b=this.terms[d],v=CTATLogicTreeNode.removeIndex(this.terms,d),e||new c(b.operator,b.terms.map(function(a){return function(b){return new c(a.operator,v.concat([b]))}}(this)))):a&&this.junctionOp()&&this.terms.every(function(a){return function(b){return b.junctionOp()&&
b.operator!==a.operator}}(this))&&(p=this.terms.map(function(a){return a.terms}))&&(g=CTATLogicTreeNode.commonLength(p))&&(f=CTATLogicTreeNode.intersection(p))&&f.length===g-1?e||(b=p.map(function(a){return function(a){return CTATLogicTreeNode.difference(a,f)[0]}}(this)),new c(this.terms[0].operator,f.concat([new c(this.operator,b)]))):!e&&this};c.prototype.deMorgan=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a&&this.junctionOp()&&this.terms.every(function(a){return a.negationOp()})?this.reverseNode(!0).negateNode():
!c&&this};c.prototype.reverseNode=function(a){null==a&&(a=!1);return new c(this.inverseOperator(),this.terms.map(function(b){return a?b.unnegateNode():b.negateNode()}))};c.prototype.implication=function(a,e){var b,d;null==a&&(a=!1);null==e&&(e=!1);return a&&this.disjunctionOp()&&this.terms.some(function(a){return a.negationOp()})&&this.terms.some(function(a){return!a.negationOp()})?e||(b=this.terms.filter(function(a){return a.negationOp()}).map(function(a){return a.unnegateNode()}),d=this.terms.filter(function(a){return!a.negationOp()}),
new CTATLogicRelationNode("IF",1<b.length?new c("AND",b):b[0],1<d.length?new c("OR",d):d[0])):!e&&this};c.prototype.biimplication=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a&&this.disjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.conjunctionOp()})&&this.terms[0].terms.every(function(a){return function(b){return a.terms[1].terms.some(function(a){return a.inverse(b)})}}(this))&&CTATLogicTreeNode.sameNegation(this.terms[0].terms)&&CTATLogicTreeNode.sameNegation(this.terms[1].terms)?
c||new CTATLogicRelationNode("IFF",this.terms[0].terms[0].unnegateNode(),this.terms[0].terms[1].unnegateNode()):!c&&this};c.prototype.biimplicationToImplication=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a&&this.conjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.implicationOp()})&&this.terms[0].left.equals(this.terms[1].right)&&this.terms[0].right.equals(this.terms[1].left)?c||new CTATLogicRelationNode("IFF",this.terms[0].left,this.terms[0].right):!c&&this};c.prototype.exclusiveDisjunction=
function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a&&this.disjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.conjunctionOp()})&&this.terms[0].terms.every(function(a){return function(b){return a.terms[1].terms.some(function(a){return a.inverse(b)})}}(this))&&CTATLogicTreeNode.oppositeNegation(this.terms[0].terms)&&CTATLogicTreeNode.oppositeNegation(this.terms[1].terms)?c||new CTATLogicRelationNode("XOR",this.terms[0].terms[0].unnegateNode(),this.terms[0].terms[1].unnegateNode()):
!c&&this};c.prototype.exclusiveDisjunctionToImplication=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return a&&this.conjunctionOp()&&2===this.terms.length&&this.terms.every(function(a){return a.implicationOp()})&&this.terms[0].left.equals(this.terms[1].right)&&this.terms[0].right.equals(this.terms[1].left)?c||new CTATLogicRelationNode("XOR",this.terms[0].left.unnegateNode(),this.terms[0].right.unnegateNode()):!c&&this};c.prototype.normalFormOperators=function(){return c.__super__.normalFormOperators.apply(this,
arguments)&&this.terms.every(function(a){return a.normalFormOperators()})};c.prototype.atomicNegation=function(){return!this.negated&&this.terms.every(function(a){return a.atomicNegation()})};c.prototype.atomicConjunction=function(){return this.conjunctionOp()&&this.terms.every(function(a){return a.atomic()})||!this.conjunctionOp()&&this.terms.every(function(a){return a.atomicConjunction()})};c.prototype.atomicDisjunction=function(){return this.disjunctionOp()&&this.terms.every(function(a){return a.atomic()})||
!this.disjunctionOp()&&this.terms.every(function(a){return a.atomicDisjunction()})};c.prototype.pushNegation=function(){this.negated&&(this.negate(),this.invertOperator(),this.terms.forEach(function(a){return function(b){b.setSteps(a.steps).negate().pushNegation();return a.setSteps(b.steps)}}(this)),this.setSteps(this.steps+1));return this};c.prototype.flatten=function(){this.terms=this.terms.reduce(function(a){return function(b,c){c.operator!==a.operator?b.push(c):b.push.apply(b,c.terms);return b}}(this),
[]);return this};c.prototype.distributeDisjunction=function(){var a,c;return this.disjunctionOp()&&this.conjunctiveTerms()?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(c=this.terms.pop()).setSteps(this.steps).terms=c.terms.map(function(b){return function(e){var d;d=b.clone();d.terms.push(e);d=d.setSteps(c.steps).applyRules(a);c.setSteps(d.steps);return d}}(this)),c.setSteps(c.steps+1).applyRules(["flatten","sort","distributeDisjunction"])):this};c.prototype.conjunctiveTerms=
function(){return this.terms.some(function(a){return a.conjunctionOp()})};c.prototype.distributeConjunction=function(){var a,c;return this.conjunctionOp()&&this.disjunctiveTerms()?(a=CTATLogicTreeNode.diff(this.rules,["replaceNodes","pushNegation"]),(c=this.terms.pop()).setSteps(this.steps).terms=c.terms.map(function(b){return function(e){var d;d=b.clone();d.terms.push(e);d=d.setSteps(c.steps).applyRules(a);c.setSteps(d.steps);return d}}(this)),c.setSteps(c.steps+1).applyRules(["flatten","sort","distributeConjunction"])):
this};c.prototype.disjunctiveTerms=function(){return this.terms.some(function(a){return a.disjunctionOp()})};c.prototype.absorb=function(){this.terms=this.terms.reduce(function(a){return function(b,c){var d,e,f,g;b instanceof Array&&(a.disjunctionOp()&&c.constant(!0)||a.conjunctionOp()&&c.constant(!1)?b=c.setSteps(a.steps+1):c.constant()&&0===b.length?b.push(c):null!=(e=b[b.length-1])&&e.equals(c,!1)?a.setSteps(a.steps+1):null!=(f=b[b.length-1])&&f.equals(c,!0)?b=(new CTATLogicConstantNode(a.disjunctionOp(),
CTATLogicTreeNode.operatorStrings[a.disjunctionOp()])).setSteps(a.steps+1):c.junctionOp()&&b.find(function(a){return c.subterm(a,!1)})?a.setSteps(a.steps+1):c.junctionOp()&&(d=b.find(function(a){return c.subterm(a,!0)}))?(a.setSteps(a.steps+1),b.push(c.removeInverse(d))):(null!=(g=b[0])&&g.constant()&&(b.pop(),a.setSteps(a.steps+1)),b.push(c)));return b}}(this),[]);return this.terms instanceof Array?this.prune():this.terms};c.prototype.subterm=function(a,c){return this.terms.some(function(b){return a.equals(b,
c)})};c.prototype.removeInverse=function(a){this.terms=this.terms.filter(function(b){return!a.equals(b,!0)});return this.prune()};c.prototype.prune=function(){return 1===this.terms.length?this.terms[0].setSteps(this.steps):this};c.prototype.sort=function(){this.terms=this.terms.sort(function(a,c){return a.compare(c)});return this};c.prototype.compare=function(a){var b;return(b=c.__super__.compare.apply(this,arguments))||this.terms.some(function(c,d){return b=c.compare(a.terms[d])})&&b||this.compareNegations(a)};
c.prototype.countVariables=function(){return this.terms.reduce(function(a,c){return a+c.countVariables()},0)};c.prototype.countLevels=function(){return 1+this.terms.reduce(function(a,c){return Math.max(a,c.countLevels())},0)};return c}(CTATLogicTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicFlattenNode=a}).call(this);var CTATLogicParser={};
(function(){var a;a=function(){function a(a){this.parser=new CTATLogicGrammar.Parser;this.parser.yy={CTATLogicRelationNode:CTATLogicRelationNode,CTATLogicFlattenNode:CTATLogicFlattenNode,CTATLogicVariableNode:CTATLogicVariableNode,CTATLogicConstantNode:CTATLogicConstantNode,CTATLogicTreeNode:CTATLogicTreeNode};this.parser.yy.variableTable=a}a.SORTRule=["sort"];a.NNFRules="replaceNodes pushNegation flatten sort absorb sort".split(" ");a.CNFRules="replaceNodes pushNegation flatten sort distributeDisjunction absorb sort".split(" ");a.DNFRules=
"replaceNodes pushNegation flatten sort distributeConjunction absorb sort".split(" ");a.NNFTests=["normalFormOperators","atomicNegation"];a.CNFTests=["normalFormOperators","atomicNegation","atomicDisjunction"];a.DNFTests=["normalFormOperators","atomicNegation","atomicConjunction"];a.prototype.getTree=function(a,c,d){null==c&&(c=!1);null==d&&(d=!1);if(a instanceof CTATLogicTreeNode)a=c?a.clone():a;else{var b;if(a instanceof String)try{b=Object.assign(this.parser.parse(a),{path:a.path})}catch(e){b=
null}else try{b=this.parser.parse(String(a))}catch(e){b=null}a=b}d&&null!=a&&a.setSteps(0);return a};a.prototype.getExpression=function(a,c,d){null==d&&(d=!1);return a instanceof CTATLogicTreeNode?c:"string"===typeof c?c:null!=(null!=c?c.path:void 0)?Object.assign(new String(c.toString(d)),{path:c.path}):null!=(null!=c?c.steps:void 0)?Object.assign(new String(c.toString(d)),{steps:c.steps}):null!=c?c.toString(d):c};a.prototype.equalExpressions=function(a,c){return a instanceof CTATLogicTreeNode?a.toString()===
c.toString():a instanceof String?a.toString()===c.toString():a===c};a.prototype.logicSetMode=function(a){Object.assign(this.parser.yy,a);return a};a.prototype.logicParse=function(a){return this.getTree(a)};a.prototype.logicGetError=function(a){try{return a instanceof CTATLogicTreeNode||this.parser.parse(String(a)),null}catch(c){return c}};a.prototype.logicStringify=function(a){return this.getExpression("",a,this.parser.yy.strictMode)};a.prototype.logicEvaluate=function(a,c){null==c&&(c=null);try{return this.getTree(a).evaluate(c)}catch(d){return null}};
a.prototype.logicSort=function(f){return this.getExpression(f,this.getTree(f,!0).applyRules(a.SORTRule,!1,!0))};a.prototype.logicGetOperator=function(a,c){var d;null==c&&(c=!1);return null!=(d=this.getTree(a))?d.getOperator(c):void 0};a.prototype.logicGetOperators=function(a,c){var d;null==c&&(c=!1);return null!=(d=this.getTree(a))?d.getOperators(c):void 0};a.prototype.logicGetVariables=function(a){var c;return null!=(c=this.getTree(a))?c.getVariables():void 0};a.prototype.logicGetOperands=function(a){var c;
return null!=(c=this.getTree(a))?c.getOperands().map(function(c){return function(b){return c.getExpression(a,b)}}(this)):void 0};a.prototype.logicFindOperator=function(a,c,d){var b,e;null==d&&(d="none");return null!=(b=this.getTree(a))?null!=(e=b.findOperator(c,[],d))?e.map(function(b){return function(c){return b.getExpression(a,c)}}(this)):void 0:void 0};a.prototype.logicFindExpression=function(a,c){var d,b;return null!=(d=this.getTree(a))?null!=(b=d.findExpression(this.getTree(c),[]))?b.map(function(b){return function(c){return b.getExpression(a,
c)}}(this)):void 0:void 0};a.prototype.logicFindRule=function(a,c,d){var b,e;null==d&&(d=!1);return null!=(b=this.getTree(a))?null!=(e=b.findRule(c,[],d))?e.map(function(b){return function(c){return b.getExpression(a,c)}}(this)):void 0:void 0};a.prototype.logicApplyRules=function(a,c,d,b){var e;null==d&&(d=!1);null==b&&(b=!1);return this.getExpression(a,function(){try{return(e=this.getTree(a,b))&&e.applyRules(c,d,b)}catch(h){}}.call(this))};a.prototype.logicReplaceExpression=function(a,c,d,b){var e,
f;null==b&&(b=null);b=(null!=b?b:null!=(e=c.path)?e.slice(0):void 0)||0;return this.getExpression(a,(null!=(f=this.getTree(a))?f.replaceExpression(this.getTree(c),this.getTree(d),b):void 0)||null)};a.prototype.logicSimplifyNNF=function(f,c){null==c&&(c=!1);return this.getExpression(f,function(){try{return this.getTree(f,!0,c).applyRules(a.NNFRules,!1,!0)}catch(d){return null}}.call(this))};a.prototype.logicSimplifyCNF=function(f,c){null==c&&(c=!1);return this.getExpression(f,function(){try{return this.getTree(f,
!0,c).applyRules(a.CNFRules,!1,!0)}catch(d){return null}}.call(this))};a.prototype.logicSimplifyDNF=function(f,c){null==c&&(c=!1);return this.getExpression(f,function(){try{return this.getTree(f,!0,c).applyRules(a.DNFRules,!1,!0)}catch(d){return null}}.call(this))};a.prototype.logicValid=function(a){return null!=this.logicParse(a)};a.prototype.logicValued=function(a,c){null==c&&(c=null);return null!=this.logicEvaluate(a,c)};a.prototype.logicSorted=function(a){var c,d;return null!=(c=this.logicSort(a))&&
null!=(d=this.getExpression(a,this.getTree(a)))?this.equalExpressions(c,d):null};a.prototype.logicCheckNNF=function(f){try{return this.getTree(f).applyTests(a.NNFTests)}catch(c){return null}};a.prototype.logicCheckCNF=function(f){try{return this.getTree(f).applyTests(a.CNFTests)}catch(c){return null}};a.prototype.logicCheckDNF=function(f){try{return this.getTree(f).applyTests(a.DNFTests)}catch(c){return null}};a.prototype.logicSimplifiedNNF=function(a){var c,d;return null!=(c=this.logicSimplifyNNF(a))&&
null!=(d=this.logicSort(a))?this.equalExpressions(c,d):null};a.prototype.logicSimplifiedCNF=function(a){var c,d;return null!=(c=this.logicSimplifyCNF(a))&&null!=(d=this.logicSort(a))?this.equalExpressions(c,d):null};a.prototype.logicSimplifiedDNF=function(a){var c,d;return null!=(c=this.logicSimplifyDNF(a))&&null!=(d=this.logicSort(a))?this.equalExpressions(c,d):null};a.prototype.logicIdentical=function(a,c){return null!=(a=this.logicSort(a))&&null!=(c=this.logicSort(c))?this.equalExpressions(a,c):
null};a.prototype.logicEqual=function(a,c,d){null==d&&(d=null);a=this.logicEvaluate(a,d);c=this.logicEvaluate(c,d);if(null!=a&&null!=c)return a===c;if(null===a||null===c)return null};a.prototype.logicEquivalent=function(a,c){return null!=(a=this.logicSimplifyDNF(a))&&null!=(c=this.logicSimplifyDNF(c))?this.equalExpressions(a,c):null};a.prototype.logicSemanticEquivalent=function(a,c){try{return!this.getTree(a).findCounterExample(this.getTree(c))}catch(d){return null}};a.prototype.logicFindCounterExample=
function(a,c){try{return this.getTree(a).findCounterExample(this.getTree(c))}catch(d){return null}};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATLogicParser=a}).call(this);var CTATFormulaFunctions={};
(function(){var a,g,f,c,d,b,e,h,l,m,n,p=[].slice;d=/^(\d+)?(?:$|(?:\s|^)(\d+)\/(\d+)$)/;c=/^\d+(\.\d\d)?$/;b=RegExp("((\\d+)\\.?(\\d+)?|\\.(\\d+))([Ee]([+-]?\\d+))?","g");m=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?$/;l=/^\s*\(\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\,\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\)\s*$/;h=/([bcdfghjklmnpqrstvwxz]|qu)y$/;e=/([bcdfghjklmnpqrstvwxz]o|[sc]h|s)$/;n=function(a,b){var c;null==b&&(b=!1);var d,e,f,g;f=null!=(c=a[4])?c:a[2]+(a[3]||
"");g=[];d=0;for(e=f.length;d<e;d++)c=f[d],(b||(b="0"!==c))&&g.push(c);return g.length};f=function(a){return(a[4]||a[3]||"").length-+(a[6]||0)};g=function(a,b,c){var d,e;return isNaN(d=+a)||isNaN(e=+b)?c(String(a).toLowerCase(),String(b).toLowerCase()):c(d,e)};try{Object.defineProperty(Array.prototype,"uniq",{value:function(){return this.filter(function(a,b,c){return c.indexOf(a)===b})}})}catch(v){console.log(v),[]}a=function(){function a(){}a.printf=("undefined"!==typeof window&&null!==window?window:
global).sprintf;a.sum=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a+ +b},0)};a.mod=function(a,b){return Math.round(a)%Math.round(b)};a.modf=function(a,b){return a%b};a.IEEEremainder=a.modf;a.isFactor=function(a,b){return 1!==+a&&0===b%a};a.isMultiple=function(a,b){return 0===a%b};a.isUnit=function(a){return 1===+a};a.isAny=function(a,b){return this.isFactor(a,b)||this.isMultiple(a,b)||this.isUnit(a)};a.gcf=function(a,b){var c;c=[Math.abs(a),Math.abs(b)];
a=c[0];for(b=c[1];0<b;)c=[b,a%b],a=c[0],b=c[1];return a};a.lcm=function(a,b){return Math.abs(a*b)/this.gcf(a,b)};a.integerInRange=function(a,b,c){var d;null==b&&(b=-Infinity);null==c&&(c=Infinity);return Math.round(b)<=(d=Math.round(a))&&d<=Math.round(c)};a.fmtDecimal=function(a,b){null==b&&(b=2);return(+a).toFixed(Math.round(+b))};a.fmtNormal=function(a,b){null==b&&(b=6);return this.fmtDecimal(a,b).replace(/\.0+$|(\..+?)0+$/,"$1")};a.fmtDollar=function(a,b){null==b&&(b="");a=this.fmtDecimal(a);b=
b.toLowerCase();0<=b.indexOf("i")&&(a=a.replace(/\.00$/,""));return 0<=b.indexOf("d")?"$"+a:a};a.dollarEquals=function(){var a,b;a=arguments[0];b=2<=arguments.length?p.call(arguments,1):[];a=this.fmtDollar(a,"i");return b.some(function(b){return function(c){return a===b.fmtDollar(c,"i")}}(this))};a.matchWithPrecision=function(a,b){var c,d;return(c=String(a).match(m))&&(d=String(b).match(m))&&n(c)===n(d)&&g(a,b,function(a,b){return a===b})};a.matchWithoutPrecision=function(a,b){var c,d;return(c=String(a).match(m))&&
(d=String(b).match(m))&&(a=n(c)>n(d)?(+a).toFixed(f(d)):String(a))&&g(a,b,function(a,b){return a===b})};a.constantsConform=function(){var a,c;a=arguments[0];c=2<=arguments.length?p.call(arguments,1):[];c=c.map(function(a){return"string"===typeof a?new RegExp("^"+a+"$","i"):a});return(a.match(b)||[]).every(function(a){return c.some(function(b){return b.test(a)})})};a.constantsDollar=function(a){return this.constantsConform(a,c)};a.isNumber=function(a,b,c){null==b&&(b=!0);return(b||"number"===typeof a)&&
!isNaN(a=+a)&&(!c||a===Math.round(a))};a.isInteger=function(a,b){return this.isNumber(a,b,!0)};a.isVar=function(a){return/^\s*[a-zA-Z]\s*$/.test(a)};a.makeFraction=function(a,b,c){null!=b&&null==c&&(c=[0,a,b],a=c[0],b=c[1],c=c[2]);a=+a||0;b=+b||0;c=+c||1;return this.isInteger(a)&&this.isInteger(b)&&this.isInteger(c)?(a?a+(b?" ":""):"")+(b?b+(1===c?"":"/"+c):""):null};a.fractionMake=a.makeFraction;a.getWhole=function(a){return null!=(a=a.match(d))?a[1]||"0":null};a.getNumerator=function(a){return null!=
(a=a.match(d))?a[2]||"0":null};a.getDividend=a.getNumerator;a.getDenominator=function(a){return null!=(a=a.match(d))?a[3]||"1":null};a.getDivisor=a.getDenominator;a.convertToMixed=function(a){return null!=(a=a.match(d))?this.makeFraction((+a[1]||0)+Math.floor((+a[2]||0)/(+a[3]||1)),(+a[2]||0)%(+a[3]||1),a[3]):null};a.convertToImproper=function(a){return null!=(a=a.match(d))?this.makeFraction(0,(+a[1]||0)*(+a[3]||1)+(+a[2]||0),a[3]||1):null};a.evaluateFraction=function(a){return null!=(a=a.match(d))?
((+a[1]||0)*(+a[3]||1)+(+a[2]||0))/(+a[3]||1):null};a.divEvaluate=a.evaluateFraction;a.simplifyFraction=function(a){var b;return null!=(a=a.match(d))?(null!=a[1]&&null!=a[2]&&(a[1]=+a[1]+Math.floor(+a[2]/+a[3]),a[2]=+a[2]%+a[3]),b=null!=a[2]?this.gcf(+a[2],+a[3]):1,this.makeFraction(a[1],a[2]/b,a[3]/b)):null};a.fractionsimplify=a.simplifyFraction;a.simplifyMixed=a.simplifyFraction;a.simplifiedFraction=function(a){var b;return null!=(b=this.simplifyFraction(a))?b===a:null};a.isSimplifiedMixed=a.simplifiedFraction;
a.fractionEquals=function(a,b){var c,d;return null!=(c=this.evaluateFraction(a))&&null!=(d=this.evaluateFraction(b))?c===d:null};a.simplifiedFractionEquals=function(a,b){var c,d;return null!=(c=this.simplifiedFraction(a))&&null!=(d=this.simplifiedFraction(b))?c&&d&&this.fractionEquals(a,b):null};a.rationalEquals=function(a,b){return this.matchWithoutPrecision(+b||this.evaluateFraction(b),+a||this.evaluateFraction(a))};a.quote=function(a){return'"'+a+'"'};a.compact=function(a){return a.replace(/\s*/g,
"")};a.equalsIgnoreCase=function(a,b){return a===b||a.toUpperCase()===b.toUpperCase()||a.toLowerCase()===b.toLowerCase()};a.replaceFirst=function(a,b,c){return a.replace(new RegExp(b),c)};a.replaceAll=function(a,b,c){return a.replace(new RegExp(b,"g"),c)};a.regExMatch=function(a,b,c){return("string"===typeof a?new RegExp("^("+a+")$",c):a).test(b)};a.rm1coeff=function(a){if(null!=a)return a.replace(/(^|[^0-9])1([a-zA-Z])/g,"$1$2")};a.setMatches=function(a,b,c){var d,e;d=a.split(c);e=b.split(c);return e.every(function(a){return d.includes(a)})&&
d.every(function(a){return e.includes(a)})};a.pointInRange=function(a,b,c,d,e){var f,g,h;if(f=null!=b?"function"===typeof b.match?b.match(l):void 0:void 0)e=[f[1],f[8],c,d],b=e[0],c=e[1],d=e[2],e=e[3];null==d&&(d=0);null==e&&(e=d);return(f=a.match(l))&&b-d<=(g=f[1])&&g<=+b+ +d&&c-e<=(h=f[8])&&h<=+c+ +e};a.plural=function(a,b,c,d){var f;if(!b||2>a)return b;null==c&&(c=h.test(f=b.toLowerCase())?"y":"");if(!b.endsWith(c))return b;null==d&&(d=h.test(f)?"ies":e.test(f)?"es":"s");c.length&&(b=b.split(c)[0]);
return b+(/[A-Z]/.test(b[b.length-1])?d.toUpperCase():d)};a.totalTableDec=function(a,b,c,d){return 1E3*(+a||0)+100*(+b||0)+10*(+c||0)+(+d||0)};a.columnCell=function(a,b,c,d,e,f,g,h,m,n){switch(m){case "r1c1":case "r2c1":case "r3c1":return n?a:e;case "r1c2":case "r2c2":case "r3c2":return n?b:f;case "r1c3":case "r2c3":case "r3c3":return n?c:g;case "r1c4":case "r2c4":case "r3c4":return n?d:h;default:return 0}};a.first=function(){return(1<=arguments.length?p.call(arguments,0):[])[0]};a.last=function(){var a;
a=1<=arguments.length?p.call(arguments,0):[];return a[a.length-1]};a.chooseRandomly=function(){var a;a=1<=arguments.length?p.call(arguments,0):[];return a[Math.floor(Math.random()*a.length)]};a.firstNonNull=function(){var a;return null!=(a=(1<=arguments.length?p.call(arguments,0):[]).find(function(a){return null!=a}))?a:null};a.valueOrZero=function(){var a;return null!=(a=(1<=arguments.length?p.call(arguments,0):[]).find(function(a){return null!=a}))?a:0};a.hasValue=function(){return(1<=arguments.length?
p.call(arguments,0):[]).every(function(a){return null!=a})};a.equals=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?p.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.every(function(a){return b===(null!=a?a:void 0)}):c.every(function(b){return a===+(null!=b?b:NaN)})};a.memberOf=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?p.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.some(function(a){return b===(null!=a?a:void 0)}):c.some(function(b){return a===
+(null!=b?b:NaN)})};a.greaterThan=function(a,b){return g(a,b,function(a,b){return a>b})};a.lessThan=function(a,b){return g(a,b,function(a,b){return a<b})};a.greaterThanOrEqual=function(a,b){return g(a,b,function(a,b){return a>=b})};a.lessThanOrEqual=function(a,b){return g(a,b,function(a,b){return a<=b})};a.equal=function(a,b){return g(a,b,function(a,b){return a===b})};a.notEqual=function(a,b){return g(a,b,function(a,b){return a!==b})};a.and=function(){return(1<=arguments.length?p.call(arguments,0):
[]).reduce(function(a,b){return a&&b},!0)};a.or=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a||b},!1)};a.not=function(a){return!a};a.ifThen=function(a,b,c){return a?b:c};a.assign=function(a,b){var c,d,e,f,g,h;h="undefined"!==typeof window&&null!==window?window:global;d=a.split(".");e=2<=d.length?p.call(d,0,c=d.length-1):(c=0,[]);f=d[c++];c=0;for(g=e.length;c<g;c++)d=e[c],h=null!=h[d]?h[d]:h[d]={};return h[f]=b};a.length=function(a){return a.length};a.toString=
function(a){return a.toString()};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaFunctions=a}).call(this);var CTATFormulaActions={};
(function(){var a;a=function(){function a(){}a.goToState=function(a){return CTAT.ToolTutor.tutor.goToState(a)};a.goToStartState=function(){return CTAT.ToolTutor.tutor.goToStartState()};a.performInterfaceAction=function(a,c,d){return CTAT.ToolTutor.sendToInterface((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATMessage.makeTransactionId(),new CTATSAI(a,c,d)))};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaActions=a}).call(this);var CTATFormulaParser={};
(function(){var a,g,f,c,d=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};c=/"(?:[^\\"]|\\\")*"|'(?:[^\\'']|\\\')*'/;g=/[A-Za-z_][\w._]*(?![\w(._])/g;f="abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface let long native new null of package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield Array Date eval function global hasOwnProperty Infinity isFinite isNaN isPrototypeOf length Math NaN name Number Object prototype String toString undefined valueOf window".split(" ");a=
function(){function a(a){var b,c,e;this.variableTable=a;this.algebraParser=new CTATAlgebraParser;this.logicParser=new CTATLogicParser;this.keys=[];this.values=[];e="EPSILON MAX_SAFE_INTEGER MAX_VALUE MIN_SAFE_INTEGER MIN_VALUE NEGATIVE_INFINITY POSITIVE_INFINITY isFinite isInteger isNaN isSafeInteger parseFloat parseInt".split(" ");a=0;for(c=e.length;a<c;a++)b=e[a],this.keys.push(b),this.values.push(Number[b]);e=["toExponential","toFixed","toLocaleString","toPrecision","valueOf"];a=0;for(c=e.length;a<
c;a++)b=e[a],this.keys.push(b),this.values.push(function(a){return function(){var b,c;c=arguments[0];b=2<=arguments.length?d.call(arguments,1):[];return a.apply(c,b)}}(Number.prototype[b]));e="E LN10 LN2 LOG10E LOG2E PI SQRT1_2 SQRT2 abs acos acosh asin asinh atan atanh atan2 cbrt ceil clz32 cos cosh exp expm1 floor fround hypot imul log log10 log1p log2 max min pow random round sign sin sinh sqrt tan tanh trunc".split(" ");a=0;for(c=e.length;a<c;a++)b=e[a],this.keys.push(b),this.values.push(Math[b]);
e=["fromCharCode","fromCodePoint"];a=0;for(c=e.length;a<c;a++)b=e[a],this.keys.push(b),this.values.push(String[b]);e="charAt charCodeAt codePointAt concat endsWith includes indexOf lastIndexOf localeCompare match normalize padEnd padStart repeat replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toUpperCase trim trimEnd trimStart valueOf".split(" ");c=0;for(a=e.length;c<a;c++)b=e[c],this.keys.push(b),this.values.push(function(a){return function(){var b,
c;c=arguments[0];b=2<=arguments.length?d.call(arguments,1):[];return a.apply(c,b)}}(String.prototype[b]));e="algParse algGetError algStringify algEvaluate algSort algGetOperator algGetOperands algFindExpression algCreateExpression algReplaceExpression algDeleteExpression algSimplifyRules algPartiallySimplify algSimplify algValid algValued algPartiallySimplified algSimplified algIdentical algEqual algPartiallyEquivalent algEquivalent isAlgValid algEval algStrictEquivTermsSameOrder algEquivTermsSameOrder algStrictEquivTerms algEquivTerms algEquiv isSimplified calc calca simplify algebraicEqual patternMatches polyTermsEqual algebraicMatches expressionMatches".split(" ");
c=0;for(a=e.length;c<a;c++)b=e[c],this.keys.push(b),this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?d.call(arguments,0):[];return a.apply(b,c)}}(this.algebraParser[b],this.algebraParser));e="logicSetMode logicParse logicGetError logicStringify logicEvaluate logicSort logicGetOperator logicGetOperators logicGetVariables logicGetOperands logicFindOperator logicFindExpression logicFindRule logicApplyRules logicReplaceExpression logicValid logicValued logicSorted logicIdentical logicEqual logicEquivalent logicSemanticEquivalent logicFindCounterExample logicSimplifyNNF logicSimplifyCNF logicSimplifyDNF logicSimplifiedNNF logicSimplifiedCNF logicSimplifiedDNF".split(" ");
c=0;for(a=e.length;c<a;c++)b=e[c],this.keys.push(b),this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?d.call(arguments,0):[];return a.apply(b,c)}}(this.logicParser[b],this.logicParser));for(b in CTATFormulaFunctions)this.keys.push(b),this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?d.call(arguments,0):[];return a.apply(b,c)}}(CTATFormulaFunctions[b],CTATFormulaFunctions));for(b in CTATFormulaActions)this.keys.push(b),this.values.push(function(a,
b){return function(){var c;c=1<=arguments.length?d.call(arguments,0):[];return a.apply(b,c)}}(CTATFormulaActions[b],CTATFormulaActions))}a.prototype.evaluate=function(a,e,m,n){var h,l,r,u,w,B,y,z,q,F,C,A;try{z="undefined"!==typeof window&&null!==window?window:global;h=function(){var a;a=[];for(u in z)a.push(u);return a}().concat(["selection","action","input"]);q=a.split(c);l=0;for(w=q.length;l<w;l++)for(y=q[l],C=null!=(F=y.match(g))?F:[],r=0,B=C.length;r<B;r++)u=C[r],0>b.call(f,u)&&0>b.call(h,u)&&
0>b.call(this.keys,u)&&CTATFormulaFunctions.assign(u,void 0);for(u in A=this.variableTable.getTable())z[u]=A[u];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(d.call(this.keys),["return "+a.trim()]),function(){}).apply(z,[e,m,n].concat(d.call(this.values)))}catch(E){return console.log(E),null}finally{for(u in z)null!=u&&0>b.call(h,u)&&(A[u]=z[u],delete z[u])}};a.prototype.interpolateSplitPattern=/<%=|%>/;
a.prototype.interpolate=function(a,b,c,d){var e,f,g,h,m;h=a.split(this.interpolateSplitPattern);m=[];a=f=0;for(g=h.length;f<g;a=++f)e=h[a],m.push(a%2?this.evaluate(e,b,c,d):e);return m.join("")};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaParser=a}).call(this);var CTATSingleMatcher=function(a,g){CTATMatcher.call(this,!0,a,g);var f=this,c="",d="";this.getSingle=function(a){return c};this.setSingle=function(a){null===a||"undefined"===typeof a?f.ctatdebug('CTATSingleMatcher --\x3e bad argument "'+a+'" to setSingle()'):c=a};this.toString=function(){console.log("Error: CTATSingleMatcher.toString() called: should be overridden")};this.matchSingle=function(a){console.log("Error: CTATSingleMatcher.matchSingle("+a+") called: should be overridden");return!1};this.getReplacementFormula=
function(){return d};this.setReplacementFormula=function(a){d=a?a:""};this.evaluateReplacement=function(a,c,g){g=null;if(!d)return g;f.ctatdebug("CTATSingleMatcher.evaluateReplacement("+a+", "+c+")");var b=a.getSelection(),e=a.getAction();a=CTATVariableTable.standardizeType(a.getInput());c||(c=new CTATVariableTable);c=new CTATFormulaParser(c);f.ctatdebug("CTATSingleMatcher calling CTATFormulaParser.evaluate("+d+", "+b+", "+e+", "+a+")");try{g=c.evaluate(d,b,e,a)}catch(n){f.ctatdebug("CTATSingleMatcher error from CTATFormulaParser.evaluate("+
d+") "+n.name+": "+n.message),g=null}f.ctatdebug("CTATSingleMatcher.evaluateReplacement() returns "+g+", type "+typeof g);return g}};CTATSingleMatcher.prototype=Object.create(CTATMatcher.prototype);CTATSingleMatcher.prototype.constructor=CTATSingleMatcher;CTATSingleMatcher.prototype.matchConcatenation=function(a){a=this.array2ConcatString(a);return this.matchSingle(a)};CTATSingleMatcher.prototype.match=function(a,g,f,c){return this.matchConcatenation(a)};
CTATSingleMatcher.prototype.setParameter=function(a,g,f){this.ctatdebug("CTATSingleMatcher.setParameter("+a+", "+g+", "+f+") calling\n  "+this.setSingle.toString());this.setSingle(a)};"undefined"!==typeof module&&(module.exports=CTATSingleMatcher);var CTATAnyMatcher=function(a,g){CTATSingleMatcher.call(this,a,!0);var f=this;this.toString=function(){return"*"};this.matchSingle=function(a){return!0};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>AnyMatcher</matcherType>\n")+(a+'    <matcherParameter name="single">'+f.getSingle()+"</matcherParameter>\n")+(a+"</matcher>\n")}};CTATAnyMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATAnyMatcher.prototype.constructor=CTATAnyMatcher;
"undefined"!==typeof module&&(module.exports=CTATAnyMatcher);var CTATExactMatcher=function(a,g){CTATSingleMatcher.call(this,a,!0);var f=this;this.toString=function(){return f.getSingle().toString()};this.matchSingle=function(a){var c=f.getSingle();ctatdebug("CTATExactMatcher --\x3e in matchSingle: s = "+a+", singleval = "+c+", caseInsensitive "+f.getCaseInsensitive()+", "+typeof f.getCaseInsensitive());return f.getCaseInsensitive()?String(a).toUpperCase()==String(c).toUpperCase():String(a)==String(c)};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+
(a+"    <matcherType>ExactMatcher</matcherType>\n")+(a+'    <matcherParameter name="single">'+f.getSingle()+"</matcherParameter>\n")+(a+"</matcher>\n")}};CTATExactMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExactMatcher.prototype.constructor=CTATExactMatcher;"undefined"!==typeof module&&(module.exports=CTATExactMatcher);var CTATExampleTracerException=function(a){CTATBase.call(this,"CTATExampleTracerException","");this.toString=function(){return a}};CTATExampleTracerException.prototype=Object.create(CTATBase.prototype);CTATExampleTracerException.prototype.constructor=CTATExampleTracerException;"undefined"!==typeof module&&(module.exports=CTATExampleTracerException);var CTATExpressionMatcher=function(a,g){function f(a,d,e,f,g){h.ctatdebug("CTATExpressionMatcher.testVector["+f+"]("+a+", "+d+", "+e+", "+g+") to call evaluate");var m=CTATVariableTable.standardizeType(e);h.ctatdebug("CTATExpressionMatcher.testVector typeof input "+typeof e+"; inputConv "+m+", typeof "+typeof m);e=h.evaluate(a,d,m,g);h.ctatdebug("CTATExpressionMatcher.testVector evaluate("+a+", "+d+", "+m+", "+g+") returned "+e+", type "+typeof e);g=null;switch(f){case CTATMatcher.SELECTION:g=a;break;
case CTATMatcher.ACTION:g=d;break;case CTATMatcher.INPUT:case CTATMatcher.NON_SINGLE:g=m}b=g;h.ctatdebug("CTATExpressionMatcher.testVector comparee "+g+", type "+typeof g+", relation "+c+"( "+CTATExpressionMatcher.RELATIONS[c]+" )");try{switch(c){case CTATExpressionMatcher.BOOL_RELATION:return!!e;case CTATExpressionMatcher.EQ_RELATION:if(null==g)return null==e;if(null==e)break;return h.compareNumberOrString(g,e,c);case CTATExpressionMatcher.NOT_EQ_RELATION:return null==g?null!=e:null==e?!0:h.compareNumberOrString(g,
e,c);case CTATExpressionMatcher.LT_RELATION:case CTATExpressionMatcher.GT_RELATION:if(null==g||null==e)break;return h.compareNumberOrString(g,e,c);case CTATExpressionMatcher.LTE_RELATION:case CTATExpressionMatcher.GTE_RELATION:if(null==g)return null==e;if(null!=e)return h.compareNumberOrString(g,e,c)}}catch(u){}return!1}CTATSingleMatcher.call(this,a,g);var c=CTATExpressionMatcher.EQ_RELATION,c=CTATExpressionMatcher.BOOL_RELATION,d=g,b=null,e=!1,h=this;this.getLastInput=function(){h.ctatdebug("CTATExpressionMatcher.getLastInput() returns "+
b);return b};this.isEqualRelation=function(){h.ctatdebug("CTATExpressionMatcher --\x3e in isEqualRelation");return c===CTATExpressionMatcher.EQ_RELATION};this.getEvaluatedInput=function(a,b){h.ctatdebug("CTATExpressionMatcher --\x3e in getEvaluatedInput("+a+", "+b+")");var c=CTATVariableTable.standardizeType(a.getInput()),c=h.evaluate(a.getSelection(),a.getAction(),c,b);h.ctatdebug("CTATExpressionMatcher.getEvaluatedInput() returns "+c);return c};this.toString=function(){return CTATExpressionMatcher.RELATIONS[c]+
' "'+d+'"'};this.MatcherSAItoXML=function(a){var b;b=a+"<matcher>\n"+(a+"    <matcherType>ExpressionMatcher</matcherType>\n")+(a+'    <matcherParameter name="InputExpression">'+h.getInputExpression()+"</matcherParameter>\n");b+=a+'    <matcherParameter name="relation">'+CTATExpressionMatcher.RELATIONS[c]+"</matcherParameter>\n";return b+(a+"</matcher>\n")};this.matchSingle=function(a){throw new CTATExampleTracerException("UnsupportedOperationException");};this.setInputExpression=function(a){d=a};
this.setRelation=function(a){c=a};this.interpolate=function(a,b,c,d){try{var e=new CTATVariableTable;return(new CTATFormulaParser(e)).interpolate(a,b,c,d)}catch(r){return null}};this.evaluate=function(a,b,c,d){if("undefined"==typeof d||null==d)d=new CTATVariableTable;h.ctatdebug("CTATExpressionMatcher.evaluate(..., vt="+d+") creating CTATFormulaParser");d=new CTATFormulaParser(d);h.ctatdebug("calling CTATFormulaParser.evaluate("+h.getInputExpression()+", "+a+", "+b+", "+c+")");try{return d.evaluate(h.getInputExpression(),
a,b,c)}catch(v){return h.ctatdebug("CTATExpressionMatcher --\x3e "+v.name+": "+v.message),null}};this.matchConcatenation=function(b,c,d,g){b=h.array2ConcatString(b);null===c||"undefined"===typeof c||null===d||"undefined"===typeof d?e=f(b,null,null,a,g):(c=h.array2ConcatString(c),d=h.array2ConcatString(d),e=f(b,c,d,a,g));return e};this.match=function(a,b,c,d,e){return h.matchConcatenation(a,b,c,e)};this.getInputExpression=function(){return d};(function(){if(null!==g&&"undefined"!==typeof g){var a;
a=g.indexOf('"');var b=g.lastIndexOf('"');0<=a&&0<=b?(a=g.substring(a+1,b),b=g.substring(0,g.indexOf(" ")),c=CTATExpressionMatcher.nameToRelation(b)):a=g;h.setInputExpression(a)}})()};Object.defineProperty(CTATExpressionMatcher,"EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:0});Object.defineProperty(CTATExpressionMatcher,"LT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:1});
Object.defineProperty(CTATExpressionMatcher,"GT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATExpressionMatcher,"NOT_EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATExpressionMatcher,"GTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:4});Object.defineProperty(CTATExpressionMatcher,"LTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:5});
Object.defineProperty(CTATExpressionMatcher,"BOOL_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:6});Object.defineProperty(CTATExpressionMatcher,"RELATIONS",{enumerable:!1,configurable:!1,writable:!1,value:"= < > != >= <= boolean".split(" ")});CTATExpressionMatcher.nameToRelation=function(a){for(var g=0;g<CTATExpressionMatcher.RELATIONS.length;g++)if(a==CTATExpressionMatcher.RELATIONS[g])return g;return CTATExpressionMatcher.EQ_RELATION};CTATExpressionMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATExpressionMatcher.prototype.constructor=CTATExpressionMatcher;CTATExpressionMatcher.prototype.setParameter=function(a,g,f){a&&g&&f&&(a=f.getNodeTextValue(a),this.ctatdebug("CTATExpressionMatcher.setParameter("+g+", "+a+")"),"InputExpression"==g?this.setInputExpression(a):"relation"==g&&this.setRelation(CTATExpressionMatcher.nameToRelation(a)))};
CTATExpressionMatcher.prototype.compareNumberOrString=function(a,g,f){a=String(a);g=String(g);var c=Number(a),d=Number(g);if(isNaN(c)||isNaN(d))switch(f){case CTATExpressionMatcher.EQ_RELATION:return a==g;case CTATExpressionMatcher.NOT_EQ_RELATION:return a!=g;case CTATExpressionMatcher.LT_RELATION:return a.toLowerCase()<g.toLowerCase();case CTATExpressionMatcher.GT_RELATION:return a.toLowerCase()>g.toLowerCase();case CTATExpressionMatcher.LTE_RELATION:return a.toLowerCase()<=g.toLowerCase();case CTATExpressionMatcher.GTE_RELATION:return a.toLowerCase()>=
g.toLowerCase();case CTATExpressionMatcher.BOOL_RELATION:return!!g;default:return!1}else switch(f){case CTATExpressionMatcher.EQ_RELATION:return c==d;case CTATExpressionMatcher.NOT_EQ_RELATION:return c!=d;case CTATExpressionMatcher.LT_RELATION:return c<d;case CTATExpressionMatcher.GT_RELATION:return c>d;case CTATExpressionMatcher.LTE_RELATION:return c<=d;case CTATExpressionMatcher.GTE_RELATION:return c>=d;case CTATExpressionMatcher.BOOL_RELATION:return!!d;default:return!1}};
"undefined"!==typeof module&&(module.exports=CTATExpressionMatcher);var CTATRangeMatcher=function(a,g){CTATSingleMatcher.call(this,a,!0);var f=this,c=0,d=0;this.toString=function(){return"[ "+c+" , "+d+" ]"};this.MatcherSAItoXML=function(a){var b;b=a+"<matcher>\n"+(a+"    <matcherType>RangeMatcher</matcherType>\n")+(a+'    <matcherParameter name="minimum">'+f.getMinimum()+"</matcherParameter>\n");b+=a+'    <matcherParameter name="maximum">'+f.getMaximum()+"</matcherParameter>\n";return b+(a+"</matcher>\n")};this.setMinimum=function(a){try{c=parseFloat(a)}catch(e){throw new CTATExampleTracerException('Number format exception while parsing minimum value "'+
a+'": '+e);}};this.getMinimum=function(){return c};this.setMaximum=function(a){try{d=parseFloat(a)}catch(e){throw new CTATExampleTracerException('Number format exception while parsing maximum value "'+a+'": '+e);}};this.getMaximum=function(){return d};this.matchSingle=function(a){var b;try{b=parseFloat(a)}catch(h){throw new CTATExampleTracerException("Number format exception while parsing .");}return c<=b&&b<=d?!0:!1}};CTATRangeMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATRangeMatcher.prototype.constructor=CTATRangeMatcher;CTATRangeMatcher.prototype.setParameter=function(a,g){switch((g?g:"").toString().trim().toLowerCase()){case "minimum":this.setMinimum(a);break;case "maximum":this.setMaximum(a);break;default:console.log('CTATRangeMatcher.setParameter() undefined parameter name "'+g+'"'),this.setMinimum(a),this.setMaximum(a)}};CTATRangeMatcher.prototype.match=function(a,g,f,c){return this.matchSingle(a,g,f,c)};"undefined"!==typeof module&&(module.exports=CTATRangeMatcher);var CTATRegexMatcher=function(a,g){CTATSingleMatcher.call(this,a,!0);var f=null,c=null,d=this;this.toString=function(){return f};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>RegexMatcher</matcherType>\n")+(a+'    <matcherParameter name="single">'+d.getSinglePattern()+"</matcherParameter>\n")+(a+"</matcher>\n")};this.setSinglePattern=function(a){"undefined"===typeof a||null===a?console.log("CTATRegexMatcher: null or undefined pattern"):(f=a,c=d.getCaseInsensitive()?
new RegExp(a,"i"):new RegExp(a))};this.getSinglePattern=function(){return f};this.setSingle=function(a){d.setSinglePattern(a)};this.matchSingle=function(a){if(null==a)return null==getSingle();if(null==c)return console.log("Error: CTATRegexMatcher.matchSingle called before pattern has been set"),!1;var b=c.exec(a);return null!=b&&b[0]==a}};CTATRegexMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRegexMatcher.prototype.constructor=CTATRegexMatcher;
"undefined"!==typeof module&&(module.exports=CTATRegexMatcher);var CTATWildcardMatcher=function(a,g){function f(a){if(null==a||"undefined"===typeof a)return null;var b=(new String(a)).replace(RegExp("\\?","g"),"."),d=b.replace(RegExp("\\*","g"),".*"),f=d.replace(RegExp("\\[\\!","g"),"[^");c.ctatdebug("CTATWildcardMatcher.convertToFullRegex("+a+") after qm: "+b+"; after aster: "+d+"; after negate: "+f+";");return f}CTATRegexMatcher.call(this,a,g);var c=this;this.toString=function(){return null};this.MatcherSAItoXML=function(a){return a+"<matcher>\n"+(a+"    <matcherType>WildcardMatcher</matcherType>\n")+
(a+'    <matcherParameter name="single">'+c.getSinglePattern()+"</matcherParameter>\n")+(a+"</matcher>\n")};this.setSingle=function(a){c.simpleSinglePattern=a;c.setSinglePattern.call(c,f(a))};this.setSingle(g);this.simpleSinglePattern=g};CTATWildcardMatcher.prototype=Object.create(CTATRegexMatcher.prototype);CTATWildcardMatcher.prototype.constructor=CTATWildcardMatcher;"undefined"!==typeof module&&(module.exports=CTATWildcardMatcher);var CTATVectorMatcher=function(a,g,f,c){function d(a,c,d,f,g){m.ctatdebug("CTATVectorMatcher --\x3e in _match("+a+", "+c+", "+d+", "+f+")");if(0===b.length||0===e.length||0===h.length)b.push(new CTATExactMatcher(CTATMatcher.SELECTION,m.array2ConcatString(m.getDefaultSelectionArray()))),e.push(new CTATExactMatcher(CTATMatcher.ACTION,m.array2ConcatString(m.getDefaultActionArray()))),h.push(new CTATExactMatcher(CTATMatcher.INPUT,m.array2ConcatString(m.getDefaultInputArray())));var n=[];n[CTATMatcher.SELECTION]=
a;n[CTATMatcher.ACTION]=c;n[CTATMatcher.INPUT]=d;for(var p=0;3>p;p++){var v=l[p][0],q=v instanceof CTATExpressionMatcher?v.matchConcatenation(a,c,d,f):v.matchConcatenation(n[p]);m.ctatdebug("CTATVectorMatcher --\x3e in _match["+p+"] after "+v+".concat returns: "+q);if(g)g.push(q);else if(!1===q)return!1}if(g)for(a=0;a<g.length;++a)if(!g[a])return!1;return!0}CTATMatcher.call(this,!0,CTATMatcher.VECTOR,!0);var b=a instanceof Array?a:[],e=g instanceof Array?g:[],h=f instanceof Array?f:[],l=[];l[CTATMatcher.SELECTION]=
b;l[CTATMatcher.ACTION]=e;l[CTATMatcher.INPUT]=h;var m=this;this.match=function(a,b,c,e,f){return!1!==d(a,b,c,f)&&m.matchActor(e)?!0:!1};this.getMatchers=function(a){return l[a]};this.getTutorSAI=function(a,b,c){m.ctatdebug("CTATVectorMatcher.getTutorSAI("+a+", vt, "+c+")");if(c&&CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()==c.toLowerCase())return a;var e=[];if(d(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,e))return c=a.clone(),a=m.evaluateReplacement(a,b,null),null!=a&&c.setInput("object"==
typeof a?a.toString():a),c;c=a.clone();for(a=0;a<e.length;a++)switch(a){case CTATMatcher.SELECTION:if(e[a])continue;c.setSelection(m.getDefaultSelection());c.setSelectionArray(m.getDefaultSelectionArray());break;case CTATMatcher.ACTION:if(e[a])continue;c.setAction(m.getDefaultAction());c.setActionArray(m.getDefaultActionArray());break;case CTATMatcher.INPUT:if(e[a])continue;c.setInput(m.getDefaultInput());c.setInputArray(m.getDefaultInputArray());break;default:console.log("CTATVectorMatcher.getTutorSAI() unexpected no. of details: "+
a)}return c};this.getInputMatcher=function(){var a=h[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultInput():a.toString()};this.getActionMatcher=function(){var a=e[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultAction():a.toString()};this.getSelectionMatcher=function(){var a=b[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultSelection():a.toString()};this.getSingleMatcher=function(a){return"selection".toString().toUpperCase()===
a.toString().toUpperCase()?b[0]:"action".toString().toUpperCase()===a.toString().toUpperCase()?e[0]:h[0]};var n=m.getDefaultSAI;this.getDefaultSAI=function(){var a=n.apply(m),c=0<b.length&&b[0]instanceof CTATExactMatcher?b[0].getSingle():a.getSelection(),d=0<e.length&&e[0]instanceof CTATExactMatcher?e[0].getSingle():a.getAction(),a=0<h.length&&h[0]instanceof CTATExactMatcher?h[0].getSingle():a.getInput();return new CTATSAI(c,d,a)};this.getSelection=function(){return 0===b.length?m.getDefaultSelection():
b[0].toString()};this.getAction=function(){return 0===e.length?m.getDefaultAction():e[0].getAction()};this.setDefaultSelection=function(a){return 0===b.length?m.internalSetDefaultSelection(a):b[0].setDefaultSelection(a)};this.setDefaultAction=function(a){return 0===e.length?m.internalSetDefaultAction(a):e[0].setDefaultAction(a)};this.setDefaultInput=function(a){return 0===h.length?m.internalSetDefaultInput(a):h[0].setDefaultInput(a)};this.getEvaluatedInput=function(a,b){if(0===h.length)return m.getInput();
var c=h[0];return!1===c instanceof CTATExpressionMatcher?m.getInput():!0===c.isEqualRelation()?c.getEvaluatedInput(a,b):m.getInput()};this.matchForHint=function(a,c,d,e){ctatdebug("CTATVectorMatcher.matchForHint("+a+", "+c+", "+d+", vt)");if(!m.matchActor(d))return!1;c=b[0];return Array.isArray(a)?c.matchConcatenation(a,m.getDefaultActionArray(),m.getDefaultInputArray(),e):c.matchConcatenation([a],m.getDefaultActionArray(),m.getDefaultInputArray(),e)};this.setCaseInsensitive=function(a){ctatdebug("CTATVectorMatcher.setCaseInsensitive("+
a+")");for(var b=0;b<l.length;++b)if(Array.isArray(l[b]))for(var c=0;c<l[b].length;++c)l[b][c].setCaseInsensitive(a);else l[b]instanceof CTATMatcher&&l[b].setCaseInsensitive(a)};this.toString=function(){return"this is CTATVectorMatcher"};this.getReplacementFormula=function(){var a=h[0];return null===a||"undefined"===typeof a?null:a.getReplacementFormula()};this.evaluateReplacement=function(a,b,c){return h[0].evaluateReplacement(a,b,c)};this.setActor(c)};CTATVectorMatcher.prototype=Object.create(CTATMatcher.prototype);
CTATVectorMatcher.prototype.constructor=CTATVectorMatcher;"undefined"!==typeof module&&(module.exports=CTATVectorMatcher);var CTATExampleTracerNodeVisualData=function(){CTATBase.call(this,"ExampleTracerNodeVisualData","visualdata");var a="****",g="undefined",f=-1,c=-1,d=null;this.setID=function(b){a=b};this.getID=function(){return a};this.setLabel=function(a){g=a};this.getLabel=function(){return g};this.setX=function(a){f=a};this.getX=function(){return f};this.setY=function(a){c=a};this.getY=function(){return c};this.setVizReference=function(a){d=a};this.getVizReference=function(){return d}};
CTATExampleTracerNodeVisualData.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNodeVisualData.prototype.constructor=CTATExampleTracerNodeVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNodeVisualData);var CTATExampleTracerNode=function(a,g){CTATBase.call(this,"CTATExampleTracerNode",a);var f=null,c={x:1,y:1},d="",b=g?g:new Set,e=new Set;b.forEach(function(a,b,c){b.isCorrect()&&e.add(b)});var h=new Set,l=!1,m=this;this.toString=function(){return"node"+a};this.toXML=function(a){var b=a+'<node locked="'+this.getLocked()+'" doneState="'+this.IsDoneState()+'">\n',b=b+(a+"    <text>"+this.getNodeName()+"</text>\n"),b=b+(a+"    <uniqueID>"+this.getNodeID()+"</uniqueID>\n"),c=this.getDimension(),d=a+"    ",
e;e=d+"<dimension>\n"+(d+"    <x>"+c.x+"</x>\n");e+=d+"    <y>"+c.y+"</y>\n";return b+(e+(d+"</dimension>")+"\n")+(a+"</node>")};this.getNodeID=function(){return a};this.getLocked=function(){return!1};this.IsDoneState=function(){return this.getNodeName().startsWith("Done")?!0:l};this.setDoneState=function(a){l=a};this.getDimension=function(){return c};this.setDimension=function(a){c=a};this.getNodeName=function(){return d};this.setNodeName=function(a){m.ctatdebug("CTATExampleTracerGraph --\x3e in setNodeName("+
a+")");d=a};this.getOutLinks=function(){ctatdebug("CTATExampleTracerNode --\x3e getOutLinks");return b};this.getCorrectOutLinks=function(){return e};this.addOutLink=function(a){ctatdebug("CTATExampleTracerNode --\x3e addOutLink( "+a+" )");b.add(a);a.isCorrect()&&e.add(a)};this.clearInLinks=function(){h=new Set};this.addInLink=function(a){h.add(a)};this.getInLinks=function(){return h};this.getOutDegree=function(){return b.size};this.getCorrectOutDegree=function(){return e.size};this.setVisualData=
function(a){f=a};this.getVisualData=function(){return f}};CTATExampleTracerNode.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNode.prototype.constructor=CTATExampleTracerNode;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNode);var CTATExampleTracerLinkVisualData=function(){CTATBase.call(this,"CTATExampleTracerLinkVisualData","visualdata");var a="****",g="undefined",f="****",c="****";this.setID=function(c){a=c};this.getID=function(){return a};this.setLabel=function(a){g=a};this.getLabel=function(){return g};this.setSource=function(a){f=a};this.getSource=function(){return f};this.setDestination=function(a){c=a};this.getDestination=function(){return c}};CTATExampleTracerLinkVisualData.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerLinkVisualData.prototype.constructor=CTATExampleTracerLinkVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkVisualData);var CTATExampleTracerLink=function(a,g,f){CTATBase.call(this,"CTATExampleTracerLink","("+g+"-"+f+")");var c="undefined"===typeof a||null===a?null:a,d=null,b="",e="",h="undefined"===typeof g||null===g?null:g,l="undefined"===typeof f||null===f?null:f,m=null,n=1,p=1,v="CORRECT_ACTION",r=[],u=!1,w=null,B="",y=p.toString(),z=n.toString(),q=null,F=null,C=this;this.getUniqueID=function(){return c};this.getMatcher=function(){C.ctatdebug("CTATExampleTracerLink --\x3e in getMatcher");return m};this.isCorrect=
function(){return v==CTATExampleTracerLink.CORRECT_ACTION};this.matchesSAI=function(a,b,c){var d=C.getMatcher();C.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAI(); matcher "+d+", typeof "+typeof d+", sai "+a);a=d.match(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,c);C.ctatdebug("CTATExampleTracerLink --\x3e out of matchesSAI: result = "+a);return a};this.matchesSAIforHint=function(a,b,c,d){C.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAIforHint("+a+", "+b+") selectionArray "+
a.getSelectionArray());if(!1===C.getMatcher().matchForHint(a.getSelectionArray(),a.getActionArray(),b,d))return C.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false because no match"),!1;if(null!==c&&"undefined"!==typeof c&&!0===c.getWantReportableHints()&&(a=null===C.getAllHints()||"undefined"===typeof C.getAllHints()?0:C.getAllHints().length,1>a))return C.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false nStaticHints "+a+"< 1"),!1;C.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning true");
return!0};this.getDepth=function(){return d};this.getBuggyMsg=function(){return B};this.getSuccessMsg=function(){return w};this.getType=function(){return v};this.getPrevNode=function(){return h};this.getNextNode=function(){return l};this.setPrevNode=function(a){h=a};this.setNextNode=function(a){l=a};this.toString=function(){var a;a="[link "+C.getUniqueID();a+=" ("+C.getPrevNode()+"-"+C.getNextNode();a+=") "+C.getType();return a+"]"};this.toXML=function(a){var b;b=a+"    ";var c=b+'<actionLabel preferPathMark="'+
C.getIsPreferredLink()+'" minTraversals="'+C.getMinTraversalsStr()+'" maxTraversals="'+C.getMaxTraversalsStr()+'">\n',c=c+(b+"    <studentHintRequest></studentHintRequest>\n")+(b+"    <stepSuccessfulCompletion></stepSuccessfulCompletion>\n")+(b+"    <stepStudentError></stepStudentError>\n")+(b+"    <uniqueID>"+C.getUniqueID()+"</uniqueID>\n"),d=b+"    ",e="";C.getDemoMsgObj()&&(e+=d+C.getDemoMsgObj().getXMLString(!0)+"\n");c=c+e+(b+"    <buggyMessage>"+C.getBuggyMsg()+"</buggyMessage>\n");c+=b+"    <successMessage>"+
C.getSuccessMsg()+"</successMessage>\n";d=C.getHints();for(e=0;e<d.length;e++)c+=b+"    <hintMessage>"+d[e]+"</hintMessage>\n";var c=c+(b+"    <callbackFn></callbackFn>\n")+(b+"    <actionType>"+C.getActionType()+"</actionType>\n"),c=c+(b+"    <oldActionType>Correct Action</oldActionType>\n")+(b+"    <checkedStatus>Never Checked</checkedStatus>\n"),d=b+"    ",f=C.getMatcher().getMatchers(0)[0],e=C.getMatcher().getMatchers(1)[0],g=C.getMatcher().getMatchers(2)[0],f=d+'<matchers Concatenation="true">\n'+
(d+"    <Selection>\n")+f.MatcherSAItoXML(d+"        "),f=f+(d+"    </Selection>\n")+(d+"    <Action>\n")+e.MatcherSAItoXML(d+"        "),f=f+(d+"    </Action>\n")+(d+"    <Input>\n")+g.MatcherSAItoXML(d+"        "),f=f+(d+"    </Input>\n")+(d+'    <Actor linkTriggered="false">'+C.getMatcher().getActor()+"</Actor>\n");b=a+"<edge>\n"+(c+(f+(d+"</matchers>\n"))+(b+"</actionLabel>\n"));b+=a+"    <preCheckedStatus>No-Applicable</preCheckedStatus>\n";c=this.getSkillNames();d=a+"    ";e="";if(0<c.length)for(g=
0;g<c.length;g++)e+=d+"<rule>\n",e+=d+"    <text>"+c[g]+"</text>\n",e+=d+"    <indicator>-1</indicator>\n",e+=d+"</rule>\n";else e=e+(d+"<rule>\n")+(d+"    <text>unnamed</text>\n")+(d+"    <indicator>-1</indicator>\n")+(d+"</rule>\n");b=b+e+(a+"    <sourceID>"+this.getPrevNode()+"</sourceID>\n");b+=a+"    <destID>"+this.getNextNode()+"</destID>\n";return b+(a+"    <traversalCount>0</traversalCount>\n")+(a+"</edge>")};this.getDemoMsgObj=function(){return b};this.setDemoMsgObj=function(a){b=a};this.getTransactionID=
function(){return e};this.setTransactionID=function(a){e=a};this.getXMLString=function(a){if(messageObj.xml)return messageObj.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(messageObj);alert("ERROR: Extremely old browser");return""};this.getTutorSAI=function(a,b){return C.getMatcher().getTutorSAI(a,b,C.getActionType())};this.getEvaluatedInput=function(a,b){return C.getMatcher().getEvaluatedInput(a,b)};this.setDepth=function(a){d=a};this.getMaxTraversals=function(){return n};this.getMaxTraversalsStr=
function(){return z};this.isDone=function(){var a=String(C.getDefaultSAI().getSelection()).toLowerCase(),b=String(C.getDefaultSAI().getAction()).toLowerCase(),a=CTATMsgType.DONE.toLowerCase()==a&&CTATMsgType.BUTTON_PRESSED.toLowerCase()==b;C.ctatdebug("CTATExampleTracerLink.isDone() returns "+a);return a};this.interpolateHints=function(a){C.ctatdebug("CTATExampleTracerLink --\x3e interpolateHints("+a+")");var b=[];if(null===r||"undefined"===typeof r||0===r.length)return b;null==a&&(a=new CTATVariableTable);
var c=new CTATFormulaParser(a);r.forEach(function(a){if(!(1>String(a).trim().length)){var d=C.getDefaultSAI().getSelection(),e=C.getDefaultSAI().getAction(),f=CTATVariableTable.standardizeType(C.getDefaultSAI().getInput());C.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate("+a+", "+d+", "+e+", "+f+")");a=c.interpolate(a,d,e,f);C.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate() returns "+a);b.push(a)}});C.ctatdebug("CTATExampleTracerLink --\x3e out of interpolateHints "+
b);return b};this.getHints=function(){C.ctatdebug("CTATExampleTracerLink --\x3e in getHints");var a=[];C.interpolateHints(null).forEach(function(b){C.ctatdebug("CTATExampleTracerLink --\x3e in getHints loop");b.toString()!=="".toString()&&a.push(b)});C.ctatdebug("CTATExampleTracerLink --\x3e out of getHints");return a};this.getAllNonEmptyHints=function(){var a=[];r.forEach(function(b){b.trim().toString()!=="".toString()&&a.push(b)});return a};this.isTraversable=function(){return 1>C.getMaxTraversals()?
!1:CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()==C.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()==C.getActionType().toString().toUpperCase()?!0:!1};this.replaceInput=function(){return CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==C.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==C.getActionType().toString().toUpperCase()?!1:C.getMatcher().replaceInput()};
this.evaluateReplacement=function(a,b,c){return C.getMatcher().evaluateReplacement(a,b,c)};this.getActor=function(){return C.getMatcher().getActor()};this.getDefaultSAI=function(){C.ctatdebug(C.toString()+".getSAI(): "+(m?m.getDefaultSAI():"(matcher null)"));return m.getDefaultSAI()};this.getActionType=function(){return v};this.getMinTraversals=function(){return p};this.getMinTraversalsStr=function(){return y};this.getIsPreferredLink=function(){return u};this.getAllHints=function(){return r};this.setMatcher=
function(a){m=a};this.addHint=function(a){null!==a&&"undefined"!==typeof a&&a.toString()!=="".toString()&&r.push(a)};this.setSelection=function(a){C.getMatcher().setDefaultSelection(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setAction=function(a){C.getMatcher().setDefaultAction(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setActionType=function(a){if(null===a||"undefined"===typeof a||a.toString()!==CTATExampleTracerLink.CORRECT_ACTION.toString()&&a.toString()!==
CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.HINT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.UNTRACEABLE_ERROR.toString()&&a.toString()!==CTATExampleTracerLink.CLT_ERROR_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.GIVEN_ACTION.toString())throw new CTATExampleTracerException("invalid action type "+v);v=a};this.setBuggyMsg=function(a){B=a};this.setSuccessMsg=function(a){w=
a};this.setMinTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)y="1",p=1;else try{y=a,p=parseInt(a.trim()),isNaN(p)&&(p=1)}catch(E){p=1}};this.setMaxTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)z=y,n=p;else try{z=a,n=parseInt(a.trim()),isNaN(n)&&(n=1)}catch(E){n=p}};this.setUniqueID=function(a){c=a};this.addSkillName=function(a){C.ctatdebug("ETLink["+c+"].addSkillName("+a+")");if("unnamed"!==a){if(null===F||"undefined"===typeof F)F=[];-1<F.indexOf(a)||
(F.push(a),C.ctatdebug("ETLink.addSkillName() return with skillNames "+F))}};this.getSkillNames=function(){if(null===F||"undefined"===typeof F)F=[];return F};this.isTutorPerformed=function(a){if(CTATExampleTracerLink.CORRECT_ACTION.toUpperCase()!==C.getActionType().toUpperCase())return!1;var b=C.getMatcher();if(null===b||"undefined"===typeof b||null!==a&&"undefined"!==typeof a&&a!==b.isLinkTriggered())return!1;a=C.getActor();return CTATMatcher.isTutorActor(a,!0)?!0:!1};this.setIsPreferredLink=function(a){C.ctatdebug("ETLink.setIsPreferredLink() was "+
u+", now "+a);u=a};this.setVisualData=function(a){q=a};this.getVisualData=function(){return q}};
CTATExampleTracerLink.compareLinkTypes=function(a,g){ctatdebug("CTATExampleTracerLink --\x3e in compareLinkTypes("+a+", "+g+")");return null===a||"undefined"===typeof a?null===g||"undefined"===typeof g?0:1:null===g||"undefined"===typeof g?-1:a.toString()===g.toString()?0:a.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?1:a.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?
1:a.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?-1:g.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?1:0};Object.defineProperty(CTATExampleTracerLink,"BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Buggy Action"});Object.defineProperty(CTATExampleTracerLink,"FIREABLE_BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Fireable Buggy Action"});
Object.defineProperty(CTATExampleTracerLink,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Correct Action"});Object.defineProperty(CTATExampleTracerLink,"NO_MODEL",{enumerable:!1,configurable:!1,writable:!1,value:"NO-MODEL"});Object.defineProperty(CTATExampleTracerLink,"HINT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Hint Action"});Object.defineProperty(CTATExampleTracerLink,"UNTRACEABLE_ERROR",{enumerable:!1,configurable:!1,writable:!1,value:"Untraceable Error"});
Object.defineProperty(CTATExampleTracerLink,"CLT_ERROR_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Error Action"});Object.defineProperty(CTATExampleTracerLink,"GIVEN_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Given Action"});Object.defineProperty(CTATExampleTracerLink,"SUCCESS",{enumerable:!1,configurable:!1,writable:!1,value:"SUCCESS"});CTATExampleTracerLink.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLink.prototype.constructor=CTATExampleTracerLink;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerLink);var CTATExampleTracerPathComparator=function(){CTATBase.call(this,"CTATExampleTracerPathComparator","");var a=this;this.compare=function(g,f){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare");a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isDonePath(): "+g.isDonePath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isDonePath(): "+f.isDonePath());if(!0===g.isDonePath()&&!1===f.isDonePath())return-1;if(!0===f.isDonePath()&&!1===g.isDonePath())return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isIncorrectPath(): "+f.isIncorrectPath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isIncorrectPath()(): "+g.isIncorrectPath());if(!0===f.isIncorrectPath()&&!1===g.isIncorrectPath())return-1;if(!0===g.isIncorrectPath()&&!1===f.isIncorrectPath())return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredPrefixLinks(): "+g.getNumberOfPreferredPrefixLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredPrefixLinks(): "+
f.getNumberOfPreferredPrefixLinks());var c=g.getNumberOfPreferredPrefixLinks(),d=f.getNumberOfPreferredPrefixLinks();if(c>d)return-1;if(c<d)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfSuboptimalLinks(): "+g.getNumberOfSuboptimalLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfSuboptimalLinks(): "+f.getNumberOfSuboptimalLinks());c=g.getNumberOfSuboptimalLinks();d=f.getNumberOfSuboptimalLinks();if(c<d)return-1;if(c>d)return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredLinks(): "+g.getNumberOfPreferredLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredLinks(): "+f.getNumberOfPreferredLinks());c=g.getNumberOfPreferredLinks();d=f.getNumberOfPreferredLinks();if(c>d)return-1;if(c<d)return 1;c=g.getLinks().size;d=f.getLinks().size;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+c);a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+
d);if(c<d)return-1;if(c>d)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e out of comapre, about to call breakByLowerLinkID");return a.breakByLowerLinkID(g,f)};this.breakByLowerLinkID=function(g,f){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID");var c=g.getSortedLinks(),d=f.getSortedLinks(),b=null,e=null,h=0,l=0;do a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID in do while"),l>=c.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 1 is shorter"),
h=-1):l>=d.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 2 is shorter"),h=1):(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path are same, compare IDS"),b=c[l],e=d[l]),l++;while(0===h&&b.getUniqueID()===e.getUniqueID());0===h&&(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+b.getUniqueID()),a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+e.getUniqueID()),
h=b.getUniqueID()<e.getUniqueID()?-1:1);return h}};CTATExampleTracerPathComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPathComparator.prototype.constructor=CTATExampleTracerPathComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPathComparator);var CTATExampleTracerPath=function(a){CTATBase.call(this,"CTATExampleTracerPath","");var g=new Set;"undefined"!==typeof a&&null!==a&&a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in constructor building links with "+a);g.add(a)});var f=null,c=null,d=null,b=null,e=null,h=null,l=this;this.isIncorrectPath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isIncorrectPath");if(null!==h&&"undefined"!==typeof h)return h;var a=!1;l.getLinks().forEach(function(b){!0!==a&&b.getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(a=h=!0)});if(!0===a)return!0;h=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isIncorrectPath");return!1};this.getNumberOfSuboptimalLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfSuboptimalLinks");l.getSortedLinks();if(null!==b&&"undefined"!==typeof b)return b;var a=0;l.getLinks().forEach(function(b){CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()===b.getType().toString()&&a++});b=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfSuboptimalLinks");
return a};this.getNumberOfPreferredPrefixLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredPrefixLinks");if(null!==c&&"undefined"!==typeof c)return c;var a=0,b=!1;l.getSortedLinks().forEach(function(c){!0!==b&&(!0===c.getIsPreferredLink()?a++:b=!0)});c=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredPrefixLinks");return a};this.size=function(){return g.size};this.containsAll=function(a){var b=!0;if(a)for(var c=0;b&&c<a.length;++c)b=l.getLinks().has(a[c]);
l.ctatdebug("CTATExampleTracerPath containsAll(testLinks.length "+a.length+") returning "+b);return b};this.getLinksRestricted=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getLinksRestricted");var b=CTATExampleTracerPath.getDeepestLink(a),c=new Set;g.forEach(function(a){a.getDepth()<=b.getDepth()&&c.add(a)});ctatdebug("CTATExampleTracerPath --\x3e out of getLinksRestricted");return c};this.getLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getLinks");return g};this.getSortedLinks=
function(){ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks that.getLinks(): "+l.getLinks());f=[];l.getLinks().forEach(function(a){f.push(a)});ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks sortedLinks.length(): "+f.length);f.sort(function(a,b){return a.getDepth()-b.getDepth()});ctatdebug("CTATExampleTracerPath --\x3e out of getSortedLinks, returning "+f);return f};this.isDonePath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isDonePath");if(null!==e&&"undefined"!==typeof e)return e;
var a=!1;l.getLinks().forEach(function(b){!0!==a&&!0===b.isDone()&&(a=e=!0)});if(!0===a)return!0;e=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isDonePath");return!1};this.addLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in addLink ("+a+")");g.add(a);h=e=b=d=c=f=null;ctatdebug("CTATExampleTracerPath --\x3e out of addLink")};this.getNumberOfPreferredLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredLinks");if(null!==d&&"undefined"!==typeof d)return d;var a=
0;l.getLinks().forEach(function(b){!0===b.getIsPreferredLink()&&a++});d=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredLinks");return a};this.subpath=function(a){for(var b=new CTATExampleTracerPath,c=l.getSortedLinks(),d=0;d<c.length;++d)if(b.addLink(c[d]),c[d].getNextNode()==a.getNodeID())return b;return null};this.toString=function(){var a="CTATExampleTracerPath: links";l.getSortedLinks().forEach(function(b){a+=" "+b});return a};CTATExampleTracerPath.getDeepestLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getDeepestLink");
var b=null;a.forEach(function(a){if(null===b||"undefined"===typeof b||b.getDepth()<a.getDepth())b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getDeepestLink");return b};CTATExampleTracerPath.getBestPath=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath");var b=null,c=new CTATExampleTracerPathComparator;a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath loop");if(null===b||"undefined"===typeof b||0<c.compare(b,a))b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getBestPath");
return b}};CTATExampleTracerPath.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPath.prototype.constructor=CTATExampleTracerPath;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPath);var CTATLinkGroup=function(){CTATBase.call(this,"CTATLinkGroup","")};CTATLinkGroup.prototype=Object.create(CTATBase.prototype);CTATLinkGroup.prototype.constructor=CTATLinkGroup;"undefined"!==typeof module&&(module.exports=CTATLinkGroup);var CTATDefaultLinkGroup=function(a,g,f,c){CTATLinkGroup.call(this,"CTATDefaultLinkGroup",a);var d=a,b=g,e=f,h=new Set;null!==c&&"undefined"!==typeof c&&c.forEach(function(a){h.add(a)});var l=new Set,m=null,n=null,p=this;p.ctatdebug("CTATDefaultLinkGroup constructor group name: "+a);p.ctatdebug("CTATDefaultLinkGroup constructor group isOrdered: "+g);p.ctatdebug("CTATDefaultLinkGroup constructor group isReenterable: "+f);this.toXML=function(a,b){var c=a+'<group name="'+p.getName(),c=c+('" ordered="'+
p.getIsOrdered()),c=c+('" reenterable="'+p.getIsReenterable()+'">\n');b.getUniqueLinks(p).forEach(function(b){c+=a+'    <link id="'+b.getUniqueID()+'"/>\n'});l.forEach(function(d){c+=d.toXML(a+"    ",b)});return c+=a+"</group>\n"};this.setOrdered=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered group name: "+d);p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered:: "+a);b=a};this.setName=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setName: "+a);d=a};this.containsLink=
function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in containsLink: "+a.getUniqueID());return h.has(a)};this.removeLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in removeLink: "+a.getUniqueID());return h["delete"](a)};this.getParent=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getParent");return m};this.addLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addLink: "+a.getUniqueID());h.add(a)};this.getIsOrdered=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsOrdered: "+
b);return b};this.getIsReenterable=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsReenterable: "+e);return e};this.getSubgroups=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getSubgroups");return l};this.setSubgroups=function(a){l=a};this.getLinks=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getLinks");return h};this.setReenterable=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setReenterable: "+a);e=a};this.setParent=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setParent: "+
a.getName());m=a};this.addSubgroup=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addSubgroup groupName: "+a.getName());l.add(a)};this.getName=function(){return d};this.getDefaultBuggyMsg=function(){return n};this.setDefaultBuggyMsg=function(a){n=""==a?null:a};this.toString=function(){return"Group Name: "+this.getName()}};CTATDefaultLinkGroup.prototype=Object.create(CTATLinkGroup.prototype);CTATDefaultLinkGroup.prototype.constructor=CTATDefaultLinkGroup;
"undefined"!==typeof module&&(module.exports=CTATDefaultLinkGroup);var InternalGroupIterator=function(a,g){CTATBase.call(this,"InternalGroupIterator",a);var f=this,c=g.length,d=[],b=0;a.getSubgroups().forEach(function(a){a&&d.push(a)});g.push(f);f.ctatdebug("InternalGroupIterator() constructor group "+a+", stack.length "+g.length+", sgList.length "+d.length);this.toString=function(){return"{"+a+" at "+c+" with "+d.length+" subgroups}"};this.next=function(){return b>=d.length?(g.pop(),f.ctatdebug("InternalGroupIterator at deepest next() returning "+a+" with stack.length "+
g.length),{value:a,done:!1}):(new InternalGroupIterator(d[b++],g)).next()}};InternalGroupIterator.prototype=Object.create(CTATBase.prototype);InternalGroupIterator.prototype.constructor=InternalGroupIterator;var CTATGroupIterator=function(a){CTATBase.call(this,"CTATGroupIterator",a);this.ctatdebug("CTATGroupIterator("+a+") begin constructor");var g=null;this.next=function(){null===g&&(g=[],new InternalGroupIterator(a,g));return 0>=g.length?{value:null,done:!0}:g[g.length-1].next()}};
CTATGroupIterator.prototype=Object.create(CTATBase.prototype);CTATGroupIterator.prototype.constructor=CTATGroupIterator;"undefined"!==typeof module&&(module.exports=CTATGroupIterator);var CTATGroupModel=function(){CTATBase.call(this,"CTATGroupModel","");var a=this;this.clear=function(){};this.setDefaultReenterable=function(a){};this.setGroupOrdered=function(a,f){};this.getTopLevelGroup=function(){};this.setGroupName=function(a,f){};this.addLinkToGroup=function(a,f){};this.isGroupOrdered=function(a){};this.isGroupReenterable=function(a){};this.isLinkInGroup=function(){};this.getGroupsContainingLink=function(a){};this.getGroupLinkCount=function(g){return a.getGroupLinks(g).size};
this.getLowestLevelGroupOfLink=function(a){};this.getGroupSubgroups=function(a){};this.getUniqueLinks=function(a){};this.getGroupLinks=function(a){};this.removeLinkFromGroup=function(a,f){};this.getGroupParent=function(a){};this.addGroup=function(a,f,c){};this.setGroupReenterable=function(a,f){}};CTATGroupModel.prototype=Object.create(CTATBase.prototype);CTATGroupModel.prototype.constructor=CTATGroupModel;"undefined"!==typeof module&&(module.exports=CTATGroupModel);var CTATDefaultGroupModel=function(){function a(a,b,c){l.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroupRecursive");!0===a.containsLink(b)&&(l.getGroupSubgroups(a).forEach(function(a){l.removeLinkFromGroup(a,b)}),(a!==e||c)&&g(a,b))}function g(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroup");return a.removeLink(b)}function f(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in getImmediateGroupOfLink");var c=null,d=!1,e=null;l.getGroupSubgroups(b).forEach(function(b){!0!==
d&&!0===l.isLinkInGroup(b,a)&&(c=f(a,b),e=null!==c&&"undefined"!==typeof c?c:b,d=!0)});return!0===d?e:null}function c(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in getNaturalContainingGroup");if(b.size===l.getGroupLinks(a).size)throw l.getGroupLinks(a).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}),new CTATExampleTracerException("Group containing this set of links already exists: "+a);if(b.size>=l.getGroupLinks(a).size)throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+
a);var d=!1,e=null;b.forEach(function(f){if(!0!==d){if(!1===l.isLinkInGroup(a,f))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);l.getGroupSubgroups(a).forEach(function(g){!0!==d&&!0===l.isLinkInGroup(g,f)&&(l.getGroupLinkCount(g)>=b.size?(e=c(g,b),d=!0):l.getGroupLinks(g).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}))})}});return!0===d?e:a}function d(a,
c){l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity parent: "+a.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity child: "+c.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity size: "+l.getGroupSubgroups(a).size);l.getGroupSubgroups(a).forEach(function(d){var e=l.getGroupLinks(d);if(0===e.size)l.getGroupSubgroups(a)["delete"](d),b(c,d);else{var f=null,g=!1;e.forEach(function(a){!1===g&&(f=a,g=!0)});!0===l.isLinkInGroup(c,
f)&&(l.getGroupSubgroups(a)["delete"](d),b(c,d))}});b(a,c)}function b(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroup");a.addSubgroup(b);b.setParent(a)}CTATGroupModel.call(this);var e=null,h=!1,l=this;this.clear=function(){l.ctatdebug("CTATDefaultGroupModel --\x3e in clear");e=new CTATDefaultLinkGroup("defaultName",!0,h,null)};this.setDefaultReenterable=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in setDefaultReenterable");h=a};this.setGroupOrdered=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupOrdered");
a.setOrdered(b)};this.getTopLevelGroup=function(){ctatdebug("CTATDefaultGroupModel --\x3e in getTopLevelGroup");return e};this.setGroupName=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupName");a.setName(b)};this.addLinkToGroup=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in addLinkToGroup");for(l.removeLinkFromGroup(e,b);null!==a&&"undefined"!==typeof a;a=l.getGroupParent(a)){var c=a,d=b;l.ctatdebug("CTATDefaultGroupModel --\x3e in internalAddLinkToGroup");c.addLink(d)}};
this.isGroupOrdered=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered group name: "+a.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered: "+a.getIsOrdered());return a.getIsOrdered()};this.isGroupReenterable=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupReenterable");return a.getIsReenterable()};this.isLinkInGroup=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in isLinkInGroup");return a.containsLink(b)};this.getGroupsContainingLink=
function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink("+a+"): TopLevel "+e+", typeof(TopLevel) "+typeof e);var b=new Set,c=new CTATGroupIterator(e);l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink before loop: groupIter "+c+", typeof(groupIter) "+typeof c);for(var d=c.next();!d.done;d=c.next())d=d.value,!0===l.isLinkInGroup(d,a)&&b.add(d);l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink returning groups.size "+b.size);return b};this.getLowestLevelGroupOfLink=
function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getLowestLevelGroupOfLink");var b=f(a,e);return null!==b&&"undefined"!==typeof b?b:!0===l.isLinkInGroup(e,a)?e:null};this.getGroupSubgroups=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupSubgroups");return null!==a&&"undefined"!==typeof a?a.getSubgroups():null};this.getUniqueLinks=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getUniqueLinks");var b=new Set;l.getGroupLinks(a).forEach(function(a){b.add(a)});l.getGroupSubgroups(a).forEach(function(a){l.getGroupLinks(a).forEach(function(a){b["delete"](a)})});
return b};this.getGroupLinks=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupLinks: "+a.getName());return a.getLinks()};this.removeLinkFromGroup=function(b,c){l.ctatdebug("CTATDefaultGroupModel --\x3e in removeLinkFromGroup");a(b,c,!1)};this.getGroupParent=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupParent");return a.getParent()};this.addGroup=function(a,b,f){l.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup");var g=null;try{g=c(e,f)}catch(r){return r.toString()}a=
new CTATDefaultLinkGroup(a,b,h,f);l.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup after creating new group");d(g,a);return""};this.setGroupReenterable=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupReenterable");a.setReenterable(b)};this.createIdToLinkMap=function(){l.ctatdebug("CTATDefaultGroupModel --\x3e in createIdToLinkMap");var a={};l.getGroupLinks(e).forEach(function(b){a[b.getUniqueID()]=b});return a};this.getGroupByName=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupByName TopLevel has: "+
e.getSubgroups().size);for(var b=new CTATGroupIterator(e),c=b.next();!c.done;c=b.next())if(c=c.value,l.getGroupName(c).toString()===a.toString())return c;return null};this.getGroupName=function(a){return a.getName()};l.clear()};CTATDefaultGroupModel.prototype=Object.create(CTATGroupModel.prototype);CTATDefaultGroupModel.prototype.constructor=CTATDefaultGroupModel;"undefined"!==typeof module&&(module.exports=CTATDefaultGroupModel);var CTATMatcherComparator=function(){CTATBase.call(this,"CTATMatcherComparator","");CTATMatcherComparator.compare=function(a,g){ctatdebug("CTATMatcherComparator--\x3e in compare");var f=CTATMatcherComparator.compareBasedOnType(a,g);if(0!==f||!1===a instanceof CTATVectorMatcher&&!1===g instanceof CTATVectorMatcher)return f;f=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("input"),g.getSingleMatcher("input"));if(0!==f)return f;f=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("selection"),
g.getSingleMatcher("selection"));return 0!==f?f:CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("action"),g.getSingleMatcher("action"))};CTATMatcherComparator.compareBasedOnType=function(a,g){ctatdebug("CTATMatcherComparator --\x3e in compareBasedOnType");for(var f in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(f)&&a instanceof CTATMatcherComparator.matcherPrecedenceOrder[f])break;for(var c in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(c)&&
g instanceof CTATMatcherComparator.matcherPrecedenceOrder[c])break;return f<c?1:f>c?-1:0}};Object.defineProperty(CTATMatcherComparator,"matcherPrecedenceOrder",{enumerable:!1,configurable:!1,writable:!1,value:{0:CTATExactMatcher,1:CTATRangeMatcher,2:CTATExpressionMatcher,3:CTATWildcardMatcher,4:CTATRegexMatcher,5:CTATAnyMatcher}});CTATMatcherComparator.prototype=Object.create(CTATBase.prototype);CTATMatcherComparator.prototype.constructor=CTATMatcherComparator;
"undefined"!==typeof module&&(module.exports=CTATMatcherComparator);new CTATMatcherComparator;var CTATExampleTracerLinkComparator=function(a,g){CTATBase.call(this,"CTATExampleTracerLinkComparator","");this.compare=function(f,c){ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+c.getUniqueID());var d=f.getType(),b=c.getType(),d=CTATExampleTracerLink.compareLinkTypes(d,b);if(0!==d)return ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare m: "+d),d;d=g.nonEmptyHints(f,
a.getVariableTable());b=g.nonEmptyHints(c,a.getVariableTable());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare h1, h2: "+d+", "+b);if(0<d&&0>=b)return-1;if(0>=d&&0<b)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getDepth(), l2.getDepth(): "+f.getDepth()+", "+c.getDepth());if(f.getDepth()<c.getDepth())return-1;if(f.getDepth()>c.getDepth())return 1;d=a.getTraversalCount(f)-f.getMinTraversals();b=a.getTraversalCount(c)-c.getMinTraversals();ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare tc1, tc2: "+
d+", "+b);if(0>d&&0<=b)return-1;if(0<=d&&0>b)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getIsPreferredLink(): "+f.getIsPreferredLink());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getIsPreferredLink(): "+c.getIsPreferredLink());if(f.getIsPreferredLink())return-1;if(c.getIsPreferredLink())return 1;if(0!==(d=CTATMatcherComparator.compare(f.getMatcher(),c.getMatcher())))return d;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+
f.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+c.getUniqueID());return f.getUniqueID()<c.getUniqueID()?-1:1}};CTATExampleTracerLinkComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLinkComparator.prototype.constructor=CTATExampleTracerLinkComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkComparator);var CTATExampleTracerEvent=function(a,g,f){CTATBase.call(this,"CTATExampleTracerEvent",g?g.toString():"null");var c="",d=!1,b=CTATExampleTracerLink.NO_MODEL,e=!1,h=null,l=null,m="student",n=null,p=null,v="",r=null,u="",w=null,B=null,y=null,z=null,q=[],F=!1,C=null,A=null,E=this,I=null,G=[],x=[],H={};this.getMsgToRestore=function(){return I};this.setMsgToRestore=function(a){I=a};this.getActor=function(){return m};this.setActor=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e setActor("+a+")");
m=a};this.getStudentSAI=function(){E.ctatdebug("CTATExampleTracerEvent.getStudentSAI() returning type "+typeof h+", value "+h);return h};this.setStudentSAI=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setStudentSAI("+a+")");null!==a&&"undefined"!==typeof a&&(h=a);E.ctatdebug("CTATExampleTracerEvent --\x3e out of setStudentSAI")};this.getPreloadedLinkMatches=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getPreloadedLinkMatches");return w};this.setTutorSAI=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setTutorSAI");
null!==a&&"undefined"!==typeof a&&(l=a);E.ctatdebug("CTATExampleTracerEvent --\x3e out of setTutorSAI")};this.setNumberOfInterpretations=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setNumberOfInterpretations( "+a+" )")};this.getTransactionID=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getTransactionID() returning "+c);return c};this.setTransactionID=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setTransactionID( "+a+" )");c=a};this.setDoneStepFailed=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setDoneStepFailed( "+
a+" )");d=a};this.setHintRequest=function(a){e=a};this.getHintRequest=function(){return e};this.setResult=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setResult( "+a+" )");b=a};this.isBuggyResult=function(){return b.toString()===CTATExampleTracerLink.BUGGY_ACTION||b.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION};this.isSolverResult=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in isSolverResult");return!1};this.getResult=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getResult() returning "+
b);return b};this.setReportableLink=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableLink("+a+")");n=a};this.setReportableInterpretation=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableInterpretation("+a+")");p=a};this.setStepID=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setStepID("+a+")");v=a?a.toString():""};this.setReportableVariableTable=function(a){y=a.clone()};this.setSuccessOrBuggyMsg=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setSuccessOrBuggyMsg("+
a+")");z=a};this.setReportableHints=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableHints("+a+")");q=Array.isArray(a)&&0<a.length?a:[]};this.getWantReportableHints=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getWantReportableHints() returning "+F);return F};this.setOutOfOrder=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setOutOfOrder("+a+")");r=a};this.isOutOfOrder=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getOutOfOrder() returning "+
r);return r};this.setTraceOutcome=function(a){u=a};this.getTraceOutcome=function(){return u};this.setEvaluatedInput=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setEvaluatedInput("+a+")");if(null===B||"undefined"===typeof B)B=[];B.push(a)};this.addPreloadedLinkMatch=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in addPreloadedLinkMatch("+a+")");if(null===w||"undefined"===typeof w)w=[];w.push(a)};this.setInterpolatedSAI=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedSAI("+
a+")");a&&(C=a)};this.getInterpolatedSAI=function(){return C?C:E.getStudentSAI()};this.setInterpolatedHints=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedHints("+a+")");A&&(A.length=0);a&&(A=a.slice(0));E.ctatdebug("CTATExampleTracerEvent --\x3e out of setInterpolatedHints")};this.setWantReportableHints=function(a){E.ctatdebug("CTATExampleTracerEvent --\x3e in setWantReportableHints("+a+")");F=a};this.setAssociatedRules=function(a){G=a instanceof Array?a:a instanceof String?
[a]:[]};this.setAssociatedSkills=function(a){x=a instanceof Array?a:a instanceof String?[a]:[]};this.setCustomFields=function(a){H=a instanceof Object?a:{}};this.getSuccessOrBuggyMsg=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getSuccessOrBuggyMsg() returning "+z);return z};this.getReportableHints=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableHints() returning "+q);return q};this.getReportableLink=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableLink() returning "+
n);return n};this.getReportableVariableTable=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableVariableTable() returning "+y);return y};this.getReportableInterpretation=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableInterpretation() returning "+p);return p};this.getStepID=function(){E.ctatdebug("CTATExampleTracerEvent --\x3e in getStepID() returning "+v);return v};this.getTutorSelection=function(){return null===l||"undefined"===typeof l?null:l.getSelectionArray()};
this.getTutorAction=function(){return null===l||"undefined"===typeof l?null:l.getActionArray()};this.getTutorInput=function(){return null!==B&&"undefined"!==typeof B?E.getEvaluatedInputArray():null!==l&&"undefined"!==typeof l?l.getInputArray():null};this.getEvaluatedInputArray=function(){return B};this.toString=function(){var a;a="["+E.getResult();null!==E.getStudentSAI()&&"undefined"!==typeof E.getStudentSAI()&&(a+=", StudentSAI "+E.getStudentSAI());null!==E.getReportableLink()&&"undefined"!==typeof E.getReportableLink()&&
(a+=", reportableLink "+E.getReportableLink());!0===E.isDoneStepFailed()&&(a+=", doneStepFailed");null!==E.getTutorSAI()&&"undefined"!==typeof E.getTutorSAI()&&(a+=", TutorSAI "+E.getTutorSAI());return a+"]"};this.isDoneStepFailed=function(){return d};this.getTutorSAI=function(){return l};this.getAssociatedRules=function(){return G};this.getAssociatedSkills=function(){return x};this.getCustomFields=function(){return H};this.setStudentSAI(g);this.setActor(f)};CTATExampleTracerEvent.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerEvent.prototype.constructor=CTATExampleTracerEvent;"undefined"!==typeof module&&(module.exports=CTATExampleTracerEvent);var CTATExampleTracerInterpretation=function(a){CTATBase.call(this,"CTATExampleTracerInterpretation","");var g=null,f=[],c={},d=new CTATVariableTable,b=new Set;a.forEach(function(a){b.add(a)});var e=CTATExampleTracerLink.CORRECT_ACTION,h=null,l=this;this.getVariableTable=function(){return d};this.setVariableTable=function(a){d=a};this.setLatestHints=function(a,b){l.ctatdebug("In evaluate after calling setInterpolatedHints");if(!Array.isArray(a)||1>a.length)a=b;!Array.isArray(a)||1>a.length||d.put("hints",
a)};this.getLatestHints=function(){return d.get("hints")};this.setLatestBuggyMessage=function(a){!a||1>(a=String(a)).length||d.put("buggy_message",a)};this.setLatestSuccessMessage=function(a){!a||1>(a=String(a)).length||d.put("success_message",a)};this.getLatestBuggyMessage=function(){return d.get("buggy_message")};this.getLatestSuccessMessage=function(){return d.get("success_message")};this.getTraversalCount=function(a){a=c[a.getUniqueID()];return"undefined"===typeof a||null===a?0:a[0]};this.getPaths=
function(){return b};this.clone=function(){var a=new CTATExampleTracerInterpretation(b);a.setInterpolatedSAI(l.getInterpolatedSAI());a.addTraversedLinks(f);for(var g in c)c.hasOwnProperty(g)&&a.putInlinkIdTraversalCountMap(g,c[g].slice());a.setWorstLinkType(e);g=d.clone();a.setVariableTable(g);a.setLatestHints(l.getLatestHints());a.setLatestSuccessMessage(l.getLatestSuccessMessage());a.setLatestBuggyMessage(l.getLatestBuggyMessage());h&&a.setPathToDone(new CTATExampleTracerPath(h.getLinks()));ctatdebug("CTATExampleTracerInterpretation --\x3e out of clone");
return a};this.addTraversedLinks=function(a){f=f.concat(a)};this.putInlinkIdTraversalCountMap=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap");ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap key: "+a);ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap value: "+b);c[a]=b};this.setWorstLinkType=function(a){e=a};this.addLink=function(a){!a.isTraversable()||h&&h.getLinks().has(a)||(h=null);
ctatdebug("CTATExampleTracerInterpretation.addLink("+(a&&a.getUniqueID())+") pathToDone "+(h&&h.size()));f.push(a);var b=a.getMatcher(),b=null===b||"undefined"===typeof b?1:b.getTraversalIncrement(),d=c[a.getUniqueID()];null!==d&&"undefined"!==typeof d?d[0]+=b:(d=[],d.push(b),c[a.getUniqueID()]=d);a=a.getType();0>CTATExampleTracerLink.compareLinkTypes(e,a)&&(e=a)};this.setPathToDone=function(a){h=a};this.getPathToDone=function(a){if(h)return h;var b=a.getStartNode();b&&a.getDoneStates().forEach(function(c){h||
(h=a.getBestSubpath(b,c,f))});return h};this.countStepsForScore=function(a){var b=Number.MAX_VALUE,c=l.getPathToDone(a);if((a=a.getStudentStartsHereNode()||a.getStartNode())&&c&&c.getLinks()){var d=a.getNodeID(),b=0;c.getSortedLinks().forEach(function(a){if(!(0<d&&a.getPrevNode()!=d||(d=-1,CTATMatcher.isTutorActor(a.getActor(),!0)))){var c=l.getTraversalCount(a);a=a.getMinTraversals();b=c>a?b+c:b+a}})}return b};this.updateVariableTable=function(a,b,c){var e=a,f=a.getInput();null!==b&&"undefined"!==
typeof b&&(f=b,e=new CTATSAI(a.getSelection(),a.getAction(),f));d.put("link"+c.getUniqueID()+".selection",a.getSelection());d.put("link"+c.getUniqueID()+".action",a.getAction());b="link"+c.getUniqueID()+".input";d.put(b,f);d.put(CTATVariableTable.nameAsString(b),CTATVariableTable.valueAsString(f));if(CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()===c.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()===c.getActionType().toString().toUpperCase())a=
a.getSelection(),null!==a&&"undefined"!==typeof a&&0<a.length&&d.put(a,f);return e};this.getInterpolatedSAI=function(){return g};this.setInterpolatedSAI=function(a){g=a};this.getLastMatchedLink=function(){return 0===f.length?null:f[f.length-1]};this.getMatchedLinks=function(){return f};this.getType=function(){return e};this.isTraversed=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed: "+a.getUniqueID());var d=c[a.getUniqueID()];if(null===d||"undefined"===typeof d)return ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (traversalCount === null): "+
(null===d)),ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (typeof(traversalCount) === 'undefined'): "+("undefined"===typeof d)),!0===b?0>=a.getMinTraversals():!1;ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition traversalCount[0]: "+d[0]);ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition link.getMinTraversals(): "+a.getMinTraversals());return d[0]>=a.getMinTraversals()};this.toString=function(){var a=
"{";f.forEach(function(b){a+=b.getUniqueID()+", "});a.substring(a.length-2,a.length).toString()===", ".toString()&&(a=a.substring(0,a.length-2));a+=" ("+(null===b||"undefined"===typeof b?-1:b.size)+" paths)";a+=" var tbl "+d;return a+="}"}};CTATExampleTracerInterpretation.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretation.prototype.constructor=CTATExampleTracerInterpretation;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretation);var CTATExampleTracerInterpretationComparator=function(){CTATBase.call(this,"CTATExampleTracerInterpretationComparator","");var a=this;this.compare=function(g,f){a.ctatdebug("CTATExampleTracerInterpretationComparator --\x3e in compare");var c=g.getType(),d=CTATExampleTracerLink.compareLinkTypes(c,f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i1Type: "+g.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i2Type: "+f.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing link types result: "+
d);if(0!==d)return ctatdebug("CTATExampleTracerInterpretationComparator result is not equal to 0"),0>d?1:-1;if(CTATExampleTracerLink.BUGGY_ACTION.toString().toUpperCase()===c.toString().toUpperCase()&&(ctatdebug("CTATExampleTracerInterpretationComparator checking for buggy actions"),c=g.getLastMatchedLink(),d=f.getLastMatchedLink(),c=CTATMatcherComparator.compare(c.getMatcher(),d.getMatcher()),0!==c))return c;var d=CTATExampleTracerPath.getBestPath(g.getPaths()),c=CTATExampleTracerPath.getBestPath(f.getPaths()),
b=new Set;b.add(d);b.add(c);d=CTATExampleTracerPath.getBestPath(b);ctatdebug("CTATExampleTracerInterpretationComparator found best path: "+(d===c));d.getLinks().forEach(function(b){a.ctatdebug("My best link==: "+b.getUniqueID())});return d===c?-1:1}};CTATExampleTracerInterpretationComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretationComparator.prototype.constructor=CTATExampleTracerInterpretationComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretationComparator);var CTATExampleTracerTracer_count=0,CTATExampleTracerTracer=function(a,g){function f(a,b,c){if(!a)return a;b=new CTATFormulaParser(b);x.ctatdebug("CTATETT.interpolate("+a+",vt,"+c+")");var d=c.getSelection(),e=c.getAction();c=c.getInput();c=CTATVariableTable.standardizeType(c);x.ctatdebug("CTATETT.interpolate() calling CTATFP.interpolate("+a+", "+d+", "+e+", "+c);a=b.interpolate(a,d,e,c);x.ctatdebug("CTATETT.interpolate() returning "+a);return a}function c(a,b,c,d,e,g){x.ctatdebug("finishEvaluate() doUpdate "+
b+", link "+d+", bestInterp.getLastMatchedLink() "+e.getLastMatchedLink());null==d&&(d=e.getLastMatchedLink());(b||a.getWantReportableHints())&&g.forEach(function(b){var c="",g=b.getLastMatchedLink();g&&(g.getActionType()==CTATExampleTracerLink.CORRECT_ACTION?a.getHintRequest()?a.getWantReportableHints()&&b.setLatestHints(d.interpolateHints(b.getVariableTable()),g.getHints()):b.setLatestSuccessMessage(c=f(g.getSuccessMsg(),b.getVariableTable(),a.getStudentSAI())):b.setLatestBuggyMessage(c=f(g.getBuggyMsg(),
b.getVariableTable(),a.getStudentSAI())),b==e&&(x.ctatdebug('ETT.finishEvaluate() successOrBuggyMsg "'+c+'"'),a.setSuccessOrBuggyMsg(c)))});if(b){C.push(a.getStudentSAI());d!=e.getLastMatchedLink()&&(e.addLink(d),a.setResult(d.getActionType()),a.setTraceOutcome(d.getActionType()));if(c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()){x.ctatdebug("In evaluate -- in first branch doUpdate()");g.forEach(function(a){a.getLastMatchedLink().getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(x.ctatdebug("In evaluate -- deleting an incorrect interp"),g["delete"](a))});x.ctatdebug("In evaluate -- to call setInterpretations(), if 0 < newInterps.size "+g.size);0<g.size&&(v(g),I=e);for(var h in F)F.hasOwnProperty(h)&&delete F[h];x.ctatdebug("In evaluate -- out of DoUpdate if branch")}else{x.ctatdebug("In evaluate -- in else branch of doUpdate");a.setNumberOfInterpretations(0);for(var l in F)F.hasOwnProperty(l)&&delete F[l];g.forEach(function(a){F[a.getLastMatchedLink().getUniqueID()]=
a.getLastMatchedLink()})}c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&C.splice(C.length-1,1)}a.isSolverResult()||(x.ctatdebug("In evaluate inside the NOT solver result if condition "+c),a.setResult(c),a.setTraceOutcome(c));x.ctatdebug("In evaluate out the solver result if condition");a.setReportableLink(d);a.setAssociatedSkills(d.getSkillNames());a.setStepID(d.getUniqueID());a.setReportableInterpretation(e);a.setInterpolatedSAI(e.getInterpolatedSAI());a.setReportableVariableTable(e.getVariableTable());
a.getHintRequest()?(a.setReportableHints(e.getLatestHints()),x.ctatdebug("In evaluate --\x3e after setReportableHints")):(b=d.getTutorSAI(a.getInterpolatedSAI(),e.getVariableTable()),x.ctatdebug("In evaluate -- TUTORSAI: "+b+", studentSAI was "+a.getStudentSAI()),a.setTutorSAI(b));x.ctatdebug("In evaluate after fireExampleTracerEvent");x.ctatdebug("CTATExampleTracerTracer --\x3e out of finishEvaluate");return c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()}function d(a,c,d,e){x.ctatdebug("checkDoneStep() hintTrace "+
c+", sai "+a.getStudentSAI()+", exitOnIncorrectDone "+A.exitOnIncorrectDone()+", hideButRequireSteps "+A.hideButRequireSteps()+", nInterps "+e.size);if(!a.getStudentSAI().isDone())return x.ctatdebug("checkDoneStep() not isDone(), so setDoneStepFailed(false) & return null "),null;if(A.exitOnIncorrectDone())return x.ctatdebug("checkDoneStep() exitOnIncorrectDone() with setDoneStepFailed(false), so return CORRECT"),b(a,d,null,e);if(!c&&A.hideButRequireSteps()){c=A.getDoneLinks();x.ctatdebug("checkDoneStep getDoneLinks().size "+
c.size);c=c.values();for(var f;!(f=c.next()).done;)if(A.pathToLinkIsSubset(f.value,G))return b(a,d,f.value,e)}1>e.size&&a.setDoneStepFailed(!0);return null}function b(a,b,d,e){var f;a.setDoneStepFailed(!1);1>e.size?(e=x.getInterpretationsInternal(),f=x.getBestInterpretation()):f=p(e);f.setInterpolatedSAI(new CTATSAI("done","ButtonPressed","-1"));return c(a,b,CTATExampleTracerLink.CORRECT_ACTION,d,f,e)}function e(a,b,e){x.ctatdebug("CTATExampleTracerTracer --\x3e _evaluate("+a+", "+b+", "+e+")");E=
a;var f=new Set,g=a.getPreloadedLinkMatches();x.ctatdebug("interps # : "+q.length);x.ctatdebug("interps: "+q);q.forEach(function(c){x.ctatdebug("In evaluate -- entered the interpretations loop");if("undefined"===typeof g||null===g)x.ctatdebug("In evaluate -- entered if check for saiLinkMatches"),g=l(a.getStudentSAI(),a.getActor(),b,c.getVariableTable(),a),x.ctatdebug("In evaluate -- exiting if check for saiLinkMatches");else for(var d=0;d<g.length;++d)h(a.getStudentSAI(),!0,g[d],g[d].getActor(),c.getVariableTable());
x.ctatdebug("Link matches # : "+g.length);g.forEach(function(b){x.ctatdebug("In evaluate -- entered the saiLinkMatches loop + "+b);if(!A.relaxOrderConstraints()&&c.getTraversalCount(b)>=b.getMaxTraversals())return x.ctatdebug("In evaluate -- skipped a saiLinkMatches loop \n Skipped due to max traversals"+b.getMaxTraversals()),!1;var d=c.clone();d.setInterpolatedSAI(null);x.ctatdebug("In evaluate size of getPaths "+d.getPaths().size);d.getPaths().forEach(function(c){x.ctatdebug("In evaluate -- looping through the newInterp.getPaths()\n Examining path: "+
c);!1===m(b,d,c,!1,a)&&(x.ctatdebug("In evaluate -- in if condition, checking if isPathOK"),d.getPaths()["delete"](c),x.ctatdebug("In evaluate -- out of if condition, checking if isPathOK\n Tried to delete path."))});x.ctatdebug("In evaluate -- done looping through the newInterp.getPaths(), size "+d.getPaths().size);if(0<d.getPaths().size){x.ctatdebug("In evaluate -- if number of paths is greater than 0");d.addLink(b);x.ctatdebug("In evaluate -- new link added");if(!0===e){x.ctatdebug("In evaluate -- we are in the doUpdate if condition");
var g=n(b,a.getStudentSAI(),d);x.ctatdebug("In evaluate -- updatingVariable table");d.setInterpolatedSAI(d.updateVariableTable(a.getStudentSAI(),g,b));x.ctatdebug("In evaluate -- done updatingVariable table: "+d.getVariableTable())}f.add(d);x.ctatdebug("In evaluate -- added new interp")}x.ctatdebug("In evaluate -- out of saiLinkMatches loop")});x.ctatdebug("In evaluate -- out of interpretation loops")});a.setNumberOfInterpretations(f.size);x.ctatdebug("In evaluate -- number of interpretations "+f.size+
" set");var r=d(a,b,e,f);if(null!==r)return r;if(0===f.size)return x.ctatdebug("In evaluate -- if condition no new interpretations"),0!==g.length&&!0===g[0].isDone()&&a.setDoneStepFailed(!0),a.setResult(CTATExampleTracerLink.NO_MODEL),a.setTraceOutcome(CTATExampleTracerLink.NO_MODEL),x.ctatdebug("In evaluate -- if condition no new interpretations returning false"),!1;r=p(f);x.ctatdebug("In evaluate -- just found bestInterp");var u=null;!0===a.isSolverResult()?(x.ctatdebug("In evaluate -- in if branch of isSolverResult"),
u=CTATExampleTracerLink.NO_MODEL.toString().toUpperCase()===a.getResult().toString().toUpperCase()?CTATExampleTracerLink.BUGGY_ACTION.toString():a.getResult().toString()):(x.ctatdebug("In evaluate -- in else branch of isSolverResult"),u=r.getLastMatchedLink().getType());return c(a,e,u,null,r,f)}function h(a,b,c,d,e){var f=b&&c.isCorrect();if("undefined"!=typeof G[c.getUniqueID()]||c.matchesSAIforHint(a,d,null,e))G[c.getUniqueID()]=f;x.ctatdebug("updateMatchedSelections(): link "+c.getUniqueID()+", matched "+
b+", newResult "+f+", matchedSelections[link] "+G[c.getUniqueID()])}function l(a,b,c,d,e){x.ctatdebug("CTATExampleTracerTracer --\x3e in findSAIMatchingLinks("+a+", "+b+", "+c+")");var f=[];A.getLinks().forEach(function(g){if(!1===c){x.ctatdebug("Calling link.matchesSAI() on link "+g+", sai "+a);var l=g.matchesSAI(a,b,d);x.ctatdebug("Result from link.matchesSAI() on link "+g+": "+l+", typeof "+typeof l);!0===l&&f.push(g);A.hideButRequireSteps()&&h(a,l,g,b,d)}else!0===g.matchesSAIforHint(a,b,e,d)&&
f.push(g)});x.ctatdebug("CTATExampleTracerTracer --\x3e out of findSAIMatchingLinks: #matchingLinks "+f.length);return f}function m(a,b,c,d,e){x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK");var f=null;if(!0===d){x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK in demonstrate mode");var g=b.getMatchedLinks().slice();g.push(a);f=c.getLinksRestricted(g)}else x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK NOT in demonstrate mode"),f=c.getLinks();x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK path.getLinks() "+
c.getLinks().size);x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK pathLinks "+f.size);if(!0===d){var h=[],l=!0;b.getMatchedLinks().forEach(function(a){!1!==l&&(!1===A.observesOrderingConstraints(h,a,f,e)||!1===u(b,a,f)?(x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false1"),l=!1):h.push(a))});if(!1===l)return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false2"),!1}if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()){if(!1===
A.isIncorrectLinkOK(b.getMatchedLinks(),a,f,b))return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false3"),!1}else{if(!1===A.observesOrderingConstraints(b.getMatchedLinks(),a,f,e))return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false4"),!1;if(!1===u(b,a,f))return x.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false5"),!1}x.ctatdebug("CTATExampleTracerTracer --\x3e out of isPathOK returning true");return!0}function n(a,b,c){x.ctatdebug("CTATExampleTracerTracer.replaceInput("+
a+", "+b+", ...)");if(null===a||"undefined"===typeof a||!1===a.replaceInput())return x.ctatdebug("replaceInput false, returning null"),null;a=a.evaluateReplacement(b,c.getVariableTable(),x);x.ctatdebug("CTATExampleTracerTracer.replaceInput() returning "+a);return a}function p(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation");var b=new CTATExampleTracerInterpretationComparator,c=null;a.forEach(function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation iteration");
null===c||"undefined"===typeof c?(x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation first if condition"),c=a):(x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation else of first if condition"),0<b.compare(a,c)&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation second if condition"),c=a))});x.ctatdebug("CTATExampleTracerTracer --\x3e out of findBestInterpretation");return c}function v(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in setInterpretations");
q.length=0;0===a.size?x.ctatdebug("CTATExampleTracerTracer --\x3e returning from setInterpretations"):(x.ctatdebug("CTATExampleTracerTracer --\x3e setInterpretations c.size: "+a.size),a.forEach(function(a){q.push(a)}),I=null,x.ctatdebug("CTATExampleTracerTracer --\x3e out of setInterpretations"))}function r(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths");var a=A.findAllPaths();x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths: #paths "+a.size);a.forEach(function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths loopring through paths");
x.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths size of path"+a.getLinks().size)});return a}function u(a,b,c){x.ctatdebug("CTATExampleTracerTracer --\x3e in doneStepOK: link "+b+", isDone() "+b.isDone());if(null===b||"undefined"===typeof b||!1===b.isDone())return x.ctatdebug("doneStepOK in first if condition"),!0;if(b.isDone()&&A.exitOnIncorrectDone())return!0;if(b.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return x.ctatdebug("doneStepOK in second if condition"),
!0;x.ctatdebug("doneStepOK before loop");var d=!0;c.forEach(function(c){if(!1===d)x.ctatdebug("CTATExampleTracerTracer --\x3e we are breaking from the loop");else if(c.getUniqueID()===b.getUniqueID())x.ctatdebug("CTATExampleTracerTracer --\x3e inside second if condition");else{var e=a.getTraversalCount(c);A.hideButRequireSteps()&&(0<e||1>c.getMinTraversals())||!(e<c.getMinTraversals())||(x.ctatdebug("CTATExampleTracerTracer --\x3e we should return false from the second if condition"),d=!1)}});if(!1===
d)return x.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning false"),!1;x.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning true");return!0}function w(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink");var c=null!==b&&"undefined"!==typeof b&&null!==b[0]&&"undefined"!==typeof b[0]?b[0]:null;if(null===c||"undefined"===typeof c)x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink first if condition"),c=x.getBestInterpretation();null!==
b&&"undefined"!==typeof b&&(b[0]=c);x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink interp.getPaths(): "+c.getPaths().size);var d=CTATExampleTracerPath.getBestPath(c.getPaths());x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink path: "+d);var e=B(c,d,a,!1);x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink highestLink: "+e);if(null!==e&&"undefined"!==typeof e)return x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning highestLink"),e;
var f=null;x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getLinks() "+d.getLinks().size);x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getSortedLinks() "+d.getSortedLinks());var g=!1,h=null;d.getSortedLinks().forEach(function(b){!0!==g&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in for loop"+b),f=b,c.getTraversalCount(b)<b.getMaxTraversals()&&(!1===a||0<x.nonEmptyHints(b,c.getVariableTable()))&&A.observesOrderingConstraints(c.getMatchedLinks(),
b,d.getLinks(),null)&&u(c,b,d.getLinks())&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in link: "+b),h=b,g=!0))});if(!0===g)return h;x.ctatdebug("CTATExampleTracerTracer --\x3e out of _getBestNextLink, returning: "+f);return null}function B(a,b,c,d){x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink");var e=new CTATExampleTracerEvent(x,null,CTATMsgType.DEFAULT_STUDENT_ACTOR),f=!0,g=[];b.getSortedLinks().forEach(function(b){x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop link.getUniqueID(): "+
b.getUniqueID());x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop interp.isTraversed(link, countOptionalAsTraversed): "+a.isTraversed(b,d));x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop isNoOp(link): "+y(b));!0===a.isTraversed(b,d)||!0===y(b)?(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in if condition"),f=!0):(!0===f&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in second if condition"),
A.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){c&&1>x.nonEmptyHints(b,a.getVariableTable())||a.getTraversalCount(b)>=b.getMaxTraversals()||(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink pushing outlink: "+b.getUniqueID()),g.push(b))})),f=null===b||"undefined"===typeof b?!1:b.getMinTraversals()<=a.getTraversalCount(b))});g.sort(function(b,c){return(new CTATExampleTracerLinkComparator(a,x)).compare(b,c)});x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink before sorting");
var h=!1,l=null;g.forEach(function(c){!0!==h&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in fro loop"),!0===m(c,a,b,!1,e)?(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting first if"),l=c,h=!0):a.getPaths().forEach(function(d){!0!==h&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in inner loop"),b!==d&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting second if"),
!0===m(c,a,d,!1,e)&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting third if"),l=c,h=!0)))}))});if(!0===h)return x.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink returning: "+l.getUniqueID()),l;x.ctatdebug("CTATExampleTracerTracer --\x3e out of getHighestUntraversedLink");return null}function y(a){return null===a||"undefined"===typeof a?!1:1>a.getMinTraversals()&&1>a.getMaxTraversals()}CTATBase.call(this,"CTATExampleTracerTracer",a);
var z=!1,q=null,F=null,C=null,A=a,E=null;CTATExampleTracerTracer_count++;var I=null,G={},x=this;this.getModelInitialized=function(){return z};this.setModelInitialized=function(a){z=a};this.goToDone=function(a,b,c){return(a=a.getPathToDone(b))?c.traceLinks(a.getSortedLinks()):!1};this.getMatchedSelections=function(){return G};this.getLastResult=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getResult");return E};this.resetTracer=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer entering");
null===q||"undefined"===typeof q?(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer making interpretations array"),q=[]):(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer clearing interpretations array"),q.length=0);var a=new CTATExampleTracerInterpretation(r());x.ctatdebug("CTATExampleTracerTracer tempInterp--\x3e in resetTracer tempInterp "+a);null!==g&&"undefined"!==typeof g&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer startStateVT if condition"),a.setVariableTable(g));
q.push(a);I=a;if(null===F||"undefined"===typeof F)x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer incorrectActionMatches if condition"),F={};else{x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of incorrectActionMatches if condition");for(var b in F)F.hasOwnProperty(b)&&delete F[b]}G={};null===C||"undefined"===typeof C?(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer last if condition"),C=[]):(x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of last if condition"),
C.length=0);x.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer before iterating over all the links in the graphs");A.getLinks().forEach(function(a){a.getMatcher().resetMatcher()});x.ctatdebug("CTATExampleTracerTracer --\x3e out of resetTracer")};this.evaluate=function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in public evaluate(), calling private _evaluate; given event "+a);return e(a,!1,!0)};this.nonEmptyHints=function(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints");
if(null===a||"undefined"===typeof a)return 0;var c=a.interpolateHints(b);x.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints: link.interpolateHints() "+a.interpolateHints().length);if(null===c||"undefined"===typeof c||1>c.length)return 0;for(var d=0,e=0;e<c.length;++e)0<String(c[e]).trim().length&&d++;x.ctatdebug("CTATExampleTracerTracer --\x3e returning from nonEmptyHints "+d);return d};this.traceForHint=function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint");var b=e(a,
!0,!1);x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint return from evaluate "+b);x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint result from evaluate "+a.getResult().toString());x.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint link   from evaluate "+a.getReportableLink());if(a.getResult().toString()===CTATExampleTracerLink.CORRECT_ACTION.toString())return b=a.getReportableLink(),a.setTutorSAI(new CTATSAI(a.getStudentSAI().getSelection(),b.getDefaultSAI().getAction(),
b.getDefaultSAI().getInput())),a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR),x.ctatdebug("CTATExampleTracerTracer --\x3e traceForHint returning hintLink "+b+", result "+a),b;x.ctatdebug("CTATExampleTracerTracer --\x3e out of traceForHint, returning null");return null};this.matchForHint=function(a){x.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint");var b;if((b=(b=a.getStudentSAI())?b.getSelectionArray():null)&&0<b.length&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint first if"),
(b=x.traceForHint(a))&&0<a.getReportableHints().length))return x.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint via traceForHint returning "+b+", result "+a),b;b=x.getBestNextLink(!0,a);x.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint() traceForHint via getBestNextLink returning "+b);return b};this.getBestNextLink=function(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink");var c=[],d=w(a,c);if(null===d||"undefined"===typeof d)return x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink returning null"),
null;if(d.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return null no correct suboptimal step"),null;x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink else branch");x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink got interp "+(null==c?"null":c[0]));if(b){var e=d.interpolateHints(c[0].getVariableTable());b.setInterpolatedHints(e);x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink setInterpolatedHints");
Array.isArray(e)&&0<e.length?b.setReportableHints(e):b.setReportableHints(d.getHints());x.ctatdebug("In evaluate --\x3e after setReportableHints");c&&c[0]&&c[0].setLatestHints(e,d.getHints());b.setReportableLink(d);b.setAssociatedSkills(d.getSkillNames());b.setReportableInterpretation(c[0]);b.setResult(d.getType());b.setTraceOutcome(d.getType());b.setStepID(d.getUniqueID());b.setTutorSAI(d.getDefaultSAI())}x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return etLink");return d};this.doHint=
function(a,b){x.ctatdebug("CTATExampleTracerTracer --\x3e in doHint");var c=x.matchForHint(a);Array.isArray(b)&&(x.ctatdebug("CTATExampleTracerTracer --\x3e in doHint last if condition"),b.push(a));x.ctatdebug("CTATExampleTracerTracer --\x3e returning from doHint: "+c);return c};this.getBestInterpretation=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation");if(null===I||"undefined"===typeof I)x.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation in if condition"),
I=p(x.getInterpretationsInternal());x.ctatdebug("CTATExampleTracerTracer --\x3e out of getBestInterpretation "+(null===I||void 0===I));return I};this.getInterpretationsInternal=function(){x.ctatdebug("CTATExampleTracerTracer --\x3e in getInterpretationsInternal");return q};this.toString=function(){var a="TracerState\n";null===q?a+="(no interpretations)\n":q.forEach(function(b){a+=b.toString()+"\n"});return a};this.addInterfaceVariablesFromEvent=function(a){if(a){var b=a.getTutorSelection();a=a.getTutorInput();
x.addInterfaceVariables(b,a)}};this.addInterfaceVariables=function(a,b){x.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables("+a+", "+b+")");if(a&&b){var c=a.length;c>b.length&&(c=b.length);for(var d=0;d<c;d++)a[d]&&(g.put(a[d],CTATVariableTable.standardizeType(b[d])),g.put(CTATVariableTable.nameAsString(a[d]),CTATVariableTable.valueAsString(b[d])));x.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() startStateVT "+g);q&&q.forEach(function(d){if(d=d.getVariableTable()){for(var e=0;e<
c;e++)a[e]&&(d.put(a[e],CTATVariableTable.standardizeType(b[e])),d.put(CTATVariableTable.nameAsString(a[e]),CTATVariableTable.valueAsString(b[e])));x.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() interp.vt "+d)}})}};this.findCurrentState=function(){x.ctatdebug("Entering findCurrentState");var a=x.getBestInterpretation();return a&&a.getLastMatchedLink()&&a.getLastMatchedLink().isDone()?a.getLastMatchedLink().getNextNode():(a=w(!1,[a]))?a.getPrevNode():A?A.getStartNode():null};this.saveLastReport=
function(a){q&&a&&q.forEach(function(b){b.setLatestHints(a.getReportableHints()||[]);var c=a.getSuccessOrBuggyMsg()||"";a.getResult()==CTATExampleTracerLink.CORRECT_ACTION?(b.setLatestSuccessMessage(c),b.setLatestBuggyMessage("")):(b.setLatestSuccessMessage(""),b.setLatestBuggyMessage(c))})}};CTATExampleTracerTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracerTracer.prototype.constructor=CTATExampleTracerTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracerTracer);var CTATExampleTracerGraph=function(a,g,f){function c(a,c,d){D.ctatdebug("CTATExampleTracerGraph --\x3e in isOrderOK");if(D.relaxOrderConstraints()||c.isDone()&&D.exitOnIncorrectDone())return!0;for(var f=b(c),g=0;g<f.length;g++){var l=f[g];if(!0===J.isGroupOrdered(l))if(g!==f.length-1){if(!1===e(l,h(f[g+1],d),a,d))return!1}else if(!1===e(l,c,a,d))return!1}D.ctatdebug("CTATExampleTracerGraph --\x3e out of isOrderOK");return!0}function d(a,c,d){D.ctatdebug("CTATExampleTracerGraph --\x3e in isReenteringOK");
if(D.relaxOrderConstraints()||c.isDone()&&D.exitOnIncorrectDone())return!0;c=b(c);for(var e=!0,f=0;f<c.length;f++)if(!0===e&&!1===J.isGroupReenterable(c[f]))for(var e=!1,g=0;g<a.length;g++)if(!0===J.isLinkInGroup(c[f],a[g]))e=!0;else{if(!0===e)return!1}else if(!1===e)break;if(0!==a.length){var h=b(a[a.length-1]);D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups null? "+(null===h));D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups undefined? "+("undefined"===
typeof h));D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups last traversedLink "+a[a.length-1].getUniqueID());D.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups length "+(h?h.length:null));c.forEach(function(a){a=h.indexOf(a);0<=a&&h.splice(a,1)});D.ctatdebug("CTATETGraph.isReentrableOK: exitedGroups.length after removing newLink's groups: "+h.length);for(k=h.length-1;0<=k;k--)J.isGroupReenterable(h[k])&&h.splice(k,1);D.ctatdebug("CTATETGraph --\x3e in isReentrableOK: exitedGroups after removing reenterables: "+
h.length);D.ctatdebug("CTATETGraph --\x3e in isReentrableOK: traversedLinks: "+a+", path: "+d);var m=!0;h.forEach(function(b){!1!==m&&d.forEach(function(c){!1!==m&&l(a,c)<c.getMinTraversals()&&!0===J.isLinkInGroup(b,c)&&(m=!1)})});if(!1===m)return!1}D.ctatdebug("CTATExampleTracerGraph --\x3e out of isReenteringOK");return!0}function b(a){D.ctatdebug("in findGroupsOfLink(link "+a+"): typeof(groupModel) "+typeof J);a=J.getGroupsContainingLink(a);D.ctatdebug("in findGroupsOfLink groupsSet.size "+a.size);
var b=[];a.forEach(function(a){D.ctatdebug("in findGroupsOfLink group element "+a.getName());b.push(a)});b.sort(function(a,b){return J.getGroupLinkCount(b)-J.getGroupLinkCount(a)});return b}function e(a,b,c,d){var e=-1,f=null,g=Number.MAX_VALUE,m=null;J.getGroupSubgroups(a).forEach(function(a){if(!1===J.isLinkInGroup(a,b)&&0!==J.getGroupLinkCount(a)){var l=h(a,d);null!==l&&"undefined"!==typeof l&&(l=l.getDepth(),l<b.getDepth()&&l>e&&(!1===n(a)||!0===p(a,c))&&(e=l,f=a),l>b.getDepth()&&l<g&&(!1===n(a)||
!0===p(a,c))&&(g=l,m=a))}});J.getUniqueLinks(a).forEach(function(a){if(!0===d.has(a)){var h=a.getDepth();h<b.getDepth()&&h>e&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(e=h,f=a);h>b.getDepth()&&h<g&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(g=h,m=a)}});if(null!==f&&"undefined"!==typeof f)if(f instanceof CTATExampleTracerLink){if(l(c,f)<f.getMinTraversals())return!1}else if(f instanceof CTATLinkGroup&&!1===v(f,c,d))return!1;return null!==m&&"undefined"!==typeof m&&(m instanceof CTATExampleTracerLink&&
-1<c.indexOf(m)||m instanceof CTATLinkGroup&&!0===p(m,c))?!1:!0}function h(a,b){var c=Number.MAX_VALUE,d=null;J.getGroupLinks(a).forEach(function(a){a.getDepth()<c&&!0===b.has(a)&&(c=a.getDepth(),d=a)});return d}function l(a,b){for(var c=0,d=0;d<a.length;d++)b===a[d]&&c++;D.ctatdebug("CTATETGraph.getTraversalCount("+b+"): "+c);return c}function m(a,b,c){var d=!1,e=!0,f=!1;(new CTATExampleTracerPath(b)).getSortedLinks().forEach(function(b){if(!1!==e&&!0!==f){if(!1===d)!0===J.isLinkInGroup(a,b)&&(d=
!0);else if(!1===J.isLinkInGroup(a,b)){f=!0;return}c.getTraversalCount(b)<b.getMaxTraversals()&&(e=!1)}});return!1===e?!1:!0}function n(a){var b=!0;J.getGroupLinks(a).forEach(function(a){!1!==b&&0!==a.getMinTraversals()&&(b=!1)});return!1===b?!1:!0}function p(a,b){for(var c=0;c<b.length;c++)if(!0===J.isLinkInGroup(a,b[c]))return!0;return!1}function v(a,b,c){var d=!0;J.getGroupLinks(a).forEach(function(a){!1!==d&&!0===c.has(a)&&l(b,a)<a.getMinTraversals()&&(d=!1)});return!1===d?!1:!0}function r(){for(var a=
0;a<z.length;a++)z[a].clearInLinks();var b=D.getStartNode();null!==b&&"undefined"!==typeof b&&null!==b.getOutLinks()&&"undefined"!==typeof b.getOutLinks()&&(a=0,b.getOutLinks().forEach(function(b){u(b,a++)}))}function u(a,b){ctatdebug("updateInLinkSubGraph("+a+", "+b+")");var c=D.getNode(a.getNextNode());if(null!==c&&"undefined"!==typeof c){c.addInLink(a);var d=0;c.getOutLinks().forEach(function(a){u(a,d++)})}}function w(a){var b=D.getNode(a.getPrevNode());if(null!==b&&"undefined"!==typeof b){var c=
-1;b.getInLinks().forEach(function(a){-1===a.getDepth()&&w(a);a.getDepth()>c&&(c=a.getDepth())});a.setDepth(c+1)}}function B(a){var b=D.getGroupModel(),c=b.getTopLevelGroup(),d="",e=c.getSubgroups(),d=a+'<EdgesGroups ordered="'+c.getIsOrdered()+'">\n';e.forEach(function(c){d+=c.toXML(a+"    ",b)});return d+=a+"</EdgesGroups>\n"}CTATBase.call(this,"CTATExampleTracerGraph","visualdata");var y=null,z=null,q=null,F=null,C=null,A=null,E="",I=[],G=new Set,x=new Set,H=null,J=null,S=!0,O=!0,L=CTATMsgType.SHOW_ALL_FEEDBACK,
D=this;this.getAllNodes=function(){var a=[],b;for(b in F)a.push(F[b]);return a};this.getFeedbackPolicy=function(){return L};this.setFeedbackPolicy=function(a){D.ctatdebug("Graph.setFeedbackPolicy("+a+") old policy "+L);L="false"===a?CTATMsgType.SHOW_ALL_FEEDBACK:"true"===a?CTATMsgType.HIDE_ALL_FEEDBACK:a};this.hideButRequireSteps=function(){return L==CTATMsgType.HIDE_BUT_COMPLETE};this.hideAllFeedback=function(){return L==CTATMsgType.HIDE_ALL_FEEDBACK};this.relaxOrderConstraints=function(){return D.hideAllFeedback()||
D.hideButRequireSteps()||L==CTATMsgType.DELAY_FEEDBACK};this.exitOnIncorrectDone=function(){switch(L){case CTATMsgType.HIDE_ALL_FEEDBACK:case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}};this.getDefaultBuggyMsg=function(){return J.getTopLevelGroup()?J.getTopLevelGroup().getDefaultBuggyMsg():null};this.getLinks=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getLinks");return q};this.addLink=function(a,b){D.ctatdebug("CTATExampleTracerGraph --\x3e in addLink");q.push(a);a.isDone()?
x.add(a):x["delete"](a);null===b||"undefined"===typeof b?J.addLinkToGroup(J.getTopLevelGroup(),a):J.addLinkToGroup(b,a);D.ctatdebug("CTATExampleTracerGraph --\x3e out of addLink")};this.addNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in addNode");z.push(a);F[a.getNodeID()]=a;D.ctatdebug("CTATExampleTracerGraph --\x3e out of addNode")};this.findAllPaths=function(){ctatdebug("CTATExampleTracerGraph --\x3e in findAllPaths "+D.getStartNode().getNodeID());return D.findPathsFromNode(D.getStartNode())};
this.pathToLinkIsSubset=function(a,b){var c=D.getNode(a.getPrevNode());D.ctatdebug("pathToLinkIsSubset("+a+") sourceNode "+c.getNodeID());if(0<a.getMinTraversals()&&"undefined"==typeof b[a.getUniqueID()])return!1;if(c==D.getStartNode())return!0;for(c=c.getInLinks().values();!(c=c.next()).done;)return D.pathToLinkIsSubset(c.value,b);return!1};this.observesOrderingConstraints=function(a,b,e,f){D.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints");null!==f&&"undefined"!==typeof f&&
(D.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints initializing out of order false"),f.setOutOfOrder(!1));if(null===e||"undefined"===typeof e||0===e.size||null===b||"undefined"===typeof b)return D.ctatdebug("CTATExampleTracerGraph --\x3e returning first true observesOrderingConstraints"),!0;if(b.isDone()&&D.exitOnIncorrectDone())return D.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning true for doneStep && exitOnIncorrectDone"),!0;if(!0===e.has(b)&&
!0===c(a,b,e)&&!0===d(a,b,e))return D.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning isOrderOK true && isisReenteringOK() true"),!0;null!==f&&"undefined"!==typeof f&&(D.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints setting out of order true"),f.setOutOfOrder(!0));D.ctatdebug("CTATExampleTracerGraph --\x3e returning false observesOrderingConstraints");return!1};this.isIncorrectLinkOK=function(a,b,d,e){D.ctatdebug("CTATExampleTracerGraph --\x3e in isIncorrectLinkOK");
var f=!1,g=null,h=!0,l=!1;D.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){!0!==l&&!1!==h&&b.getType().toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&!0===d.has(b)&&(f=!0,!1===c(a,b,d)?h=!1:(g=b,l=!0))});if(!1===h||null===g||"undefined"===typeof g)return!1;if(!1===f)return D.ctatdebug("isIncorrectLinkOK(): no siblings of link in path"),!1;if(!0===f&&(b=D.getSmallestContainingGroup(b),!0===J.isLinkInGroup(b,g)&&!1===J.isGroupOrdered(b)&&!0===m(b,d,e)))return!1;D.ctatdebug("CTATExampleTracerGraph --\x3e out of isIncorrectLinkOK");
return!0};this.toXML=function(a){var b=this.getLinks(),c=D.getGroupModel().getTopLevelGroup().getIsOrdered(),d;d='<?xml version="1.0" standalone="yes"?>\n<stateGraph firstCheckAllStates="true" caseInsensitive="'+D.getCaseInsensitive();d=d+('" unordered="'+!c)+('" lockWidget="'+D.getLockWidget());d+='" hintPolicy="'+D.getHintPolicy();d=d+'" version="4.0'+('" suppressStudentFeedback="'+D.isFeedbackSuppressed());d+='" highlightRightSelection="'+D.isHighlightRightSelection();d+='" confirmDone="'+a.getConfirmDone();
d+='" startStateNodeName="'+D.getStudentStartStateNodeName();d+='" tutorType="Example-tracing Tutor">\n';for(var c=this.getStartStateMsgs(),e="    <startNodeMessages>\n",f=0;f<c.length;f++)e+="        "+c[f].outerHTML+"\n";d+=e+"    </startNodeMessages>\n";for(c=0;c<z.length;c++)d+=z[c].toXML("    ")+"\n";for(c=0;c<b.length;c++)d+=b[c].toXML("    ")+"\n";b=d;a=a.getGraphSkills();d="";for(c=0;c<a.length;c++)d+="    <productionRule>\n",d+="        <ruleName>"+CTATExampleTracerSkill.getName(a[c].getSkillName())+
"</ruleName>\n",d+="        <productionSet>"+a[c].getCategory()+"</productionSet>\n",d+="        <label>"+a[c].getLabel()+"</label>\n",d+="        <description>"+a[c].getDescription()+"</description>\n",d+="    </productionRule>\n";d=b+d+B("    ");return d+="</stateGraph>\n"};this.addGroup=function(a,b,c){};this.getCaseInsensitive=function(){return O};this.setCaseInsensitive=function(a){O=a};this.getLockWidget=function(){return S};this.setLockWidget=function(a){S=a};this.getHintPolicy=function(){return hintPolicy};
this.setHintPolicy=function(a){hintPolicy=CTATHintPolicyEnum.lookup(a)};this.isFeedbackSuppressed=function(){return feedbackSuppressed};this.setFeedbackSuppressed=function(a){feedbackSuppressed="false"===a?!1:"true"===a?!0:a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;D.ctatdebug("setFeedbackSuppressed("+a+"): "+feedbackSuppressed);problemSummary&&problemSummary.setCountOnlyLastResults(feedbackSuppressed)};
this.isHighlightRightSelection=function(){return highlightRightSelection};this.setHighlightRightSelection=function(a){highlightRightSelection=a};this.getStartStateMsgs=function(){return I};this.setStartStateMsgs=function(a){I=a};this.getNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in getNode("+a+") returning "+F[a]);return F[a]};this.findNode=function(a){if(a){a=a.toLowerCase();for(var b in F)if(F[b].getNodeName().toLowerCase()==a)return D.getNode(b);if("start"==a)return D.getStudentStartsHereNode()||
D.getStartNode()}return null};this.findPathsFromNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in findPathsFromNode outlinks "+a.getOutLinks().size);var b=new Set;if(!a||0===a.getOutLinks().size)return b.add(new CTATExampleTracerPath(null)),b;D.ctatdebug("CTATExampleTracerGraph --\x3e before forEach ");a.getOutLinks().forEach(function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in forEach "+a.getType().toString());if(a.getType().toString()!=CTATExampleTracerLink.BUGGY_ACTION.toString()){var c=
D.findPathsFromNode(D.getNode(a.getNextNode()));D.ctatdebug("findPathsFromNode childPaths.size "+c.size);c.forEach(function(c){D.ctatdebug("findPathsFromNode childPath.size "+c.size+", outLink "+a);c.addLink(a);b.add(c)})}},a);0===b.size&&b.add(new CTATExampleTracerPath(null));D.ctatdebug("CTATExampleTracerGraph --\x3e out of findPathsFromNode "+b.size);return b};this.getDoneStates=function(){return G};this.checkForDoneState=function(a){if(a.isDone()&&a.isTraversable()){var b=D.getNode(a.getNextNode());
D.ctatdebug("CTATExampleTracerGraph.addDoneState(linkID "+a.getUniqueID()+") adding destNode "+b);G.add(b)}};this.getBestSubpath=function(a,b,c){if(!a||!b)return null;var d=D.findPathsFromNode(a),e=new Set;d.forEach(function(a){a=a.subpath(b);!a||c&&!a.containsAll(c)||e.add(a)});D.ctatdebug("CTATExampleTracerGraph.getBestSubpath("+a+", "+b+", ["+(c?c.length:-1)+"]) pathsFrom "+d.size+", pathsFromTo "+e.size);return 1>e.size?null:CTATExampleTracerPath.getBestPath(e)};this.getStartNode=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getStartNode() returning "+
C);return C};this.getLinkByID=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in getLinkByID");for(var b=0;b<q.length;b++)if(q[b].getUniqueID()===a)return q[b];D.ctatdebug("CTATExampleTracerGraph --\x3e out of getLinkByID");return null};this.setStartNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in setStartNode("+a+")");C=a};this.getStudentStartsHereNode=function(){return null!=A?A:getStartNode()};this.setStudentStartsHereNode=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in setStudentStartsHereNode("+
a+")");A=a};this.setStudentStartStateNodeName=function(a){E=a};this.getStudentStartStateNodeName=function(){return E};this.getExampleTracer=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getExampleTracer() returning "+y);return y};this.forDebugging=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in forDebugging");D.ctatdebug("Nodes in the graph -- ids");z.forEach(function(a){D.ctatdebug(a.getNodeID())});D.ctatdebug("Links in the graph -- ids, from, to");q.forEach(function(a){D.ctatdebug(a)})};
this.getSmallestContainingGroup=function(a){return J.getLowestLevelGroupOfLink(a)};this.redoLinkDepths=function(){r();D.getLinks().forEach(function(a){a.setDepth(-1)});D.getLinks().forEach(function(a){-1===a.getDepth()&&w(a)})};this.getGroupModel=function(){return J};this.setVisualData=function(a){D.ctatdebug("CTATExampleTracerGraph --\x3e in setVisualData");H=a};this.getVisualData=function(){D.ctatdebug("CTATExampleTracerGraph --\x3e in getVisualData() returning "+H);return H};this.getDoneLinks=
function(){return x};(function(a,b){D.ctatdebug("CTATExampleTracerGraph --\x3e in initGraph ("+a+" , "+b);q=[];z=[];F={};if(null===J||"undefined"===typeof J)J=new CTATDefaultGroupModel,D.ctatdebug("CTATExampleTracerGraph --\x3e created a group model from here");J.clear();J.setDefaultReenterable(!b);J.setGroupOrdered(J.getTopLevelGroup(),a);J.setGroupName(J.getTopLevelGroup(),CTATExampleTracerGraph.TOP_LEVEL);y=new CTATExampleTracerTracer(D,f);D.ctatdebug("CTATExampleTracerGraph --\x3e out of initGraph")})(!a,
g)};Object.defineProperty(CTATExampleTracerGraph,"TOP_LEVEL",{enumerable:!1,configurable:!1,writable:!1,value:"Top Level"});Object.defineProperty(CTATExampleTracerGraph,"STUDENT_BEGINS_HERE_VAR",{enumerable:!1,configurable:!1,writable:!1,value:"%(startStateNodeName)%"});Object.defineProperty(CTATExampleTracerGraph,"IS_ORDERED",{enumerable:!1,configurable:!1,writable:!1,value:"ordered"});CTATExampleTracerGraph.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerGraph.prototype.constructor=CTATExampleTracerGraph;"undefined"!==typeof module&&(module.exports=CTATExampleTracerGraph);var CTATGraphParser=function(){function a(a){ctatdebug("processEdge()");for(var d=new CTATExampleTracerLink(null,null,null),f=e.getElementChildren(a),h,l,m,p,r,v=a=-1,A=CTATMsgType.DEFAULT_ACTOR,E=!1,I=0;I<f.length;I++){"sourceID"===e.getElementName(f[I])&&(a=parseInt(e.getNodeTextValue(f[I])),d.setPrevNode(a));"destID"===e.getElementName(f[I])&&(v=parseInt(e.getNodeTextValue(f[I])),d.setNextNode(v));if("rule"===e.getElementName(f[I]))for(var G=e.getElementChildren(f[I]),x=0;x<G.length;x++)"text"===
e.getElementName(G[x])&&d.addSkillName(e.getNodeTextValue(G[x]).toString());if("actionLabel"===e.getElementName(f[I]))for(d.setIsPreferredLink("false"!=e.getElementAttr(f[I],"preferPathMark")),d.setMinTraversalsStr(e.getElementAttr(f[I],"minTraversals")),d.setMaxTraversalsStr(e.getElementAttr(f[I],"maxTraversals")),G=e.getElementChildren(f[I]),x=0;x<G.length;x++){"uniqueID"===e.getElementName(G[x])&&(r=e.getNodeTextValue(G[x]),d.setUniqueID(parseInt(e.getNodeTextValue(G[x]))));"message"===e.getElementName(G[x])&&
(p=new CTATMessage(G[x]),d.setDemoMsgObj(p));"actionType"===e.getElementName(G[x])&&d.setActionType(e.getNodeTextValue(G[x]));"buggyMessage"===e.getElementName(G[x])&&d.setBuggyMsg(e.getNodeTextValue(G[x]));"successMessage"===e.getElementName(G[x])&&d.setSuccessMsg(e.getNodeTextValue(G[x]));"hintMessage"===e.getElementName(G[x])&&d.addHint(e.getNodeTextValue(G[x]));if("matchers"===e.getElementName(G[x]))for(var H=e.getElementChildren(G[x]),J=0;J<H.length;J++)"Selection"===e.getElementName(H[J])&&
(h=g(H[J],0)),"Action"===e.getElementName(H[J])&&(l=g(H[J],1)),"Input"===e.getElementName(H[J])&&(m=g(H[J],2)),"Actor"===e.getElementName(H[J])&&(A=e.getNodeTextValue(H[J]),E=(E=e.getElementAttr(H[J],"linkTriggered"))&&"false"!=E.toLowerCase().trim()?!0:!1);if("matcher"===e.getElementName(G[x])){m=G[x];l=p;h=e.getElementAttr(m,"replacementFormula");var S=e.getElementChildren(m),O=H=void 0,L,D=void 0,J=CTATMsgType.DEFAULT_ACTOR;m=new CTATExactMatcher(CTATMatcher.SELECTION,null);A=new CTATExactMatcher(CTATMatcher.ACTION,
null);c.ctatdebug("processMatcher(): nChildren "+S.length+", saiMessage "+l);for(var P=0;P<S.length;P++)"matcherType"===e.getElementName(S[P])&&(L=e.getNodeTextValue(S[P]),"ExactMatcher"===L&&(O=CTATExactMatcher),"RegexMatcher"===L&&(O=CTATRegexMatcher),"AnyMatcher"===L&&(O=CTATAnyMatcher),"RangeMatcher"===L&&(O=CTATRangeMatcher),"WildcardMatcher"===L&&(O=CTATWildcardMatcher),"ExpressionMatcher"===L&&(O=CTATExpressionMatcher),c.ctatdebug("processMatcher(): child "+P+", eltText "+L+", matcher "+O)),
"matcherParameter"===e.getElementName(S[P])&&(L=e.getElementAttr(S[P],"name"),D=e.getNodeTextValue(S[P]),"selection"==L&&m.setParameter(D),"action"==L&&A.setParameter(D),"input"==L&&(H=H?H:new O(CTATMatcher.INPUT,null),H.setParameter(D)),"actor"==L&&(J=D),"minimum"==L&&(H=H?H:new O(CTATMatcher.INPUT,null),H.setParameter(D,"minimum")),"maximum"==L&&(H=H?H:new O(CTATMatcher.INPUT,null),H.setParameter(D,"maximum")),"InputExpression"==L&&(H=H?H:new O(CTATMatcher.INPUT,null),H.setParameter(S[P],L,e)),
"relation"==L&&(H=H?H:new O(CTATMatcher.INPUT,null),H.setParameter(S[P],L,e)),c.ctatdebug("processMatcher(): child "+P+", eltAttrName "+L+", inputMatcher "+H));H||(H=O?new O(CTATMatcher.INPUT,null):new CTATExactMatcher(CTATMatcher.INPUT,null),H.setParameter(D?D:""),"undefined"!=typeof l&&"function"==typeof l.getSAI&&(l=l.getSAI(),m.setSingle(l.getSelection()),A.setSingle(l.getAction()),H.setSingle(l.getInput())));H.setReplacementFormula(h);A=[[m],[A],[H],J];h=A[0];l=A[1];m=A[2];A=A[3]}}}b.getStartNode()&&
v==b.getStartNode().getNodeID()&&console.log("***WARNING*** edge "+r+" destination is graph startNode "+b.getStartNode());r=new CTATVectorMatcher(h,l,m,A);r.setDefaultSAI(p.getSAI());r.setCaseInsensitive(n);r.setLinkTriggered(E);d.setMatcher(r);ctatdebug("GraphParser.processEdge() "+a+"->"+v+", edge "+d);b.getNode(a).addOutLink(d);b.checkForDoneState(d);return d}function g(a,b){c.ctatdebug("processMatchers()");for(var d=e.getElementChildren(a),f=[],g=0;g<d.length;g++)if("matcher"===e.getElementName(d[g])){for(var h=
null,l=e.getElementAttr(d[g],"replacementFormula"),m=e.getElementChildren(d[g]),n=0;n<m.length;n++){if("matcherType"===e.getElementName(m[n]))switch(h=e.getNodeTextValue(m[n]),c.ctatdebug("CTATGraphParser.processMatchers() matcherType["+n+"] = "+h),h){case "ExactMatcher":h=new CTATExactMatcher(b,null);break;case "RegexMatcher":h=new CTATRegexMatcher(b,null);break;case "AnyMatcher":h=new CTATAnyMatcher(b,null);break;case "RangeMatcher":h=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":h=
new CTATWildcardMatcher(b,null);break;case "ExpressionMatcher":h=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+n+"] = "+h+"; using CTATExactMatcher"),h=new CTATExactMatcher(b,null)}if("matcherParameter"===e.getElementName(m[n])){var p=e.getElementAttr(m[n],"name");"single"===p?h.setParameter(e.getNodeTextValue(m[n])):"minimum"===p?h.setParameter(e.getNodeTextValue(m[n]),"minimum"):"maximum"===p?h.setParameter(e.getNodeTextValue(m[n]),
"maximum"):h.setParameter(m[n],p,e)}}h&&h.setReplacementFormula(l);f.push(h)}return f}function f(a,b){var c=new Set;if("group"!==e.getElementName(a))return c;var d=e.getElementAttr(a,"name");ctatdebug("readGroupFromXML group name: "+d);var g="true"===e.getElementAttr(a,"ordered"),h="true"===e.getElementAttr(a,"reenterable");ctatdebug("readGroupFromXML group isOrdered typeof: "+typeof g);ctatdebug("readGroupFromXML group isOrdered: "+g);for(var l=function(a){c.add(a)},n=e.getElementChildren(a),p=0;p<
n.length;p++){if("link"===e.getElementName(n[p])){var r=Number(e.getElementAttr(n[p],"id")),v=b[r];if(null!==v||void 0!==v)ctatdebug("Added link ID : "+r),c.add(v)}"group"===e.getElementName(n[p])&&(ctatdebug("encountered a subgroup"),f(n[p],b).forEach(l))}m.addGroup(d,g,c);m.setGroupReenterable(m.getGroupByName(d),h);return c}CTATBase.call(this,"CTATGraphParser","__undefined__");var c=this,d,b,e=new CTATXML,h=null,l=[];new XMLSerializer;var m,n=!0,p=!0,v=[];this.getLockWidget=function(){return p};
this.setLockWidget=function(a){p=a};this.parseGraph=function(c,g){ctatdebug("parseBRD()");var r=0,u="true"===e.getElementAttr(c,"unordered");n="false"!=String(e.getElementAttr(c,"caseInsensitive")).toLowerCase();p=e.getElementAttr(c,"lockWidget");hintPolicy=e.getElementAttr(c,"hintPolicy");feedbackSuppressed=e.getElementAttr(c,"suppressStudentFeedback");var y=new CTATVariableTable;b=new CTATExampleTracerGraph(u,!1,y);b.setCaseInsensitive(n);b.setStudentStartStateNodeName(e.getElementAttr(c,"startStateNodeName"));
var z=e.getElementChildren(c),y=e.getElementAttr(c,"suppressStudentFeedback");if(null===y||void 0===y)y=CTATMsgType.SHOW_ALL_FEEDBACK;b.setFeedbackPolicy(y);g.setFeedbackSuppressed(y);y=e.getElementAttr(c,"highlightRightSelection");g.setHighlightRightSelection("false"!=y);var q=e.getElementAttr(c,"confirmDone");g.setConfirmDone("true"===q?!0:"false"===q?!1:b.getFeedbackPolicy()===CTATMsgType.HIDE_ALL_FEEDBACK);g.setHintPolicy(e.getElementAttr(c,"hintPolicy"));g.setOutOfOrderMessage(e.getElementAttr(c,
"outOfOrderMessage"));for(var q=null,F=0;F<z.length;F++)switch(e.getElementName(z[F])){case "startNodeMessages":l=e.getElementChildren(z[F]);b.setStartStateMsgs(l);break;case "node":r++;var C;C=z[F];ctatdebug("processNode("+C+")");var A=e.getElementChildren(C),E=-1;C="";for(var I=[],G=0;G<A.length;G++)switch(e.getElementName(A[G])){case "uniqueID":E=parseInt(e.getNodeTextValue(A[G]));break;case "text":C=e.getNodeTextValue(A[G]);break;case "dimension":for(var x=e.getElementChildren(A[G]),H=0;H<x.length;H++)ctatdebug("grandkids "+
H+", "+x[H]+", "+e.getNodeTextValue(x[H])+", "+parseInt(e.getNodeTextValue(x[H]))),I[H]=parseInt(e.getNodeTextValue(x[H]));ctatdebug("grandkids d "+I)}A=new CTATExampleTracerNode(E,new Set);""!==C&&A.setNodeName(C);2<=I.length&&A.setDimension({x:I[0],y:I[1]});C=A;b.addNode(C);1==r&&(b.setStartNode(C),b.setStudentStartsHereNode(C));C.getNodeName()==b.getStudentStartStateNodeName()&&b.setStudentStartsHereNode(C);break;case "edge":b.addLink(a(z[F]));break;case "EdgesGroups":q=z[F];break;case "productionRule":G=
z[F];ctatdebug("processSkill()");I=C="";E=A=null;G=e.getElementChildren(G);for(x=0;x<G.length;x++)H=e.getElementName(G[x]),"ruleName"==H&&(C=e.getNodeTextValue(G[x]),ctatdebug("ruleName="+C)),"productionSet"==H&&(I=e.getNodeTextValue(G[x]),ctatdebug("productionSet="+I)),"label"==H&&(A=e.getNodeTextValue(G[x]),ctatdebug("label="+A)),"description"==H&&(E=e.getNodeTextValue(G[x]),ctatdebug("description="+E));C&&(G=new CTATExampleTracerSkill(I,C,CTATExampleTracerSkill.DEFAULT_P_GUESS,CTATExampleTracerSkill.DEFAULT_P_KNOWN,
CTATExampleTracerSkill.DEFAULT_P_SLIP,CTATExampleTracerSkill.DEFAULT_P_LEARN,CTATExampleTracerSkill.DEFAULT_HISTORY),null!=A?G.setLabel(A):G.setLabel(C),null!=E?G.setDescription(E):G.setDescription(C+(I?" "+I:"")),v.push(G))}if(q){r=e.getElementAttr(q,"ordered");if(null===r||"undefined"==typeof isordered)r=!u;ctatdebug("parseGraph() value of isOrdered = "+r);ctatdebug("parseGraph() value of isUnordered = "+u);ctatdebug("parseGraph() typeof isOrdered: "+typeof r);ctatdebug("parseGraph()typeof isUnordered: "+
typeof u);z=q;q=r;ctatdebug("processGroup()");m=b.getGroupModel();r=m.createIdToLinkMap();m.setGroupOrdered(m.getTopLevelGroup(),q);ctatdebug("processGroup() name of group: "+m.getGroupName(m.getTopLevelGroup()));ctatdebug("processGroup() group isOrdered?: "+m.isGroupOrdered(m.getTopLevelGroup()));ctatdebug("processGroup() order of group: isOrdered= "+q);ctatdebug("processGroup() order of group: isOrdered typeof= "+typeof q);z=e.getElementChildren(z);for(q=0;q<z.length;q++)switch(e.getElementName(z[q])){case "group":f(z[q],
r);break;case "outOfOrderMessage":m.getTopLevelGroup().setDefaultBuggyMsg(e.getNodeTextValue(z[q]))}b.addGroup(void 0)}r=g.getSkillBarVector(!1,!0);if(!r||1>r.length)ctatdebug("No existing skills. Add skills from BRD."),g.addGraphSkills(v),r=g.getSkillBarVector();h=(new CTATTutorMessageBuilder).createStateGraphMessage(n,u,p,g.isSourceFlash()?b.exitOnIncorrectDone():g.isFeedbackSuppressed(),y,String(g.getConfirmDone()),r);b.redoLinkDepths();d=b.getExampleTracer();d.resetTracer();b.forDebugging();ctatdebug("Graph loaded.");
return{gr:b,tracer:d,ssm:l,sgMsg:h}}};CTATGraphParser.prototype=Object.create(CTATBase.prototype);CTATGraphParser.prototype.constructor=CTATGraphParser;"undefined"!==typeof module&&(module.exports=CTATGraphParser);var CTATProblemStateStatus=function(){var a="empty";this.getStatus=function(){return a};this.setStatus=function(g){a=g}};Object.defineProperty(CTATProblemStateStatus,"empty",{enumerable:!1,configurable:!1,writable:!1,value:"empty"});Object.defineProperty(CTATProblemStateStatus,"incompleteStartState",{enumerable:!1,configurable:!1,writable:!1,value:"incompleteStartState"});Object.defineProperty(CTATProblemStateStatus,"startState",{enumerable:!1,configurable:!1,writable:!1,value:"startState"});
Object.defineProperty(CTATProblemStateStatus,"incomplete",{enumerable:!1,configurable:!1,writable:!1,value:"incomplete"});Object.defineProperty(CTATProblemStateStatus,"goingToState",{enumerable:!1,configurable:!1,writable:!1,value:"goingToState"});Object.defineProperty(CTATProblemStateStatus,"normalFeedback",{enumerable:!1,configurable:!1,writable:!1,value:"normalFeedback"});Object.defineProperty(CTATProblemStateStatus,"complete",{enumerable:!1,configurable:!1,writable:!1,value:"complete"});
Object.defineProperty(CTATProblemStateStatus,"completedEarlier",{enumerable:!1,configurable:!1,writable:!1,value:"completedEarlier"});CTATProblemStateStatus.prototype=Object.create(CTATBase.prototype);CTATProblemStateStatus.prototype.constructor=CTATProblemStateStatus;CTATProblemStateStatus.prototype.isSendingSavedMsgsForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.normalFeedback:case CTATProblemStateStatus.complete:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustSaveForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};
CTATProblemStateStatus.prototype.countForProblemSummary=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.startState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};CTATProblemStateStatus.prototype.isOutputSuppressed=function(){switch(this.getStatus()){case CTATProblemStateStatus.goingToState:return!0;default:return!1}};
CTATProblemStateStatus.prototype.isComplete=function(){switch(this.getStatus()){case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};CTATProblemStateStatus.prototype.canRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustRetrieveProblemState=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.transition=function(a,g){var f=this.getStatus();if(CTATProblemStateStatus.completedEarlier!=f)if(CTATProblemStateStatus.complete==f&&g==CTATProblemStateStatus.completedEarlier)this.setStatus(CTATProblemStateStatus.completedEarlier);else{switch(a){case CTATMsgType.SET_PREFERENCES:CTATProblemStateStatus[g]&&(CTATProblemStateStatus.incomplete==CTATProblemStateStatus[g]?this.setStatus(CTATProblemStateStatus.incompleteStartState):CTATProblemStateStatus.complete==CTATProblemStateStatus[g]?
this.setStatus(CTATProblemStateStatus.completedEarlier):this.setStatus(CTATProblemStateStatus.startState));break;case CTATMsgType.STATE_GRAPH:this.getStatus()==CTATProblemStateStatus.incomplete||this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incompleteStartState):this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.START_STATE_END:this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incomplete):
this.getStatus()==CTATProblemStateStatus.incomplete?this.setStatus(CTATProblemStateStatus.incomplete):this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.PROBLEM_RESTORE_END:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.END_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.BEGIN_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.BEGIN_RESTORE:this.getStatus()!=CTATProblemStateStatus.incompleteStartState&&
this.setStatus(CTATProblemStateStatus.incomplete)}ctatdebug("CTATProblemStateStatus.transition("+a+", "+g+") old "+f+" => new "+this.getStatus());return this.getStatus()}};CTATProblemStateStatus.prototype.toString=function(){return"{"+this.getStatus()+"}"};var CTATMessageTank=function(a){function g(a){l.ctatdebug("entering updateProblemSummary()");a&&b.forEach(function(b){if(b.msgType==CTATMsgType.ASSOCIATED_RULES){var c=b.evt;l.ctatdebug("entering updateProblemSummaryWithEvent("+c+")");if(c)if(d&&d.getOutputStatus().isComplete())a.setCompletionStatus(CTATMsgType.CompletionValue[1],!1),a.setShowCounts(!1);else{b=c.getResult();c.getHintRequest()&&(b=CTATExampleTracerLink.HINT_ACTION);var e=CTATMsgType.CompletionValue[0],f=b&&b==CTATExampleTracerLink.CORRECT_ACTION,
g=!1,h=null,m=null,n=null,z=c.getStudentSAI();z&&(h=z.getSelection())&&(m=z.getAction())&&(g="done"==String(h).toLowerCase()&&"buttonpressed"==String(m).toLowerCase());a.setCompletionStatus(e,CTATGlobals.confirmDone);l.ctatdebug("updateProblemSummary() Completion status "+e+", doneStep "+g+", correct "+f);g&&(e=f?(n=z.getInput())&&"-1"!=n?n:CTATMsgType.CompletionValue[1]:CTATMsgType.CompletionValue[0],a.setCompletionStatus(e,!0));e.startsWith(CTATMsgType.CompletionValue[1])?(a.stopTimer(),d&&d.setOutputStatus(CTATProblemStateStatus.complete)):
a.restartTimer();e=c.getActor();l.ctatdebug("updateProblemSummmary() actor "+e+", indicatorObj "+b);!CTATMatcher.isTutorActor(e)&&d.getOutputStatus().countForProblemSummary()&&(c=c.getStepID(),CTATTutorMessageBuilder.isHint(b)?a.addHint(c):CTATTutorMessageBuilder.isCorrect(b)?null!==b&&"undefined"!==typeof b&&a.addCorrect(c):a.addError(c))}}})}function f(a){switch(l.suppressFeedback(a,d.getFeedbackPolicy())){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.DELAY_FEEDBACK:a=a.msg;var b=
CTATMsgType.getProperty(a,"Selection");l.ctatdebug("CTATMessageTank.addToDelayedFeedbackTank(\n  "+a+") selection "+b);b&&(d.getDelayedFeedback()[b.toLowerCase()]=a);return!0;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}}function c(a,b){for(var c=new CTATMessageTank(a,null),d=0;d<b.length;++d){var e=b[d];l.ctatdebug("sendNewTankful() mto["+d+"] msgType "+e.msgType);c.addToMessageTank(e.msgType,e.msg,
e.evt,null)}c.flushMessageTank(null,!0)}CTATBase.call(this,"CTATMessageTank",null);var d=a,b=null,e=null,h=null;a=new Set;a.add("SuccessMessage");a.add("BuggyMessage");a.add("HighlightMsg");a.add("NotDoneMessage");var l=this;this.toString=function(){l.ctatdebug("toString tank "+b);if(!b||1>b.length)return"MessageTank empty";var a="";b.forEach(function(b){a+=b.msgType+", "});return"MessageTank["+a.substr(0,a.length-2)+"]"};this.enqueueToolActionToStudent=function(a,b,c,e){l.ctatdebug("Entering enqueueToolActionToStudent("+
a+", "+b+", "+c+", "+e+")");var f=CTATMsgType.INTERFACE_ACTION;l.ctatdebug("entering enqueueMessageToStudent()");var g=CTATMessage.makeTransactionId();a=new CTATSAI(a,b,c);b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(g,a);b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.TRIGGER,"DATA");b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.SUBTYPE,!e||1>e.length?CTATTutorMessageBuilder.TUTOR_PERFORMED:e);e=new CTATExampleTracerEvent(d,a,CTATMsgType.DEFAULT_TOOL_ACTOR);e.setTransactionID(g);
l.addToMessageTank(f,b,e,a);return g};this.addToMessageTank=function(a,c,d,f){l.ctatdebug("Entering addToMessageTank("+a+", "+c+", "+d+")");if(c){b||(b=[],e={},h={});var g={};g.msgType=a;g.msg=c;g.evt=d;g.sai=f;b.push(g);e[a]=e[a]?e[a]+1:1;a=d.getResult();d.getHintRequest()&&(a=CTATExampleTracerLink.HINT_ACTION);h[a]=h[a]?h[a]+1:1;l.ctatdebug("Exiting addToMessageTank() this "+l.toString())}};this.flushMessageTank=function(a,n){l.ctatdebug("Entering flushMessageTank("+a+", "+n+")");if(b&&!(1>b.length)){g(a);
l.ctatdebug("flushMessageTank() after updateProblemSummary; messageTank.length "+b.length);for(var m=[],v=[],r=0;r<b.length;++r){var u=b[r];if(u.msg){var w=u.msgType,B=u.evt;l.ctatdebug("entering processInterfaceVariables() msgType "+w+", evt "+B);if(w){var y=d?d.getTracer():null;l.ctatdebug("entering processInterfaceVariables() et "+d+", tracer "+y);w=w.toLowerCase();(0===w.indexOf("correct")||0===w.indexOf("interfaceaction"))&&y&&y.addInterfaceVariablesFromEvent(B)}if(!(w=f(u)))if(w=u,B=v,CTATConfiguration.usingFlash()){var z=
y=void 0;if(!(w&&w.sai&&(y=w.sai.getAction())&&(z=CTATSAI.delayedActionRegExp.exec(y)))||3>z.length||1>=z[2])w=!1;else{var q=B.length-1,q=0>q?null:B[q];w.msg=w.msg.replace(y,z[1]);q&&q.timeout==z[2]?q.msgTuples.push(w):B.push({timeout:Number(z[2]),msgTuples:[w]});w=!0}}else w=!1;w||m.push(u.msg)}}l.ctatdebug("flushMessageTank(): msgBundle.length "+m.length+", delayedMsgsBundle.length "+v.length);for(r=0;r<v.length;++r)u=v[r],l.ctatdebug("processDelayedMsgs() delayedMsgs.timeout "+u.timeout+", .msgTuples.length "+
u.msgTuples.length),setTimeout(c,u.timeout,d,u.msgTuples);0<m.length&&(l.ctatdebug("Bottom of flushMessageTank(); to send bundle of length "+m.length+" via "+d),d.sendBundle(m)&&(l.ctatdebug("CTATMessageTank.shouldSaveNow() resultTypes "+h+", msgTypes "+e),(h[CTATExampleTracerLink.CORRECT_ACTION]||h[CTATExampleTracerLink.FIREABLE_BUGGY_ACTION]||e.CorrectAction||e.InterfaceAction||e.UntutoredAction||d.isFeedbackSuppressed()&&e.AssociatedRules)&&d.isSendingSavedMsgsForRestore()&&(CTATGlobalFunctions.isInstructorMode()?
l.ctatdebug("We're in reviewer mode: we shouldn't save as we go"):d.getProblemStateSaver().saveAsYouGo(a))),l.ctatdebug("Exiting flushMessageTank() #CorrectAction "+e.CorrectAction+", #InterfaceAction "+e.InterfaceAction+", #UntutoredAction "+e.UntutoredAction));e=b=null}};this.flushDelayedFeedback=function(){l.ctatdebug("Entering flushDelayedFeedback()");var a=d.getDelayedFeedback(),b;for(b in a)a.hasOwnProperty(b)&&CTAT.ToolTutor.sendToInterface(a[b]);d.clearDelayedFeedback()};this.suppressFeedback=
function(a,b){l.ctatdebug("CTATMessageTank.suppressFeedback("+a.msgType+", "+b+")");var c;b==CTATMsgType.SHOW_ALL_FEEDBACK?(l.ctatdebug("if.1"),c=b):CTATMsgType.hasTextFeedback(a.msgType)?(l.ctatdebug("if.2"),b==CTATMsgType.HIDE_ALL_FEEDBACK||b==CTATMsgType.HIDE_BUT_ENFORCE?(l.ctatdebug("if.2.1"),c=b):(l.ctatdebug("if.2.2"),(c=CTATMsgType.getProperty(a.msg,CTATMsgType.BUGGY_MSG))&&-1!=c.toLowerCase().indexOf(CTATMsgType.NOT_DONE_MSG.toLowerCase())?(l.ctatdebug("if.2.2.1"),c=CTATMsgType.SHOW_ALL_FEEDBACK):
(l.ctatdebug("if.2.2.2"),c=CTATMsgType.HIDE_ALL_FEEDBACK))):CTATMsgType.isCorrectOrIncorrect(a.msgType)?(l.ctatdebug("if.3: "+a.msg),CTATMsgType.isDoneMessage(a.msg)?(l.ctatdebug("if.3.1"),c=CTATMsgType.SHOW_ALL_FEEDBACK):(l.ctatdebug("if.3.2"),c=b)):(l.ctatdebug("if.4"),c=CTATMsgType.SHOW_ALL_FEEDBACK);l.ctatdebug("CTATMessageTank.suppressFeedback() returning "+c);return c}};Object.defineProperty(CTATMessageTank,"END_OF_TRANSACTION",{enumerable:!1,configurable:!1,writable:!1,value:"end_of_transaction"});
CTATMessageTank.prototype=Object.create(CTATBase.prototype);CTATMessageTank.prototype.constructor=CTATMessageTank;"undefined"!==typeof module&&(module.exports=CTATMessageTank);var CTATStep=function(a,g){CTATBase.call(this,"CTATStep",a);var f=0,c=null,d=0,b=0;this.ctatdebug("entering CTATStep("+a+", "+g+") constructor");this.incrementFirstHints=function(){f++};this.incrementNCorrect=function(){d++};this.incrementErrors=function(){b++};this.setLastResult=function(a){c=a};this.getLastResult=function(){return c};this.getResult=function(){return g};this.getNCorrect=function(){return d};this.getNErrors=function(){return b};this.getNFirstHints=function(){return f};this.ctatdebug("in CTATStep("+
a+", "+g+") constructor");switch(g){case CTATStep.StepResult[3]:this.incrementNCorrect();break;case CTATStep.StepResult[1]:this.incrementErrors();break;case CTATStep.StepResult[2]:this.incrementFirstHints()}this.ctatdebug("exiting CTATStep constructor")};Object.defineProperty(CTATStep,"StepResult",{enumerable:!1,configurable:!1,writable:!1,value:["UNTRIED","INCORRECT","HINT","CORRECT"]});CTATStep.prototype=Object.create(CTATBase.prototype);CTATStep.prototype.constructor=CTATStep;
"undefined"!==typeof module&&(module.exports=CTATStep);var CTATProblemSummary=function(a,g,f){CTATBase.call(this,"CTATProblemSummary","");if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("problemName null or empty");var c=!0,d=Number.MAX_VALUE,b=g,e=f,h=0,l=new Date,m={},n=0,p=0,v=0,r=0,u=0,w=0,B=0,y=CTATMsgType.CompletionValue[0],z=this;this.getCountOnlyLastResults=function(){return e};this.setCountOnlyLastResults=function(a){e=a};this.getTimeElapsed=function(){return h};this.getUniqueErrors=function(){if(!z.getCountOnlyLastResults())return B;
var a=0,b;for(b in m)m[b].getLastResult()==CTATStep.StepResult[1]&&a++;return a};this.getUniqueCorrect=function(){if(!z.getCountOnlyLastResults())return u;var a=0,b;for(b in m)m[b].getLastResult()==CTATStep.StepResult[3]&&a++;return a};this.getUniqueCorrectUnassisted=function(){return w};this.getHintsOnly=function(){var a=0,b;for(b in m)CTATStep.StepResult[2]==m[b].getResult()&&1>m[b].getNErrors()&&++a;return a};this.getErrorsOnly=function(){var a=0,b;for(b in m)CTATStep.StepResult[1]==m[b].getResult()&&
1>m[b].getNFirstHints()&&++a;return a};this.getUniqueSteps=function(){var a=0,b;for(b in m)a++;return a};this.getRequiredSteps=function(){return d==Number.MAX_VALUE?0:d};this.setRequiredSteps=function(a){d=a};this.getCorrect=function(){return n};this.toXML=function(b){var d,e="";d=""+(' ProblemName="'+a+'"');d+=' CompletionStatus="'+y+'"';c&&(d+=' Correct="'+n+'"',d+=' UniqueCorrect="'+z.getUniqueCorrect()+'"',d+=' UniqueCorrectUnassisted="'+w+'"',d+=' Hints="'+p+'"',d+=' UniqueHints="'+r+'"',d+=
' HintsOnly="'+z.getHintsOnly()+'"',d+=' Errors="'+v+'"',d+=' UniqueErrors="'+z.getUniqueErrors()+'"',d+=' ErrorsOnly="'+z.getErrorsOnly()+'"',d+=' UniqueSteps="'+z.getUniqueSteps()+'"',d+=' RequiredSteps="'+z.getRequiredSteps()+'"');d+=' TimeElapsed="'+h+'"';c&&(e=z.getSkills()?z.getSkills().toXML(b):"");return b?"&lt;ProblemSummary"+d+"&gt;"+e+"&lt;/ProblemSummary&gt;":"<ProblemSummary"+d+">"+e+"</ProblemSummary>"};this.getSkills=function(){return b};this.setSkills=function(a){b=a};this.stopTimer=
function(){var a=new Date;h+=a.getTime()-l.getTime();return a};this.restartTimer=function(){l=z.stopTimer();return h};this.addHint=function(a){z.ctatdebug("addHint("+a+")");var b=m[a];null!==b&&"undefined"!==typeof b?(1>b.getNFirstHints()&&++r,b.incrementFirstHints()):(b=new CTATStep(a,CTATStep.StepResult[2]),m[a]=b,r++);p++;b.setLastResult(CTATStep.StepResult[2]);z.ctatdebug("exiting addHint() hint count "+p+", trial "+b)};this.addError=function(a){z.ctatdebug("addError("+a+")");var b=m[a];null!==
b&&"undefined"!==typeof b?(1>b.getNCorrect()&&1>b.getNErrors()&&++B,b.incrementErrors()):(b=new CTATStep(a,CTATStep.StepResult[1]),m[a]=b,B++);v++;b.setLastResult(CTATStep.StepResult[1]);z.ctatdebug("exiting addError() error count "+v+", trial "+b)};this.addCorrect=function(a){var b=m[a];z.ctatdebug("entering addCorrect("+a+") trial "+b);b?(1>b.getNCorrect()&&1>b.getNErrors()&&(++u,1>b.getNFirstHints()&&w++),b.incrementNCorrect()):(z.ctatdebug("to call CTATStep("+a+", StepResult "+CTATStep.StepResult[3]),
b=new CTATStep(a,CTATStep.StepResult[3]),m[a]=b,u++,w++);n++;b.setLastResult(CTATStep.StepResult[3]);z.ctatdebug("exiting addCorrect() correct count "+n+", trial "+b)};this.setShowCounts=function(a){c=a};this.setCompletionStatus=function(a,b){z.ctatdebug("setCompletionStatus("+a+", "+b+") old value "+y);if(!y.startsWith(CTATMsgType.CompletionValue[1])||b)y=a};this.getCompletionStatus=function(){return y}};CTATProblemSummary.prototype=Object.create(CTATBase.prototype);
CTATProblemSummary.prototype.constructor=CTATProblemSummary;"undefined"!==typeof module&&(module.exports=CTATProblemSummary);var CTATSkills=function(a){CTATBase.call(this,"CTATSkills",a?String(a.length):"");var g={},f=0;a.forEach(function(a){g[a.getSkillName().toLowerCase()]=a});var c=new Set,d=this;this.toXML=function(a,c){c||(c="");var b=a?"&lt;Skills&gt;":"<Skills>",d=b.length,e;for(e in g)g.hasOwnProperty(e)&&g[e]&&(b+=c+g[e].toXML(a));b+=c&&b.length>d?"\n":"";return b+(a?"&lt;/Skills&gt;":"</Skills>")};this.getAllSkills=function(){var a=[],c;for(c in g)g.hasOwnProperty(c)&&g[c]&&a.push(g[c]);return a};this.updateSkill=
function(a,e,g){var b=null,h=d.getSkill(e);null!==h&&"undefined"!==typeof h&&(h.setTransactionNumber(f),e=g+" "+e,c.has(e)||(c.add(e),h.updatePKnown(a),h.updateHistory(a),h.changeOpportunityCount(1)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===a.toString().toUpperCase()&&c["delete"](e),b=h);return b};this.startTransaction=function(){++f};this.getSkill=function(a){var b=null===a||"undefined"===typeof a?null:a.toLowerCase(),b=g[b];d.ctatdebug("CTATSkills.getSkill("+a+") returns "+b);return b};
this.getSkillBarVector=function(a,c){var b=[],d;for(d in g)!0===g.hasOwnProperty(d)&&(!0!==c&&g[d].getTransactionNumber()!==f||b.push(g[d].getSkillBarString(a)));return b};this.setExternallyDefined=function(a){};this.setVersion=function(a){for(var b in g)!0===g.hasOwnProperty(b)&&g[b].setVersion(a)}};CTATSkills.prototype=Object.create(CTATBase.prototype);CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var ProblemStateSaver=function(a){CTATBase.call(this,"ProblemStateSaver",a);this.tracer=a;var g=this,f=[],c=null,d="",b="",e=0;this.saveAsYouGo=function(c){g.ctatdebug("saveAsYouGo() curriculum_service_url "+d+", tracer "+a);if(a&&c){var h={};h.session_id=a.getSessionID();h.authenticity_token=b;h.summary=c.toXML(!1);h.problem_state=ProblemStateSaver.xmlToJSON(f);++e;g.ctatdebug("saveAsYouGo["+e+"] to send problem_state length "+h.problem_state.length);CTATLMS.saveProblemState&&CTATLMS.saveProblemState(h);
CTATLMS.gradeStudent&&CTATLMS.gradeStudent(parseInt(c.getCorrect()),parseInt(c.getRequiredSteps()));CTATLMS.commit&&CTATLMS.commit()}else g.ctatdebug("Error: no tracer or no problem summary available, aborting save as you go")};this.setCurriculumServiceUrl=function(a){g.ctatdebug("ProblemStateSaver.setCurriculumServiceUrl() old "+d+", new "+a);d=a};this.setAuthenticityToken=function(a){g.ctatdebug("ProblemStateSaver.setAuthenticityToken() old "+b+", new "+a);a&&(b=a)};this.getStepToIndexMap=function(){null===
c&&(c=new Map);return c};this.getProblemState=function(){return f};this.getProblemStateLength=function(){return f.length}};ProblemStateSaver.prototype=Object.create(CTATBase.prototype);ProblemStateSaver.prototype.constructor=ProblemStateSaver;
ProblemStateSaver.prototype.replaceInProblemState=function(a,g,f,c){this.ctatdebug("PSS.replaceInProblemState("+CTATMsgType.getMessageType(a)+", "+f+", "+c+")");if(g.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a))){g=this.getProblemState();a=this.editForProblemState(a);if(!c){f=ProblemStateSaver.makeStepKey(f);c=this.getStepToIndexMap();this.ctatdebug("PSS.replaceInProblemState() stepKey"+f+", index "+c.get(f)+")");if(c.has(f)){var d=c.get(f);g[d]=null}c.set(f,
g.length)}g.push(a)}};ProblemStateSaver.prototype.appendToProblemState=function(a,g,f){if(f||g.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a)))g=this.getProblemState(),a=this.editForProblemState(a),g.push(a)};Object.defineProperty(ProblemStateSaver,"XML_PROLOGUE",{enumerable:!1,configurable:!1,writable:!1,value:/<\? *[xX][mM][lL][^?]*\?>/});Object.defineProperty(ProblemStateSaver,"LEADING_WHITE_SPACE",{enumerable:!1,configurable:!1,writable:!1,value:/^\s+</m});
Object.defineProperty(ProblemStateSaver,"MESSAGES_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"<messages>"});
ProblemStateSaver.prototype.editForProblemState=function(a){var g=a.split(ProblemStateSaver.XML_PROLOGUE),f=g[0],c;for(c=1;c<g.length;++c)f+=g[c];g=f.split(ProblemStateSaver.LEADING_WHITE_SPACE);f=g[0];for(c=1;c<g.length;++c)f.endsWith("\n")&&(f=f.slice(0,-1)),f.endsWith("\r")&&(f=f.slice(0,-1)),f+="<"+g[c];this.ctatdebug("ProblemStateSaver.editForProblemState("+a+")\n returns "+f);return f};ProblemStateSaver.omitFromRestore={init:!1};
ProblemStateSaver.mustSaveForRestore=function(a){ProblemStateSaver.omitFromRestore.init||(ProblemStateSaver.omitFromRestore[CTATMsgType.ASSOCIATED_RULES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.BUGGY_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.CORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INCORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INTERFACE_IDENTIFICATION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_RESTORE_END.toLowerCase()]=
!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_REQUEST.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_RESPONSE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SET_PREFERENCES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SHOW_HINTS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SUCCESS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore.init=!0);return a&&ProblemStateSaver.omitFromRestore[a.toLowerCase()]?
!1:!0};ProblemStateSaver.prototype.forwardToInterface=function(a,g,f){var c=CTATMsgType.getMessageType(a);this.ctatdebug("PSS.forwardToInterface("+c+") problemState.length "+this.getProblemState().length+", outputStatus "+f);if(f&&f.isOutputSuppressed())return!1;CTAT.ToolTutor.sendToInterface(a,g);f&&f.transition(CTATMsgType.getMessageType(a));return!0};ProblemStateSaver.prototype.processMessage=function(a){this.ctatdebug("ProblemStateSaver.processMessage("+a+")")};
ProblemStateSaver.makeStepKey=function(a){if(!a)return" ";var g=a.getSelection();a=a.getAction();g="string"!=typeof g||1>g.length?" ":g;a="string"!=typeof a||1>a.length?" ":a;return g+" "+a};
ProblemStateSaver.jsonToXML=function(a){if("string"!=typeof a||"["!=a.charAt(0))return[];var g=[];try{g=JSON.parse(a)}catch(c){return console.log("ProblemStateSaver.jsonToXML() error",c,"problemState",a),[]}var f=[];g.forEach(function(a,d){console.log("ProblemStateSaver.jsonToXML["+d+"] mo",a);var b;b="<message><verb>NotePropertySet</verb><properties><MessageType>"+("U"==a.m?CTATMsgType.UNTUTORED_ACTION:CTATMsgType.INTERFACE_ACTION);b+="</MessageType><transaction_id>"+CTATMessage.makeTransactionId();
b+="</transaction_id><Selection><value>"+a.s;b+="</value></Selection><Action><value>"+a.a;b+="</value></Action><Input><value><![CDATA["+decodeURIComponent(a.i);f.push(b+"]]\x3e</value></Input></properties></message>")});return f};
ProblemStateSaver.xmlToJSON=function(a){var g=[];a.forEach(function(a,c){ctatdebug("ProblemStateSaver.xmlToJSON["+c+"] msg\n  "+a);if(a){var d={},b=null;d.m=CTATMsgType.getMessageType(a)==CTATMsgType.UNTUTORED_ACTION?"U":"I";d.s=(b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Selection"),0))?b:"";d.a=(b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Action"),0))?b:"";b=CTATMsgType.getValue(CTATMsgType.getProperty(a,"Input"),0);b=b.replace(/^<!\[CDATA\[([^\]]*)\]\]>$/,"$1");d.i=encodeURIComponent(b);
ctatdebug("ProblemStateSaver.xmlToJSON["+c+"]  mo "+JSON.stringify(d));g.push(d)}});try{return JSON.stringify(g)}catch(f){return console.log("ProblemStateSaver.xmlToJSON() error",f,"toStringify",g),""}};"undefined"!==typeof module&&(module.exports=ProblemStateSaver);var ProblemStateRestorer=function(a){CTATBase.call(this,"ProblemStateRestorer",a);var g=this,f=null;this.getRestoreProblemUrl=function(){return f};this.setRestoreProblemUrl=function(a){f=a};this.toString=function(){return"["+f+": 0]"};this.retrieveMessages=function(c){console.log("retrieveMessages("+c+", ...)");c.mustRetrieveProblemState()?(a.stopWorking(1),CTATLMS.getProblemState&&CTATLMS.getProblemState(g.process)):console.log("Retrieval status indicates that we should not retrieve")};this.process=
function(c){a.getOutputStatus().transition(CTATMsgType.BEGIN_RESTORE);if("string"!=typeof c||""==c)console.log("ProblemStateRestorer.process("+c+") empty or not a string: ",typeof c),a.enqueueForRestore([]);else{if("["!=c.charAt(0)&&c.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG&&(console.log("ProblemStateRestorer.process() called with unrecognized string, to try htmlDecode(): ",c.slice(0,20)),c=(new DOMParser).parseFromString(c,"text/html").documentElement.textContent,
c.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG)){console.log("ProblemStateRestorer.process() called with unrecognized string: ",c.slice(0,20));a.enqueueForRestore([]);return}a:{var d=c;c=[];if("string"==typeof d){var b="";if("["==d.charAt(0))d=ProblemStateSaver.jsonToXML(d);else{d=d.split(/<\/?messages>/);g.ctatdebug("msgsArr.length "+d.length+", msgsArr[1].length "+(d[1]?d[1].length:-1));if(2>d.length)break a;b="<message>";d=d[1].split(b)}g.ctatdebug("problemStateArr.length "+
d.length);for(var e=0,f=!1,l=0;l<d.length;++l)if(d[l]){var m=b+d[l],n=CTATMsgType.getMessageType(m);CTATMsgType.STATE_GRAPH==n?f=!0:CTATMsgType.START_STATE_END==n?f=!1:f?e++:CTATMsgType.INTERFACE_ACTION==n&&l==d.length-1&&CTATMsgType.isDoneMessage(m)&&a.getOutputStatus().isComplete()||(a.getProblemStateSaver().appendToProblemState(m,null,!0),c.push(m));g.ctatdebug("problemStateArr["+l+"] "+(f?"omit ":"keep ")+n+" omitted "+e+" kept "+c.length)}}}a.enqueueForRestore(c)}}};
ProblemStateRestorer.prototype=Object.create(CTATBase.prototype);ProblemStateRestorer.prototype.constructor=ProblemStateRestorer;var SCORMProblemSummary=function(){CTATBase.call(this,"SCORMProblemSummary","")};Object.defineProperty(SCORMProblemSummary,"LESSON_STATUS",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.lesson_status"});Object.defineProperty(SCORMProblemSummary,"RAW_SCORE",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.score.raw"});Object.defineProperty(SCORMProblemSummary,"EXIT",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.exit"});
Object.defineProperty(SCORMProblemSummary,"SESSION_TIME",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.session_time"});Object.defineProperty(SCORMProblemSummary,"ExitReason",{enumerable:!1,configurable:!1,writable:!1,value:{timeout:"time-out",suspend:"suspend",logout:"logout",done:" "}});
Object.defineProperty(SCORMProblemSummary,"LessonStatus",{enumerable:!1,configurable:!1,writable:!1,value:{passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed",notAttempted:"not attempted"}});SCORMProblemSummary.getLessonStatus=function(a){return CTATMsgType.CompletionValue[1]==a.getCompletionStatus()?SCORMProblemSummary.LessonStatus.completed:SCORMProblemSummary.LessonStatus.incomplete};
SCORMProblemSummary.getRawScore=function(a){var g=a.getUniqueSteps();return 0==g?0:parseInt(100*(a.getUniqueCorrectUnassisted()/g+.005))};SCORMProblemSummary.getExitReason=function(a){return SCORMProblemSummary.ExitReason.suspend};SCORMProblemSummary.getSessionTime=function(a){var g=a.getTimeElapsed();a=g%1E3;var g=(g-a)/1E3,f=g/60,c=f/60,g=g%60;9999<c&&(c=9999,f=g=99,a=990);return sprintf("%04d:%02d:%02d.%02d",c,f,g,a/10)};
SCORMProblemSummary.getProblemSummaryElements=function(a){var g=sprintf("<%s>%s</%s>",SCORMProblemSummary.LESSON_STATUS,SCORMProblemSummary.getLessonStatus(a),SCORMProblemSummary.LESSON_STATUS),f=sprintf("<%s>%d</%s>",SCORMProblemSummary.RAW_SCORE,SCORMProblemSummary.getRawScore(a),SCORMProblemSummary.RAW_SCORE),c=sprintf("<%s>%s</%s>",SCORMProblemSummary.EXIT,SCORMProblemSummary.getExitReason(a),SCORMProblemSummary.EXIT);a=sprintf("<%s>%s</%s>",SCORMProblemSummary.SESSION_TIME,SCORMProblemSummary.getSessionTime(a),
SCORMProblemSummary.SESSION_TIME);return g+f+c+a};CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=SCORMProblemSummary;"undefined"!==typeof module&&(module.exports=SCORMProblemSummary);var CTATExampleTracer=function(){function a(){return"example"===z&&C&&C.getModelInitialized()||"rule"===z&&A&&A.getModelInitialized()}function g(a,c){c?aa|=1<<a:(aa&=-65537>>16-a,b())}function f(a){if(q.isFeedbackSuppressed()){var b=new CTATSAI("hint","SetVisible","false"),b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage("dummyTransactionID",b);a.push(b)}}function c(){return"<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.INTERFACE_REBOOT+"</MessageType></properties></message>"}
function d(a){a.unshift(c());q.ctatdebug("sendStartStateMessageStrings(): "+a.length+" elts, "+M);q.sendBundle(a)}function b(){q.ctatdebug("workTheQueue() working "+aa+", workQueue.length "+W.length+", restoreQueue.length "+V.length);if(0==aa)for(;0!=(aa=0<W.length|(0<V.length)<<1);){var a,b=!1;0<V.length?(U=1,a=V.shift(),b=!0):(U=0,a=W.shift());if(!e(a,b)){q.ctatdebug("workTheQueue() suspending workQueue.length "+W.length+", restoreQueue.length "+V.length);q.stopWorking(b?1:0);break}q.ctatdebug("workTheQueue() bottom workQueue.length "+
W.length+", restoreQueue.length "+V.length)}}function e(b,d){q.lastMessageAsString=b;var e=q.lastMessageAsXML=(new CTATXML).parseXML(b),f=q.lastMessage=new CTATMessage(e),g=f.getMessageType();q.ctatdebug("CTATExampleTracer.handleMessageFromInterface(msgType "+g+")");switch(g){case CTATMsgType.SET_PREFERENCES:g=x;q.ctatdebug("handleSetPreferences ()");P=f.getProperty("problem_name");q.ctatdebug("SetPreferences.problem_name = "+P);f=g.getElementChildren(g.getElementChildren(e)[1]);for(e=0;e<f.length;e++){var h=
g.getElementName(f[e]);q.ctatdebug("SetPreferences eltName "+h);if(h)switch(h.toLowerCase()){case "source_id":T=g.getNodeTextValue(f[e]);break;case "question_file":F=g.getNodeTextValue(f[e]);break;case "skills":q.ctatdebug(" parseSkills("+f[e]+")");for(var h=[],l=x.getElementChildren(f[e]),m=0;m<l.length;m++){var n=x.getElementName(l[m]);if(n&&"skill"==n.toLowerCase()){var r=x.getElementAttr(l[m],"name");if(r&&""!=r.trim()){var n=x.getElementAttr(l[m],"label"),u=x.getElementAttr(l[m],"pSlip"),w=x.getElementAttr(l[m],
"description"),ga=x.getElementAttr(l[m],"pKnown"),y=x.getElementAttr(l[m],"category"),B=x.getElementAttr(l[m],"pLearn"),D=x.getElementAttr(l[m],"pGuess"),E=x.getElementAttr(l[m],"history"),r=new CTATExampleTracerSkill(y,r,D,ga,u,B,E);r.setLabel(n);r.setDescription(w);h.push(r)}}}q.getProblemSummary().setSkills(new CTATSkills(h));break;case "problem_state_status":M.transition(CTATMsgType.SET_PREFERENCES,g.getNodeTextValue(f[e]));R||(R=new ProblemStateRestorer(q));q.ctatdebug("SetPreferences problemStateRestorer "+
R);break;case "curriculum_service_url":CTATConfiguration.set("curriculum_service_url",g.getNodeTextValue(f[e]));break;case "restore_problem_url":R||(R=new ProblemStateRestorer(q));q.ctatdebug("SetPreferences problemStateRestorer "+R);CTATConfiguration.set("restoreProblemUrl",g.getNodeTextValue(f[e]));break;case "session_id":ja=g.getNodeTextValue(f[e]);break;case "authenticity_token":Q.setAuthenticityToken(g.getNodeTextValue(f[e]))}}q.ctatdebug("questionFile "+F+", outputStatus "+M+", problemStateRestorer "+
R);f="undefined"!=typeof sessionStorage&&sessionStorage?sessionStorage.getItem("Go-To-State"):null;null!=f&&(sessionStorage.removeItem("Go-To-State"),f=Number(f),!Number.isSafeInteger(f)||0>=f||(ha=f,M.transition(CTATMsgType.BEGIN_GO_TO_STATE,null)));q.ctatdebug("outputStatus "+M+", problemStateRestorer "+R);pa.retrieveProblemFile(F,g,q);R&&R.retrieveMessages(M);return!1;case CTATMsgType.INTERFACE_IDENTIFICATION:return!0;case CTATMsgType.UNTUTORED_ACTION:return d&&q.sendBundle([b]),g=x,f=f.getTransactionID(),
q.ctatdebug("UntutoredAction ("+b+"), getTransactionID "+f),Q.appendToProblemState(b,q.getOutputStatus(),!1),a()&&q.setVariablesFromSAI(e,g),!0;case CTATMsgType.INTERFACE_ACTION:d&&q.sendBundle([b]);q.ctatdebug("Interface action received.");g=f.getTransactionID();if(a())if(q.messageTank=new CTATMessageTank(q),q.ctatdebug("MessageTank "+q.messageTank),q.ctatdebug("InterfaceAction ("+b+"), getTransactionID "+g),h=f.getSelectionArray().slice(0),e=f.getActionArray().slice(0),q.ctatdebug("selectionArray "+
h+", message.getSelectionArray() "+f.getSelectionArray()),h[0]&&"_tutor"==h[0].toLowerCase())q.ctatdebug("handleInterfaceAction tutor cmd SAI "+f.getSAI()+";"),e[0]&&"function"===typeof q[e[0]]&&(g=f.getSAI().getInput(),q[e[0]](g)),g=!0;else if(!h[0]||"hint"!=h[0].toLowerCase()&&"help"!=h[0].toLowerCase())q.ctatdebug("calling doNewTrace("+z+", "+f.getSAI()+") sai.selectionArray "+f.getSAI().getSelectionArray()+" msg.selectionArray "+f.getSelectionArray()),g=v(z,[null,f.getSAI(),"student",!0,g,b]);
else{q.ctatdebug("handleInterfaceAction() hint request: hintPolicy "+J+", errorSAI "+H);J===CTATHintPolicyEnum.HINTS_UNBIASED?(1<h.length&&(h[1]=""),1<e.length&&(e[1]="")):J!==CTATHintPolicyEnum.HINTS_BIASED_BY_CURRENT_SELECTION_ONLY&&(J===CTATHintPolicyEnum.HINTS_BIASED_BY_PRIOR_ERROR_ONLY?H&&H.getSelection()?(h.splice(1,0,H.getSelection()),e.splice(1,0,"PreviousFocus")):(h[1]="",e[1]=""):J===CTATHintPolicyEnum.HINTS_BIASED_BY_ALL&&H&&H.getSelection()&&(h.splice(1,0,H.getSelection()),e[1]=CTATMsgType.PREVIOUS_FOCUS.toString()));
q.startSkillTransaction();q.ctatdebug("ExampleTracer.doHint, givenSelection = "+h);l=f=null;if(e&&1<e.length&&e[1].toString()===CTATMsgType.PREVIOUS_FOCUS.toString()&&h&&1<h.length&&h[1]&&"null"!==h[1].toString()&&(f=h[1]!==h[0]?[h[1]]:null,2<e.length))for(q.ctatdebug("CTATExampleTracer --\x3e in doHint inner if condition"),l=[],h=2;h<e.length;h++)q.ctatdebug("CTATExampleTracer --\x3e in doHint for loop "+h),l.push(e[h]);q.ctatdebug("CTATExampleTracer --\x3e in doHint out of if condition");f=new CTATSAI(f,
l,null);e=new CTATExampleTracerEvent(q,f,"student");e.setHintRequest(!0);e.setWantReportableHints(!0);q.ctatdebug("CTATExampleTracerTracer --\x3e in doHint result: "+e);"example"===z?(f=C.doHint(e),g=p(e,g,f)):g=A.doHint(e,g,p)?e:null}else g=!1;return g;case CTATMsgType.PROBLEM_SUMMARY_REQUEST:return g=q.getProblemSummary(),q.ctatdebug("CTATExampleTracer.ProblemSummaryRequest getProblemSummary() "+q.getProblemSummary()),f="<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.PROBLEM_SUMMARY_RESPONSE+
"</MessageType>",f+=SCORMProblemSummary.getProblemSummaryElements(g),f+="<ProblemSummary>"+g.toXML(!0)+"</ProblemSummary>",f+="<end_of_transaction>true</end_of_transaction></properties></message>",e=[],e.push(f),q.sendBundle(e),M.transition(CTATMsgType.PROBLEM_SUMMARY_RESPONSE,g.getCompletionStatus()),q.ctatdebug("CTATExampleTracer.handleProblemSummaryRequest() sent result '"+f+"';"),!0;case CTATMsgType.START_STATE_END:return M.transition(CTATMsgType.START_STATE_END),!0;case CTATMsgType.PROBLEM_RESTORE_END:return M.transition(CTATMsgType.PROBLEM_RESTORE_END),
g=q.getSkillBarVector(),f=[],e=new CTATTutorMessageBuilder,f.push(e.createMessage(CTATMsgType.PROBLEM_RESTORE_END,g?{Skills:g}:null)),q.sendBundle(f),!0;case CTATMsgType.GO_TO_STATE:return g=f.getProperty("nodeID"),0>g||!sessionStorage||!sessionStorage.setItem?g=!0:(sessionStorage.setItem("Go-To-State",String(g)),CTAT.ToolTutor.reboot("Go-To-State "+g+" from CTATExampleTracer")||(f=[],f.push(c()),q.ctatdebug("CTATET.handleGoToState() saved nodeID "+g+"; sending to interface\n"+f),q.sendBundle(f)),
g=!1),g;default:return console.log("CTATExampleTracer.handleMessageFromInterface(restoring "+d+") "+(d?"sending":"unprocessed")+" message, type "+g+"\n  "+b),d&&q.sendBundle([b]),!0}}function h(a,b,c){var d={tutorAdvice:null,msg:null,msgType:null};d.tutorAdvice=a.getSuccessOrBuggyMsg();d.tutorAdvice&&d.tutorAdvice.trim()?(d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage"):d.tutorAdvice=null;if(a.isBuggyResult())return d;q.ctatdebug("CTATET.createBuggyMessage() past getReportableLink()");
if(a.isDoneStepFailed())return d.tutorAdvice=CTATMsgType.NOT_DONE_MSG,d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage",d;q.ctatdebug("CTATET.createBuggyMessage() past isDoneStepFailed()");var e=b&&b.getTutorSAI()?b.getTutorSAI().getSelection():null,e=e&&""!==e.trim()?e:null,f=a.getStudentSAI()?a.getStudentSAI().getSelection():null,f=f&&""!==f.trim()?f:null;q.ctatdebug("CTATET.createBuggyMessage() past hintSelection0 "+e+", studentSelection0 "+f);if(a.getResult()==
CTATExampleTracerLink.NO_MODEL&&a.isOutOfOrder()&&e&&e!=f)return q.ctatdebug("CTATET.createBuggyMessage() to create out of order"),q.isHighlightRightSelection()?(d.tutorAdvice=q.getOutOfOrderMessage(),d.msg=c.createHighlightWidgetMessage(e,b.getTutorSAI().getAction(),d.tutorAdvice,a.getTransactionID()),d.msgType="HighlightMsg",q.ctatdebug("createBuggyMessage() out of order with highlight; rtn: "+d)):(d.tutorAdvice=CTATGlobals.languageManager.getString("OUTOFORDER"),d.msg=c.createBuggyMessage(a.getTransactionID,
d.tutorAdvice),d.msgType="BuggyMessage",q.ctatdebug("createBuggyMessage() out of order without highlight; rtn: "+d)),d;if(b="example"===z?G.getDefaultBuggyMsg():A.getDefaultBuggyMsg())return d.tutorAdvice=b,d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",q.ctatdebug("createBuggyMessage() default buggy msg: "+d),d;q.ctatdebug("createBuggyMessage() no buggy msg: "+d);return d}function l(a,b,c,d){q.ctatdebug("checkForTutorAction("+a+", "+b+", "+c+", "+d+")");var e=
[];e[0]=m(G.getNode(a),!0);e[1]=m(G.getNode(b),!1);q.ctatdebug("checkForTutorAction() links[0] "+e[0]+", links[1] "+e[1]+";");a=0;e[0]===e[1]?e[1]=null:e[0]||(a=1);b=null;q.messageTank||(q.messageTank=new CTATMessageTank(q,null));for(;a<e.length&&e[a];++a)if(b=CTATGuid.guid(),c){var f=e[a].getEvaluatedInput(c,d.getReportableVariableTable()),g=e[a].getDefaultSAI().clone();g.setInput(f);b=v("example",[e[a],g,e[a].getActor(),!0,b])}else b=v("example",[e[a],e[a].getDefaultSAI(),e[a].getActor(),!0,b]);
q.ctatdebug("checkForTutorAction() returning "+b+";");return b}function m(a,b){if(null===a||"undefined"===typeof a||1!==a.getCorrectOutDegree())return null;var c=null;a.getCorrectOutLinks().forEach(function(a){null===c&&a.isTutorPerformed(b)&&0<a.getMaxTraversals()&&(c=a)});return c}function n(a){for(var b=0;b<arguments.length;++b);for(var b={},c=0;c<arguments.length;++c){var d=arguments[c];"object"==typeof d?Object.assign(b,d):b["cf"+c]=d}return b}function p(a,b,c){c=a.getReportableHints();if(!c||
1>c.length)c=[],c.push(CTATGlobals.languageManager.getString("NO_HINT_AVAILABLE"));var d=a.getAssociatedSkills()||[],e=a.getStepID();q.updateSkills(CTATExampleTracerSkill.HINT,d,e,a.getActor());q.ctatdebug("Before building hint message: tutorSAI "+a.getTutorSAI()+", hints "+c+", edge # "+e);d=(new CTATTutorMessageBuilder).createHintMessage(c,a.getTutorSAI(),e,b);q.messageTank.addToMessageTank(CTATMsgType.SHOW_HINTS_MESSAGE,d,a,null);b=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForHint(c,
a.getTutorSAI(),w(CTATMsgType.DEFAULT_STUDENT_ACTOR),q.getSkillBarVector(!0),e,b,n(a.getCustomFields(),{rules:a.getAssociatedRules()}));q.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,b,a,null);b=q.getProblemSummary(a.getReportableInterpretation());q.messageTank.flushMessageTank(b,!0);q.ctatdebug("handleInterfaceAction() sent hint result "+a);H=null;q.restartWorking();return a}function v(a,b){q.ctatdebug("doNewTrace ( "+a+", "+b+" )");var c=b.shift(),d=b.shift(),e=b.shift(),f=b.shift(),
g=b.shift(),h=b.shift(),l=new CTATExampleTracerEvent(q,d,e),m=g;if(q.getOutputStatus().isComplete()&&d.isDone())return l.setResult(CTATExampleTracerLink.CORRECT_ACTION),l.setTraceOutcome(CTATExampleTracerLink.CORRECT_ACTION),l.setTutorSAI(d),l.setTransactionID(m),c=B(l,d,e,!1),q.ctatdebug("doNewTrace("+d+", "+e+", "+f+", "+m+") returns "+c),c;q.startSkillTransaction();g=function(){l.setTransactionID(m);var c=l.getMsgToRestore();c&&(q.isFeedbackSuppressed()?Q.replaceInProblemState(c,q.getOutputStatus(),
l.getStudentSAI(),G.getFeedbackPolicy()==CTATMsgType.HIDE_BUT_ENFORCE):l.getResult()!=CTATExampleTracerLink.CORRECT_ACTION&&l.getResult()!=CTATExampleTracerLink.FIREABLE_BUGGY_ACTION||Q.appendToProblemState(c,q.getOutputStatus(),!1));c=B(l,d,e,f);q.ctatdebug("doNewTrace( "+a+", "+b+" ) returns "+c);q.restartWorking();return c};switch(a){case "example":return m=r(c,l,h,m),g();case "rule":return f=!1,u(l,h,g)}return null}function r(a,b,c,d){q.ctatdebug("doNewExampleTrace (link "+a+", result "+b+", origMsgTxt "+
c+", transactionID "+d);a&&b.addPreloadedLinkMatch(a);var e=C.evaluate(b);q.ctatdebug("Evaluate returned : "+e+", given link "+a+", result "+b);a?(q.ctatdebug("result.getTutorSelection() "+b.getTutorSelection()),q.ctatdebug("result.getTutorAction() "+b.getTutorAction()),q.ctatdebug("result.getTutorInput() "+b.getTutorInput()),q.ctatdebug("typeof(messageTank) "+typeof messageTank),a=b.getTutorSelection(),c=b.getTutorAction(),b=b.getTutorInput(),d=q.messageTank.enqueueToolActionToStudent(a,c,b,CTATTutorMessageBuilder.TUTOR_PERFORMED)):
b.setMsgToRestore(c);return d}function u(a,b,c){q.ctatdebug("DoNewRuleTrace( "+a+", "+b+" )");a.setMsgToRestore(b);return A.evaluate(a,c)}function w(a){return"undefined"!=typeof a&&a&&0<=a.toString().toLowerCase().indexOf("tutor")?"Tutor":"Student"}function B(a,b,c,d){q.ctatdebug("finishNewExampleTrace("+a+", "+b+", "+c+", "+d+")");var e=a.getStudentSAI(),f=a.getTutorSAI(),g=a.getTransactionID(),m=new CTATTutorMessageBuilder,p=a.getReportableLink()||null,r=null;b=a.getAssociatedSkills()||[];var u=
function(){q.lastResult=a;q.getTracer()&&"function"==typeof q.getTracer().saveLastReport&&q.getTracer().saveLastReport(a);var b=q.getProblemSummary(a.getReportableInterpretation());q.ctatdebug("finishNewExampleTrace() to flushMessageTank");q.messageTank.flushMessageTank(b,!0);q.ctatdebug("finishNewExampleTrace() sent result "+a.getResult()+",\n studentSAI "+e+",\n tutorSAI "+a.getTutorSAI()+",\n successOrBuggyMsg "+a.getSuccessOrBuggyMsg());return a};if(a.isSolverResult())return a.getResult(),u();
if(a.getResult()===CTATExampleTracerLink.CORRECT_ACTION){CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()!=c.toUpperCase()&&q.messageTank.addToMessageTank(CTATMsgType.CORRECT_ACTION,m.createCorrectActionMessage(g,f),a,f);q.updateSkills(CTATExampleTracerSkill.CORRECT,b,a.getStepID(),c);b=a.getSuccessOrBuggyMsg();var v=m.createAssociatedRulesMessageForAction(a.getResult(),f,w(c),e,q.getSkillBarVector(!0,c),p?p.getUniqueID():a.getStepID(),g,b,a.isOutOfOrder(),n(a.getCustomFields(),{rules:a.getAssociatedRules()}),
a.getTraceOutcome());q.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,v,a,f);q.ctatdebug("finishNewExampleTrace() successMsg "+b);b&&q.messageTank.addToMessageTank("SuccessMessage",m.createSuccessMessage(g,b),a,null);H=null;d&&(r=l(p?p.getNextNode():null,C.findCurrentState(!1,!1),q.lastMessage?q.lastMessage.getSAI():null,a))&&(a=r);return u()}q.messageTank.addToMessageTank(CTATMsgType.INCORRECT_ACTION,m.createInCorrectActionMessage(g,a.getInterpolatedSAI()),a,null);q.ctatdebug("about to do silent traceForHint("+
e+"), selectionArray "+e.getSelectionArray());var x=q.lastSilentHintResult=new CTATExampleTracerEvent(q,e,c);x.setHintRequest(!0);b=function(){var b=a.getAssociatedSkills()||[],n=a.getStepID()||"";q.updateSkills(CTATExampleTracerSkill.INCORRECT,b,n,c);f=a.getTutorSAI();b=h(a,x,m);q.ctatdebug("createBuggyMessage() tutorAdvice: "+b.tutorAdvice+";\n  msg "+b.msg);n=m.createAssociatedRulesMessageForAction(a.getResult(),f&&f.getSelection()?f:e,w(c),e,q.getSkillBarVector(!0,c),n,g,b.tutorAdvice,a.isOutOfOrder(),
a.getCustomFields(),a.getTraceOutcome());q.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,n,a,null);b.msg&&q.messageTank.addToMessageTank(b.msgType,b.msg,a);H=e;d&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION==a.getResult()?(r=l(p?p.getNextNode():null,C.findCurrentState(!1,!1),q.lastMessage?q.lastMessage.getSAI():null,a))&&(a=r):a.isDoneStepFailed()&&q.messageTank.flushDelayedFeedback();return u()};if("example"===z)return y(a,x),b();"rule"===z&&(a.setCustomFields(n(a.getCustomFields(),{rules:a.getAssociatedRules()})),
b())}function y(a,b){var c=C.traceForHint(b);q.ctatdebug("silent hint result: "+b+"; hintLink "+c);c||(c=C.getBestNextLink(!1,b),q.ctatdebug("getBestNextLink result: "+b+"; hintLink "+c));c&&((c=b.getTutorSAI())&&c.getSelection()&&a.setTutorSAI(c),a.setStepID(b.getStepID()),a.setAssociatedSkills(b.getAssociatedSkills()),a.setReportableInterpretation(b.getReportableInterpretation()))}CTATBase.call(this,"CTATExampleTracer","tracer");var z=null,q=this,F=null,C,A,E=null,I,G,x=new CTATXML;new XMLSerializer;
var H=null,J,S=!0,O=!0,L=!1,D=null,P=null,T=null,Q=new ProblemStateSaver(q);Q.setAuthenticityToken(CTATCommLibrary.getAuthenticityToken());var R=null,U=1,M=new CTATProblemStateStatus,V=[],W=[],aa=0,ja="",ha=-1,ea=null;q.ctatdebug("CTATExampleTracer constructor outputStatus="+M);this.messageTank=this.lastSilentHintResult=this.lastResult=this.lastMessage=this.lastMessageAsXML=this.lastMessageAsString=null;var pa=new CTATCommLibrary;this.receiveFromInterface=function(a){q.ctatdebug("CTATExampleTracer.receiveFromInterface() \n  "+
a);(/<MessageType>SetPreferences<.MessageType>/i.test(a)?V:W).push(a);b()};this.setVariablesFromSAI=function(a,b){var c=CTATMsgType.getSAIArraysFromElement(a,b);switch(z){case "example":q.getTracer()&&q.getTracer().addInterfaceVariables(c.selection,c.input);break;case "rule":A.handleUntutoredAction(c)}};this.traceLinks=function(a){for(var b=[],c=q.getTracer().getBestInterpretation(),d=0;d<a.length&&null!==a[d];++d)c.getTraversalCount(a[d])<a[d].getMinTraversals()&&(q.messageTank=new CTATMessageTank(q,
null),b.push(v("example",[a[d],a[d].getDefaultSAI(),a[d].getActor(),!1,null])),q.ctatdebug("traceLinks["+d+"] result "+b[d]));return b};this.enqueueForRestore=function(b){q.ctatdebug("enqueueForRestore() tracerReady "+a()+": got "+(b?b.length:-1)+" message elements");null==E&&null!=b&&(E=b);null!=E&&(V=V.concat(E),E=null,b=(new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null),V.push(b),U=1,a()&&q.startWorking())};this.restartWorking=function(){"rule"===z&&g(U,!1)};this.startWorking=
function(){g(U,!1)};this.stopWorking=function(a){g("undefined"!=typeof a?a:U,!0)};this.goToStartState=function(){var a=G.getStudentStartsHereNode()||G.getStartNode();a?q.goToState(a.getNodeName()):console.trace("goToStartState() did not find start node")};this.goToState=function(a){a=(a=G.findNode(a))?a.getNodeID():-1;0<a&&q.receiveFromInterface("<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.GO_TO_STATE+"</MessageType><nodeID>"+a+"</nodeID></properties></message>")};
this.processXML=function(a){if(null!=a){z="example";q.ctatdebug("processXML (), tutorType = "+z);q.ctatdebug("No of children"+x.getElementChildren(a).length);var b=new CTATGraphParser,c=b.parseGraph(a,q);G=c.gr;C=c.tracer;a=c.ssm;c=c.sgMsg;q.ctatdebug("sendStartStateMessages() nMsgs "+a.length+", outputStatus "+M);for(var e=[],g=new XMLSerializer,h=null,m=0;m<a.length;m++)if("message"==x.getElementName(a[m])){var n=g.serializeToString(a[m]),p=CTATMsgType.getMessageType(n);CTATMsgType.UNTUTORED_ACTION!=
p&&CTATMsgType.INTERFACE_ACTION!=p||q.setVariablesFromSAI(a[m],x);CTATMsgType.START_STATE_END==p?(f(e),h=n,e.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd()),e.push((new CTATTutorMessageBuilder).createLockWidgetMsg(b.getLockWidget()))):e.push(n)}e.unshift(c);d(e);b=h;a:{a=[];c=G.getStartNode();e=CTATMsgType.START_STATE_END;g=c.getNodeID();h=null;m=ha;ha=-1;0>m&&(m=(m=G?G.getStudentStartsHereNode():null)?m.getNodeID():g);m==g?(console.trace("CTATExampleTracer.resetGoToState to transition1 destNodeID == noopNodeID",
g),M.transition(e,null)):0<m&&(h=G.getNode(m));q.ctatdebug("CTATET.resetGoToState("+e+", null, "+g+") returns "+h);h||console.trace("CTATExampleTracer.resetGoToState to transition2 destNode",g);e=h;if(null!==c&&null!==e&&c.getNodeID()!=e.getNodeID()){a=G.getBestSubpath(c,e);q.ctatdebug("advanceToStudentStartsHere() path "+a);if(!a)break a;a=a.getSortedLinks();a=q.traceLinks(a);q.ctatdebug("advanceToStudentStartsHere() results "+a)}e=c=null;0<a.length&&(e=a[a.length-1],a=e.getReportableLink(),null!==
a&&(c=a.getNextNode()));q.ctatdebug("advanceToStudentStartsHere() to check for TPA "+c+", "+e);l(c,C.findCurrentState(!1,!1),null,e)}a=[];b&&a.push(b);M.canRestore()||a.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));0<a.length&&q.sendBundle(a);C.setModelInitialized(!0)}q.startWorking()};this.processNools=function(a){var b=new CTATTutorMessageBuilder;z="rule";A=new CTATRuleTracer("nools",q);A.initEngine(a,function(a,c){q.ctatdebug("nools engine compiled");var e;
e=new CTATTutorMessageBuilder;var g=c.suppressStudentFeedback;if(null===g||void 0===g)g=CTATMsgType.SHOW_ALL_FEEDBACK;q.setFeedbackSuppressed(g);var h=c.highlightRightSelection;q.setHighlightRightSelection("false"!=h);var l=c.confirmDone;q.setConfirmDone("true"===l?!0:"false"===l?!1:g===CTATMsgType.HIDE_ALL_FEEDBACK);g=c.lockWidget;q.setHintPolicy(c.hintPolicy);q.setOutOfOrderMessage(c.outOfOrderMessage);e=e.createStateGraphMessage("false","false",g,q.isFeedbackSuppressed(),h,String(q.getConfirmDone()),
[]);h=[];f(a);a.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd());a.push(b.createLockWidgetMsg(c.lockWidget));a.unshift(e);d(a);h.push("<message><verb>SendNoteProperty</verb><properties><MessageType>StartStateEnd</MessageType></properties></message>");M.canRestore()||h.push(b.createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));q.sendBundle(h);q.enqueueForRestore();q.startWorking()},function(a){console.log("error starting nools engine: "+a)},CTATConfiguration.get("use_backtracking"))};
this.setConfirmDone=function(a){S=a};this.getConfirmDone=function(){return S};this.addGraphSkills=function(a){q.ctatdebug("adding graph skills: "+a.length);0<a.length&&(a=new CTATSkills(a),a.setExternallyDefined(!1),q.getProblemSummary().setSkills(a))};this.getGraphSkills=function(){var a=q.getProblemSummary().getSkills();return a?a.getAllSkills():[]};this.sendBundle=function(a){q.ctatdebug("sending bundle #msgs = "+a.length+", outputStatus "+M);for(var b=0,c=0;c<a.length;c++){q.ctatdebug("Sending message #"+
c);var d=a[c];0>=c&&(d='<?xml version="1.0" encoding="UTF-8"?>'+d);Q.forwardToInterface(d,c>=a.length-1,M)&&++b}return 0<b};this.getHintPolicy=function(){return J};this.setHintPolicy=function(a){J=CTATHintPolicyEnum.lookup(a)};this.isHighlightRightSelection=function(){return O};this.setHighlightRightSelection=function(a){O=a};this.updateSkills=function(a,b,c,d){var e=[];q.ctatdebug("in updateSkills("+b+") with step ID = "+c+", transaction result = "+a+", outputStatus "+q.getOutputStatus()+", actor "+
d);if(!q.getOutputStatus().countForProblemSummary()||d&&!/^(student)?$/i.test(d))return e;var f=q.getProblemSummary().getSkills();if(!f)return e;b.forEach(function(b){(b=f.updateSkill(a,b,c))&&e.push(b)});return e};this.getSessionID=function(){return ja};this.getProblemSummary=function(a){q.ctatdebug("Entering getProblemSummary() problemSummary "+D);if(null===D||"undefined"===typeof D){var b=q.getProblemName();D=null===b||"undefined"===typeof b||1>b.length?new CTATProblemSummary("NoProblemDefined",
null,q.isFeedbackSuppressed()):new CTATProblemSummary(b,null,q.isFeedbackSuppressed())}a&&D.setRequiredSteps(a.countStepsForScore(G));return D};this.getProblemName=function(){return P};this.getSourceID=function(){return T};this.isSourceFlash=function(){return"string"==typeof T&&T.match(/flash/i)};this.isFeedbackSuppressed=function(){return L};this.setFeedbackSuppressed=function(a){L="false"===a?!1:"true"===a?!0:a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?
!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;q.ctatdebug("setFeedbackSuppressed("+a+"): "+L);D&&D.setCountOnlyLastResults(L)};this.getSkillBarVector=function(a,b){var c=q.getProblemSummary().getSkills();return null===c||"undefined"===typeof c?null:"Student"!=w(b)?null:"undefined"!=typeof a&&a?c.getSkillBarVector(!1,!1):c.getSkillBarVector(!0,!0)};this.startSkillTransaction=function(){var a=q.getProblemSummary().getSkills();a&&a.startTransaction()};this.getProblemStateSaver=function(){return Q};this.isSendingSavedMsgsForRestore=
function(){return q.getOutputStatus().isSendingSavedMsgsForRestore()};this.getOutputStatus=function(){return M};this.setOutputStatus=function(a){var b=M.getStatus();q.ctatdebug("setOutputStatus() old "+b+", new "+a);CTATProblemStateStatus[a]?M.setStatus(CTATProblemStateStatus[a]):(console.error("CTATExampleTracer.setOutputStatus() unexpected argument "+a),M.setStatus(CTATProblemStateStatus.empty))};this.getFeedbackPolicy=function(){return G?G.getFeedbackPolicy():CTATMsgType.SHOW_ALL_FEEDBACK};this.getGraph=
function(){return G};this.getTracer=function(){return C};this.getRuleTracer=function(){return A};this.getOutOfOrderMessage=function(){return I?I:CTATMsgType.DEFAULT_OUT_OF_ORDER_MESSAGE};this.setOutOfOrderMessage=function(a){I=a};this.getDelayedFeedback=function(){null==ea&&(ea={});return ea};this.clearDelayedFeedback=function(){ea=null};this.getQuestionFile=function(a){if(!F||a)return F;a=F.split("/");return a[a.length-1]};this.addTPAToMessageTank=function(a,b,c,d){q.messageTank.enqueueToolActionToStudent(a,
b,c,d)}};CTATExampleTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracer.prototype.constructor=CTATExampleTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracer);
